import{d as W,c as j,b as S,w as z,r as A,e as n,o as y,x as K,k as e,g as r,j as t,l as d,A as M,f as k,F as Q,z as J,u as B,B as $,n as q,ai as u}from"./element-plus.59ccb443.js";import{W as F}from"./jointPrepare.318e4ddb.js";import{R as v}from"./WorkerInfoDialog.898a9f84.js";const G={class:"batch-run-dialog"},H={key:0,class:"item-wrap"},L={key:0,class:"item-wrap"},X=r("div",null,"启用后，设置的运行开始节点及其下游所有节点都将使用最新方案进行调度。",-1),Y=r("div",null,"若上游节点的方案参数和算法版本有变化，可能导致运行失败",-1),Z={class:"item-wrap"},ee={class:"item-wrap",style:{position:"relative"}},te={class:"dialog-footer"},se=W({__name:"BatchRerunDialog",props:{visible:{type:Boolean,default:!1},selectIds:{default:()=>[]},hideNewSchema:{type:Boolean,default:!1},setPriorityIds:{default:()=>[]}},emits:["update:visible","success"],setup(I,{emit:U}){const b=U,p=I,h=j(()=>{var o;return((o=p.setPriorityIds)==null?void 0:o.length)!==0}),g=S(),f=S(!1),c=S(!1);z(()=>p.visible,o=>{f.value=o});const s=A({editData:{useNewSchema:!1,priority:2,mode:v.NOTSUCCESS}});function P(){s.editData={useNewSchema:!1,priority:2,mode:v.NOTSUCCESS},q(()=>{var o;(o=g.value)==null||o.clearValidate()})}function w(){b("update:visible",!1)}function E(o){return new Promise((a,l)=>{o.value?o.value.validate(m=>{a(m)}):a(!1)})}function V(){if(h.value){const a={workerIds:[...p.setPriorityIds],priority:s.editData.priority};c.value=!0,F.updateWorkerPriority(a).then(l=>{l.code==="0000"?(u({type:"success",title:"设置优先级成功"}),b("success"),w()):u({type:"warning",title:"设置优先级失败，请重试"})}).catch(l=>{u({type:"error",title:"设置优先级错误",message:l.message||"服务有错"})}).finally(()=>{c.value=!1})}else E(g).then(o=>{if(o){const a=p.selectIds.map(l=>({id:l,useNewSchema:s.editData.useNewSchema,priority:s.editData.priority,mode:s.editData.mode}));c.value=!0,F.rerunWorker(a).then(l=>{l.code==="0000"?(u({type:"success",title:"重新运行成功"}),b("success"),w()):u({type:"warning",title:"重新运行失败，请重试"})}).catch(l=>{u({type:"error",title:"重新运行错误",message:l.message||"服务有错"})}).finally(()=>{c.value=!1})}})}return(o,a)=>{const l=n("el-radio"),m=n("el-radio-group"),_=n("el-form-item"),R=n("el-checkbox"),D=n("QuestionFilled"),N=n("el-icon"),C=n("el-tooltip"),T=n("el-form"),x=n("el-button"),O=n("el-dialog");return y(),K(O,{modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=i=>f.value=i),class:"center-dialog",title:h.value?"批量设置优先级":"批量重新运行","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"440px",onOpen:P,onClosed:w},{footer:e(()=>[r("span",te,[t(x,{onClick:a[4]||(a[4]=i=>f.value=!1)},{default:e(()=>[d("取 消")]),_:1}),t(x,{type:"primary",loading:c.value,onClick:V},{default:e(()=>[d(" 确 定 ")]),_:1},8,["loading"])])]),default:e(()=>[r("div",G,[t(T,{ref_key:"editFormRef",ref:g,class:"edit-form",inline:"",model:s.editData,"label-width":"150px","label-position":"right",onKeyup:M(V,["enter"])},{default:e(()=>[h.value?(y(),k("div",H,[t(_,{label:"任务优先级：",prop:"priority"},{default:e(()=>[t(m,{modelValue:s.editData.priority,"onUpdate:modelValue":a[0]||(a[0]=i=>s.editData.priority=i)},{default:e(()=>[t(l,{label:2},{default:e(()=>[d("高")]),_:1}),t(l,{label:1},{default:e(()=>[d("中")]),_:1}),t(l,{label:0},{default:e(()=>[d("低")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):(y(),k(Q,{key:1},[o.hideNewSchema?J("",!0):(y(),k("div",L,[t(_,{label:"使用最新方案：",prop:"useNewSchema"},{default:e(()=>[t(R,{modelValue:s.editData.useNewSchema,"onUpdate:modelValue":a[1]||(a[1]=i=>s.editData.useNewSchema=i)},null,8,["modelValue"]),t(C,{class:"item",effect:"dark",placement:"top"},{content:e(()=>[X,Y]),default:e(()=>[t(N,{style:{"margin-left":"12px"}},{default:e(()=>[t(D)]),_:1})]),_:1})]),_:1})])),r("div",Z,[t(_,{label:"任务优先级：",prop:"priority"},{default:e(()=>[t(m,{modelValue:s.editData.priority,"onUpdate:modelValue":a[2]||(a[2]=i=>s.editData.priority=i)},{default:e(()=>[t(l,{label:2},{default:e(()=>[d("高")]),_:1}),t(l,{label:1},{default:e(()=>[d("中")]),_:1}),t(l,{label:0},{default:e(()=>[d("低")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),r("div",ee,[t(_,{label:"运行开始位置：",prop:"mode"},{default:e(()=>[t(m,{modelValue:s.editData.mode,"onUpdate:modelValue":a[3]||(a[3]=i=>s.editData.mode=i),class:"mode-group"},{default:e(()=>[r("div",null,[t(l,{label:B(v).NOTSUCCESS},{default:e(()=>[d(" 从非成功节点开始运行 ")]),_:1},8,["label"]),t(C,{class:"item",effect:"dark",placement:"top"},{content:e(()=>[r("div",null,$(o.hideNewSchema?"":"不使用最新方案且")+"状态为成功的任务，将默认从起始节点开始重新运行 ",1)]),default:e(()=>[t(N,{style:{"font-size":"14px"}},{default:e(()=>[t(D)]),_:1})]),_:1})]),r("div",null,[t(l,{label:B(v).FIRST},{default:e(()=>[d("从起始节点开始运行")]),_:1},8,["label"])])]),_:1},8,["modelValue"])]),_:1})])],64))]),_:1},8,["model"])])]),_:1},8,["modelValue","title"])}}});export{se as _};
