import{d as ne,S as De,b,r as re,e as s,o as u,x as D,k as o,g as y,j as l,l as T,f as q,F as de,y as ce,ak as H,aj as ie,c as be,w as Te,N as xe,n as le,T as Ee,R as oe,t as we,v as ke,u as F,$ as Ve,a0 as Re,z as $,a1 as Ae,U as Se,B as Ke,ad as se,A as Oe,ai as R}from"./element-plus.59ccb443.js";import{q as z}from"./lodash.22f463b4.js";import{E as Ue}from"./login.a4e9287e.js";import{n as Be,o as Ie,p as Fe,q as $e,r as Le,t as Me,v as Ne,w as Pe,l as je,x as Ge,y as ze,z as qe,B as He,C as Je,D as Qe,E as We,F as Xe,G as Ze,H as Ye,I as et,J as tt,K as at,L as lt,N as ot,O as st,P as it,Q as nt,R as rt,T as dt,U as ct,V as ut,W as pt,X as ft,c as mt,m as yt}from"./index-a95bb620.js";import{D as m,d as gt}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{_ as _t}from"./error.229cea25.js";const Ct={class:"previewTree"},vt={class:"dialog-footer"},ht=ne({__name:"importTree",props:{modelValue:{type:Boolean},type:{default:"RESOURCE"},parentId:{}},emits:["update:modelValue","success"],setup(J,{emit:Q}){const x=J,S={RESOURCE:Be,FILE:Ie,GRAPHPLATFORM:Fe,RESOURCESET:$e,SERVICE:Le}[x.type],{modelValue:p}=De(x),E=b(p),w=b([]),K={children:"children",label:"name"},f=Q;function e(){f("success"),f("update:modelValue",!1)}const W=b([]);async function O(){const g=await Me({page:1,rows:9999999});g.success&&(W.value=g.data.records)}O();const h=re({classificationId:"",parentId:"",isCover:!1});async function X(g){const _=await Ne({classificationId:g});_.success&&(w.value=_.data)}function k(){H.confirm("覆盖方式会把当前已有目录内容全部迁移到默认目录，请谨慎操作！","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await S({classificationId:h.classificationId,isCover:!0})).success&&(e(),ie({type:"success",message:"导入成功"}))})}function Z(){H.confirm("追加会把当前已有目录内容追加到当前选中的目录！","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{console.log(x.parentId),(await S({classificationId:h.classificationId,parentId:x.parentId,isCover:!1})).success&&(e(),ie({type:"success",message:"导入成功"}))})}return(g,_)=>{const L=s("el-option"),Y=s("el-select"),M=s("el-form-item"),ee=s("el-tree"),N=s("el-form"),U=s("el-button"),B=s("el-dialog");return u(),D(B,{modelValue:E.value,"onUpdate:modelValue":_[1]||(_[1]=C=>E.value=C),title:"导入目录",width:"380px",onClosed:e},{footer:o(()=>[y("span",vt,[l(U,{onClick:e},{default:o(()=>[T("取 消")]),_:1}),l(U,{type:"primary",onClick:k},{default:o(()=>[T(" 覆盖 ")]),_:1}),l(U,{type:"primary",onClick:Z},{default:o(()=>[T(" 追加 ")]),_:1})])]),default:o(()=>[l(N,{model:h,"label-width":"120px"},{default:o(()=>[l(M,{label:"资源目录："},{default:o(()=>[l(Y,{modelValue:h.classificationId,"onUpdate:modelValue":_[0]||(_[0]=C=>h.classificationId=C),style:{width:"100%"},placeholder:"选择资源目录",clearable:"",onChange:X},{default:o(()=>[(u(!0),q(de,null,ce(W.value,C=>(u(),D(L,{key:C.id,label:C.name,value:C.id},null,8,["label","value"]))),128)),l(L,{label:"Zone two",value:"beijing"})]),_:1},8,["modelValue"])]),_:1}),l(M,{label:"预览目录：",style:{width:"100%"}},{default:o(()=>[y("div",Ct,[l(ee,{data:w.value,props:K,style:{width:"100%"}},null,8,["data"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});const Dt=_t(ht,[["__scopeId","data-v-ae00ac36"]]),bt={class:"common-tree__header"},Tt={class:"common-tree__checkbox"},xt={key:0,class:"db-node__toolbar"},Et={class:"classify-data"},wt={class:"item-wrap"},kt={class:"item-wrap"},Vt={class:"item-wrap"},Rt={class:"dialog-footer"},It=ne({__name:"CatalogTree",props:{type:{default:"RESOURCE"},editable:{type:Boolean,default:!0}},emits:["change"],setup(J,{expose:Q,emit:x}){const A=x,S=b(),p=J,E=Pe(),w=je(),K=b(),f=b(),e=re({isLoadingTree:!0,classifyTreeData:[],filterText:"",treeProps:{label:"name",children:"children"},defaultExpandedkeys:[],curActiveKey:"#",checkAll:!0,selectText:"所有数据",dialogType:m.ADD,curClassifyData:{},dialogVisible:!1,submiting:!1,defaultData:{name:"",pid:"#",description:""},editData:{},rules:{name:[{required:!0,message:"目录名称不能为空",trigger:["change","blur"]},{min:0,max:10,message:"长度在 10 个字符以内",trigger:["blur","change"]}],pid:[{required:!0,message:"上级目录不能为空",trigger:["change"]}]}}),O={RESOURCE:{getData:Ge,add:ze,modify:qe,delete:He},FILE:{getData:Je,add:Qe,modify:We,delete:Xe},GRAPHPLATFORM:{getData:Ze,add:Ye,modify:et,delete:tt},RESOURCESET:{getData:at,add:lt,modify:ot,delete:st},SERVICE:{getData:it,add:nt,modify:rt,delete:dt},METATEMPLATE:{getData:ct,add:ut,modify:pt,delete:ft}}[p.type],h=be(()=>{if(e.classifyTreeData.length===0)return[{value:"#",label:"/"}];{let a=[{value:"#",label:"/",idx:0}];const t=(n,c,I)=>{n.forEach(r=>{var V;const P=r.pid==="#"?r.name:`${c} / ${r.name}`,j=r.pid==="#"?1:I;a.push({value:r.id,label:P,idx:j}),((V=r==null?void 0:r.children)==null?void 0:V.length)>0&&t(r.children,P,j+1)})},d=z.cloneDeep(e.classifyTreeData).filter(n=>!n.isDefault);return t(d,"",1),e.dialogType===m.EDIT&&(a=a.filter(n=>n.value!==e.editData.id)),a=a.filter(n=>n.idx<=3),a}});Te(()=>e.filterText,a=>{f.value.filter(a)}),xe(()=>{k()});function X(a){if(a)e.curActiveKey="#",f.value.setCurrentKey(null),e.selectText="所有数据",A("change",e.curActiveKey);else{const t=e.classifyTreeData.find(d=>d.isDefault);e.curActiveKey=t.id,f.value.setCurrentKey(e.curActiveKey),e.selectText=t.name,A("change",e.curActiveKey)}}async function k(a=!1){e.isLoadingTree=!0;const t=await O.getData();e.isLoadingTree=!1,t.code==="0000"&&(e.classifyTreeData=z.cloneDeep(t.data)||[],p.type==="RESOURCE"?E.setClassifyTreeData(e.classifyTreeData):p.type==="FILE"&&w.setClassifyTreeData(e.classifyTreeData),a?le(()=>{e.curActiveKey=e.classifyTreeData[0].id,f.value.setCurrentKey(e.curActiveKey),A("change",e.curActiveKey),e.selectText=e.classifyTreeData[0].name}):le(()=>{f.value.setCurrentKey(e.curActiveKey)}))}function Z(){e.curClassifyData={pid:"#"},e.dialogType=m.ADD,e.dialogVisible=!0}function g(a,t,d){return a?mt(a,t,d,e.treeProps.label):!0}function _(a,t){a&&(e.curActiveKey=a.id,e.selectText=a.name,e.checkAll=!1,f.value.setCurrentKey(e.curActiveKey),A("change",e.curActiveKey),p.type==="RESOURCE"?E.setCatalogObj(oe(a)):p.type==="FILE"&&w.setFileCatalogObj(oe(a)))}function L(a){e.curClassifyData={pid:a.id},e.dialogType=m.ADD,e.dialogVisible=!0}function Y(a){e.curClassifyData=z.cloneDeep(a),e.dialogType=m.EDIT,e.dialogVisible=!0}function M(a){yt.getDataPageList({keyword:"",status:"",dataType:"",dataFormat:"",rows:1,page:1,catalogId:a.id}).then(t=>{var n,c;let d=!1;if(t.code==="0000"&&((c=(n=t.data)==null?void 0:n.records)==null?void 0:c.length)===0&&(d=!0),d){const I=`删除【${a[e.treeProps.label]}】目录，是否继续？`;H.confirm(I,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{O.delete(a.id).then(r=>{r.code==="0000"?(R({type:"success",title:"删除成功"}),k(e.curActiveKey===a.id)):R({type:"error",title:"删除失败"})}).catch(r=>{R({type:"error",title:"删除失败",message:r.message||"服务连接有错"})})}).catch(()=>{})}else H.alert("请先移除当前目录下的所有数据！","提示",{confirmButtonText:"确定",type:"warning"})}).catch(()=>{})}function ee(){e.dialogType===m.ADD?(e.editData=z.cloneDeep(e.defaultData),e.editData.pid=e.curClassifyData.pid):e.dialogType===m.EDIT&&(e.editData={...e.curClassifyData}),le(()=>{K.value.clearValidate()})}function N(){K.value.validate(a=>{if(a){const t=e.dialogType===m.ADD?"新增":"编辑",d=e.dialogType===m.ADD?"add":"modify",n={...e.editData,jobType:p.type};e.dialogType!==m.ADD&&(delete n.children,delete n.level),e.submiting=!0,O[d](n).then(c=>{e.submiting=!1,c.code==="0000"?(R({type:"success",title:`${t}目录成功`}),e.dialogVisible=!1,k()):R({type:"error",title:`${t}目录失败`,message:c.message})}).catch(c=>{e.submiting=!1,R({type:"error",title:`${t}目录失败`,message:c.message})})}})}const U=()=>{e.filterText=""},B=b(!1);function C(){B.value=!0}return Q({resetFilter:U,treeDomRef:S}),Ee(()=>{p.type==="RESOURCE"?E.setCatalogObj(oe(null)):p.type==="FILE"&&w.setFileCatalogObj(null)}),(a,t)=>{const d=s("el-input"),n=s("el-button"),c=s("el-dropdown-item"),I=s("el-dropdown-menu"),r=s("el-dropdown"),P=s("el-checkbox"),j=s("circle-plus"),V=s("ElIcon"),te=s("ElTooltip"),ue=s("Edit"),pe=s("Delete"),fe=s("el-scrollbar"),ae=s("el-form-item"),me=s("el-option"),ye=s("el-select"),ge=s("el-form"),_e=s("el-dialog"),Ce=we("loading");return ke((u(),q("div",{ref_key:"treeDomRef",ref:S,class:"dbase-tree","element-loading-text":"拼命加载中..."},[y("div",bt,[l(d,{modelValue:e.filterText,"onUpdate:modelValue":t[0]||(t[0]=i=>e.filterText=i),placeholder:"请输入关键字搜索","prefix-icon":F(Ve),clearable:""},null,8,["modelValue","prefix-icon"]),a.editable?(u(),D(r,{key:0},{dropdown:o(()=>[l(I,null,{default:o(()=>[l(c,{onClick:Z},{default:o(()=>[T("新增")]),_:1}),l(c,{onClick:C},{default:o(()=>[T("导入")]),_:1})]),_:1})]),default:o(()=>[l(n,{class:"common-tree__header-btn",type:"primary",icon:F(Re),plain:""},null,8,["icon"])]),_:1})):$("",!0)]),y("div",Tt,[l(P,{modelValue:e.checkAll,"onUpdate:modelValue":t[1]||(t[1]=i=>e.checkAll=i),label:"查看所有",size:"large",onChange:t[2]||(t[2]=i=>X(e.checkAll))},null,8,["modelValue"])]),l(fe,{class:"common-tree__wrapper"},{default:o(()=>[l(F(Ae),{ref_key:"treeRef",ref:f,data:e.classifyTreeData,props:e.treeProps,"node-key":"id","empty-text":"暂无数据","default-expand-all":"","default-expanded-keys":e.defaultExpandedkeys,"highlight-current":"","current-node-key":e.curActiveKey,"expand-on-click-node":!1,"filter-node-method":g,onCurrentChange:_},{default:o(({node:i,data:v})=>[l(F(Ue),{"custom-class":"db-node__content",text:i.label},{content:o(({setSlotRef:ve,ellipsis:he})=>[y("div",{ref:G=>ve(G),class:Se({"db-text__ellipsis":he,"db-node__label":!0})},Ke(i.label),3),a.editable&&e.curActiveKey===v.id?(u(),q("div",xt,[l(te,{content:"添加子目录",placement:"bottom",effect:"light","show-after":350},{default:o(()=>[!v.isDefault&&v.level<4?(u(),D(V,{key:0,size:"16",color:"var(--el-color-primary)",onClick:se(G=>L(v),["stop"])},{default:o(()=>[l(j)]),_:2},1032,["onClick"])):$("",!0)]),_:2},1024),l(te,{content:"编辑",placement:"bottom",effect:"light","show-after":350},{default:o(()=>[v.isDefault?$("",!0):(u(),D(V,{key:0,size:"16",color:"var(--el-color-primary)",onClick:se(G=>Y(v),["stop"])},{default:o(()=>[l(ue)]),_:2},1032,["onClick"]))]),_:2},1024),l(te,{content:"删除",placement:"bottom",effect:"light","show-after":350},{default:o(()=>[v.isDefault?$("",!0):(u(),D(V,{key:0,size:"16",color:"var(--el-color-danger)",onClick:se(G=>M(v),["stop"])},{default:o(()=>[l(pe)]),_:2},1032,["onClick"]))]),_:2},1024)])):$("",!0)]),_:2},1032,["text"])]),_:1},8,["data","props","default-expanded-keys","current-node-key"])]),_:1}),l(_e,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=i=>e.dialogVisible=i),class:"center-dialog",title:(F(gt).get(e.dialogType)||"新增")+"目录","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"500px",onOpen:ee,onClosed:t[8]||(t[8]=i=>e.dialogVisible=!1)},{footer:o(()=>[y("span",Rt,[l(n,{onClick:t[6]||(t[6]=i=>e.dialogVisible=!1)},{default:o(()=>[T("取 消")]),_:1}),l(n,{type:"primary",loading:e.submiting,onClick:N},{default:o(()=>[T(" 确 定 ")]),_:1},8,["loading"])])]),default:o(()=>[y("div",Et,[l(ge,{ref_key:"editForm",ref:K,class:"edit-form",inline:"",model:e.editData,rules:e.rules,"label-width":"100px","label-position":"right",onKeyup:Oe(N,["enter"])},{default:o(()=>[y("div",wt,[l(ae,{label:"目录名称：",prop:"name"},{default:o(()=>[l(d,{modelValue:e.editData.name,"onUpdate:modelValue":t[3]||(t[3]=i=>e.editData.name=i),type:"text",placeholder:"请输入目录名称",maxlength:"10","show-word-limit":""},null,8,["modelValue"])]),_:1})]),y("div",kt,[l(ae,{label:"上级目录：",prop:"pid"},{default:o(()=>[l(ye,{modelValue:e.editData.pid,"onUpdate:modelValue":t[4]||(t[4]=i=>e.editData.pid=i),placeholder:"请选择上级目录",style:{width:"100%"}},{default:o(()=>[(u(!0),q(de,null,ce(h.value,i=>(u(),D(me,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),y("div",Vt,[l(ae,{label:"描述：",prop:"description"},{default:o(()=>[l(d,{modelValue:e.editData.description,"onUpdate:modelValue":t[5]||(t[5]=i=>e.editData.description=i),type:"textarea",placeholder:"请输入描述",clearable:"",rows:6,maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})])]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"]),l(Dt,{modelValue:B.value,"onUpdate:modelValue":t[9]||(t[9]=i=>B.value=i),type:a.type,"parent-id":e.curActiveKey,onSuccess:k},null,8,["modelValue","type","parent-id"])])),[[Ce,e.isLoadingTree]])}}});export{It as _};
