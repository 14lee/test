import{w as Se,l as Ee,S as Pe,A as ke,m as se,h as Fe,Y as Me,Z as Ie,_ as je,$ as Ye,a0 as We,j as Ge,k as Ze}from"./index-a95bb620.js";import{v as ye,q as re}from"./lodash.22f463b4.js";import{d as _e,b as q,c as me,r as ue,w as ce,e as p,o as n,x as L,k as t,g as s,j as a,l as N,u as w,n as fe,ai as Q,f as C,F as ae,y as ie,a0 as Je,D as Xe,z as Z,aj as de,ak as De,N as we,bc as Qe,L as ze,t as xe,B,bJ as ea,bn as aa,bE as ta,v as he,U as ge,$ as $e,b1 as la,bK as oa,ad as na,a6 as Re,bL as ia,ae as Ve,Z as sa,_ as ra}from"./element-plus.59ccb443.js";import{o as da,a as ua,r as Ne,v as Be,D as ca,x as Oe,z as pa}from"./login.a4e9287e.js";import{D as X,d as ma,e as fa,S as ga}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{D as _a}from"./index.533bb29b.js";import{A as Te}from"./datasourceManage.013f4c4a.js";import{u as ba}from"./useTableAndPagination.0c6e0294.js";import{u as ya,t as qe,d as ha,A as He,k as va}from"./useTemplateData.bd428139.js";import{_ as Ke}from"./error.229cea25.js";import{_ as Da}from"./CatalogTree.vue_vue_type_script_setup_true_lang.900e7dde.js";const Ca={class:"data-source-choose"},Va={class:"item-wrap"},wa={class:"dialog-footer"},Vo=_e({__name:"MoveDataDialog",props:{visible:{type:Boolean,default:!1},resourceIds:{default:()=>[]},isFile:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(G,{emit:te}){const v=G,H=te,y=q(),U=Se(),e=Ee(),V=me(()=>v.isFile?e.classifyTreeData:U.classifyTreeData),o=ue({dialogVisible:!1,submiting:!1,form:{catalogObj:null},rules:{catalogObj:[{required:!0,message:"请选择所属目录",trigger:"change"}]},treeProps:{label:"name",children:"children",disabled:"no"},treeValueKey:"id"});ce(()=>v.visible,M=>{o.dialogVisible=M});function le(){o.form.catalogObj=null,fe(()=>{var M;(M=y.value)==null||M.clearValidate()})}function l(){H("update:visible",!1)}function _(){y.value.validate(M=>{M&&(o.submiting=!0,(v.isFile?ke.moveResourcesByCatalogId:se.moveResourcesByCatalogId)(o.form.catalogObj.id,v.resourceIds).then(F=>{o.submiting=!1,F.code==="0000"?(Q({type:"success",title:"批量移动成功"}),l(),H("save")):Q({type:"error",title:"批量移动失败",message:F.message})}).catch(F=>{o.submiting=!1,Q({type:"error",title:"批量移动失败",message:F.message})}))})}return(M,u)=>{const F=p("el-form-item"),P=p("el-form"),I=p("el-button"),D=p("el-dialog");return n(),L(D,{modelValue:o.dialogVisible,"onUpdate:modelValue":u[2]||(u[2]=A=>o.dialogVisible=A),class:"center-dialog",title:"批量移动","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"500px",onOpen:le,onClosed:l},{footer:t(()=>[s("span",wa,[a(I,{onClick:u[1]||(u[1]=A=>o.dialogVisible=!1)},{default:t(()=>[N("取 消")]),_:1}),a(I,{type:"primary",loading:o.submiting,onClick:_},{default:t(()=>[N("确 定")]),_:1},8,["loading"])])]),default:t(()=>[s("div",Ca,[a(P,{ref_key:"formRef",ref:y,class:"edit-form",inline:"",model:o.form,rules:o.rules,"label-width":"120px","label-position":"right"},{default:t(()=>[s("div",Va,[a(F,{label:"所属目录：",prop:"catalogObj"},{default:t(()=>[a(w(Pe),{modelValue:o.form.catalogObj,"onUpdate:modelValue":u[0]||(u[0]=A=>o.form.catalogObj=A),"tree-props":o.treeProps,"tree-data":V.value,"value-key":o.treeValueKey,style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data","value-key"])]),_:1})])]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}});const ka={class:"set-property"},Ta={class:"item-wrap"},Ia={class:"item-wrap"},xa={class:"item-wrap"},Na={class:"item-wrap"},Oa=["accept"],La={class:"item-wrap"},$a={class:"item-wrap",style:{"margin-bottom":"10px"}},Sa={class:"item-wrap"},Ea=s("div",{style:{height:"2px"}},null,-1),Pa={key:0,class:"item-wrap"},Fa={class:"item-wrap"},Ua={class:"dialog-footer"},Aa=_e({__name:"SettingPropertyDialog",props:{visible:{type:Boolean,default:!1},resourceData:{default:()=>{}}},emits:["update:visible","update"],setup(G,{emit:te}){const v=G,H=te,y=q(),U=q(),e=ue({dialogVisible:!1,submiting:!1,uniqueIdName:"sgeoc_guid",initData:{dataSourceType:"LOCAL",datasourceId:"",tableName:"",fileName:"",tableAlias:"",targetName:"",gbk:!1,sourceColumn:"",targetColumn:""},editData:{},rules:{dataSourceType:[{required:!0,message:"请选择数据源类型",trigger:"change"}],datasourceId:[{required:!0,message:"请选择数据库",trigger:"change"}],tableName:[{required:!0,message:"请选择目标表",trigger:"change"}],fileName:[{required:!0,message:"请上传文件",trigger:"change"}],targetName:[{required:!0,message:"请输入目标表名",trigger:["change","blur"]},{validator(c,r,f){typeof r=="string"&&r.toLowerCase()!==r?f(new Error("请输入小写字母")):f()},trigger:"blur"}],sourceColumn:[{required:!0,message:"请选择源字段",trigger:["change","blur"]}],targetColumn:[{required:!0,message:"请选择目标字段",trigger:["change","blur"]}]},datasourceOptions:[],tableNameOptions:[],targetColumnOptions:[],sourceColumnOptions:[],file:null,hasDataSourceAuthority:!1}),V=me(()=>v.resourceData.dataType?["BIMMODEL","MODEL"].includes(v.resourceData.dataType):!1),o=me(()=>v.resourceData.dataType?["VECTOR"].includes(v.resourceData.dataType):!1);ce(()=>v.visible,c=>{e.dialogVisible=c});function le(){e.targetColumnOptions=[],e.sourceColumnOptions=[],e.tableNameOptions=[],e.file=null,e.editData=ye(e.initData),l(),fe(()=>{y.value.clearValidate()})}function l(){const{dataType:c,dataFormat:r}=v.resourceData;Te.getDatasourceEnum(!1,c,r).then(f=>{if(f.code==="0000"){const{data:b=[]}=f;e.hasDataSourceAuthority=b.length>0,e.datasourceOptions=b}else e.hasDataSourceAuthority=!1,e.datasourceOptions=[]}).catch(()=>{e.hasDataSourceAuthority=!1,e.datasourceOptions=[]})}function _(){e.editData.tableName="";const{dataType:c,dataFormat:r}=v.resourceData;Te.getFilterTablesList({datasourceId:e.editData.datasourceId,dataType:c,dataFormat:r}).then(f=>{if(f.code==="0000"){const{success:b=!1,tables:R=[]}=f.data;b?e.tableNameOptions=R.map(Y=>({value:Y,label:Y})):e.tableNameOptions=[]}else e.tableNameOptions=[],de({type:"error",message:"获取图层数据失败"})}).catch(()=>{e.tableNameOptions=[],de({type:"error",message:"获取图层数据失败"})})}function M(){I(),y.value.clearValidate()}function u(){H("update:visible",!1)}function F(){U.value.click()}function P(c){const{files:r}=c.target;if(r.length===0)return;const f=r[0],b=D(f.name);let R=!1;if(V.value?["csv","xls","xlsx","zip","db"].includes(b)&&(R=!0):o.value?["csv","xls","xlsx","zip"].includes(b)&&(R=!0):["zip"].includes(b)&&(R=!0),!R){De.alert("请选择规定类型的文件上传！","提示",{confirmButtonText:"确定",type:"error"}),c.target.value="";return}[,e.editData.fileName]=f.name.match(/(.*)\.[^.]+/),e.file=new File([f],f.name),I(),c.target.value=""}function I(){if(V.value||o.value){e.editData.targetColumn="",e.editData.sourceColumn="";const c=e.editData.dataSourceType==="LOCAL",r={resourceId:v.resourceData.resourceId,extensionType:e.editData.dataSourceType};c?r.file=e.file:(r.datasourceId=e.editData.datasourceId,r.tableName=e.editData.tableName);const f=new FormData;for(const b in r)f.append(b,r[b]);se.getConnectColumnList(f).then(b=>{if(b.code==="0000"){let R=b.data.targetColumns||[],Y=b.data.sourceColumns||[];R=R.filter(ee=>ee!==e.uniqueIdName),e.targetColumnOptions=R.map(ee=>({value:ee,label:ee})),Y=Y.filter(ee=>ee!==e.uniqueIdName),e.sourceColumnOptions=Y.map(ee=>({value:ee,label:ee}))}else e.targetColumnOptions=[],e.sourceColumnOptions=[],Q({type:"error",title:c?"文件读取失败":"数据库读取失败",message:b.message})}).catch(b=>{e.targetColumnOptions=[],e.sourceColumnOptions=[],Q({type:"error",title:c?"文件读取失败":"数据库读取失败",message:b.message})})}}function D(c){return c.replace(/.+\./,"")}function A(){y.value.validate(c=>{if(c){const r={resourceId:v.resourceData.resourceId,dataSourceType:e.editData.dataSourceType,tableName:e.editData.tableName};e.editData.dataSourceType==="LOCAL"?(r.file=e.file,r.tableName=`job_${e.editData.targetName}`,r.tableAlias=e.editData.tableAlias,r.gbk=e.editData.gbk):r.datasourceId=e.editData.datasourceId,V.value&&(r.targetColumn=e.editData.targetColumn),o.value&&(r.targetColumn=e.editData.targetColumn,r.sourceColumn=e.editData.sourceColumn);const f=new FormData;for(const b in r)f.append(b,r[b]);e.submiting=!0,se.addExtendProperties(f).then(b=>{e.submiting=!1,b.code==="0000"?(Q({type:"success",title:"属性表入库成功"}),u(),H("update")):Q({type:"error",title:"属性表入库失败",message:b.message})}).catch(b=>{e.submiting=!1,Q({type:"error",title:"属性表入库失败",message:b.message})})}})}return(c,r)=>{const f=p("el-divider"),b=p("el-radio"),R=p("el-radio-group"),Y=p("el-form-item"),ee=p("el-option"),k=p("el-select"),O=p("el-button"),h=p("el-input"),E=p("el-icon"),g=p("el-tooltip"),d=p("el-checkbox"),i=p("el-form"),x=p("el-dialog");return n(),L(x,{modelValue:e.dialogVisible,"onUpdate:modelValue":r[10]||(r[10]=m=>e.dialogVisible=m),class:"center-dialog set-property-dialog",title:"挂接属性设置","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"500px",onOpen:le,onClosed:u},{footer:t(()=>[s("span",Ua,[a(O,{onClick:r[9]||(r[9]=m=>e.dialogVisible=!1)},{default:t(()=>[N("取 消")]),_:1}),a(O,{type:"primary",loading:e.submiting,onClick:A},{default:t(()=>[N("确 定")]),_:1},8,["loading"])])]),default:t(()=>[s("div",ka,[a(i,{ref_key:"editForm",ref:y,class:"edit-form",inline:"",model:e.editData,rules:e.rules,"label-width":"120px","label-position":"right"},{default:t(()=>[a(f,{"content-position":"left"},{default:t(()=>[N("连接/导入属性表")]),_:1}),s("div",Ta,[a(Y,{label:"数据源类型：",prop:"dataSourceType"},{default:t(()=>[a(R,{modelValue:e.editData.dataSourceType,"onUpdate:modelValue":r[0]||(r[0]=m=>e.editData.dataSourceType=m),onChange:M},{default:t(()=>[a(b,{label:"LOCAL"},{default:t(()=>[N("本地文件")]),_:1}),a(b,{label:"REMOTE",disabled:!e.hasDataSourceAuthority},{default:t(()=>[N(" 数据库 ")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})]),e.editData.dataSourceType==="REMOTE"?(n(),C(ae,{key:0},[s("div",Ia,[a(Y,{label:"数据库名：",prop:"datasourceId"},{default:t(()=>[a(k,{modelValue:e.editData.datasourceId,"onUpdate:modelValue":r[1]||(r[1]=m=>e.editData.datasourceId=m),style:{width:"100%"},filterable:"",placeholder:"请选择数据库",onChange:_},{default:t(()=>[(n(!0),C(ae,null,ie(e.datasourceOptions,m=>(n(),L(ee,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),s("div",xa,[a(Y,{label:"目标表名：",prop:"tableName"},{default:t(()=>[a(k,{modelValue:e.editData.tableName,"onUpdate:modelValue":r[2]||(r[2]=m=>e.editData.tableName=m),style:{width:"100%"},filterable:"","no-data-text":"数据库连接失败或当前数据库查询目标表为空",placeholder:"请选择目标表",onChange:I},{default:t(()=>[(n(!0),C(ae,null,ie(e.tableNameOptions,m=>(n(),L(ee,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])],64)):(n(),C(ae,{key:1},[s("div",Na,[a(Y,{class:"fileName",label:"文件名：",prop:"fileName"},{default:t(()=>[a(h,{modelValue:e.editData.fileName,"onUpdate:modelValue":r[3]||(r[3]=m=>e.editData.fileName=m),placeholder:"请点击右侧按钮上传文件",readonly:""},{append:t(()=>[a(O,{icon:w(Je),onClick:F},{default:t(()=>[N("上传")]),_:1},8,["icon"])]),_:1},8,["modelValue"]),a(g,{class:"item",effect:"dark",content:V.value?"仅支持上传.csv、.excel、.db、.zip格式文件；shp文件使用zip压缩包上传":o.value?"仅支持上传.csv、.excel、.zip格式文件；shp文件使用zip压缩包上传":"仅支持上传.zip格式文件；shp文件使用zip压缩包上传",placement:"top"},{default:t(()=>[a(E,{class:"question"},{default:t(()=>[a(w(Xe))]),_:1})]),_:1},8,["content"])]),_:1}),s("input",{ref_key:"uploadFile",ref:U,style:{display:"none"},type:"file",class:"uploadFile",directory:"",nwdirectory:"",accept:V.value?".csv,.xls,.xlsx,.zip,.db":o.value?".csv,.xls,.xlsx,.zip":".zip",onChange:P},null,40,Oa)]),s("div",La,[a(Y,{label:"目标表名：",prop:"targetName"},{default:t(()=>[a(h,{modelValue:e.editData.targetName,"onUpdate:modelValue":r[4]||(r[4]=m=>e.editData.targetName=m),class:"prefixName"},{prefix:t(()=>[N("job_")]),_:1},8,["modelValue"])]),_:1})]),s("div",$a,[a(Y,{label:"表中文名：",prop:"tableAlias"},{default:t(()=>[a(h,{modelValue:e.editData.tableAlias,"onUpdate:modelValue":r[5]||(r[5]=m=>e.editData.tableAlias=m)},null,8,["modelValue"])]),_:1})]),s("div",Sa,[a(Y,{label:"编码：",prop:"gbk"},{default:t(()=>[a(d,{modelValue:e.editData.gbk,"onUpdate:modelValue":r[6]||(r[6]=m=>e.editData.gbk=m)},{default:t(()=>[N("GBK编码")]),_:1},8,["modelValue"])]),_:1})])],64)),V.value||o.value?(n(),C(ae,{key:2},[Ea,a(f,{"content-position":"left"},{default:t(()=>[N("连接字段设置")]),_:1}),o.value?(n(),C("div",Pa,[a(Y,{label:"源字段：",prop:"sourceColumn"},{default:t(()=>[a(k,{modelValue:e.editData.sourceColumn,"onUpdate:modelValue":r[7]||(r[7]=m=>e.editData.sourceColumn=m),style:{width:"100%"},filterable:"",placeholder:"请选择源字段"},{default:t(()=>[(n(!0),C(ae,null,ie(e.sourceColumnOptions,m=>(n(),L(ee,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):Z("",!0),s("div",Fa,[a(Y,{label:"目标字段：",prop:"targetColumn"},{default:t(()=>[a(k,{modelValue:e.editData.targetColumn,"onUpdate:modelValue":r[8]||(r[8]=m=>e.editData.targetColumn=m),style:{width:"100%"},filterable:"",placeholder:"请选择目标字段"},{default:t(()=>[(n(!0),C(ae,null,ie(e.targetColumnOptions,m=>(n(),L(ee,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])],64)):Z("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}});const Ra={class:"dialog-title"},Ba={class:"theme"},Ma={class:"property-info"},za={class:"dialog-footer"},qa=_e({__name:"PropertyInfoDialog",props:{visible:{type:Boolean,default:!1},resourceId:{default:""},isOuterProperty:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!0},resourceData:{default:()=>{}}},emits:["update:visible","update"],setup(G,{emit:te}){const v=G,H=te,y=q([]),U=q(),e=ue({dialogVisible:!1,fullscreen:!1,isLoadingAll:!1,isLoadingSaveBtn:!1,page:0,rows:200,tableData:[],maxHeight:200,searchForm:{},colDatas:[],editData:{targetTableName:"",sourceColumn:"",targetColumn:""},uniqueIdName:"sgeoc_guid",curEditItem:{id:"",propertyName:""},changeDataMap:new Map,isNoMore:!1});ce(()=>v.visible,h=>{e.dialogVisible=h});const V=me(()=>v.resourceData.dataType?["BIMMODEL","MODEL"].includes(v.resourceData.dataType):!1),o=me(()=>v.resourceData.dataType?["VECTOR"].includes(v.resourceData.dataType):!1),le=me(()=>re.keys(re.pickBy(e.searchForm)).length!==0),l={mounted(h,E){let g=0;const d=h.querySelector(".el-scrollbar__wrap");d==null||d.addEventListener("scroll",()=>{const i=d.scrollHeight-d.scrollTop===d.clientHeight,x=g===d.scrollTop;i&&!x&&d.scrollTop!==0&&E.value&&E.value(),x||(g=d.scrollTop)})}};we(()=>{fe(()=>{setTimeout(()=>{r()},200)}),da(window,"resize",r)}),Qe(()=>{y.value=[]}),ze(()=>{ua(window,"resize",r)});function _(){e.isLoadingAll=!0,u(),setTimeout(()=>{b(),r()},200)}function M(){e.tableData=[],H("update:visible",!1),e.colDatas=[]}function u(){e.fullscreen=!1,e.searchForm={},e.changeDataMap.clear(),e.tableData=[],e.page=1,e.isNoMore=!1}function F(){e.fullscreen=!e.fullscreen,r()}function P(){e.isNoMore||(e.page++,b())}function I(h){var E,g;(g=(E=y.value[h])==null?void 0:E.popperRef)==null||g.contentRef.querySelector(".el-input__inner").focus()}function D(){e.searchForm=re.mapValues(e.searchForm,()=>""),A()}function A(){e.changeDataMap.size>0?De.confirm("检测到存在未保存的修改记录，直接搜索将清除所有修改记录，是否保存后再搜索呢?","提示",{confirmButtonText:"保存后搜索",cancelButtonText:"直接搜索",type:"warning"}).then(()=>{O(()=>{c()})}).catch(()=>{c()}):c()}function c(){e.changeDataMap.clear(),e.page=1,e.tableData=[],e.isLoadingAll=!0,b(),U.value.$refs.bodyWrapper.scrollTop=0}function r(){if(e.fullscreen)e.maxHeight=document.body.offsetHeight-184-0;else{const E=Math.ceil(document.body.offsetHeight-document.body.offsetHeight/100*10*2);e.maxHeight=E-184-0}}async function f(h){var E;if(!h)e.colDatas=[{prop:"none_data_table",label:"属性"}];else if(((E=h.records)==null?void 0:E.length)>0){const g=h.records[0],d=re.keys(g).filter(i=>i!==e.uniqueIdName);e.colDatas=[],d.forEach(i=>{e.searchForm[i]="",e.colDatas.push({prop:i,label:i,minWidth:i.length*8+100})}),y.value=[],await fe(),e.searchForm={...e.searchForm}}else e.colDatas=[{prop:"none_data_table",label:"属性"}]}function b(h=e.searchForm,E={},g=null){h=re.pickBy(h,j=>j);const{resourceId:d=v.resourceId,page:i=e.page,rows:x=e.rows}=E,m=v.isOuterProperty?"getExtendProperties":"getProperties";se[m](h,{resourceId:d,page:i,rows:x}).then(j=>{if(f(j.data),j.code==="0000")if(g&&g instanceof Function)g(j.data);else{if(e.isNoMore=j.data.records.length<e.rows,e.tableData=e.tableData.concat(j.data.records),e.isNoMore){const K=re.cloneDeep(e.tableData[0]);K[e.uniqueIdName]="no-more-data",e.tableData.push(K)}e.isLoadingAll=!1}else g&&g instanceof Function&&g(null),e.isLoadingAll=!1}).catch(()=>{e.isLoadingAll=!1,g&&g instanceof Function&&g(null)})}function R({row:h,column:E,columnIndex:g}){if(h[e.uniqueIdName]==="no-more-data")return g===0?(e.tableData.forEach(i=>{i[e.uniqueIdName]==="no-more-data"&&(i[E.property]="没有更多数据了")}),[1,re.keys(h).length-1]):[0,0]}function Y(){}function ee(h,E){e.changeDataMap.set(h[e.uniqueIdName],h),e.tableData.forEach(g=>{g[e.uniqueIdName]===h[e.uniqueIdName]&&(g[E]=h[E])}),e.curEditItem.id="",e.curEditItem.propertyName=""}function k(){e.curEditItem.id="",e.curEditItem.propertyName=""}function O(h){const E=[];for(const d of e.changeDataMap.values())E.push(d);const g={};g.resourceId=v.resourceId,o.value&&(g.sourceColumn=e.editData.sourceColumn,g.targetColumn=e.editData.targetColumn),V.value&&(g.targetColumn=e.editData.targetColumn),e.isLoadingSaveBtn=!0,se.updateExtendProperties(E,g).then(d=>{h&&h instanceof Function&&h(),e.isLoadingSaveBtn=!1,d.code==="0000"?(Q({type:"success",title:"挂接属性修改成功！"}),H("update")):Q({type:"warning",title:"挂接属性修改失败，请重试"})}).catch(d=>{e.isLoadingSaveBtn=!1,Q({type:"error",title:"修改错误",message:d.message||"服务错误"})})}return(h,E)=>{const g=p("el-icon"),d=p("el-input"),i=p("el-popover"),x=p("el-table-column"),m=p("el-table"),j=p("el-button"),K=p("el-dialog"),J=xe("loading");return n(),L(K,{modelValue:e.dialogVisible,"onUpdate:modelValue":E[1]||(E[1]=$=>e.dialogVisible=$),class:"property-info-dialog","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,fullscreen:e.fullscreen,width:"80%",top:"10vh",onOpen:_,onClosed:M},{header:t(()=>[s("div",Ra,[s("span",Ba,B(h.isOuterProperty?"关联表信息":"源表信息"),1),a(g,{class:"fullIcon",title:e.fullscreen?"退出全屏":"全屏",onClick:F},{default:t(()=>[e.fullscreen?(n(),L(w(ea),{key:0})):(n(),L(w(aa),{key:1}))]),_:1},8,["title"])])]),footer:t(()=>[s("div",za,[a(j,{icon:w(ta),type:"primary",text:"",disabled:!le.value,onClick:D},{default:t(()=>[N(" 清空筛选条件 ")]),_:1},8,["icon","disabled"]),a(j,{onClick:E[0]||(E[0]=$=>e.dialogVisible=!1)},{default:t(()=>[N(" 关 闭 ")]),_:1})])]),default:t(()=>[he((n(),C("div",Ma,[he((n(),L(m,{ref_key:"table",ref:U,class:"property-table",height:e.maxHeight,data:e.tableData,"span-method":R,onCellDblclick:Y},{default:t(()=>[(n(!0),C(ae,null,ie(e.colDatas,$=>(n(),L(x,{key:$.prop,prop:$.prop,label:$.label,"min-width":$.minWidth,align:"center","label-class-name":"header-label"},{header:t(oe=>[s("span",null,B(oe.column.label),1),oe.column.property!=="none_data_table"?(n(),L(i,{key:0,ref_for:!0,ref:ne=>{ne&&(y.value[oe.$index]=ne)},placement:"bottom",width:"250",trigger:"click",onAfterEnter:ne=>I(oe.$index)},{reference:t(()=>[s("span",{class:ge(["search-icon",{isSearching:!!e.searchForm[oe.column.property]}])},[a(g,null,{default:t(()=>[a(w($e))]),_:1})],2)]),default:t(()=>[s("div",null,[a(d,{modelValue:e.searchForm[oe.column.property],"onUpdate:modelValue":ne=>e.searchForm[oe.column.property]=ne,class:"search-input",clearable:"",placeholder:"输入关键字搜索","prefix-icon":w($e),onChange:A},null,8,["modelValue","onUpdate:modelValue","prefix-icon"])])]),_:2},1032,["onAfterEnter"])):Z("",!0)]),default:t(oe=>[!h.isCheck&&oe.row[e.uniqueIdName]===e.curEditItem.id&&oe.column.property===e.curEditItem.propertyName?(n(),L(d,{key:0,ref_for:!0,ref:"edit-input",modelValue:oe.row[$.prop],"onUpdate:modelValue":ne=>oe.row[$.prop]=ne,placeholder:`请输入${oe.column.label}`,onChange:ne=>ee(oe.row,$.prop),onBlur:k},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])):(n(),C("span",{key:1,class:ge({"no-more":oe.row[e.uniqueIdName]==="no-more-data"})},B(oe.row[$.prop]),3))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["height","data"])),[[l,P]])])),[[J,e.isLoadingAll]])]),_:1},8,["modelValue","fullscreen"])}}});const Ha={style:{"margin-bottom":"5px"}},Ka={class:"dialog-footer"},ja=s("div",{class:"tips"},"说明：保存后，当前页面信息即刻生效",-1),Ya={class:"desc_box",style:{color:"#a8abb2"}},Wa={class:"desc_box",style:{color:"#a8abb2"}},Ga={class:"dialog-footer"},Za="PLPZSX",Ja=_e({__name:"PropertiesConfigDialog",props:{visible:{type:Boolean,default:!1},editPropertyItem:{default:()=>{}},tableData:{default:()=>[]}},emits:["update:visible","save","showBatchApply"],setup(G,{emit:te}){const v=G,H=te,y=ue({dialogVisible:!1,submiting:!1,modifyData:[],cloneData:[]}),U=q({id:"",type:"",name:""}),e=q(),V=q(),o=q(null);ce(()=>v.visible,k=>{y.dialogVisible=k});const le=me(()=>{const k=y.modifyData.length,O=y.modifyData.filter(h=>h.published).length;return k===O&&k!==0});function l(){y.modifyData=re.cloneDeep(v.tableData),y.cloneData=re.cloneDeep(y.modifyData),fe(()=>{M()}),R()}function _(){var k,O;(k=o.value)!=null&&k.el&&((O=o.value)==null||O.destroy()),y.modifyData=[],H("update:visible",!1)}function M(){var h;const O=((h=V.value)==null?void 0:h.querySelector(".sortableTable")).querySelector(".el-table__body-wrapper tbody");o.value=Fe.create(O,{disabled:!1,onEnd({newIndex:E,oldIndex:g}){const d=y.cloneData.splice(g,1)[0];y.cloneData.splice(E,0,d)}})}function u(){y.cloneData.forEach(k=>{var O,h;k.aliasName=(O=y.modifyData.find(E=>E.columnName===k.columnName))==null?void 0:O.aliasName,k.published=(h=y.modifyData.find(E=>E.columnName===k.columnName))==null?void 0:h.published}),y.submiting=!0,se.savePropertiesConfigList(re.cloneDeep(y.cloneData)).then(k=>{y.submiting=!1,k.code==="0000"?(Q({type:"success",title:"设置成功"}),H("save",re.cloneDeep(y.cloneData)),_()):Q({type:"error",title:"设置失败",message:k.message})}).catch(k=>{y.submiting=!1,Q({type:"error",title:"设置失败",message:k.message})})}const F=()=>{le.value?y.modifyData.forEach(k=>{k.published=!1}):y.modifyData.forEach(k=>{k.published=!0})},P=q(!1),I=ue({dictTypeId:"",dataSourceId:""}),D=q([]),A=q(null);async function c(){y.cloneData.forEach(O=>{var h,E;O.aliasName=(h=y.modifyData.find(g=>g.columnName===O.columnName))==null?void 0:h.aliasName,O.published=(E=y.modifyData.find(g=>g.columnName===O.columnName))==null?void 0:E.published}),(await se.savePropertiesConfigList(re.cloneDeep(y.cloneData))).success&&(H("save",re.cloneDeep(y.cloneData)),H("showBatchApply"),_())}function r(){P.value=!0}function f(){if(!A.value){de.warning("请选择字典!");return}P.value=!1,b()}function b(){var O,h;const k=((h=(O=A.value)==null?void 0:O.children)==null?void 0:h.filter(E=>E.isCatalogue===0))||[];y.modifyData.forEach(E=>{const g=k.find(d=>d.dictKey===E.columnName);g&&(E.aliasName=g.dictValue)})}async function R(){const k=await Me(),{success:O,data:h}=k;if(O){const E=h.businessList.find(g=>g.typeValue===Za);U.value.id=E.id,U.value.name=E.typeName,U.value.type=E.typeValue,I.dictTypeId=E.id}}async function Y(){const k=await Ie({pageNo:1,pageSize:9999,dictTypeId:I.dictTypeId}),{data:O,success:h}=k;if(h){const E=O.records||[];D.value=E.filter(g=>g.isCatalogue===1)}else D.value=[]}function ee(){const k=D.value.find(O=>O.id===I.dataSourceId);A.value=k||null}return ce(()=>I.dictTypeId,()=>{I.dictTypeId&&(I.dataSourceId="",A.value=null,D.value=[],Y())}),(k,O)=>{const h=p("el-button"),E=p("el-checkbox"),g=p("el-table-column"),d=p("el-input"),i=p("el-table"),x=p("el-dialog"),m=p("el-form-item"),j=p("el-option"),K=p("el-select"),J=p("el-form");return n(),C(ae,null,[a(x,{modelValue:y.dialogVisible,"onUpdate:modelValue":O[1]||(O[1]=$=>y.dialogVisible=$),class:"center-dialog properties-config-dialog",title:"配置数据","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"1000px",onOpen:l,onClosed:_},{footer:t(()=>[s("span",Ka,[ja,a(h,{onClick:O[0]||(O[0]=$=>y.dialogVisible=!1)},{default:t(()=>[N("取消")]),_:1}),a(h,{type:"primary",loading:y.submiting,onClick:u},{default:t(()=>[N("应用")]),_:1},8,["loading"]),a(h,{type:"primary",loading:y.submiting,onClick:c},{default:t(()=>[N(" 批量应用 ")]),_:1},8,["loading"])])]),default:t(()=>[s("div",{ref_key:"mainRef",ref:V,class:"properties-config"},[s("div",Ha,[a(h,{type:"primary",text:"",onClick:F},{default:t(()=>[N(B(le.value?"取消全选":"全选"),1)]),_:1}),a(h,{type:"primary",text:"",onClick:r},{default:t(()=>[N("批量配置")]),_:1})]),a(i,{ref_key:"tableRef",ref:e,class:"property-table sortableTable",data:y.modifyData,"max-height":"560"},{default:t(()=>[a(g,{prop:"published",align:"center",label:"发布",width:"80"},{default:t($=>[a(E,{modelValue:$.row.published,"onUpdate:modelValue":oe=>$.row.published=oe},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{prop:"columnName",align:"center",label:"字段名称"}),a(g,{prop:"aliasName",align:"center",label:"中文名称"},{default:t($=>[a(d,{modelValue:$.row.aliasName,"onUpdate:modelValue":oe=>$.row.aliasName=oe,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{prop:"columnType",align:"center",label:"字段类型"})]),_:1},8,["data"])],512)]),_:1},8,["modelValue"]),a(x,{modelValue:P.value,"onUpdate:modelValue":O[4]||(O[4]=$=>P.value=$),"append-to-body":"","close-on-click-modal":!1,title:"批量配置",width:"560px",class:"batch-setting-dialog"},{footer:t(()=>[s("span",Ga,[a(h,{onClick:O[3]||(O[3]=$=>P.value=!1)},{default:t(()=>[N("取消")]),_:1}),a(h,{type:"primary",onClick:f},{default:t(()=>[N("确定")]),_:1})])]),default:t(()=>[s("div",null,[a(J,{ref:"form","label-width":"100px",model:I},{default:t(()=>[a(m,{label:"字典类型："},{default:t(()=>[s("span",Ya,B(U.value.name),1)]),_:1}),a(m,{label:"字典名称："},{default:t(()=>[a(K,{modelValue:I.dataSourceId,"onUpdate:modelValue":O[2]||(O[2]=$=>I.dataSourceId=$),placeholder:"选择字典名称",style:{width:"100%"},onChange:ee},{default:t(()=>[(n(!0),C(ae,null,ie(D.value,$=>(n(),L(j,{key:$.id,label:$.dictValue,value:$.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"描述："},{default:t(()=>{var $;return[s("div",Wa,B((($=A.value)==null?void 0:$.remarks)||"暂无描述"),1)]}),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])],64)}}});const Xa={class:"association-settings"},Qa={class:"dialog-footer"},et=s("div",{class:"tips"},"说明：保存后，当前页面信息即刻生效",-1),at=_e({__name:"AssociationSettingsDialog",props:{visible:{type:Boolean,default:!1},innerPropertyItem:{default:()=>{}},outerPropertyItem:{default:()=>{}},resourceData:{default:()=>{}}},emits:["update:visible","save","openSetting"],setup(G,{emit:te}){const v=G,H=q(),y=me(()=>v.resourceData.dataType?["BIMMODEL","MODEL"].includes(v.resourceData.dataType):!1),U=me(()=>v.resourceData.dataType?["VECTOR"].includes(v.resourceData.dataType):!1),e=te,V=ue({dialogVisible:!1,submiting:!1,modifyData:[],editData:{sourceTableName:"",targetTableName:"",sourceColumn:"",targetColumn:""},rules:{sourceColumn:[{required:!0,message:"源字段不能为空",trigger:["blur","change"]}],targetColumn:[{required:!0,message:"目标字段不能为空",trigger:["blur","change"]}]},sourceColumnOptions:[],targetColumnOptions:[],uniqueIdName:"sgeoc_guid"});ce(()=>v.visible,u=>{V.dialogVisible=u});function o(){var u,F,P,I,D,A;le(),V.editData.sourceTableName=`${((u=v.innerPropertyItem)==null?void 0:u.tableName)||"--"} / ${((F=v.innerPropertyItem)==null?void 0:F.tableAliasName)||"--"}`,V.editData.targetTableName=`${((P=v.outerPropertyItem)==null?void 0:P.tableName)||"--"} / ${((I=v.outerPropertyItem)==null?void 0:I.tableAliasName)||"--"}`,V.editData.sourceColumn=((D=v.outerPropertyItem)==null?void 0:D.sourceColumn)??"",V.editData.targetColumn=((A=v.outerPropertyItem)==null?void 0:A.targetColumn)??"",fe(()=>{var c;(c=H.value)==null||c.clearValidate()})}function le(){if(U.value||y.value){const{resourceId:u}=v.resourceData;se.getExistSourceAndTargetColumn(u).then(F=>{if(F.code==="0000"){let P=F.data.targetColumns||[],I=F.data.sourceColumns||[];P=P.filter(D=>D!==V.uniqueIdName),V.targetColumnOptions=P.map(D=>({value:D,label:D})),I=I.filter(D=>D!==V.uniqueIdName),V.sourceColumnOptions=I.map(D=>({value:D,label:D}))}else V.targetColumnOptions=[],V.sourceColumnOptions=[]}).catch(()=>{V.targetColumnOptions=[],V.sourceColumnOptions=[]})}}function l(){e("update:visible",!1)}function _(){l(),e("openSetting")}function M(u){H==null||H.value.validate(F=>{if(F){V.submiting=!0;const P={};P.resourceId=v.resourceData.resourceId,U.value&&(P.sourceColumn=V.editData.sourceColumn,P.targetColumn=V.editData.targetColumn),y.value&&(P.targetColumn=V.editData.targetColumn),se.updateExtendProperties([],P).then(I=>{u&&u instanceof Function&&u(),V.submiting=!1,I.code==="0000"?(Q({type:"success",title:"关联设置修改成功！"}),e("save"),l()):Q({type:"warning",title:"关联设置修改失败，请重试"})}).catch(I=>{V.submiting=!1,Q({type:"error",title:"修改错误",message:I.message||"服务错误"})})}})}return(u,F)=>{const P=p("el-form-item"),I=p("el-option"),D=p("el-select"),A=p("el-form"),c=p("el-button"),r=p("el-dialog");return n(),L(r,{modelValue:V.dialogVisible,"onUpdate:modelValue":F[3]||(F[3]=f=>V.dialogVisible=f),class:"center-dialog association-settings-dialog",title:"关联设置","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"550px",onOpen:o,onClosed:l},{footer:t(()=>[s("span",Qa,[et,a(c,{onClick:F[2]||(F[2]=f=>V.dialogVisible=!1)},{default:t(()=>[N("取 消")]),_:1}),a(c,{type:"primary",plain:"",onClick:_},{default:t(()=>[N("重新设置")]),_:1}),a(c,{type:"primary",loading:V.submiting,onClick:M},{default:t(()=>[N("保 存")]),_:1},8,["loading"])])]),default:t(()=>[s("div",Xa,[a(A,{ref_key:"formRef",ref:H,model:V.editData,rules:V.rules,"label-width":90},{default:t(()=>{var f;return[(f=u.innerPropertyItem)!=null&&f.tableName&&V.editData.sourceTableName?(n(),L(P,{key:"sourceTableName",label:"源表名 :",prop:"sourceTableName"},{default:t(()=>[s("span",null,B(V.editData.sourceTableName),1)]),_:1})):Z("",!0),a(P,{key:"targetTableName",label:"关联表名 :",prop:"targetTableName"},{default:t(()=>[s("span",null,B(V.editData.targetTableName),1)]),_:1}),U.value?(n(),L(P,{key:"sourceColumn",label:"源字段 :",prop:"sourceColumn"},{default:t(()=>[a(D,{modelValue:V.editData.sourceColumn,"onUpdate:modelValue":F[0]||(F[0]=b=>V.editData.sourceColumn=b),filterable:"",style:{width:"100%"}},{default:t(()=>[(n(!0),C(ae,null,ie(V.sourceColumnOptions,b=>(n(),L(I,{key:b.value,label:b.label,value:b.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):Z("",!0),y.value||U.value?(n(),L(P,{key:"targetColumn",label:"目标字段 :",prop:"targetColumn"},{default:t(()=>[a(D,{modelValue:V.editData.targetColumn,"onUpdate:modelValue":F[1]||(F[1]=b=>V.editData.targetColumn=b),filterable:"",style:{width:"100%"}},{default:t(()=>[(n(!0),C(ae,null,ie(V.targetColumnOptions,b=>(n(),L(I,{key:b.value,label:b.label,value:b.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):Z("",!0)]}),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}});function tt(G){return Ne.doGetPromise("/resourcerelease/manager/resources/metadata/getMetadataForResource",G)}function lt(G){return Ne.doPostPromiseJson("/resourcerelease/manager/resources/metadata/saveOrUpdateForResource",G,{})}function ot(G){return Ne.doGetPromise("/resourcerelease/manager/resources/metadata/getMetadataForBusiness",G)}function nt(G){return Ne.doPostPromiseJson("/resourcerelease/manager/resources/metadata/saveOrUpdateForBusiness",G,{})}const it={class:"form_box"},st={class:"item-wrap"},rt=_e({__name:"MetaForm",props:{form:{default:()=>({})},list:{default:()=>[]}},setup(G,{expose:te}){const v=G,H={label:"dictValue",value:"id"},y=q([]),U=q(),e=q({});ce(()=>v.list,M=>{Array.isArray(M)&&V(M)},{immediate:!0});function V(M){M.forEach(async(u,F)=>{var P,I;if(u.type==="DICTIONARY"){const D=await Ie({pageNo:1,pageSize:9999,dictTypeId:u.dictTypeId}),{data:A,success:c}=D;c&&(y.value[F]=A.records,e.value[u.name]=((P=u==null?void 0:u.value)==null?void 0:P.split(","))||((I=u==null?void 0:u.initialValue)==null?void 0:I.split(","))||null)}else e.value[u.name]=u.value||u.initialValue||null})}function o(){return new Promise((M,u)=>{U.value.validate(F=>{F?M(e):u()})})}function le(){}function l(M){e.value[M]?e.value[M]=Math.round(e.value[M]):e.value[M]=0}function _(M){e.value[M]||(e.value[M]=0)}return we(()=>{}),ze(()=>{U.value&&U.value.resetFields()}),te({submitForm:o,cancelForm:le}),(M,u)=>{const F=p("el-switch"),P=p("el-date-picker"),I=p("el-input-number"),D=p("el-cascader"),A=p("el-input"),c=p("el-form-item"),r=p("el-form");return n(),C("div",it,[a(r,{ref_key:"formRef",ref:U,class:"meta_form",model:e.value,"label-width":"auto","label-position":"right",inline:"","label-suffix":" :"},{default:t(()=>[s("div",st,[(n(!0),C(ae,null,ie(v.list,(f,b)=>(n(),L(c,{key:b,label:f.aliasName,prop:f.name,rules:[{required:f.required,message:`${f.name}为必填项`}]},{default:t(()=>[f.type==="BOOLEAN"?(n(),L(F,{key:0,modelValue:e.value[f.name],"onUpdate:modelValue":R=>e.value[f.name]=R,"inline-prompt":"","active-text":"是","inactive-text":"否","active-value":"true","inactive-value":"false"},null,8,["modelValue","onUpdate:modelValue"])):f.type==="DATETIME"?(n(),L(P,{key:1,modelValue:e.value[f.name],"onUpdate:modelValue":R=>e.value[f.name]=R,style:{width:"100%"},type:"datetime",placeholder:"请选择日期时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):f.type==="DATE"?(n(),L(P,{key:2,modelValue:e.value[f.name],"onUpdate:modelValue":R=>e.value[f.name]=R,style:{width:"100%"},type:"date",placeholder:"请选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):f.type==="INT"?(n(),L(I,{key:3,modelValue:e.value[f.name],"onUpdate:modelValue":R=>e.value[f.name]=R,step:1,"step-strictly":"",style:{width:"100%"},"controls-position":"right",placeholder:"请输入整数",onChange:R=>l(f.name)},null,8,["modelValue","onUpdate:modelValue","onChange"])):f.type==="DECIMAL"?(n(),L(I,{key:4,modelValue:e.value[f.name],"onUpdate:modelValue":R=>e.value[f.name]=R,step:1,precision:f.decimal,style:{width:"100%"},"controls-position":"right",placeholder:"请输入小数",onChange:R=>_(f.name)},null,8,["modelValue","onUpdate:modelValue","precision","onChange"])):f.type==="DICTIONARY"?(n(),L(D,{key:5,modelValue:e.value[f.name],"onUpdate:modelValue":R=>e.value[f.name]=R,style:{width:"100%"},"show-all-levels":!1,clearable:"",options:y.value[b],props:H},null,8,["modelValue","onUpdate:modelValue","options"])):(n(),L(A,{key:6,modelValue:e.value[f.name],"onUpdate:modelValue":R=>e.value[f.name]=R,style:{width:"100%"},type:"text",placeholder:"请输入",maxlength:f.length,"show-word-limit":""},null,8,["modelValue","onUpdate:modelValue","maxlength"]))]),_:2},1032,["label","prop","rules"]))),128))])]),_:1},8,["model"])])}}});const Le=Ke(rt,[["__scopeId","data-v-2c60693b"]]),dt={class:"card"},ut={class:"content-wrap TableBtnsContainer"},ct={class:"content-wrap"},pt=s("span",{style:{"font-size":"16px",color:"#ff8282"}},"*",-1),mt=s("div",null,[N(" 若该模板用于数据库表，需按数据库列名规范设置，请勿使用保留关键词 "),s("br"),N(" 例如：INTEGER, STRING, INT64, INT32, INT16, INT8, DOUBLE, "),s("br"),N(" FLOAT, DECIMAL, DATE, DATETIME, TIME, DURATION, BOOL "),s("br"),N(" BOOLEAN, LIST, SET, MAP, POINT, LINESTRING, POLYGON ")],-1),ft={key:1},gt=s("p",null,[s("span",{style:{"font-size":"16px",color:"#ff8282"}},"*"),N(" 中文名称 ")],-1),_t={key:1},bt=s("p",null,[s("span",{style:{"font-size":"16px",color:"#ff8282"}},"*"),N(" 数据类型 ")],-1),yt=s("p",null,"关联字典",-1),ht={key:1},vt={key:1},Dt={key:1},Ct={key:1},Vt=["onClick"],wt={key:0,class:"content-wrap"},kt=s("div",{id:"anchorPoint",style:{overflow:"hidden"}},null,-1),Tt={class:"dialog-footer"},It=_e({__name:"ExpandDialog",props:{visible:{type:Boolean,default:!1},list:{default:()=>[]}},emits:["update:visible","save"],setup(G,{emit:te}){const v=G,H=te,y=q(),U=q(),e=q(),V=q(),o=q(X.EDIT),le=q([]),l=q([]),_=ue({dialogVisible:!1,submiting:!1,form:{},isLoading:!1,isHandling:!1,file:null,rules:{name:[{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]}],aliasName:[{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]},{required:!0,message:"模板名称不能为空",trigger:["blur","change"]}]},tableData:[],tableRules:{name:[{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]},{required:!0,message:"英文名称不能为空",trigger:["blur","change"]}],aliasName:[{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]},{required:!0,message:"中文名称不能为空",trigger:["blur","change"]}],type:[{required:!0,message:"数据类型不能为空",trigger:["change"]}]},selection:[]});ce(()=>v.visible,g=>{_.dialogVisible=g,_.tableData=v.list},{immediate:!0});function M(){H("update:visible",!1)}const u=q(null),{createTableItem:F,isSelectable:P,isRelationKey:I}=ya();ce(()=>v.visible,g=>{_.dialogVisible=g}),we(()=>{document.body.ondrop=function(g){g.preventDefault(),g.stopPropagation()},h()});function D(){var i;const d=((i=U.value.$el)==null?void 0:i.querySelector(".sortableTable")).querySelector(".el-table__body-wrapper tbody");u.value=Fe.create(d,{disabled:!1,handle:".draggable-item",onEnd({newIndex:x,oldIndex:m}){const j=re.cloneDeep(_.tableData),K=j.splice(m,1)[0];j.splice(x,0,K),_.tableData=[...j]}})}async function A(){_.isLoading=!0,_.isHandling=!1,_.file=null,_.tableData=[],_.isLoading=!1,fe(()=>{D()})}function c(){const g=F(),d=re.cloneDeep([..._.tableData,g]);_.tableData=[],fe(()=>{_.tableData=d}),setTimeout(()=>{y.value.querySelector("#anchorPoint").scrollIntoView()},20)}function r(g){var d;P(g)&&(_.tableData=_.tableData.filter(i=>i.id!==g.id),_.selection=_.selection.filter(i=>i!==g.id),_.selection.length===0&&((d=V.value)==null||d.clearSelection()))}function f(){var g;_.tableData=_.tableData.filter(d=>_.selection.every(i=>d.id!==i)),_.selection=[],(g=V.value)==null||g.clearSelection()}function b(){e.value.click()}function R(g){return g.replace(/.+\./,"")}function Y(g){const{files:d}=g.target;if(d.length===0)return;const i=d[0];_.isHandling=!0;const x=["xls","xlsx"],m=R(i.name).toLowerCase();if(x.includes(m))_.file=new File([i],i.name);else{De.alert("上传失败，请选择正确的文件格式上传","提示",{confirmButtonText:"确定",type:"error"}),g.target.value="",_.isHandling=!1;return}ee(),g.target.value=""}function ee(){const g=new FormData;g.append("file",_.file),He.importTemplate(g).then(d=>{if(d.code==="0000"&&(d!=null&&d.data)){const i=d.data;i.forEach(x=>{x.id=Ye()}),_.tableData=re.cloneDeep(i)}else Q({type:"error",title:"文件读取失败",message:d.message})}).catch(d=>{Q({type:"error",title:"文件读取失败",message:d.message})}).finally(()=>{_.isHandling=!1})}function k(g){_.selection=g.map(d=>d.id)}function O(){U.value.validate(g=>{if(!g)return;if(We(_.tableData,"name")){De.alert("英文名称存在相同的值，需唯一，请检查后再保存","提示",{confirmButtonText:"确定",type:"warning"});return}const d=va.map(i=>i.toLocaleLowerCase());if(_.tableData.some(i=>d.includes(i.name.toLocaleLowerCase()))){De.alert("英文名称存在特殊关键词，请检查后再保存","提示",{confirmButtonText:"确定",type:"warning"});return}H("save",_.tableData)})}async function h(){const g=await Me(),{success:d,data:i}=g;d&&(le.value=[...i.businessList,...i.systemList])}async function E(g,d){if(g.dictTypeId){const i=await Ie({pageNo:1,pageSize:9999,dictTypeId:g.dictTypeId}),{data:x,success:m}=i;m&&(l.value[d]=x.records)}else g.initialValue=""}return(g,d)=>{const i=p("el-button"),x=p("el-icon"),m=p("el-table-column"),j=p("QuestionFilled"),K=p("el-tooltip"),J=p("el-input"),$=p("el-form-item"),oe=p("el-option"),ne=p("el-select"),pe=p("el-checkbox"),ve=p("el-input-number"),Ce=p("el-form"),z=p("Plus"),W=p("el-dialog");return n(),L(W,{modelValue:_.dialogVisible,"onUpdate:modelValue":d[1]||(d[1]=T=>_.dialogVisible=T),class:"center-dialog",title:"字段信息","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"80vw",onOpen:A,onClosed:M},{footer:t(()=>[s("span",Tt,[a(i,{onClick:d[0]||(d[0]=T=>_.dialogVisible=!1)},{default:t(()=>[N("取 消")]),_:1}),a(i,{type:"primary",loading:_.submiting,onClick:O},{default:t(()=>[N("确 定")]),_:1},8,["loading"])])]),default:t(()=>[s("div",{ref_key:"mainRef",ref:y,class:"mess_body"},[s("div",dt,[s("div",ut,[a(i,{type:"danger",plain:"",disabled:_.selection.length===0,onClick:f},{default:t(()=>[N(" 批量删除 ")]),_:1},8,["disabled"]),a(i,{type:"primary",plain:"",loading:_.isHandling,onClick:b},{default:t(()=>[N(" 导入 ")]),_:1},8,["loading"]),s("input",{ref_key:"uploadFile",ref:e,style:{display:"none"},type:"file",class:"uploadFile",directory:"",nwdirectory:"",accept:".xls,.xlsx",onChange:Y},null,544)]),s("div",ct,[a(Ce,{ref_key:"fieldFormRef",ref:U,class:"table-form tableContainer",model:_},{default:t(()=>[a(w(la),{ref_key:"tableRef",ref:V,class:"table commonTable sortableTable",data:_.tableData,"row-key":"id",onSelectionChange:k},{default:t(()=>[a(m,{"class-name":"draggable-item",align:"center",label:"排序",width:"60"},{default:t(()=>[a(x,null,{default:t(()=>[a(w(oa))]),_:1})]),_:1}),o.value!==w(X).CHECK?(n(),L(m,{key:0,align:"center",type:"selection",label:"选中","reserve-selection":"",selectable:w(P)},null,8,["selectable"])):Z("",!0),a(m,{prop:"name","min-width":"120"},{header:t(()=>[s("p",null,[pt,N(" 英文名称 "),a(K,{class:"item",effect:"dark",placement:"top"},{content:t(()=>[mt]),default:t(()=>[a(x,{style:{"margin-left":"4px",transform:"translateY(2px)"}},{default:t(()=>[a(j)]),_:1})]),_:1})])]),default:t(T=>[o.value!==w(X).CHECK?(n(),L($,{key:0,prop:"tableData."+T.$index+".name",rules:_.tableRules.name},{default:t(()=>{var S;return[a(J,{modelValue:T.row.name,"onUpdate:modelValue":be=>T.row.name=be,modelModifiers:{trim:!0},disabled:!w(P)(T.row)||o.value===w(X).EDIT&&!!((S=T.row)!=null&&S.templateDataId),placeholder:"请输入英文名称",onInput:be=>T.row.name=w(je)(be)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"])]}),_:2},1032,["prop","rules"])):(n(),C("span",ft,B(T.row.name),1))]),_:1}),a(m,{prop:"aliasName","min-width":"120"},{header:t(()=>[gt]),default:t(T=>[o.value!==w(X).CHECK?(n(),L($,{key:0,prop:"tableData."+T.$index+".aliasName",rules:_.tableRules.aliasName},{default:t(()=>[a(J,{modelValue:T.row.aliasName,"onUpdate:modelValue":S=>T.row.aliasName=S,placeholder:"请输入中文名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(n(),C("span",_t,B(T.row.aliasName),1))]),_:1}),a(m,{prop:"type","min-width":"120"},{header:t(()=>[bt]),default:t(T=>[a($,{prop:"tableData."+T.$index+".type",rules:_.tableRules.type},{default:t(()=>[a(ne,{modelValue:T.row.type,"onUpdate:modelValue":S=>T.row.type=S,disabled:o.value===w(X).CHECK||!w(P)(T.row),placeholder:"请选择"},{default:t(()=>[(n(!0),C(ae,null,ie(w(qe),(S,be)=>(n(),L(oe,{key:be,label:S,value:be},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),a(m,null,{header:t(()=>[yt]),default:t(T=>[a($,{prop:"tableData."+T.$index+".dictTypeId"},{default:t(()=>[a(ne,{modelValue:T.row.dictTypeId,"onUpdate:modelValue":S=>T.row.dictTypeId=S,disabled:o.value===w(X).CHECK||!w(P)(T.row),placeholder:"请选择",clearable:"",onChange:S=>E(T.row,T.$index)},{default:t(()=>[(n(!0),C(ae,null,ie(le.value,S=>(n(),L(oe,{key:S.id,label:S.typeName,value:S.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1032,["prop"])]),_:1}),a(m,{prop:"primaryKey",label:"主键","min-width":"60",align:"center"},{default:t(T=>[a($,{class:"content-center",prop:"tableData."+T.$index+".primaryKey"},{default:t(()=>[a(pe,{modelValue:T.row.primaryKey,"onUpdate:modelValue":S=>T.row.primaryKey=S,disabled:o.value===w(X).CHECK},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:1}),a(m,{prop:"length",label:"字段长度","min-width":"120"},{default:t(T=>[o.value!==w(X).CHECK?(n(),L($,{key:0,prop:"tableData."+T.$index+".length"},{default:t(()=>[a(ve,{modelValue:T.row.length,"onUpdate:modelValue":S=>T.row.length=S,"controls-position":"right",min:0,max:255,disabled:w(I)(T.row)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])):(n(),C("span",ht,B(T.row.length),1))]),_:1}),a(m,{prop:"decimal",label:"小数位数","min-width":"120"},{default:t(T=>[o.value!==w(X).CHECK?(n(),L($,{key:0,prop:"tableData."+T.$index+".decimal"},{default:t(()=>[a(ve,{modelValue:T.row.decimal,"onUpdate:modelValue":S=>T.row.decimal=S,"controls-position":"right",min:0,max:255},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])):(n(),C("span",vt,B(T.row.decimal),1))]),_:1}),a(m,{prop:"required",label:"必填","min-width":"60",align:"center"},{default:t(T=>[a($,{class:"content-center",prop:"tableData."+T.$index+".required"},{default:t(()=>[a(pe,{modelValue:T.row.required,"onUpdate:modelValue":S=>T.row.required=S,disabled:o.value===w(X).CHECK||!w(P)(T.row)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:1}),a(m,{prop:"indexYn",label:"索引","min-width":"60",align:"center"},{default:t(T=>[a($,{class:"content-center",prop:"tableData."+T.$index+".indexYn"},{default:t(()=>[a(pe,{modelValue:T.row.indexYn,"onUpdate:modelValue":S=>T.row.indexYn=S,disabled:o.value===w(X).CHECK||T.row.name===w(ha)||w(I)(T.row)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:1}),a(m,{prop:"initialValue",label:"初始值","min-width":"120"},{default:t(T=>[o.value!==w(X).CHECK?(n(),L($,{key:0,prop:"tableData."+T.$index+".initialValue"},{default:t(()=>[a(J,{modelValue:T.row.initialValue,"onUpdate:modelValue":S=>T.row.initialValue=S,disabled:!w(P)(T.row)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])):(n(),C("span",Dt,B(T.row.initialValue),1))]),_:1}),a(m,{prop:"description",label:"业务描述","min-width":"120"},{default:t(T=>[o.value!==w(X).CHECK?(n(),L($,{key:0,prop:"tableData."+T.$index+".description"},{default:t(()=>[a(J,{modelValue:T.row.description,"onUpdate:modelValue":S=>T.row.description=S,placeholder:"请输入业务描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])):(n(),C("span",Ct,B(T.row.description),1))]),_:1}),o.value!==w(X).CHECK?(n(),L(m,{key:1,width:"60px",label:"操作",align:"center",fixed:"right","class-name":"tableOperate"},{default:t(T=>[s("span",{class:ge(["delete",{disabled:!w(P)(T.row)}]),onClick:na(S=>r(T.row),["stop"])}," 删除 ",10,Vt)]),_:1})):Z("",!0)]),_:1},8,["data"])]),_:1},8,["model"])]),o.value!==w(X).CHECK?(n(),C("div",wt,[s("div",{class:"addTableBtn",onClick:c},[a(x,null,{default:t(()=>[a(z)]),_:1}),N("新增参数 ")])])):Z("",!0),kt])],512)]),_:1},8,["modelValue"])}}});const xt={key:0,class:"choose_template"},Nt={key:0,class:"choose_template"},Ot={class:"step_box"},Lt={key:0,class:"center"},$t={class:"bottom_box page_box"},St={key:1,class:"center"},Et={class:"bottom_box"},Pt={key:1,class:"not_first_edit"},Ft={key:0,class:"edit_form"},Ut=s("div",{class:"sub_title"},"元数据信息",-1),At={class:"sub_title"},Rt=s("span",null,"扩展信息",-1),Bt=s("span",null,"编辑",-1),Mt={class:"bottom_box"},zt={key:1,class:"form_details"},qt=s("div",{class:"sub_title"},"元数据信息",-1),Ht={class:"field_box"},Kt={key:0},jt={key:1},Yt={key:2},Wt=s("div",{class:"sub_title"},"扩展信息",-1),Gt={class:"field_box"},Zt={key:0},Jt={key:1},Xt={class:"bottom_box"},Qt={key:2},el={key:1},al={class:"dataCenter-header"},tl={class:"header-content"},ll={class:"left-content"},ol=s("span",null,"查看字段",-1),nl={key:0},il={key:1},sl={key:2},rl=_e({__name:"MetaBaseInfo",props:{id:{},isFile:{type:Boolean}},setup(G){const te=G,v=q(),H=q(),y=q(),U=q(),{currentPage:e,pageSize:V,pageSizes:o,total:le,maxHeight:l,handleSizeChange:_,handleCurrentPageChange:M}=ba(v,H,A),u=ue({showFiledsPage:!1,isFirstEdit:!1,isReEdit:!1,isLoadingTable:!1,activeIdx:null,templateList:[],colDatas:[{prop:"aliasName",label:"模板名称",className:"clickable",minWidth:120},{prop:"name",label:"模板标识",className:"clickable",minWidth:120},{prop:"creator",label:"创建人",minWidth:120},{prop:"createTime",label:"创建时间",minWidth:120}],fieldColDatas:[{prop:"name",label:"英文名称",minWidth:120},{prop:"aliasName",label:"中文名称",minWidth:120},{prop:"type",label:"数据类型",minWidth:120},{prop:"indexYn",label:"索引",minWidth:120,slot:"indexYn"},{prop:"required",label:"必填",minWidth:120,slot:"required"},{prop:"length",label:"字段长度",minWidth:120},{prop:"decimal",label:"数位",minWidth:120},{prop:"initialValue",label:"初始值",minWidth:120},{prop:"description",label:"描述",minWidth:120}],curSelectId:"",fieldList:[],expandForm:{},showExpandDialog:!1,detailInfo:{metadataList:[],extMetadataList:[]}});ce(()=>te.id,A),we(()=>{fe(()=>{D()})});const F=q([]);function P(d){d.forEach((i,x)=>{i.type==="DICTIONARY"&&Ie({pageNo:1,pageSize:9999,dictTypeId:i.dictTypeId}).then(m=>{const{data:j,success:K}=m;if(K){const J=I(i,j.records);F.value[x]=J.join("/")}})})}function I(d,i){const x=[],m=d.value.split(",");if(m.length>=1){let j=i;for(const K of m){const J=j.find($=>$.id===K);J?(x.push(J.dictValue),j=J.children||[]):x.push("")}}return x}function D(){(te.isFile?ot:tt)({dataId:te.id}).then(i=>{var x;i.code==="0000"&&(u.detailInfo=i.data||{metadataList:[],extMetadataList:[]},P(i.data.metadataList),(x=u.detailInfo.metadataList)!=null&&x.length||(u.activeIdx=0,u.isFirstEdit=!0,A()))})}function A(){const d={page:e.value,rows:V.value,dataId:te.id};u.isLoadingTable=!0,He.getTemplatePageList(d).then(i=>{var x,m,j;u.isLoadingTable=!1,i.code==="0000"?(u.templateList=((x=i.data)==null?void 0:x.records)||[],u.curSelectId=(m=u.templateList[0])==null?void 0:m.id,le.value=((j=i.data)==null?void 0:j.total)||0):de.error(i.message||"获取模板列表数据错误")}).catch(i=>{u.isLoadingTable=!1,de.error(i.message||"获取模板列表数据错误")})}function c(d,i){i.label!=="操作"&&(u.curSelectId=d.id)}function r(d){return qe[d]||"--"}function f(d){u.fieldList=d.templateDataFieldList||[],u.showFiledsPage=!0}function b(){u.showFiledsPage=!1}function R(){if(!u.curSelectId)return;const d=u.templateList.find(i=>i.id===u.curSelectId);u.detailInfo.metadataList=d.templateDataFieldList||[],u.activeIdx=1}function Y(){u.activeIdx=0}function ee(){u.showExpandDialog=!0}function k(d){u.detailInfo.extMetadataList=d,u.showExpandDialog=!1}function O(){u.showExpandDialog=!1}async function h(){const d=await y.value.submitForm();d&&(u.detailInfo.metadataList.forEach(i=>{var x;i.type==="DICTIONARY"?i.value=(x=d.value[i.name])==null?void 0:x.join(","):i.value=d.value[i.name],delete i.id}),g())}async function E(){Promise.all([y.value.submitForm(),U.value.submitForm()]).then(d=>{const[i,x]=d||[];u.detailInfo.metadataList.forEach(m=>{var j;m.type==="DICTIONARY"?m.value=(j=i.value[m.name])==null?void 0:j.join(","):m.value=i.value[m.name]}),u.detailInfo.extMetadataList.forEach(m=>{m.value=x.value[m.name]}),g()})}function g(){const d={dataId:te.id,metadataList:u.detailInfo.metadataList,extMetadataList:u.detailInfo.extMetadataList};(te.isFile?nt:lt)(d).then(x=>{x.code==="0000"&&(u.isFirstEdit=!1,u.isReEdit=!1,D())})}return(d,i)=>{const x=p("el-step"),m=p("el-steps"),j=p("el-radio"),K=p("el-table-column"),J=p("el-button"),$=p("el-table"),oe=p("el-pagination"),ne=p("el-icon"),pe=p("ArrowLeft"),ve=p("el-checkbox"),Ce=xe("loading");return n(),C("div",{ref_key:"mainContainerRef",ref:v,class:"data_base_info"},[u.showFiledsPage?Z("",!0):(n(),C("div",xt,[u.isFirstEdit?(n(),C("div",Nt,[s("div",Ot,[a(m,{space:200,active:u.activeIdx,"finish-status":"success"},{default:t(()=>[a(x,{title:"选择元模板"}),a(x,{title:"填写元数据信息"})]),_:1},8,["active"])]),u.activeIdx===0?(n(),C("div",Lt,[he((n(),L($,{ref_key:"tableRef",ref:H,"element-loading-text":"拼命加载中...",style:{width:"100%"},data:u.templateList,"max-height":w(l)-30,height:w(l)-30,"row-key":"id","highlight-current-row":"",onCellClick:c},{default:t(()=>[a(K,{align:"center",type:"radio",label:"",width:"60"},{default:t(z=>[a(j,{modelValue:u.curSelectId,"onUpdate:modelValue":i[0]||(i[0]=W=>u.curSelectId=W),label:z.row.id},{default:t(()=>[N(" ")]),_:2},1032,["modelValue","label"])]),_:1}),(n(!0),C(ae,null,ie(u.colDatas,z=>(n(),L(K,{key:z.prop,prop:z.prop,label:z.label,"min-width":z.minWidth,"class-name":z.className,sortable:""},null,8,["prop","label","min-width","class-name"]))),128)),a(K,{width:"180px",label:"操作",fixed:"right"},{default:t(z=>[a(J,{type:"primary",text:"",onClick:W=>f(z.row)},{default:t(()=>[N(" 查看字段 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","max-height","height"])),[[Ce,u.isLoadingTable]]),s("div",$t,[a(oe,{"current-page":w(e),"onUpdate:currentPage":i[1]||(i[1]=z=>Re(e)?e.value=z:null),"page-size":w(V),"onUpdate:pageSize":i[2]||(i[2]=z=>Re(V)?V.value=z:null),layout:"total, sizes, prev, pager, next","page-sizes":w(o),total:w(le),onSizeChange:w(_),onCurrentChange:w(M)},null,8,["current-page","page-size","page-sizes","total","onSizeChange","onCurrentChange"]),a(J,{type:"primary",onClick:R},{default:t(()=>[N("下一步")]),_:1})])])):Z("",!0),u.activeIdx===1?(n(),C("div",St,[a(Le,{ref_key:"metaFormRef",ref:y,list:u.detailInfo.metadataList},null,8,["list"]),s("div",Et,[a(J,{onClick:Y},{default:t(()=>[N("上一步")]),_:1}),a(J,{type:"primary",onClick:h},{default:t(()=>[N("完成")]),_:1})])])):Z("",!0)])):(n(),C("div",Pt,[u.isReEdit?(n(),C("div",Ft,[Ut,a(Le,{ref_key:"metaFormRef",ref:y,list:u.detailInfo.metadataList},null,8,["list"]),s("div",At,[Rt,s("span",{class:"icon-box",onClick:ee},[a(ne,null,{default:t(()=>[a(w(ia))]),_:1}),Bt])]),a(Le,{ref_key:"expandFormRef",ref:U,list:u.detailInfo.extMetadataList},null,8,["list"]),s("div",Mt,[a(J,{onClick:i[3]||(i[3]=z=>u.isReEdit=!1)},{default:t(()=>[N("取消")]),_:1}),a(J,{type:"primary",onClick:E},{default:t(()=>[N("完成")]),_:1})])])):(n(),C("div",zt,[qt,s("div",Ht,[(n(!0),C(ae,null,ie(u.detailInfo.metadataList,(z,W)=>(n(),C("div",{key:W,class:"item"},[N(B(z.aliasName)+": ",1),z.type==="BOOLEAN"?(n(),C("span",Kt,B(z.value?"是":"否"),1)):Z("",!0),z.type==="DICTIONARY"?(n(),C("span",jt,B(F.value[W]),1)):(n(),C("span",Yt,B(z.value),1))]))),128))]),Wt,s("div",Gt,[(n(!0),C(ae,null,ie(u.detailInfo.extMetadataList,(z,W)=>(n(),C("div",{key:W,class:"item"},[N(B(z.aliasName)+": ",1),z.type==="BOOLEAN"?(n(),C("span",Zt,B(z.value?"是":"否"),1)):(n(),C("span",Jt,B(z.value),1))]))),128))]),s("div",Xt,[a(J,{type:"primary",onClick:i[4]||(i[4]=z=>u.isReEdit=!0)},{default:t(()=>[N("编辑")]),_:1})])]))])),u.activeIdx?(n(),C("div",Qt)):Z("",!0)])),u.showFiledsPage?(n(),C("div",el,[s("div",al,[s("div",tl,[s("div",ll,[a(ne,{onClick:b},{default:t(()=>[a(pe)]),_:1}),ol])])]),a($,{style:{width:"100%"},data:u.fieldList,"max-height":w(l),"row-key":"id","highlight-current-row":""},{default:t(()=>[(n(!0),C(ae,null,ie(u.fieldColDatas,z=>(n(),L(K,{key:z.prop,prop:z.prop,label:z.label,"min-width":z.minWidth,"class-name":z.className,sortable:""},{default:t(W=>[z.slot?(n(),C("div",nl,[a(ve,{modelValue:W.row[z.prop],"onUpdate:modelValue":T=>W.row[z.prop]=T,label:W.row[z.prop]},{default:t(()=>[N("   ")]),_:2},1032,["modelValue","onUpdate:modelValue","label"])])):z.prop==="type"?(n(),C("span",il,B(r(W.row[z.prop])),1)):(n(),C("span",sl,B(W.row[z.prop]),1))]),_:2},1032,["prop","label","min-width","class-name"]))),128))]),_:1},8,["data","max-height"])])):Z("",!0),u.showExpandDialog?(n(),L(It,{key:2,visible:u.showExpandDialog,list:u.detailInfo.extMetadataList,onSave:k,onClose:O},null,8,["visible","list"])):Z("",!0)],512)}}});const dl={style:{display:"flex",gap:"16px","margin-bottom":"16px"}},ul={class:"selected-tips"},cl={class:"dataContainer__pagination"},pl={class:"dialog-footer"},ml=_e({__name:"BatchApply",props:{visible:{type:Boolean,default:!1},editTableData:{default:()=>[]}},emits:["update:visible","setBatchApplyResultData"],setup(G,{emit:te}){const v=G,H=te,y=ue({dialogVisible:!1,submiting:!1,title:"批量应用",tableData:[],isLoadingTable:!1}),U=q(),e=q([]),V=ue({catalogId:"#",keyword:""}),o=ue({total:0,pageSizes:[10,20,30,40],currentPage:1,pageSize:10});ce(()=>v.visible,c=>{y.dialogVisible=c});function le(){H("update:visible",!1)}function l(){if(e.value.length===0){de.warning("请选择要应用的数据");return}const c={fields:v.editTableData.map(r=>({columnName:r.columnName,aliasName:r.aliasName})),resourceIds:e.value.map(r=>r.resourceId),canConfigPublished:!1};se.batchConfig(c).then(r=>{if(r.success){const f=r.data||[];H("setBatchApplyResultData",f),le()}})}function _(c){U.value.clearSelection(),V.catalogId!==c&&(V.catalogId=c,M())}function M(){o.currentPage=1,u()}function u(){y.isLoadingTable=!0;const c={page:o.currentPage,rows:o.pageSize,...V};se.getDataPageList(c).then(r=>{y.isLoadingTable=!1,r.code==="0000"?(y.tableData=r.data?r.data.records:[],y.tableData||(y.tableData=[]),o.total=r.data?r.data.total:0,e.value.length>0&&fe(()=>{e.value.forEach(f=>{U.value.setCurrentRow(f)})})):de({type:"error",message:r.message||"获取表格数据失败"})}).catch(r=>{y.isLoadingTable=!1,de({type:"error",message:r.message||"获取表格数据错误"})})}function F(c){o.pageSize=c,o.currentPage=1,u()}function P(c){o.currentPage=c,u()}function I(c){if(e.value=c||[],c.length>500){e.value=c.slice(0,500);const r=c.slice(500);fe(()=>{r.forEach(f=>{U.value.toggleRowSelection(f,!1)})})}}function D(c){c.length>500&&de({type:"warning",message:"最多选择500条数据"})}function A(){o.currentPage=1,o.pageSize=10,o.total=0,V.keyword="",V.catalogId="#",e.value=[],M()}return(c,r)=>{const f=p("el-input"),b=p("el-button"),R=p("el-table-column"),Y=p("el-table"),ee=p("el-pagination"),k=p("el-dialog"),O=xe("loading");return n(),L(k,{modelValue:y.dialogVisible,"onUpdate:modelValue":r[4]||(r[4]=h=>y.dialogVisible=h),title:y.title,"append-to-body":"",class:"batch-apply-dialog","close-on-click-modal":!1,"close-on-press-escape":!1,width:"840px",onOpen:A,onClosed:le},{footer:t(()=>[s("span",pl,[a(b,{onClick:r[3]||(r[3]=h=>y.dialogVisible=!1)},{default:t(()=>[N("取消")]),_:1}),a(b,{type:"primary",onClick:l},{default:t(()=>[N("确定")]),_:1})])]),default:t(()=>[a(w(Be),{style:{width:"100%",height:"50vh"}},{default:t(()=>[a(w(ca),null,{default:t(()=>[a(Da,{type:"RESOURCE",editable:!1,onChange:_})]),_:1}),a(w(Be),null,{default:t(()=>[a(w(Oe),{padding:"1 1 0",border:""},{default:t(()=>[s("div",dl,[a(f,{modelValue:V.keyword,"onUpdate:modelValue":r[0]||(r[0]=h=>V.keyword=h),class:"search-input",clearable:"",placeholder:"数据名称","prefix-icon":w($e)},null,8,["modelValue","prefix-icon"]),a(b,{type:"primary",onClick:M},{default:t(()=>[N("搜索")]),_:1})])]),_:1}),a(w(Oe),{padding:"0 0 0"},{default:t(()=>[s("div",ul,"已选择 "+B(e.value.length)+" 条数据，最多可选 500 条",1)]),_:1}),a(w(pa),{style:{"border-bottom":"1px solid #ebeef5"}},{default:t(()=>[he((n(),L(Y,{ref_key:"tableRef",ref:U,class:"data-table","element-loading-text":"拼命加载中...",style:{width:"100%"},data:y.tableData,"row-key":"resourceId",height:"100%","highlight-current-row":"",onSelectionChange:I,onSelect:D},{default:t(()=>[a(R,{align:"center",type:"selection",label:"选中","reserve-selection":""}),a(R,{prop:"name",label:"数据名称",align:"center"})]),_:1},8,["data"])),[[O,y.isLoadingTable]])]),_:1}),a(w(Oe),null,{default:t(()=>[s("div",cl,[o.total&&o.total>0?(n(),L(ee,{key:0,"current-page":o.currentPage,"onUpdate:currentPage":r[1]||(r[1]=h=>o.currentPage=h),"page-size":o.pageSize,"onUpdate:pageSize":r[2]||(r[2]=h=>o.pageSize=h),background:"","pager-count":5,layout:"total, sizes, prev, pager, next","page-sizes":o.pageSizes,total:o.total,onSizeChange:F,onCurrentChange:P},null,8,["current-page","page-size","page-sizes","total"])):Z("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}});const fl={class:"apply-result_body"},gl=s("div",{class:"title-tip"},"处理结果：",-1),_l={class:"result-data-content"},bl=["onClick"],yl={class:"result-item_content"},hl={class:"result-item_unmatch-ields"},vl={style:{"margin-bottom":"5px"}},Dl={class:"dialog-footer"},Cl=s("div",{class:"tips"},"说明：保存后，当前页面信息即刻生效",-1),Vl=_e({__name:"BatchApplyResultDialog",props:{visible:{type:Boolean,default:!1},batchApplyResultData:{default:()=>[]}},emits:["update:visible","setBatchApplyResultData"],setup(G,{emit:te}){const v=G,H=q([]),y=q(),U=q(),e=q(null),V=te,o=ue({dialogVisible:!1,tableData:[],isLoadingTable:!1});ce(()=>v.visible,c=>{o.dialogVisible=c}),ce(()=>v.batchApplyResultData,c=>{H.value=c},{immediate:!0,deep:!0});function le(){V("update:visible",!1)}function l(){}const _=ue({dialogVisible:!1,propertiesList:[],cloneData:[],submiting:!1});function M(c){c.propertiesInfo&&c.propertiesInfo.id&&se.getPropertiesConfigList(c.propertiesInfo.id).then(r=>{r.code==="0000"&&(_.propertiesList=(r==null?void 0:r.data)||[],_.cloneData=re.cloneDeep((r==null?void 0:r.data)||[]),_.dialogVisible=!0)})}function u(){var c,r;_.dialogVisible=!1,_.propertiesList=[],_.cloneData=[],(c=e.value)!=null&&c.el&&((r=e.value)==null||r.destroy())}const F=me(()=>{const c=_.propertiesList.length,r=_.propertiesList.filter(f=>f.published).length;return c===r&&c!==0}),P=()=>{F.value?_.propertiesList.forEach(c=>{c.published=!1}):_.propertiesList.forEach(c=>{c.published=!0})};function I(){var f;const r=((f=U.value)==null?void 0:f.querySelector(".sortableTable")).querySelector(".el-table__body-wrapper tbody");e.value=Fe.create(r,{disabled:!1,onEnd({newIndex:b,oldIndex:R}){const Y=_.cloneData.splice(R,1)[0];_.cloneData.splice(b,0,Y)}})}function D(){_.cloneData.forEach(c=>{var r,f;c.aliasName=(r=_.propertiesList.find(b=>b.columnName===c.columnName))==null?void 0:r.aliasName,c.published=(f=_.propertiesList.find(b=>b.columnName===c.columnName))==null?void 0:f.published}),_.submiting=!0,se.savePropertiesConfigList(re.cloneDeep(_.cloneData)).then(c=>{_.submiting=!1,c.code==="0000"?Q({type:"success",title:"设置成功"}):Q({type:"error",title:"设置失败",message:c.message})}).catch(c=>{_.submiting=!1,Q({type:"error",title:"设置失败",message:c.message})})}function A(){fe(()=>{I()})}return(c,r)=>{const f=p("el-dialog"),b=p("el-button"),R=p("el-checkbox"),Y=p("el-table-column"),ee=p("el-input"),k=p("el-table");return n(),C(ae,null,[a(f,{modelValue:o.dialogVisible,"onUpdate:modelValue":r[0]||(r[0]=O=>o.dialogVisible=O),title:"批量应用","append-to-body":"",class:"batch-apply-result-dialog","close-on-click-modal":!1,"close-on-press-escape":!1,width:"640px",onOpen:l,onClosed:le},{default:t(()=>[s("div",fl,[gl,s("div",_l,[s("ul",null,[(n(!0),C(ae,null,ie(H.value,(O,h)=>(n(),C("li",{key:h,class:"result-item",onClick:E=>M(O)},[s("span",{class:ge(O.unmatchFields?"warn-tip":"sucess-tip")},null,2),s("div",yl,B(O.resourceName),1),s("span",hl,"未配对 "+B(O.unmatchFields)+" 个",1)],8,bl))),128))])])])]),_:1},8,["modelValue"]),a(f,{modelValue:_.dialogVisible,"onUpdate:modelValue":r[1]||(r[1]=O=>_.dialogVisible=O),title:"配置数据","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"840px",class:"properties-config-dialog",onOpen:A,onClosed:u},{footer:t(()=>[s("span",Dl,[Cl,a(b,{onClick:u},{default:t(()=>[N("取消")]),_:1}),a(b,{type:"primary",loading:_.submiting,onClick:D},{default:t(()=>[N(" 应用 ")]),_:1},8,["loading"])])]),default:t(()=>[s("div",{ref_key:"mainRef",ref:U,class:"properties-config"},[s("div",vl,[a(b,{type:"primary",text:"",onClick:P},{default:t(()=>[N(B(F.value?"取消全选":"全选"),1)]),_:1})]),a(k,{ref_key:"tableRef",ref:y,class:"property-table sortableTable",data:_.propertiesList,"max-height":500},{default:t(()=>[a(Y,{prop:"published",align:"center",label:"发布",width:"80"},{default:t(O=>[a(R,{modelValue:O.row.published,"onUpdate:modelValue":h=>O.row.published=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(Y,{prop:"columnName",align:"center",label:"字段名称"}),a(Y,{prop:"aliasName",align:"center",label:"中文名称"},{default:t(O=>[a(ee,{modelValue:O.row.aliasName,"onUpdate:modelValue":h=>O.row.aliasName=h,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(Y,{prop:"columnType",align:"center",label:"字段类型"})]),_:1},8,["data"])],512)]),_:1},8,["modelValue"])],64)}}});const Ue=G=>(sa("data-v-e3362071"),G=G(),ra(),G),wl={class:"common-wrapper","element-loading-text":"数据获取中"},kl={class:"dataCenter-header"},Tl={class:"header-content"},Il={class:"left-content"},xl={key:0,class:"dataCenter-tab-title"},Nl={class:"dataCenter-main"},Ol={class:"card"},Ll=Ue(()=>s("div",{class:"card-title"},"数据信息",-1)),$l={class:"content-wrap"},Sl={class:"item-wrap item2"},El={key:1},Pl={class:"item-wrap item2"},Fl={key:1},Ul={class:"item-wrap item2"},Al={key:0,class:"item-wrap item2"},Rl={key:1,class:"item-wrap"},Bl={style:{"margin-left":"100px"}},Ml={style:{"margin-left":"100px"}},zl={class:"item-wrap item2"},ql={class:"item-wrap item2"},Hl={class:"item-wrap"},Kl={key:0,class:"card"},jl={class:"tab-box-title mb-16"},Yl=["onClick"],Wl={class:"content-wrap"},Gl={class:"content-box mb-16"},Zl=Ue(()=>s("span",null," 源表名:    ",-1)),Jl={class:"mb-16 content-box"},Xl=Ue(()=>s("span",{class:"select-perfix-name"}," 关联表名： ",-1)),Ql={class:"content-wrap"},eo={class:"content-wrap"},ao={class:"dataCenter-footer"},to=_e({__name:"DataInfoDialog",props:{visible:{type:Boolean,default:!1},dialogType:{default:X.CHECK},domId:{default:""},curEditId:{default:""},isFile:{type:Boolean,default:!1}},emits:["update:visible","changeEdit","save"],setup(G,{emit:te}){const v=G,H=te,y=q(),U=q("details"),e=Se(),V=Ee(),o=me(()=>v.isFile?V.classifyTreeData:e.classifyTreeData),le=Ge(o.value),l=ue({dialogVisible:!1,isLoadingData:!1,submiting:!1,editData:{},rules:{name:[{required:!0,message:"数据名称不能为空",trigger:["blur","change"]}]},includeInnerProperty:["BIMMODEL","MODEL","VECTOR","IOT","TABLE"],includeOuterProperty:["BIMMODEL","MODEL","VECTOR","IMAGERY"],includeProperty:[],setPropertyVisible:!1,propertyInfoVisible:!1,isOuterProperty:!1,isCheckProperty:!0,catalogName:"",catalogObj:null,treeProps:{label:"name",children:"children",disabled:"no"},treeValueKey:"id",curTabName:1,tabList:[],innerPropertyList:[],curInnerProperty:{},innerTableData:[],outerPropertyList:[],curOuterProperty:{},outerTableData:[],propertyConfigVisible:!1,associationSettingsVisible:!1,batchApplyVisible:!1,editPropertyItem:{},editTableData:[],isLoadingDeleteBtn:!1});ce(()=>v.visible,d=>{l.dialogVisible=d}),we(()=>{l.includeProperty=[...new Set([...l.includeInnerProperty,...l.includeOuterProperty])]});function _(){U.value="details",l.isLoadingData=!0,l.innerPropertyList=[],l.outerPropertyList=[],l.curInnerProperty={},l.curOuterProperty={},l.innerTableData=[],l.outerTableData=[],l.tabList=[],l.curTabName=1,fe(()=>{y.value.clearValidate()}),D(!0)}function M(){H("update:visible",!1)}function u(){H("changeEdit")}function F(){l.setPropertyVisible=!0}function P(){l.isOuterProperty=!1,l.isCheckProperty=v.dialogType===X.CHECK,l.propertyInfoVisible=!0}function I(){l.propertyInfoVisible=!0,l.isCheckProperty=v.dialogType===X.CHECK,l.isOuterProperty=!0}function D(d=!1){(v.isFile?ke.getDataInfoById:se.getDataInfoById)(v.curEditId).then(x=>{var m,j;if(x.code==="0000"&&x.data){if(d&&(l.editData=x.data,b(x.data.catalogId),l.catalogName=le.value.get(x.data.catalogId),x.data.srsOrigin)){const $=x.data.srsOrigin.split(",");l.editData.srsOrigin={x:$[0],y:$[1],z:$[2]}}const{dataType:K,propertiesInfo:J=[]}=x.data;if(l.innerPropertyList=J==null?void 0:J.filter($=>$.propertiesType==="DATA"),l.outerPropertyList=J==null?void 0:J.filter($=>$.propertiesType==="EXTEND"),l.curInnerProperty=((m=l.innerPropertyList)==null?void 0:m[0])??{},l.curOuterProperty=((j=l.outerPropertyList)==null?void 0:j[0])??{},A(),!d)return;l.includeInnerProperty.includes(K)&&l.includeOuterProperty.includes(K)?(l.tabList=[{code:1,name:"源表信息"},{code:2,name:"关联表信息"}],l.curTabName=1):l.includeInnerProperty.includes(K)?(l.tabList=[{code:1,name:"源表信息"}],l.curTabName=1):l.includeOuterProperty.includes(K)&&(l.tabList=[{code:2,name:"关联表信息"}],l.curTabName=2)}else de({type:"error",message:"获取数据信息失败"})}).catch(()=>{de({type:"error",message:"获取数据信息错误"})}).finally(()=>{l.isLoadingData=!1})}function A(){var d,i;(d=l.curInnerProperty)!=null&&d.id?se.getPropertiesConfigList(l.curInnerProperty.id).then(x=>{x.code==="0000"&&(l.innerTableData=(x==null?void 0:x.data)||[])}):l.innerTableData=[],(i=l.curOuterProperty)!=null&&i.id?se.getPropertiesConfigList(l.curOuterProperty.id).then(x=>{x.code==="0000"&&(l.outerTableData=(x==null?void 0:x.data)||[])}):l.outerTableData=[]}function c(){l.curTabName===1?(l.editPropertyItem=ye(l.curInnerProperty),l.editTableData=ye(l.innerTableData)):(l.editPropertyItem=ye(l.curOuterProperty),l.editTableData=ye(l.outerTableData)),l.propertyConfigVisible=!0}function r(){l.associationSettingsVisible=!0}function f(d){l.curTabName===1?l.innerTableData=ye(d):l.outerTableData=ye(d)}function b(d){l.catalogObj={id:d,name:le.value.get(d)}}function R(){De.confirm("删除关联表, 是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{l.isLoadingDeleteBtn=!0,se.deleteExtendRelation(v.curEditId).then(d=>{l.isLoadingDeleteBtn=!1,d.code==="0000"?(Q({type:"success",title:"删除成功！"}),D()):Q({type:"warning",title:"删除失败，请重试"})}).catch(d=>{l.isLoadingDeleteBtn=!1,Q({type:"error",title:"删除错误",message:d.message||"服务错误"})})}).catch(()=>{})}function Y(){y.value.validate(d=>{if(d){l.submiting=!0;const i=ye(l.editData);if(l.editData.srsOrigin){const{x:m,y:j,z:K}=l.editData.srsOrigin,J=`${m},${j},${K}`;i.srsOrigin=J}l.catalogObj&&(i.catalogId=l.catalogObj.id,i.catalogName=l.catalogObj.name),(v.isFile?ke.updateDataInfo:se.updateDataInfo)(i).then(m=>{l.submiting=!1,m.code==="0000"?(Q({type:"success",title:"数据编辑成功"}),M(),H("save")):Q({type:"error",title:"数据编辑失败",message:m.message})}).catch(m=>{l.submiting=!1,Q({type:"error",title:"数据编辑错误",message:m.message})})}})}const ee=me(()=>d=>{if(d){const{resourceType:i,storageType:x,tableName:m}=d;return i==="DB"?`${x} / ${m}`:"文件上传"}return""});function k(){l.batchApplyVisible=!0}const O=q(!1),h=q([]);function E(d){h.value=ye(d),O.value=!0}const g=me(()=>l.curTabName===1?l.innerTableData||[]:l.curTabName===2?l.outerTableData||[]:[]);return(d,i)=>{const x=p("ArrowLeft"),m=p("el-icon"),j=p("el-input"),K=p("el-form-item"),J=p("el-form"),$=p("el-option"),oe=p("el-select"),ne=p("el-button"),pe=p("el-table-column"),ve=p("el-table"),Ce=p("el-scrollbar"),z=xe("loading");return n(),L(w(ga),{modelValue:l.dialogVisible,"onUpdate:modelValue":i[15]||(i[15]=W=>l.dialogVisible=W),"append-to-dom":d.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:_,onClosed:M},{default:t(()=>[he((n(),C("div",wl,[s("div",kl,[s("div",Tl,[s("div",Il,[a(m,{onClick:M},{default:t(()=>[a(x)]),_:1}),s("span",null,B((w(ma).get(d.dialogType)||"编辑")+"数据"),1)])]),d.dialogType===w(X).CHECK?(n(),C("div",xl,[s("div",{class:ge(["btn",{actived:U.value==="details"}]),onClick:i[0]||(i[0]=W=>U.value="details")}," 数据信息 ",2),s("div",{class:ge(["btn",{actived:U.value==="dataBlood"}]),onClick:i[1]||(i[1]=W=>U.value="dataBlood")}," 数据血缘 ",2),s("div",{class:ge(["btn",{actived:U.value==="baseInfo"}]),onClick:i[2]||(i[2]=W=>U.value="baseInfo")}," 元数据 ",2)])):Z("",!0)]),s("div",Nl,[U.value==="details"?(n(),L(Ce,{key:0},{default:t(()=>{var W,T;return[s("div",{class:ge([d.dialogType===w(X).CHECK?"main isCheck":"main"])},[s("div",Ol,[Ll,s("div",$l,[a(J,{ref_key:"editForm",ref:y,class:"form edit-form",inline:"",model:l.editData,rules:l.rules,"label-width":"auto","label-position":"right","label-suffix":" :"},{default:t(()=>[s("div",Sl,[a(K,{label:"数据名称",prop:"name"},{default:t(()=>[d.dialogType!==w(X).CHECK?(n(),L(j,{key:0,modelValue:l.editData.name,"onUpdate:modelValue":i[3]||(i[3]=S=>l.editData.name=S),type:"text",placeholder:"请输入数据名称"},null,8,["modelValue"])):(n(),C("span",El,B(l.editData.name),1))]),_:1}),a(K,{label:"数据类型",prop:"dataTypeAliasName"},{default:t(()=>[s("span",null,B(l.editData.dataTypeAliasName)+" / "+B(l.editData.dataFormat),1)]),_:1})]),s("div",Pl,[a(K,{label:"所属目录"},{default:t(()=>[d.dialogType!==w(X).CHECK?(n(),L(w(Pe),{key:0,modelValue:l.catalogObj,"onUpdate:modelValue":i[4]||(i[4]=S=>l.catalogObj=S),"tree-props":l.treeProps,"tree-data":o.value,"value-key":l.treeValueKey,style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data","value-key"])):(n(),C("span",Fl,B(l.editData.catalogName),1))]),_:1}),a(K)]),s("div",Ul,[l.editData.resourceType!=="DB"?(n(),L(K,{key:0,label:"数据大小",prop:"dataSize"},{default:t(()=>[s("span",null,B(l.editData.dataSize),1)]),_:1})):Z("",!0),a(K,{label:"数据状态",prop:"status"},{default:t(()=>[s("span",null,B(w(fa).get(l.editData.status)),1)]),_:1})]),l.editData.srs?(n(),C("div",Al,[a(K,{label:"坐标系统",prop:"srs"},{default:t(()=>[s("span",null,B(l.editData.srs),1)]),_:1})])):Z("",!0),l.editData.srsOrigin?(n(),C("div",Rl,[a(K,{label:"偏移量",prop:"srsOrigin"},{default:t(()=>{var S,be,Ae;return[s("span",null,"X : "+B((S=l.editData.srsOrigin)==null?void 0:S.x),1),s("span",Bl,"Y : "+B((be=l.editData.srsOrigin)==null?void 0:be.y),1),s("span",Ml,"Z : "+B((Ae=l.editData.srsOrigin)==null?void 0:Ae.z),1)]}),_:1})])):Z("",!0),s("div",zl,[a(K,{label:"数据来源",prop:"resourceType"},{default:t(()=>[s("span",null,B(ee.value(l.editData)),1)]),_:1}),l.editData.resourceType!=="DB"?(n(),L(K,{key:0,label:"上传时间",prop:"uploadTime"},{default:t(()=>[s("span",null,B(l.editData.uploadTime),1)]),_:1})):Z("",!0)]),s("div",ql,[a(K,{label:"创建者",prop:"creator"},{default:t(()=>[s("span",null,B(l.editData.creator),1)]),_:1}),a(K,{label:"创建时间",prop:"createTime"},{default:t(()=>[s("span",null,B(l.editData.createTime),1)]),_:1})]),s("div",Hl,[a(K,{label:"描述",prop:"description"},{default:t(()=>[d.dialogType!==w(X).CHECK?(n(),L(j,{key:0,modelValue:l.editData.description,"onUpdate:modelValue":i[5]||(i[5]=S=>l.editData.description=S),type:"text",placeholder:"请输入描述",clearable:""},null,8,["modelValue"])):(n(),C("span",{key:1,class:ge(["description",l.editData.description?"":"empty"])},B(l.editData.description||"未描述"),3))]),_:1})])]),_:1},8,["model","rules"])])]),l.includeProperty.includes(l.editData.dataType)&&l.editData.status!=="PROCESSING"&&l.editData.status!=="UPLOAD_FAIL"?(n(),C("div",Kl,[s("div",jl,[(n(!0),C(ae,null,ie(l.tabList,S=>(n(),C("div",{key:S.code,class:ge(["btn",[l.curTabName===S.code?"actived":""]]),onClick:be=>l.curTabName=S.code},B(S.name),11,Yl))),128))]),s("div",Wl,[he(s("div",Gl,[(W=l.curInnerProperty)!=null&&W.id?(n(),C(ae,{key:0},[Zl,a(oe,{modelValue:l.curInnerProperty,"onUpdate:modelValue":i[6]||(i[6]=S=>l.curInnerProperty=S),class:"select-table","value-key":"id"},{default:t(()=>[(n(!0),C(ae,null,ie(l.innerPropertyList,S=>(n(),L($,{key:S.id,label:S.tableName,value:S},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s("span",null,"   表别名:  "+B(l.curInnerProperty.tableAliasName||"-")+"     ",1),N("   "),a(ne,{type:"primary",plain:"",onClick:P},{default:t(()=>[N(" 预览数据 ")]),_:1}),d.dialogType!==w(X).CHECK?(n(),L(ne,{key:0,type:"primary",plain:"",onClick:c},{default:t(()=>[N(" 配置数据 ")]),_:1})):Z("",!0)],64)):Z("",!0)],512),[[Ve,l.curTabName===1]]),he(s("div",Jl,[(T=l.curOuterProperty)!=null&&T.id?(n(),C(ae,{key:0},[Xl,a(oe,{modelValue:l.curOuterProperty,"onUpdate:modelValue":i[7]||(i[7]=S=>l.curOuterProperty=S),class:"select-table","value-key":"id"},{default:t(()=>[(n(!0),C(ae,null,ie(l.outerPropertyList,S=>(n(),L($,{key:S.id,label:S.tableName,value:S},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s("span",null,"   表别名:  "+B(l.curOuterProperty.tableAliasName||"-")+"     ",1),a(ne,{type:"primary",plain:"",onClick:I},{default:t(()=>[N(" 预览数据 ")]),_:1}),d.dialogType!==w(X).CHECK?(n(),C(ae,{key:0},[a(ne,{type:"primary",plain:"",onClick:c},{default:t(()=>[N(" 配置数据 ")]),_:1}),l.editData.dataType==="IMAGERY"?(n(),L(ne,{key:0,type:"primary",plain:"",onClick:F},{default:t(()=>[N(" 重新设置 ")]),_:1})):(n(),L(ne,{key:1,type:"primary",plain:"",onClick:r},{default:t(()=>[N(" 关联设置 ")]),_:1})),a(ne,{type:"danger",plain:"",loading:l.isLoadingDeleteBtn,onClick:R},{default:t(()=>[N(" 删除关联 ")]),_:1},8,["loading"])],64)):Z("",!0)],64)):(n(),C(ae,{key:1},[d.dialogType!==w(X).CHECK?(n(),L(ne,{key:0,type:"primary",plain:"",onClick:F},{default:t(()=>[N(" 新增关联表 ")]),_:1})):Z("",!0)],64))],512),[[Ve,l.curTabName===2]])]),he(s("div",Ql,[a(ve,{class:"property-table",data:l.innerTableData},{default:t(()=>[a(pe,{prop:"published",align:"center",label:"发布",width:"80"},{default:t(S=>[s("span",null,B(S.row.published?"√":""),1)]),_:1}),a(pe,{prop:"columnName",align:"center",label:"字段名称"}),a(pe,{prop:"aliasName",align:"center",label:"中文名称"}),a(pe,{prop:"columnType",align:"center",label:"字段类型"})]),_:1},8,["data"])],512),[[Ve,l.curTabName===1]]),he(s("div",eo,[a(ve,{class:"property-table",data:l.outerTableData},{default:t(()=>[a(pe,{prop:"published",align:"center",label:"发布",width:"80"},{default:t(S=>[s("span",null,B(S.row.published?"√":""),1)]),_:1}),a(pe,{prop:"columnName",align:"center",label:"字段名称"}),a(pe,{prop:"aliasName",align:"center",label:"中文名称"}),a(pe,{prop:"columnType",align:"center",label:"字段类型"})]),_:1},8,["data"])],512),[[Ve,l.curTabName===2]])])):Z("",!0)],2)]}),_:1})):Z("",!0),U.value==="dataBlood"?(n(),C("div",{key:1,class:ge([d.dialogType===w(X).CHECK?"main isCheck":"main"])},[a(w(_a),{id:v.curEditId,type:"RESULT_DATA","blood-job-type":v.isFile?"BUSINESS_RESOURCE_DATA":""},null,8,["id","blood-job-type"])],2)):Z("",!0),U.value==="baseInfo"?(n(),C("div",{key:2,class:ge(["meta-data-box",[d.dialogType===w(X).CHECK?"main isCheck":"main"]])},[a(rl,{id:v.curEditId,"is-file":v.isFile},null,8,["id","is-file"])],2)):Z("",!0)]),he(s("div",ao,[a(ne,{onClick:i[8]||(i[8]=W=>l.dialogVisible=!1)},{default:t(()=>[N("取消")]),_:1}),d.dialogType!==w(X).CHECK?(n(),L(ne,{key:0,type:"primary",loading:l.submiting,onClick:Y},{default:t(()=>[N("保存")]),_:1},8,["loading"])):Z("",!0),d.dialogType===w(X).CHECK&&l.editData.status!=="UPLOAD_FAIL"?(n(),L(ne,{key:1,type:"primary",onClick:u},{default:t(()=>[N("编辑")]),_:1})):Z("",!0)],512),[[Ve,U.value==="details"]]),a(Aa,{visible:l.setPropertyVisible,"onUpdate:visible":i[9]||(i[9]=W=>l.setPropertyVisible=W),"resource-data":l.editData,onUpdate:D},null,8,["visible","resource-data"]),a(qa,{visible:l.propertyInfoVisible,"onUpdate:visible":i[10]||(i[10]=W=>l.propertyInfoVisible=W),"resource-id":d.curEditId,"resource-data":l.editData,"is-outer-property":l.isOuterProperty,"is-check":l.isCheckProperty,onUpdate:D},null,8,["visible","resource-id","resource-data","is-outer-property","is-check"]),a(Ja,{visible:l.propertyConfigVisible,"onUpdate:visible":i[11]||(i[11]=W=>l.propertyConfigVisible=W),"edit-property-item":l.editPropertyItem,"table-data":l.editTableData,onSave:f,onShowBatchApply:k},null,8,["visible","edit-property-item","table-data"]),a(at,{visible:l.associationSettingsVisible,"onUpdate:visible":i[12]||(i[12]=W=>l.associationSettingsVisible=W),"resource-data":l.editData,"inner-property-item":l.curInnerProperty,"outer-property-item":l.curOuterProperty,onSave:D,onOpenSetting:F},null,8,["visible","resource-data","inner-property-item","outer-property-item"]),a(ml,{visible:l.batchApplyVisible,"onUpdate:visible":i[13]||(i[13]=W=>l.batchApplyVisible=W),"edit-table-data":g.value,onSave:f,onSetBatchApplyResultData:E},null,8,["visible","edit-table-data"]),a(Vl,{visible:O.value,"onUpdate:visible":i[14]||(i[14]=W=>O.value=W),"batch-apply-result-data":h.value},null,8,["visible","batch-apply-result-data"])])),[[z,l.isLoadingData]])]),_:1},8,["modelValue","append-to-dom"])}}});const wo=Ke(to,[["__scopeId","data-v-e3362071"]]),lo={class:"data-source-choose"},oo={class:"item-wrap"},no={class:"item-wrap"},io={class:"item-wrap"},so={key:0,class:"item-wrap"},ro={key:1,class:"item-wrap"},uo={key:2,class:"item-wrap"},co={class:"dialog-footer"},ko=_e({__name:"DataSourceChooseDialog",props:{visible:{type:Boolean,default:!1},curCatalogId:{default:""},isFile:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(G,{emit:te}){const v=G,H=te,y=q(),U=q(),e=v.isFile?Ee():Se(),V=me(()=>e.classifyTreeData),o=ue({dialogVisible:!1,submiting:!1,initData:{name:"",datasourceId:"",tableName:"",category:[],description:""},editData:{name:"",datasourceId:"",tableName:"",category:[],description:""},rules:{datasourceId:[{required:!0,message:"请选择数据源",trigger:"change"}],tableName:[{required:!0,message:"请选择图层",trigger:"change"}],category:[{required:!0,message:"请选择数据类型",trigger:"change"}]},datasourceOptions:[],tableNameOptions:[],cascaderOptions:[],cascaderProps:{expandTrigger:"hover",value:"code",label:"text"},catalogObj:null,treeProps:{label:"name",children:"children",disabled:"no"},treeValueKey:"id"});ce(()=>v.visible,I=>{o.dialogVisible=I});function le(){if(o.editData=ye(o.initData),o.tableNameOptions=[],v.curCatalogId==="#"){const I=V.value.find(D=>D.isDefault);o.catalogObj={id:I==null?void 0:I.id,name:""}}else o.catalogObj={id:v.curCatalogId,name:""};fe(()=>{y.value.clearValidate(),o.catalogObj=U.value.getTypeObj(o.catalogObj.id)}),u()}function l(I){_(I[0],I[1]),o.editData.datasourceId="",o.editData.tableName=""}function _(I,D){const A=v.isFile?"":I,c=v.isFile?"":D;Te.getDatasourceEnum(v.isFile,A,c).then(r=>{r.code==="0000"?o.datasourceOptions=r.data:(o.datasourceOptions=[],de({type:"error",message:"获取数据源失败"}))}).catch(()=>{o.datasourceOptions=[],de({type:"error",message:"获取数据源失败"})})}function M(){o.editData.tableName="";const{category:I}=o.editData;Te.getFilterTablesList({datasourceId:o.editData.datasourceId,dataType:I[0],dataFormat:I[1],hiddenRegister:!0}).then(D=>{if(D.code==="0000"){const{success:A=!1,tables:c=[]}=D.data;A&&c?o.tableNameOptions=c.map(r=>({value:r,label:r})):o.tableNameOptions=[]}else o.tableNameOptions=[]}).catch(()=>{o.tableNameOptions=[]})}function u(){const I=v.isFile?"ywsjzclx":"sjzclx";Ze(I).then(D=>{if(D.code==="0000"){const{data:{[I]:A}}=D;o.cascaderOptions=A||[],o.cascaderOptions.forEach(c=>{var r,f;c.code=c.dictKey,c.text=c.dictValue,((r=c.children)==null?void 0:r.length)===0?delete c.children:(f=c.children)==null||f.forEach(b=>{var R;b.code=b.dictKey,b.text=b.dictValue,((R=b.children)==null?void 0:R.length)===0&&delete b.children})})}else de({type:"warning",message:"请求数据类型失败"})}).catch(D=>{de({type:"error",message:D.message})})}function F(){H("update:visible",!1)}function P(){y.value.validate(I=>{var D,A;if(I){const c=o.editData.category[0],r={dataFormat:o.editData.category[1],dataSize:"",dataType:c,dataTypeAliasName:(A=(D=o.cascaderOptions)==null?void 0:D.find(b=>b.code===c))==null?void 0:A.text,name:o.editData.name||o.editData.tableName,status:"PROCESSED",datasourceId:o.editData.datasourceId,tableName:o.editData.tableName,resourceType:"DB",catalogId:o.catalogObj.id,catalogName:o.catalogObj.name,description:o.editData.description};o.submiting=!0,(v.isFile?ke.registerData:se.addDataResource)(r).then(b=>{o.submiting=!1,b.code==="0000"?(Q({type:"success",title:"数据导入成功"}),F(),H("save")):Q({type:"error",title:"数据导入失败",message:b.message})}).catch(b=>{o.submiting=!1,Q({type:"error",title:"数据导入失败",message:b.message})})}})}return(I,D)=>{const A=p("el-form-item"),c=p("el-input"),r=p("el-cascader"),f=p("el-option"),b=p("el-select"),R=p("el-form"),Y=p("el-button"),ee=p("el-dialog");return n(),L(ee,{modelValue:o.dialogVisible,"onUpdate:modelValue":D[7]||(D[7]=k=>o.dialogVisible=k),class:"center-dialog",title:"注册数据","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"500px",onOpen:le,onClosed:F},{footer:t(()=>[s("span",co,[a(Y,{onClick:D[6]||(D[6]=k=>o.dialogVisible=!1)},{default:t(()=>[N("取 消")]),_:1}),a(Y,{type:"primary",loading:o.submiting,onClick:P},{default:t(()=>[N("确 定")]),_:1},8,["loading"])])]),default:t(()=>[s("div",lo,[a(R,{ref_key:"editForm",ref:y,class:"edit-form",inline:"",model:o.editData,rules:o.rules,"label-width":"120px","label-position":"right"},{default:t(()=>[s("div",oo,[a(A,{label:"所属目录："},{default:t(()=>[a(w(Pe),{ref_key:"selectTreeRef",ref:U,modelValue:o.catalogObj,"onUpdate:modelValue":D[0]||(D[0]=k=>o.catalogObj=k),"tree-props":o.treeProps,"tree-data":V.value,"value-key":o.treeValueKey,style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data","value-key"])]),_:1})]),s("div",no,[a(A,{label:"数据名称：",prop:"name"},{default:t(()=>[a(c,{modelValue:o.editData.name,"onUpdate:modelValue":D[1]||(D[1]=k=>o.editData.name=k),style:{width:"100%"},clearable:"",placeholder:"请输入数据名称"},null,8,["modelValue"])]),_:1})]),s("div",io,[a(A,{label:"数据类型：",prop:"category"},{default:t(()=>[a(r,{modelValue:o.editData.category,"onUpdate:modelValue":D[2]||(D[2]=k=>o.editData.category=k),style:{width:"100%"},options:o.cascaderOptions,props:o.cascaderProps,placeholder:"请选择数据类型",onChange:l},null,8,["modelValue","options","props"])]),_:1})]),o.datasourceOptions.length!==0?(n(),C("div",so,[a(A,{label:"数据源名称：",prop:"datasourceId"},{default:t(()=>[a(b,{modelValue:o.editData.datasourceId,"onUpdate:modelValue":D[3]||(D[3]=k=>o.editData.datasourceId=k),style:{width:"100%"},filterable:"",placeholder:"请选择数据源名称",onChange:M},{default:t(()=>[(n(!0),C(ae,null,ie(o.datasourceOptions,k=>(n(),L(f,{key:k.value,label:k.label,value:k.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):Z("",!0),o.tableNameOptions.length!==0?(n(),C("div",ro,[a(A,{label:"表名：",prop:"tableName"},{default:t(()=>[a(b,{modelValue:o.editData.tableName,"onUpdate:modelValue":D[4]||(D[4]=k=>o.editData.tableName=k),style:{width:"100%"},filterable:"","no-data-text":"数据源连接失败或当前数据源查询表为空",placeholder:"请选择表名"},{default:t(()=>[(n(!0),C(ae,null,ie(o.tableNameOptions,k=>(n(),L(f,{key:k.value,label:k.label,value:k.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):Z("",!0),v.isFile?(n(),C("div",uo,[a(A,{label:"描述：",prop:"description"},{default:t(()=>[a(c,{modelValue:o.editData.description,"onUpdate:modelValue":D[5]||(D[5]=k=>o.editData.description=k),style:{width:"100%"},type:"textarea",clearable:"",autosize:{minRows:3,maxRows:6},maxlength:"100","show-word-limit":"",placeholder:"请输入文本"},null,8,["modelValue"])]),_:1})])):Z("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}});export{wo as D,Vo as _,ko as a,qa as b};
