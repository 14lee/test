import{r as ae,d as j,e as R,o as l,f as $,y as ne,F as Q,x as U,k as s,u as N,z as M,g as c,B as x,j as i,b as W,c as H,w as Z,aE as we,i as ke,N as re,L as fe,U as oe,aD as se,n as ue,ad as ie,l as P,Z as Re,_ as Ae,Q as he,ak as ve,bj as Ce,aj as F,t as ye,aK as $e,v as ge,bk as xe,p as Me}from"./element-plus.59ccb443.js";import{u as X,e as pe,_ as Y}from"./error.229cea25.js";import{l as _e,u as ee,s as be,r as O,S as te,m as Le,n as Ie,q as Ue}from"./login.a4e9287e.js";import{u as de,g as Be,a as Pe,s as Ne,b as Te}from"./index-a95bb620.js";import{A as z}from"./smartweb3.2d5e4c59.js";import{u as De}from"./home.680d2d18.js";import{t as He}from"./lodash.22f463b4.js";import{e as Ve}from"../../app-config.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smart-ui.e8e0134c.js";const le=()=>({theme:ae({headerHeight:"60px",menuItemHeight:"48px",breadcrumbFontSize:"12px",breadcrumbHeight:"16px",tabsHeight:"36px",padding:"16px"})}),Ee=j({__name:"MenuItem",props:{menuList:{}},setup(n){const y=X(),v=n,u=S=>{const k=document.createElement("a");S.meta.path.includes("http")?k.href=S.meta.path:k.href=`http://${S.meta.path}`,k.target=(S.meta.displayArea&z.isShowInNewTab.code)===z.isShowInNewTab.code?"_blank":"",k.click()},e=S=>{if(S.path)if(S.meta.type==="2")if((S.meta.displayArea&z.isShowInNewTab.code)===z.isShowInNewTab.code){const k=y.resolve({name:S.name});window.open(k.href,"_blank")}else y.push({path:S.path});else S.meta.type==="3"&&u(S)};return(S,k)=>{const w=R("MenuItem",!0),t=R("el-sub-menu"),h=R("el-menu-item");return l(!0),$(Q,null,ne(v.menuList,o=>(l(),$(Q,{key:o.path},[o.children&&o.children.length>0?(l(),U(t,{key:0,index:o.path?o.path:o.name},{title:s(()=>[o.meta.icons?(l(),U(N(_e),{key:0,name:o.meta.icons},null,8,["name"])):M("",!0),c("span",null,x(o.meta.title),1)]),default:s(()=>[i(w,{"menu-list":o.children},null,8,["menu-list"])]),_:2},1032,["index"])):(l(),U(h,{key:1,index:o.path?o.path:o.name,onClick:m=>e(o)},{default:s(()=>[o.meta.icons?(l(),U(N(_e),{key:0,name:o.meta.icons},null,8,["name"])):M("",!0),c("span",null,x(o.meta.title),1)]),_:2},1032,["index","onClick"]))],64))),128)}}});const Fe=n=>(Re("data-v-858b13fd"),n=n(),Ae(),n),Oe=["onClick"],We={class:"module-name"},je=Fe(()=>c("span",{class:"underline"},null,-1)),ze={key:0,class:"ellipsis-row"},Ge=j({__name:"BothHeaderMenu",setup(n,{expose:y}){se(a=>({d7a25ed4:N(e).headerHeight}));const v=X(),u=pe(),{theme:e}=le(),S=de(),k=ee(),w=De(),t=W([]),h=W(),o=W([]),m=W(!1),d=W(),D=["UserCenter"],f=H(()=>S.getRouters.filter(a=>a.meta&&(a.meta.displayArea&z.isShowOnMenu.code)===z.isShowOnMenu.code).filter(a=>a.meta&&["2","3"].includes(a.meta.type))),r=a=>{const p=a.path.startsWith("/")?a.path.slice(1,a.path.length):a.path,b=p.includes("http")?p:`http://${p}`;window.open(b,"_blank")},_=a=>{const p=b=>{for(let A=0;A<b.length;A++){if((b[A].meta.displayArea&z.isShowOnMenu.code)===z.isShowOnMenu.code&&b[A].path&&b[A].meta.type==="2")return b[A];if(b[A].children)return p(b[A].children)}};return p(a)||null},L=a=>{const p=b=>{const A=[];return b.filter(C=>C.meta&&(C.meta.displayArea&z.isShowOnMenu.code)===z.isShowOnMenu.code).filter(C=>C.meta.type==="2").forEach(C=>{C.children&&C.children.length!==0&&(C.children=p(C.children)),A.push(C)}),A};return p(a)},B=a=>{if(a.pid==="-1"&&a.meta.cmpPath){if(a.children&&a.children.length!==0){const[p]=a.children;p.meta.type==="2"?v.push({path:p.path}):p.meta.type==="3"&&r(p)}}else if(!a.children||!a.children.length)a.meta.type==="2"?v.push({path:a.path}):a.meta.type==="3"&&r(a);else{const p=_(a.children);p&&(k.setSubMenu(L(a.children)),v.push({path:p.path}))}},J=()=>{let a=!1,p=null,b=!1;const A=C=>{for(let T=0;T<C.length;T++){const E=C[T];E.path===u.path&&(b=!0),E.children&&E.children.length&&A(E.children)}};for(let C=0;C<f.value.length&&!a;C++){if(f.value[C].path===u.path){a=!0,p=N(f.value)[C];break}f.value[C].children&&(A(f.value[C].children),b&&(a=!0,p=N(f.value)[C]))}p&&p.children&&k.setSubMenu(L(p.children))};function G(a,p){const b=a.filter(T=>["2","3"].includes(T.meta.type));let A={};function C(T,E){for(let ce=0;ce<T.length;ce++){const q=T[ce];if(q.path===p){if((q==null?void 0:q.pid)==="-1"){A=q;break}if(E){A=E;break}}q.children&&q.children.length&&C(q.children,E||q)}}return C(b,""),A}const g=H(()=>{const{path:a}=u;if(a.indexOf(D.join(","))>-1)return"";const p=G(f.value,a);return p?p.name??p.id:"home"});Z([g,o],([a,p])=>{p.length&&a&&(m.value=!!p.find(b=>b.name===a))},{immediate:!0});const I=()=>{t.value=f.value,o.value=[]};Z(()=>u.path,a=>{ue(()=>{I(),J()})},{immediate:!0});const V=a=>{ue(()=>{var T;const p=a?(T=a.value)==null?void 0:T.offsetWidth:0,b=Array.from(h.value.children);let A=50;const C=b.findIndex(E=>(A+=E.offsetWidth+40,A>p));if(C===0&&(t.value=[],o.value=f.value),C!==-1){const E=C;E<=0?(t.value=[],o.value=f.value):(t.value=f.value.slice(0,E),o.value=f.value.slice(E,f.value.length))}})};return w.$subscribe((a,p)=>{if(p.activeModulePath){const b=f.value.filter(A=>A.path===p.activeModulePath);b&&b.length&&B(b[0])}}),we(()=>{d.value=ke("navRef")}),k.$subscribe((a,p)=>{p.isRenderLogoView&&(d.value,V(d.value))}),re(()=>{J(),I(),window.onresize=He(()=>{I(),V(d.value)},100)}),fe(()=>{window.onresize=null}),y({menuRef:h}),(a,p)=>{const b=R("el-dropdown-item"),A=R("el-dropdown-menu"),C=R("el-dropdown");return l(),$("div",{ref_key:"menuRef",ref:h,class:"module-menus"},[(l(!0),$(Q,null,ne(t.value,T=>(l(),$("div",{key:T.id,class:oe(["module",{active:g.value===T.name}]),onClick:ie(E=>B(T),["stop"])},[c("span",We,x(T.meta.title),1),je],10,Oe))),128)),o.value.length?(l(),$("div",ze,[i(C,{"popper-class":"nav-menu-dropdown"},{dropdown:s(()=>[i(A,null,{default:s(()=>[(l(!0),$(Q,null,ne(o.value,T=>(l(),U(b,{key:T.id,class:oe({active:g.value===T.name}),onClick:E=>B(T)},{default:s(()=>[P(x(T.meta.title),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),default:s(()=>[c("span",{class:oe(["el-dropdown-link",{active:m.value}])},". . .",2)]),_:1})])):M("",!0)],512)}}});const qe=Y(Ge,[["__scopeId","data-v-858b13fd"]]),Je={key:0,class:"menu"},Ke={class:"menu__collapse"},Qe=j({__name:"BothSideMenu",props:{show:{type:Boolean,default:!0}},setup(n){se(w=>({a63f3aa2:N(y).menuItemHeight}));const{theme:y}=le(),v=ee(),u=X(),e=n,S=H(()=>e.show),k=ae({activePath:""});return Z(()=>u.currentRoute.value,w=>{w&&(k.activePath=w.path)},{immediate:!0}),(w,t)=>{const h=R("el-menu"),o=R("el-scrollbar"),m=R("Expand"),d=R("Fold"),D=R("el-icon");return N(v).getSubMenu.length>0&&S.value?(l(),$("div",Je,[i(o,{style:he({width:`${N(v).getSideBarWidth}`})},{default:s(()=>[i(h,{class:"smart-menu",mode:"vertical",collapse:N(v).getIsSideBarCollapse,"collapse-transition":!1,"default-active":k.activePath},{default:s(()=>[i(Ee,{"menu-list":N(v).getSubMenu},null,8,["menu-list"])]),_:1},8,["collapse","default-active"])]),_:1},8,["style"]),c("div",Ke,[i(D,{onClick:t[0]||(t[0]=f=>N(v).setSideBarCollapse(!N(v).getIsSideBarCollapse))},{default:s(()=>[N(v).getIsSideBarCollapse?(l(),U(m,{key:0})):(l(),U(d,{key:1}))]),_:1})])])):M("",!0)}}});const Ze=Y(Qe,[["__scopeId","data-v-334ed460"]]),Se=""+new URL("../svg/logo-b8dc7000.svg",import.meta.url).href,Xe={key:0,class:"icon"},Ye=["src"],et={class:"title"},tt={class:"main-title"},at={key:0,class:"sub-title"},st=j({__name:"Logo",setup(n){const y=ee(),{systemInfo:v}=be(y),u=X(),e=H(()=>v.value.systemName||""),S=H(()=>v.value.systemSubTitle||""),k=H(()=>v.value.systemIcon||{url:Se}),w=async()=>{try{const h=await Be();if(h.data){const{systemIcon:o,systemName:m,systemSubTitle:d}=h.data;y.setSystemInfo({...y.getSystemInfo,systemIcon:o,systemName:m,systemSubTitle:d}),y.setIsRenderLogoView(!0)}}catch{}},t=()=>{u.replace("/")};return re(()=>{w()}),(h,o)=>{var m,d;return l(),$("div",{class:"logo",onClick:t},[(m=k.value)!=null&&m.url?(l(),$("div",Xe,[c("img",{src:(d=k.value)==null?void 0:d.url,alt:"系统logo"},null,8,Ye)])):M("",!0),c("div",et,[c("span",tt,x(e.value),1),S.value?(l(),$("span",at,x(S.value),1)):M("",!0)])])}}});const ot=Y(st,[["__scopeId","data-v-b45590cd"]]),nt={class:"avatar"},lt={class:"avatar-content"},rt={class:"avatar-content__avatar"},ct={class:"avatar-content__text"},it=j({__name:"Avatar",setup(n){se(o=>({"9068dac8":t.value}));const y=X(),v=ee(),{userInfo:u}=be(v),e=H(()=>u.value.avatarInfo?u.value.avatarInfo.url:Se),S=H(()=>u.value.name?u.value.name:""),k=H(()=>{var o;return u.value&&u.value.name?String.fromCodePoint((o=u.value.name)==null?void 0:o.codePointAt(0)).toUpperCase():""}),w=["#3375b9","#67C23A","#E6A23C","#F56C6C"],t=H(()=>e.value?"#999999":w[Math.floor(Math.random()*w.length)]),h=()=>{ve.confirm("是否确认退出登录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Pe().then(()=>{v.appLogout()})}).catch(()=>{})};return(o,m)=>{const d=R("el-avatar"),D=R("el-dropdown-item"),f=R("el-dropdown-menu"),r=R("el-dropdown");return l(),$(Q,null,[c("div",nt,[i(r,null,{dropdown:s(()=>[i(f,null,{default:s(()=>[i(D,{onClick:m[0]||(m[0]=_=>N(y).push({path:"/UserCenter"}))},{default:s(()=>[P(" 个人中心 ")]),_:1}),i(D,{onClick:m[1]||(m[1]=_=>N(y).push({path:"/personal-center"}))},{default:s(()=>[P(" 个人设置 ")]),_:1})]),_:1})]),default:s(()=>[c("span",lt,[c("div",rt,[i(d,{size:30,src:e.value},{default:s(()=>[P(x(k.value),1)]),_:1},8,["src"])]),c("span",ct,x(S.value),1)])]),_:1})]),c("span",{class:"exit",onClick:h})],64)}}});const pt=Y(it,[["__scopeId","data-v-99ee5dce"]]),dt={class:"content__card"},ut=j({__name:"Content",props:{hasShadow:{type:Boolean,default:!0}},setup(n){se(w=>({"2280f2cd":S.value}));const{theme:y}=le(),v=ee(),u=n,e=H(()=>u.hasShadow),S=H(()=>e.value?"16px":"0px"),k=H(()=>{const w="0px",t=v.getHasBreadcrumb?Number(y.breadcrumbHeight.split("px")[0]):0,h=`${t&&t+16}px`;return`calc(100vh - ${`calc(${S.value} + ${y.headerHeight} + ${w} + ${h})`})`});return(w,t)=>{const h=R("router-view");return l(),$("div",{class:oe(["content",{"has-shadow":e.value,"has-no-shadow":!e.value}]),style:he({height:k.value})},[c("div",dt,[i(h)])],6)}}});const _t=Y(ut,[["__scopeId","data-v-eccaadc9"]]),mt={class:"Breadcrumb"},ft={class:"Breadcrumb__content"},ht=j({__name:"Breadcrumb",setup(n){se(w=>({"47b7a295":N(v).breadcrumbFontSize}));const y=de(),{theme:v}=le(),u=pe(),e=X(),S=W([]),k=()=>{const w=[];function t(h,o){h.forEach(m=>{const d=e.currentRoute.value.meta.isStatic?m.name:m.id,D=e.currentRoute.value.meta.isStatic&&m.meta?m.meta.title:m.name;if(d===o&&(w.push({title:D,path:m.cmpPath?m.path:""}),m.pid!=="-1")){const f=e.currentRoute.value.meta.isStatic?m.meta.pid:m.pid;t(h,f)}})}t(y.getOriginRouters.filter(h=>h.type==="2"),e.currentRoute.value.name),S.value=w.reverse()};return Z(()=>u.path,()=>{k()},{immediate:!0}),(w,t)=>{const h=R("el-breadcrumb-item"),o=R("el-breadcrumb");return l(),$("div",mt,[c("div",ft,[i(o,{separator:"/"},{default:s(()=>[i(Ce,{name:"breadcrumb"},{default:s(()=>[(l(!0),$(Q,null,ne(S.value,m=>(l(),U(h,{key:m.path,to:m.path},{default:s(()=>[P(x(m.title),1)]),_:2},1032,["to"]))),128))]),_:1})]),_:1})])])}}});const vt=Y(ht,[["__scopeId","data-v-286d9260"]]),K={searchSceneApprovalList(n,y,v,u){return O.doGetPromise("/sceneservice/scene/apply/searchApprovalList",{approvalStatus:n,keyword:y,page:v,rows:u})},sceneApprove({id:n,approvalStatus:y,validDays:v,approvalReason:u=""}){return O.doPostPromise("/sceneservice/scene/apply/approve",{id:n,approvalStatus:y,validDays:v,approvalReason:u},{})},sceneBatchApprove({ids:n,approvalStatus:y=1}){return O.doPostPromise("/sceneservice/scene/apply/batchUpdateSceneApprove",{applyRecordIds:n,approvalStatus:y},{})},searchServiceApprovalList(n,y,v,u){return O.doGetPromise("/mapserver/service/apply/searchApprovalList",{approvalStatus:n,keyword:y,page:v,rows:u})},serviceApprove({id:n,approvalStatus:y,validDays:v,approvalReason:u=""}){return O.doPostPromise("/mapserver/service/apply/approve",{id:n,approvalStatus:y,validDays:v,approvalReason:u},{})},serviceBatchApprove({ids:n,approvalStatus:y=1}){return O.doPostPromise("/mapserver/service/apply/batchUpdateServiceApprove",{applyRecordIds:n,approvalStatus:y},{})},searchAllUnReadApprovalList(n){return O.doGetPromise("/sceneservice/scene/apply/searchAllUnReadApprovalList",{userId:n})},searchAllUnReadApplyList(n){return O.doGetPromise("/sceneservice/scene/apply/searchAllUnReadApplyList",{userId:n})},batchUpdateSceneReadStatus(n){return O.doPostPromise("/sceneservice/scene/apply/batchUpdateReadStatus",{ids:n},{})},batchUpdateServiceReadStatus(n){return O.doPostPromise("/mapserver/service/apply/batchUpdateReadStatus",{ids:n},{})},getSceneRecordById(n){return O.doGetPromise("/sceneservice/scene/apply/findByApprovalRecordId",{approvalRecordId:n})},getServiceRecordById(n){return O.doGetPromise("/mapserver/service/apply/findByApprovalRecordId",{approvalRecordId:n})}},yt=""+new URL("../jpg/app-2ba58488.jpg",import.meta.url).href,gt={class:"message-dialog-container"},bt={class:"dialogTitle"},St=c("p",{class:"infoTitle"},"申请信息",-1),wt={class:"infoTitle"},kt={key:0,class:"quickMsg"},Rt={class:"dialog-footer"},At=j({__name:"MessageDialog",props:{info:{type:Object,default:()=>{}},validDaysMap:{type:Map},isApply:{type:Boolean,default:!1}},emits:["closed"],setup(n,{emit:y}){const v=y,u=n,e=ae({dialogVisible:!1,form:{approvalReason:""},isScene:!0,effectiveDuration:7,isProcessing:!1}),S=H(()=>e.isScene?"场景审批详情":"服务审批详情");re(()=>{e.dialogVisible=!0,k()});function k(){e.isScene=u.info.applyRecordType==="scene",h(),u.isApply?o():u.info.approvalRead||o()}function w(){v("closed")}function t(f){e.form.approvalReason=f?"同意使用":"申请理由不清楚"}function h(){const{applyRecordId:f}=u.info,r=e.isScene?"getSceneRecordById":"getServiceRecordById";K[r](f).then(_=>{var L;_.code!==te.SUCCESS?F({type:"warning",message:_.message}):(e.effectiveDuration=_.data.validDays,e.form=_.data,e.form.validDays=u.validDaysMap.get(_.data.validDays),(L=e.form)!=null&&L.phone&&(e.form.phone=Le(e.form.phone)||""))}).catch(_=>{F({type:"warning",message:_.message})})}function o(){const{applyRecordId:f}=u.info,r=e.isScene?"batchUpdateSceneReadStatus":"batchUpdateServiceReadStatus";K[r](f).then(_=>{_.code!==te.SUCCESS&&F({type:"warning",message:_.message})}).catch(_=>{F({type:"warning",message:_.message})})}function m(){const{id:f,approvalReason:r}=e.form,_=e.isScene?"sceneApprove":"serviceApprove",L={id:f,approvalStatus:1,validDays:e.effectiveDuration,approvalReason:r||"同意使用"};D(_,L)}function d(){const{id:f,approvalReason:r}=e.form,_=e.isScene?"sceneApprove":"serviceApprove",L={id:f,approvalStatus:2,validDays:e.effectiveDuration,approvalReason:r||"申请理由不清楚"};D(_,L)}function D(f,r){e.isProcessing=!0,K[f](r).then(_=>{_.code===te.SUCCESS?setTimeout(()=>{e.isProcessing=!1,F({type:"success",message:"审批操作成功"}),w()},400):(e.isProcessing=!1,F({type:"warning",message:r.message}))}).catch(_=>{F({type:"error",message:_.message}),e.isProcessing=!1})}return(f,r)=>{const _=R("el-form-item"),L=R("el-button"),B=R("el-radio"),J=R("el-radio-group"),G=R("el-input"),g=R("el-form"),I=R("el-dialog"),V=ye("loading");return l(),$("div",gt,[i(I,{modelValue:e.dialogVisible,"onUpdate:modelValue":r[4]||(r[4]=a=>e.dialogVisible=a),width:"700px",top:"6vh",center:"","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,class:"message-dialog",onClosed:w},$e({header:s(()=>[c("span",bt,x(S.value),1)]),default:s(()=>[ge((l(),U(g,{ref:"applyForm",class:"applyForm",model:e.form,"label-width":"155px"},{default:s(()=>[St,e.isScene?(l(),U(_,{key:0,label:"申请场景："},{default:s(()=>[c("span",null,x(e.form.sceneName),1)]),_:1})):M("",!0),e.isScene?M("",!0):(l(),U(_,{key:1,label:"服务名称："},{default:s(()=>[c("span",null,x(e.form.serviceName),1)]),_:1})),e.isScene?M("",!0):(l(),U(_,{key:2,label:"服务别名："},{default:s(()=>[c("span",null,x(e.form.serviceAlisName),1)]),_:1})),i(_,{label:"申请人："},{default:s(()=>[c("span",null,x(e.form.applyName),1)]),_:1}),i(_,{label:"所属部门："},{default:s(()=>[c("span",null,x(e.form.applyBelongDept),1)]),_:1}),i(_,{label:"手机号码："},{default:s(()=>[c("span",null,x(e.form.phone),1)]),_:1}),i(_,{label:"电子邮箱："},{default:s(()=>[c("span",null,x(e.form.email),1)]),_:1}),i(_,{label:"申请时间："},{default:s(()=>[c("span",null,x(e.form.applyTime),1)]),_:1}),i(_,{label:"有效期："},{default:s(()=>[c("span",null,x(e.form.validDays),1)]),_:1}),i(_,{label:"申请理由："},{default:s(()=>[c("span",null,x(e.form.applyReason),1)]),_:1}),c("p",wt,[P(" 审批情况 "),e.form.approvalStatus===1?(l(),U(L,{key:0,class:"result",plain:""},{default:s(()=>[P("通过")]),_:1})):M("",!0),e.form.approvalStatus===2?(l(),U(L,{key:1,class:"result fail",plain:""},{default:s(()=>[P(" 拒绝 ")]),_:1})):M("",!0),e.form.approvalStatus===0?(l(),U(L,{key:2,class:"result wait",plain:""},{default:s(()=>[P(" 待审核 ")]),_:1})):M("",!0)]),e.form.approvalStatus!==0?(l(),U(_,{key:3,label:"审核人："},{default:s(()=>[c("span",null,x(e.form.approvalName),1)]),_:1})):M("",!0),n.isApply&&e.form.approvalStatus===1?(l(),U(_,{key:4,label:"有效期："},{default:s(()=>[c("span",null,x(e.form.validDays),1)]),_:1})):M("",!0),!n.isApply&&e.form.approvalStatus===0?(l(),U(_,{key:5,label:"有效期："},{default:s(()=>[i(J,{modelValue:e.effectiveDuration,"onUpdate:modelValue":r[0]||(r[0]=a=>e.effectiveDuration=a)},{default:s(()=>[i(B,{label:7},{default:s(()=>[P("7天")]),_:1}),i(B,{label:30},{default:s(()=>[P("1个月")]),_:1}),i(B,{label:90},{default:s(()=>[P("3个月")]),_:1}),e.isScene?M("",!0):(l(),U(B,{key:0,label:36500},{default:s(()=>[P("永久")]),_:1}))]),_:1},8,["modelValue"])]),_:1})):M("",!0),i(_,{label:"审核意见："},{default:s(()=>[!n.isApply&&e.form.approvalStatus===0?(l(),$("div",kt,[c("a",{class:"success",onClick:r[1]||(r[1]=a=>t(!0))},"同意使用"),c("a",{class:"fail",onClick:r[2]||(r[2]=a=>t(!1))},"申请理由不清楚")])):M("",!0),i(G,{modelValue:e.form.approvalReason,"onUpdate:modelValue":r[3]||(r[3]=a=>e.form.approvalReason=a),type:"textarea",placeholder:"请输入审核意见",rows:3,maxlength:"50","show-word-limit":"",resize:"none",readonly:n.isApply||e.form.approvalStatus!==0},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["model"])),[[V,e.isProcessing]])]),_:2},[!n.isApply&&e.form.approvalStatus===0?{name:"footer",fn:s(()=>[c("span",Rt,[i(L,{type:"primary",disabled:e.isProcessing,plain:"",onClick:m},{default:s(()=>[P(" 通 过 ")]),_:1},8,["disabled"]),i(L,{type:"danger",disabled:e.isProcessing,onClick:d},{default:s(()=>[P(" 拒 绝 ")]),_:1},8,["disabled"])])]),key:"0"}:{name:"footer",fn:s(()=>[c("span",{class:"dialog-footer"},[i(L,{type:"primary",onClick:w},{default:s(()=>[P("关 闭")]),_:1})])]),key:"1"}]),1032,["modelValue"])])}}});const Ct={class:"latestMessageContainer"},$t={key:0,class:"empty"},xt=["onClick"],Mt={class:"list_item_top"},Lt={class:"avader fl"},It=["src"],Ut={key:1,src:yt},Bt={class:"info fl"},Pt={key:0,class:"unread"},Nt={key:1,class:"operation"},Tt={class:"userName"},Dt=["title"],Ht={key:0,class:"validDay"},me=j({__name:"MessageItem",props:{messageList:{type:Array,default:()=>[]},isApply:{type:Boolean,default:!1}},setup(n){const y=n,v=new Map([[7,"7天"],[30,"1个月"],[90,"3个月"],[36500,"永久"]]),u=ae({dialogVisible:!1,info:{}});function e(t){u.info=t,u.dialogVisible=!0}function S(t){const{applyRecordId:h,validDays:o,applyRecordType:m}=t;w(m==="scene"?"sceneApprove":"serviceApprove",{id:h,approvalStatus:1,validDays:o,approvalReason:"同意使用"})}function k(t){const{applyRecordId:h,validDays:o,applyRecordType:m}=t;w(m==="scene"?"sceneApprove":"serviceApprove",{id:h,approvalStatus:2,validDays:o,approvalReason:"申请理由不清楚"})}function w(t,h){K[t](h).then(o=>{o.code===te.SUCCESS?(F({type:"success",message:"审批操作成功"}),y.messageList.forEach(m=>{m.applyRecordId===h.id&&(m.approvalRead=!0,m.approvalStatus=h.approvalStatus)})):F({type:"warning",message:h.message})}).catch(o=>{F({type:"error",message:o.message})})}return(t,h)=>{const o=R("el-button"),m=R("el-scrollbar");return l(),$("div",Ct,[n.messageList.length===0?(l(),$("div",$t,"暂无消息")):(l(),U(m,{key:1},{default:s(()=>[(l(!0),$(Q,null,ne(n.messageList,d=>(l(),$("li",{key:d.id,class:oe({"is-unread":n.isApply&&!d.applyRead||!n.isApply&&!d.approvalRead}),onClick:D=>e(d)},[c("div",Mt,[c("div",Lt,[d.headPictureUrl?(l(),$("img",{key:0,src:d.headPictureUrl},null,8,It)):(l(),$("img",Ut))]),c("div",Bt,[n.isApply&&!d.applyRead||!n.isApply&&!d.approvalRead?(l(),$("span",Pt,"未读")):M("",!0),!n.isApply&&d.approvalStatus===0?(l(),$("div",Nt,[i(o,{type:"primary",text:"",onClick:ie(D=>k(d),["stop"])},{default:s(()=>[P("拒绝")]),_:2},1032,["onClick"]),i(o,{type:"primary",text:"",onClick:ie(D=>S(d),["stop"])},{default:s(()=>[P("通过")]),_:2},1032,["onClick"])])):M("",!0),c("p",null,[c("span",Tt,x(n.isApply?d.approvalName:d.applyName),1),d.approvalStatus===1?(l(),U(o,{key:0,class:"result",plain:""},{default:s(()=>[P("通过")]),_:1})):M("",!0),d.approvalStatus===2?(l(),U(o,{key:1,class:"result fail",plain:""},{default:s(()=>[P(" 拒绝 ")]),_:1})):M("",!0),d.approvalStatus===0?(l(),U(o,{key:2,class:"result wait",plain:""},{default:s(()=>[P(" 待审批 ")]),_:1})):M("",!0)]),c("p",{class:"resourceName",title:d.resourceName},x(d.applyRecordType==="scene"?"申请场景":"服务别名")+"："+x(d.resourceName),9,Dt),c("p",null,[P(" 申请日期："+x(d.applyTime)+" ",1),d.approvalStatus!==2?(l(),$("span",Ht," 有效期："+x(N(v).get(d.validDays)||d.validDays+"天"),1)):M("",!0)])])])],10,xt))),128))]),_:1})),u.dialogVisible?(l(),U(At,{key:2,info:u.info,"is-apply":n.isApply,"valid-days-map":N(v),onClosed:h[0]||(h[0]=d=>u.dialogVisible=!1)},null,8,["info","is-apply","valid-days-map"])):M("",!0)])}}});const Vt={class:"messageContainer"},Et=j({__name:"index",props:{reload:{type:Boolean,default:!1}},emits:["hide"],setup(n,{emit:y}){const v=y,u=n,e=X(),S=ee(),k=W("none"),w=H(()=>S.getUserInfo),t=ae({isLoading:!1,activeName:"myApplication",applyList:[],approvalList:[],unReadApplyListCount:0,unReadApprovalListCount:0,isFirst:!0});Z(()=>u.reload,f=>{if(f){t.isLoading=!0;const r=d(),_=D();Promise.all([r,_]).then(()=>{t.isLoading=!1,k.value!=="admin"?(t.activeName="myApplication",t.unReadApplyListCount=0):(t.activeName="myAudit",t.unReadApprovalListCount=0)})}});function h(){t.unReadApplyListCount=0,t.unReadApprovalListCount=0,t.isFirst=!1}function o(f){f==="myAudit"?e.push({path:"/ApprovalManage"}):e.push({name:"UserCenter"}),v("hide"),m(f)}function m(f){const r=f==="myAudit"?t.approvalList:t.applyList,_=r.filter(B=>B.applyRecordType==="scene").map(B=>B.applyRecordId),L=r.filter(B=>B.applyRecordType==="service").map(B=>B.applyRecordId);try{_.length!==0&&K.batchUpdateSceneReadStatus(_.join(","))}catch(B){F({type:"error",message:B.message||"请求数据失败"})}try{L.length!==0&&K.batchUpdateServiceReadStatus(L.join(","))}catch(B){F({type:"error",message:B.message||"请求数据失败"})}}async function d(){if(k.value==="admin")return!0;const f=w.value.id;try{const r=await K.searchAllUnReadApplyList(f);return r.code===te.SUCCESS?(t.applyList=r.data,t.isFirst&&(t.unReadApplyListCount=r.data.length),!0):(t.applyList=[],F({type:"warning",message:r.message}),!1)}catch(r){return t.applyList=[],F({type:"error",message:r.message||"请求数据失败"}),!1}}async function D(){const f=w.value.id;try{const r=await K.searchAllUnReadApprovalList(f);return r.code===te.SUCCESS?(t.approvalList=r.data,t.isFirst&&(t.unReadApprovalListCount=r.data.length),!0):(t.approvalList=[],F({type:"warning",message:r.message}),!1)}catch(r){return t.approvalList=[],F({type:"error",message:r.message||"请求数据失败"}),!1}}return(f,r)=>{const _=R("el-badge"),L=R("el-tab-pane"),B=R("el-tabs"),J=ye("loading");return ge((l(),$("div",Vt,[i(B,{modelValue:t.activeName,"onUpdate:modelValue":r[0]||(r[0]=G=>t.activeName=G),onTabClick:h},{default:s(()=>[k.value!=="admin"?(l(),U(L,{key:0,name:"myApplication"},{label:s(()=>[c("span",null,[i(_,{class:"customBadge",hidden:!t.unReadApplyListCount,value:t.unReadApplyListCount,max:99},{default:s(()=>[P(" 我的申请 ")]),_:1},8,["hidden","value"])])]),default:s(()=>[i(me,{"message-list":t.applyList,"is-apply":""},null,8,["message-list"])]),_:1})):M("",!0),i(L,{name:"myAudit"},{label:s(()=>[c("span",null,[i(_,{class:"customBadge",hidden:!t.unReadApprovalListCount,value:t.unReadApprovalListCount,max:99},{default:s(()=>[P(" 我的审核 ")]),_:1},8,["hidden","value"])])]),default:s(()=>[i(me,{"message-list":t.approvalList},null,8,["message-list"])]),_:1})]),_:1},8,["modelValue"]),c("span",{class:"all",onClick:r[1]||(r[1]=G=>o(t.activeName))},"查看更多 >>")])),[[J,t.isLoading]])}}});const Ft=Ie(Ve.VITE_APP_BASE_URL),Ot={class:"layout"},Wt={class:"layout__header"},jt={class:"layout__header__notice"},zt={class:"layout__content"},Gt={class:"layout__content__sidebar"},qt={class:"layout__content__main"},Jt={class:"layout__content__main__container"},Kt={key:0,class:"layout__content__main__container__navbar"},Qt={class:"layout__content__main__container__content"},Zt=j({__name:"Layout",setup(n){se(g=>({"47552f81":N(u).headerHeight,"5d62821c":N(u).tabsHeight,"2bea8df7":N(u).breadcrumbHeight}));const y=W(""),v=W(),{theme:u}=le(),e=ee(),S=de(),k=pe(),w=W();Me("navRef",v);const t=ae({unreadMessage:0,msgReload:!1,websocket:null}),h=H(()=>e.getUserInfo),o=H(()=>e.getHasBreadcrumb),m=H(()=>f(k.path,S.getRouters)),d=W(!1),D=H(()=>{const g=S.getRouters,I=[];function V(a){a.forEach(p=>{Reflect.has(p,"children")&&p.children.length?V(p.children):I.push(p)})}return V(g),I});Z(()=>k.path,g=>{if(g==="/home"){e.setBreadcrumb(!1);return}const I=D.value.find(a=>a.path===g?(document.title=a.meta.title,!0):!1),V=Reflect.has(I.meta,"iframeUrl")&&I.pid!=="-1"||!Reflect.has(I.meta,"iframeUrl")||Reflect.has(I.meta,"isStatic");e.setBreadcrumb(V)},{immediate:!0});function f(g,I){if(g.indexOf("micro")>-1)return d.value=!1,!0;let V=!1;const a=p=>{p.filter(b=>{var A;return["2","3"].includes((A=b.meta)==null?void 0:A.type)}).forEach(b=>{b.path===g&&(b==null?void 0:b.pid)!=="-1"?V=!0:b.children&&b.children.length&&a(b.children)})};return a(I),d.value=V,V}const r=g=>{ve.alert(g,"警告",{type:"warning",showClose:!1})},_=async()=>{try{const g=await Ne();g.data&&(e.setUserInfo(g.data),g.data.auditTips&&r(g.data.auditTips),g.data.id&&(y.value=g.data.id))}catch{}},L=async()=>{try{const g=await Te();g.data&&r(g.data)}catch{}};function B(){var g;(g=w.value)==null||g.hide()}function J(){t.unreadMessage=0}Z(()=>h.value.id,g=>{var I;g?G():window.WebSocket&&((I=t.websocket)==null||I.close())});function G(){var g;(g=h.value)!=null&&g.id&&window.WebSocket&&(t.websocket=new WebSocket(`${Ft}/certification/websocket?userId=${y.value}_${Ue()}`),t.websocket.onopen=function(){},t.websocket.onclose=function(){},t.websocket.onmessage=I=>{const V=JSON.parse(I.data),{totalMyApplyMessageCount:a=0,totalMyApproval:p=0}=V;t.unreadMessage=a+p},t.websocket.onerror=function(){})}return fe(()=>{var g;window.WebSocket&&((g=t.websocket)==null||g.close())}),re(async()=>{await _(),G(),await L()}),(g,I)=>{const V=R("el-icon"),a=R("el-badge"),p=R("el-popover"),b=R("WebsocketNotification");return l(),$("div",Ot,[c("div",Wt,[i(ot),c("div",{ref_key:"navRef",ref:v,class:"layout__header__nav"},[i(N(qe))],512),c("div",jt,[i(p,{ref_key:"popoverRef",ref:w,"show-arrow":!1,"popper-class":"messagePopper",placement:"bottom-end",width:"506px",trigger:"click",onShow:I[0]||(I[0]=A=>t.msgReload=!0),onHide:I[1]||(I[1]=A=>t.msgReload=!1)},{reference:s(()=>[i(a,{"is-dot":t.unreadMessage>0,onClick:J},{default:s(()=>[i(V,{title:t.unreadMessage===0||t.unreadMessage==="0"?"消息":`${t.unreadMessage}条未读消息`,class:"icon"},{default:s(()=>[i(N(xe))]),_:1},8,["title"])]),_:1},8,["is-dot"])]),default:s(()=>[i(Et,{reload:t.msgReload,onHide:B},null,8,["reload"])]),_:1},512)]),i(pt)]),c("div",zt,[c("div",Gt,[i(N(Ze),{show:m.value},null,8,["show"])]),c("div",qt,[c("div",Jt,[o.value?(l(),$("div",Kt,[i(vt)])):M("",!0),c("div",Qt,[i(_t,{"has-shadow":d.value},null,8,["has-shadow"])])])])]),i(b,{"user-id":y.value},null,8,["user-id"])])}}});const ia=Y(Zt,[["__scopeId","data-v-a4ec9989"]]);export{ia as default};
