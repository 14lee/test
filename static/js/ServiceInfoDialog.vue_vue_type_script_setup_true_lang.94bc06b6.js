import{d as O,r as j,w as R,aj as d,e as c,t as M,o as y,x as C,k as o,j as t,u as I,l as T,v as P,f as z,g as n,B as r,U as h,z as F}from"./element-plus.59ccb443.js";import{r as $,S as k,x as q}from"./login.a4e9287e.js";import{g as G}from"./index.81042689.js";const w=p=>$.doGetPromise(`/mapserver/manager/services/${p}`),H={class:"modal-content","element-loading-text":"数据加载中..."},W=O({__name:"ServiceInfoDialog",props:{dialogTop:{type:String,default:"10vh"},appendToBody:{type:Boolean,default:!1},visible:Boolean,currentItem:{type:Object,default:()=>{}},isApply:{type:Boolean,default:!1},customClass:{type:String,default:""}},emits:["closed"],setup(p,{emit:V}){const x=V,i=p,B=new Map([[0,"公开"],[1,"受限"]]),e=j({dialogVisible:!1,form:{},isLoading:!1});R(()=>i.visible,s=>{s?D():e.dialogVisible=!1});function U(){N(i.currentItem.serviceId)}function m(){x("closed")}function N(s){e.isLoading=!0,w(s).then(a=>{e.isLoading=!1,a.code===k.SUCCESS?(e.form=a.data,e.form.approvalStatus=i.currentItem.approvalStatus,e.form.serviceUrl=i.currentItem.serviceUrl):d({type:"warning",message:a.message})}).catch(a=>{e.isLoading=!1,d({type:"error",message:a.message||"请求数据失败"})})}function D(){w(i.currentItem.serviceId).then(s=>{s.code===k.SUCCESS?e.dialogVisible=!0:(d.info("该服务已经删除"),m())}).catch(()=>{m(),d.info("该服务已经删除")})}function E(s){const{id:a,category:l,serviceUrl:f,approvalStatus:u,name:g,serviceType:v}=s;if(u===1&&!b(l)){const _=G({category:l,id:a,serviceType:v,name:g,url:f});window.open(_)}}function b(s){return s==="TERRAIN"||s==="VECTORICON"}function L(){return i.isApply?i.currentItem.isPassed:e.form.approvalStatus===1||e.form.approvalStatus===3}return(s,a)=>{const l=c("el-form-item"),f=c("el-text"),u=c("el-tooltip"),g=c("el-form"),v=c("el-button"),_=c("el-dialog"),A=M("loading");return y(),C(_,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[1]||(a[1]=S=>e.dialogVisible=S),title:"服务详情",class:h(p.customClass+" serviceInfoDialog"),"close-on-click-modal":!1,width:"660px",top:p.dialogTop,"append-to-body":p.appendToBody,center:"",onOpen:U,onClosed:m},{footer:o(()=>[t(I(q),{justify:"end"},{default:o(()=>[t(v,{type:"primary",onClick:m},{default:o(()=>[T("关 闭")]),_:1})]),_:1})]),default:o(()=>[P((y(),z("div",H,[t(g,{ref:"approvalForm",class:"approvalForm",model:e.form,"label-width":"160px"},{default:o(()=>[t(l,{label:"服务名称 : ",prop:"name"},{default:o(()=>[n("span",null,r(e.form.name),1)]),_:1}),t(l,{label:"服务别名 : ",prop:"aliasName"},{default:o(()=>[n("span",null,r(e.form.aliasName),1)]),_:1}),t(l,{label:"服务类型 : ",prop:"categoryAliasName"},{default:o(()=>[n("span",null,r(e.form.categoryAliasName),1)]),_:1}),t(l,{label:"服务说明 : ",prop:"description"},{default:o(()=>[n("span",{class:h({empty:!e.form.description})},r(e.form.description||"未说明"),3)]),_:1}),t(l,{label:"发布人 : ",prop:"creator"},{default:o(()=>[n("span",null,r(e.form.creator),1)]),_:1}),t(l,{label:"发布时间 : ",prop:"createTime"},{default:o(()=>[n("span",null,r(e.form.createTime),1)]),_:1}),t(l,{label:"服务权限 : ",prop:"permissionType"},{default:o(()=>[n("span",null,r(I(B).get(e.form.permissionType)),1)]),_:1}),t(l,{label:"访问次数 : ",prop:"accessCount"},{default:o(()=>[n("span",null,r(e.form.accessCount),1)]),_:1}),L()?(y(),C(l,{key:0,label:"服务申请链接 : ",prop:"serviceUrl",class:"apply-link"},{default:o(()=>[t(u,{content:e.form.serviceUrl,effect:"light"},{default:o(()=>[t(f,{"line-clamp":"1",type:"primary",disabled:b(e.form.category)||e.form.approvalStatus!==1,onClick:a[0]||(a[0]=S=>E(e.form))},{default:o(()=>[T(r(e.form.serviceUrl),1)]),_:1},8,["disabled"])]),_:1},8,["content"])]),_:1})):F("",!0)]),_:1},8,["model"])])),[[A,e.isLoading]])]),_:1},8,["modelValue","class","top","append-to-body"])}}});export{W as _};
