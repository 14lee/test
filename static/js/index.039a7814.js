import{d as fe,r as ce,b as z,w as _e,e as D,t as ge,o as f,x as E,k as p,g as s,j as d,u as c,v as H,f as S,F as te,y as ye,a6 as ke,l as N,n as Ee,aj as $,a4 as Pe,N as we,L as ze,T as Ae,ad as G,B as C,ae as oe,Z as Be,_ as Re,bc as Me,U as re,z as ee,ai as P,S as Oe,bo as We,ak as Ve}from"./element-plus.59ccb443.js";import{q as le,v as be}from"./lodash.22f463b4.js";import{M as He,H as de,G as je,v as Fe,E as Te,B as xe,P as Ge,S as Ke,U as qe,V as Ze,W as Xe,X as Ne,Q as Ye,Y as Je,Z as Qe,_ as et,$ as Ie}from"./PublishFieldBox.e4cc4538.js";import{y as $e,o as tt,a as at,t as ot,x as lt,z as it,A as st,v as nt}from"./login.a4e9287e.js";import{l as dt,m as rt,S as Le,D as w,d as ct,g as pt}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import"./index-a95bb620.js";import{u as ut}from"./useTableAndPagination.0c6e0294.js";import{_ as ft}from"./error.229cea25.js";import"./wujie-vue3.9ecbe737.js";import"../../app-config.js";import"./echarts.39e3cf74.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";const gt={class:"top toolbar"},mt={class:"table center"},ht={class:"bottom pagination"},vt={key:1},bt={class:"operation"},_t=fe({__name:"SelectSpaceDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(A,{emit:J}){const j=J,F=A,_=ce({submiting:!1,form:{keyword:""},isLoadingTable:!1,tableData:[],colDatas:[{prop:"spaceCode",label:"空间标识",minWidth:150},{prop:"nameSpace",label:"空间名称",minWidth:150},{prop:"creator",label:"创建人",minWidth:120},{prop:"createTime",label:"创建时间",minWidth:180},{prop:"description",label:"描述",minWidth:180}],curSelectObj:{}}),b=[{label:"关键字",key:"keyword",type:"text",placeholder:"空间标识/空间名称/创建人",span:8,value:_.form.keyword}],u=z(!1),g=z(),T=z();_e(()=>F.visible,()=>{u.value=F.visible});const{currentPage:e,pageSize:k,pageSizes:I,total:M,maxHeight:B,handleSizeChange:K,handleCurrentPageChange:q,resize:X}=ut(g,T,Y);function R(){_.tableData=[],_.curSelectObj={},_.form.keyword="",O()}function U(){j("update:visible",!1)}function O(l){l&&(_.form.keyword=l.keyword),e.value=1,Y()}function Y(){_.isLoadingTable=!0;const l={page:e.value,rows:k.value,..._.form};He(l).then(i=>{_.isLoadingTable=!1,i.code==="0000"?(_.tableData=i.data?i.data.records:[],M.value=i.data?i.data.total:0,Ee(()=>{X()})):$({type:"error",message:i.message||"获取图谱空间列表失败"})}).catch(i=>{_.isLoadingTable=!1,$({type:"error",message:i.message||"获取图谱空间列表错误"})})}function r(l){_.curSelectObj=le.cloneDeep(l)}function o(){j("save",_.curSelectObj),U()}return(l,i)=>{const n=D("el-table-column"),a=D("el-table"),t=D("el-pagination"),h=D("el-button"),x=D("el-dialog"),V=ge("loading");return f(),E(x,{modelValue:u.value,"onUpdate:modelValue":i[3]||(i[3]=v=>u.value=v),class:"center-dialog select-space-dialog",title:"选择图谱数据","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"1000px",onOpen:R,onClosed:U},{default:p(()=>{var v;return[s("div",{ref_key:"mainContainerRef",ref:g,class:"common-flex-container main-content"},[s("div",gt,[d(c($e),{ref:"SmartSearchRef",options:b,onHandleSearch:O},null,512)]),s("div",mt,[H((f(),E(a,{ref_key:"tableRef",ref:T,class:"space-table","element-loading-text":"拼命加载中...",style:{width:"100%"},data:_.tableData,"max-height":c(B),"row-key":"id","highlight-current-row":"","row-class-name":"table-row",onCurrentChange:r},{default:p(()=>[(f(!0),S(te,null,ye(_.colDatas,y=>(f(),E(n,{key:y.prop,prop:y.prop,label:y.label,width:y.width,"min-width":y.minWidth,sortable:"",align:"center"},null,8,["prop","label","width","min-width"]))),128))]),_:1},8,["data","max-height"])),[[V,_.isLoadingTable]])]),s("div",ht,[c(M)&&c(M)>0?(f(),E(t,{key:0,"current-page":c(e),"onUpdate:currentPage":i[0]||(i[0]=y=>ke(e)?e.value=y:null),"page-size":c(k),"onUpdate:pageSize":i[1]||(i[1]=y=>ke(k)?k.value=y:null),layout:"total, sizes, prev, pager, next","page-sizes":c(I),background:"",total:c(M),onSizeChange:c(K),onCurrentChange:c(q)},null,8,["current-page","page-size","page-sizes","total","onSizeChange","onCurrentChange"])):(f(),S("div",vt)),s("div",bt,[d(h,{onClick:i[2]||(i[2]=y=>u.value=!1)},{default:p(()=>[N("取 消")]),_:1}),d(h,{type:"primary",loading:_.submiting,disabled:!((v=_.curSelectObj)!=null&&v.id),onClick:o},{default:p(()=>[N(" 确 定 ")]),_:1},8,["loading","disabled"])])])],512)]}),_:1},8,["modelValue"])}}});const yt=A=>(Be("data-v-b5395369"),A=A(),Re(),A),wt={class:"diagram-main-content"},Dt={class:"header-box"},St={class:"title"},Ct=yt(()=>s("span",{class:"text fontWeight last"},"服务预览",-1)),kt=["id"],Vt={class:"info-container"},Tt={class:"title"},xt={class:"label"},It={class:"props-list"},Et={class:"label-name"},Nt=["title"],$t=["title"],Lt=["title"],Ut=["title"],Pt={style:{width:"120px"}},zt={class:"menu-ul"},At=fe({__name:"PreviewGraphDialog",props:{visible:{type:Boolean,default:!1},containerId:{default:"diagarm-container"},previewData:{default:()=>({node:[],edges:[]})}},emits:["update:visible"],setup(A,{emit:J}){const j=J,F=A,_=z(),b=z(),u=Pe({graph:null}),g=ce({dialogVisible:!1,colorList:["#7390ca","#22a3b5","#554a73","#c0b9fd","#66d6c0"],isLodingInfo:!1,showInfoVisible:!1,curShowInfo:{}});_e(()=>F.visible,r=>{g.dialogVisible=r}),we(()=>{M(),tt(window,"resize",q)}),ze(()=>{at(window,"resize",q)}),Ae(()=>{var r;!u.graph||u.graph.get("destroyed")||((r=u.graph)==null||r.destroy(),u.graph=null)});function T(){const r=le.cloneDeep(F.previewData);de.Util.processParallelEdges(r.edges,15,"quadratic","line","loop"),r.edges.forEach(o=>{o.type==="loop"&&(o.style={endArrow:{path:de.Arrow.vee(4,6,0),d:0}})}),r.nodes.forEach(o=>{const l=Math.floor(Math.random()*g.colorList.length);o.style={fill:g.colorList[l],stroke:g.colorList[l],fillOpacity:1}}),Ee(()=>{var i,n;const o=(i=_.value)==null?void 0:i.offsetWidth,l=(n=_.value)==null?void 0:n.offsetHeight;if(q(),r.nodes.length===1){const a=Math.floor(o/2-20),t=Math.floor(l/2-20);r.nodes[0].x=a,r.nodes[0].y=t}u.graph.data({nodes:r.nodes,edges:r.edges}),u.graph.render(),setTimeout(()=>{X();const a=u.graph.getNodes();for(let t=0;t<a.length;t++)a[t].setState("expanded",!0)},20)})}function e(){O(),U(),g.showInfoVisible=!1,u.graph.setMode("default"),j("update:visible",!1),!(!u.graph||u.graph.get("destroyed"))&&u.graph.clear()}function k(r,o,l){const i=r.getNeighbors("target").filter(n=>n._cfg.id!==o&&n._cfg.id!==r._cfg.id&&n.isVisible());for(let n=0;n<i.length;n++)l?l.get("model").id!==i[n].get("model").id&&(u.graph.hideItem(i[n]),k(i[n],o,r)):(u.graph.hideItem(i[n]),k(i[n],o,r))}function I(r,o){if(r.getStates().includes("expanded")){const i=r.getNeighbors("target").filter(n=>n._cfg.id!==r._cfg.id);for(let n=0;n<i.length;n++)o.get("model").id!==i[n].get("model").id&&!i[n].isVisible()&&(u.graph.showItem(i[n]),I(i[n],r))}}function M(){const r=new de.Menu({className:"node-menu-container",offsetX:6,offsetY:10,itemTypes:["node"],getContent:o=>{U();const l=o.item.getStates(),i=o.item.getModel(),n=l.includes("expanded")?"收起":"拓展",a=l.includes("searched")&&(i==null?void 0:i.targetCount)===0,t=document.createElement("div");return t.style.width="100px",t.innerHTML=`<ul class="menu-ul">
        <li class="${a?"disable":""}" action="expand">${n}</li>
      </ul>`,t},handleMenuClick:(o,l)=>{var n;if(o.getAttribute("action")==="expand"&&((n=l.getModel())==null?void 0:n.targetCount)===0)return;O();const i=l.getStates();if(o.getAttribute("action")==="expand"){const a=l.getNeighbors("target");if(i.includes("expanded"))k(l,l._cfg.id),l.setState("expanded",!1);else{for(let t=0;t<a.length;t++)u.graph.showItem(a[t]),I(a[t],l);l.setState("expanded",!0)}}}});u.graph=new de.Graph({container:F.containerId,width:600,height:500,minZoom:.4,linkCenter:!0,layout:{type:"force",linkDistance:o=>{var l,i;return((l=o.source)==null?void 0:l.targetCount)<15?180:((i=o.source)==null?void 0:i.targetCount)<30?250:300},nodeStrength:o=>o!=null&&o.isLeaf?-10:-25,preventOverlap:!0},defaultNode:{color:"#5B8FF9",size:je,style:{cursor:"pointer"},labelCfg:{style:{cursor:"pointer",fill:"#666",opacity:0}}},defaultEdge:{style:{endArrow:{path:de.Arrow.vee(4,6,10),d:0},cursor:"pointer",lineAppendWidth:6},labelCfg:{autoRotate:!0,style:{cursor:"pointer",fill:"#999",stroke:"white",lineWidth:5}}},nodeStateStyles:{"displayState:ash":{fill:"#f4f4f4",stroke:"#ccc"}},edgeStateStyles:{"displayState:ash":{stroke:"#ccc"}},modes:{default:["drag-canvas","zoom-canvas","drag-node","activate-relations",{type:"click-select",selectEdge:!0}],setStyleMode:["drag-canvas","zoom-canvas"]},plugins:[r]}),u.graph.on("node:dragstart",o=>{u.graph.layout(),B(o)}),u.graph.on("node:drag",o=>{B(o)}),u.graph.on("node:dragend",o=>{o.item.get("model").fx=null,o.item.get("model").fy=null}),u.graph.on("node:click",o=>{U()}),u.graph.on("node:dblclick",o=>{}),u.graph.on("node:mouseenter",o=>{const l=o.item.getModel();l.labelCfg.style.opacity=1,o.item.refresh()}),u.graph.on("node:mouseleave",o=>{const l=o.item.getModel();l.labelCfg.style.opacity=0,o.item.refresh()}),u.graph.on("nodeselectchange",o=>{var i,n;if(O(),!o.target){g.showInfoVisible=!1;return}const{type:l}=o.target._cfg;l==="node"&&o.select&&o.selectedItems.nodes.length===1?K((i=o.target)==null?void 0:i._cfg.model):l==="edge"&&o.select&&o.selectedItems.edges.length===1?K((n=o.target)==null?void 0:n._cfg.model):g.showInfoVisible=!1}),u.graph.on("canvas:click",o=>{U()}),u.graph.on("canvas:contextmenu",o=>{const l=b.value;l&&(l.style.left=`${o.canvasX}px`,l.style.top=`${o.canvasY}px`,l.style.visibility="visible")})}function B(r){const o=r.item.get("model");o.fx=r.x,o.fy=r.y}function K(r){g.isLodingInfo=!0,g.showInfoVisible=!0;const{id:o,objectId:l,spaceId:i}=r;Fe(o,l,i).then(n=>{n.code==="0000"&&(n!=null&&n.data)?(g.curShowInfo=le.cloneDeep(n.data),g.showInfoVisible=!0):$({type:"error",message:"获取信息失败"})}).catch(()=>{$({type:"error",message:"获取信息错误"})}).finally(()=>{g.isLodingInfo=!1})}function q(){var l,i;if(!u.graph||u.graph.get("destroyed"))return;const r=(l=_.value)==null?void 0:l.offsetWidth,o=(i=_.value)==null?void 0:i.offsetHeight;!_.value||!r||!o||u.graph.changeSize(r,o)}function X(){u.graph.zoomTo(1),setTimeout(()=>{u.graph.fitCenter()},50),U()}function R(){const r=u.graph.getNodes();for(let l=0;l<r.length;l++)u.graph.setItemState(r[l],"displayState",xe.SHOW),u.graph.showItem(r[l]),r[l].enableCapture(!0);const o=u.graph.getEdges();for(let l=0;l<o.length;l++)o[l].enableCapture(!0),u.graph.setItemState(o[l],"displayState",xe.SHOW);U(),setTimeout(()=>{const l=u.graph.getNodes();for(let i=0;i<l.length;i++)l[i].setState("expanded",!0)},100)}function U(){const r=b.value;r&&(r.style.visibility="hidden")}function O(){var o;const r=(o=_.value)==null?void 0:o.querySelector(".node-menu-container");r.style.visibility="hidden"}function Y(){const r=u.graph.findById(g.curShowInfo.id);r&&r.setState("selected",!1),g.showInfoVisible=!1}return(r,o)=>{const l=D("ArrowLeftBold"),i=D("el-icon"),n=D("Close"),a=ge("loading");return f(),E(c(Le),{id:"preview-graph-dialog",modelValue:g.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=t=>g.dialogVisible=t),class:"full-dialog","modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:T,onClosed:e},{default:p(()=>{var t;return[s("div",wt,[s("div",Dt,[s("div",St,[s("div",{class:"back-icon",onClick:e},[d(i,null,{default:p(()=>[d(l)]),_:1})]),Ct])]),s("div",{ref_key:"mainRef",ref:_,class:"main"},[s("div",{id:r.containerId,class:"diagarm-container",onContextmenu:o[0]||(o[0]=G(()=>{},["prevent"]))},null,40,kt),H((f(),S("div",Vt,[s("div",{class:"close-icon",onClick:Y},[d(i,null,{default:p(()=>[d(n)]),_:1})]),s("div",Tt,C(g.curShowInfo.entityType===c(Te).OBJECT?"实体属性":"关系属性"),1),s("span",xt,C(g.curShowInfo.objectName),1),s("div",It,[(f(!0),S(te,null,ye((t=g.curShowInfo)==null?void 0:t.templateDataFieldList,h=>(f(),S("div",{key:h.name,class:"props-flex"},[s("div",Et,C(h.aliasName)+"：",1),g.curShowInfo.entityType===c(Te).OBJECT?(f(),S("div",{key:0,class:"value",title:h.value},C(h.value),9,Nt)):(f(),S(te,{key:1},[h.name===c(dt)?(f(),S("div",{key:0,class:"value",title:g.curShowInfo.sourceName},C(g.curShowInfo.sourceName),9,$t)):h.name===c(rt)?(f(),S("div",{key:1,class:"value",title:g.curShowInfo.targetName},C(g.curShowInfo.targetName),9,Lt)):(f(),S("div",{key:2,class:"value",title:h.value},C(h.value),9,Ut))],64))]))),128))])])),[[oe,g.showInfoVisible],[a,g.isLodingInfo]]),s("div",{ref_key:"contextMenuRef",ref:b,class:"context-menu-container",style:{position:"absolute",top:"294px",left:"643px",visibility:"hidden"}},[s("div",Pt,[s("ul",zt,[s("li",{onClick:G(R,["stop"])},"恢复拓展/收起"),s("li",{onClick:G(X,["stop"])},"恢复缩放/居中")])])],512)],512)])]}),_:1},8,["modelValue"])}}});const Ue=ft(At,[["__scopeId","data-v-b5395369"]]),Bt={class:"main-content"},Rt={class:"title"},Mt={class:"card"},Ot=s("div",{class:"subtitle"},"服务信息",-1),Wt={class:"content-wrap"},Ht={class:"item-wrap item2"},jt={key:1},Ft={class:"item-wrap item2"},Gt={key:1},Kt={class:"item-wrap"},qt={key:0,class:"item-wrap item2"},Zt={key:1,class:"item-wrap"},Xt={class:"link"},Yt={key:2,class:"item-wrap"},Jt={key:0,class:"card"},Qt=s("div",{class:"subtitle"},"版本信息",-1),ea={class:"table content-wrap"},ta=["title"],aa=["onClick"],oa={class:"card"},la=s("span",{class:"text"},"数据信息",-1),ia={class:"content-wrap"},sa={class:"item-wrap item2 mb0"},na={class:"none-select"},da={class:"card"},ra=s("div",{class:"subtitle"},"筛选条件",-1),ca=s("p",null,[s("span",{style:{"font-size":"16px",color:"#ff8282"}},"*"),N(" 对象 ")],-1),pa={key:0,class:"content-wrap"},ua=s("div",{id:"anchorPoint",style:{overflow:"hidden"}},null,-1),fa={class:"footer"},ga=fe({__name:"GraphServerInfoDialog",props:{visible:{type:Boolean,default:!1},dialogType:{default:w.CHECK},domId:{default:""},curEditData:{default:()=>{}}},emits:["update:visible","changeEdit","save"],setup(A,{emit:J}){const j=z(),F=z(),_=z(),b=A,u=J,g=z({});Me(()=>{g.value={}});let T;const e=ce({dialogVisible:!1,loading:!1,submiting:!1,initData:{id:"",name:"",aliasName:"",type:"",status:0,description:"",creator:"",publishTime:"",url:"",versions:[]},editData:{},rules:{aliasName:[{required:!0,message:"服务名称不能为空",trigger:"blur"},{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]}],description:[{min:0,max:100,message:"长度在 100 个字符以内",trigger:["blur","change"]}]},curVersionInfo:{id:"",version:""},spaceDialogVisible:!1,selectSpaceData:{},boxList:[],loadingVersion:!1,previewDialogVisible:!1,previewData:{nodes:[],edges:[]},isLoadingData:!1}),k=z("data"),I=z(!1);_e(()=>b.visible,a=>{e.dialogVisible=a});function M(){e.selectSpaceData={},e.boxList=[],g.value={},k.value="data",I.value=!1,e.isLoadingData=!1,j.value.clearValidate(),q(b.curEditData.id)}function B(){var a;e.previewDialogVisible=!1,(a=T==null?void 0:T.abort)==null||a.call(T),u("update:visible",!1)}function K(a){var t;e.previewDialogVisible=!1,(t=T==null?void 0:T.abort)==null||t.call(T),u("changeEdit",a)}function q(a){e.loading=!0,e.loadingVersion=!0,Ke(a).then(t=>{if(t.code==="0000"){X(a),e.editData=le.cloneDeep(e.initData),e.curVersionInfo={id:t.data.versionId,version:t.data.versionName};for(const h in e.initData)e.editData[h]=t.data[h]??e.initData[h]}else $({type:"error",message:"获取信息失败"}),e.loadingVersion=!1,e.editData={}}).catch(()=>{$({type:"error",message:"获取信息错误"}),e.loadingVersion=!1,e.editData={}}).finally(()=>{e.loading=!1})}function X(a){qe(a).then(t=>{t.code==="0000"?e.editData.versions=le.cloneDeep(t.data):$({type:"error",message:"获取版本信息失败"})}).catch(()=>{$({type:"error",message:"获取版本信息错误"})}).finally(()=>{e.loadingVersion=!1})}function R({id:a,versionName:t}){Ze(a).then(h=>{h.code==="0000"?(P({type:"success",title:"设置版本成功"}),e.curVersionInfo={id:a,version:t},u("save")):P({type:"error",title:"设置版本失败",message:h.message})}).catch(h=>{P({type:"error",title:"设置版本错误",message:h.message})})}function U(a){Xe(a.id).then(t=>{t.code==="0000"&&t.data?(P({type:"success",title:"删除版本成功"}),e.editData.versions=e.editData.versions.filter(h=>h.id!==a.id),u("save")):P({type:"error",title:"删除版本失败",message:t.message})}).catch(t=>{P({type:"error",title:"删除版本错误",message:t.message})})}function O(a){e.isLoadingData=!0,T=new AbortController,Ne(a.previewUrl,T.signal).then(t=>{const{code:h,data:{edges:x,nodes:V}}=t;h==="0000"?(e.previewData.nodes=V??[],e.previewData.edges=x??[],e.previewDialogVisible=!0):$({type:"error",message:"获取预览数据失败"})}).catch(t=>{(t==null?void 0:t.message)!=="canceled"&&$({type:"error",message:"获取预览数据错误"})}).finally(()=>{e.isLoadingData=!1})}function Y(){e.spaceDialogVisible=!0}function r(a){var t;((t=e.selectSpaceData)==null?void 0:t.id)!==a.id&&(e.selectSpaceData=le.cloneDeep(a),e.boxList=[],g.value={})}function o(){e.boxList.push(pt()),setTimeout(()=>{_.value.querySelector("#anchorPoint").scrollIntoView()},20)}function l(a){e.boxList=e.boxList.filter(t=>t!==a),Reflect.deleteProperty(g.value,a)}function i(a){return new Promise(t=>{a.validate(h=>{t(h)})})}function n(){var a;if(b.dialogType===w.UPDATE){if(k.value==="data"){if(!((a=e.selectSpaceData)!=null&&a.id)){$({type:"warning",message:"请选择数据"});return}const h=Reflect.ownKeys(g.value).map(v=>g.value[v]),x=Array(h.length).fill(void 0);h==null||h.forEach((v,y)=>{x[y]=v==null?void 0:v.validData()}),Promise.all(x).then(v=>{if(!v.some(y=>!y)){const y=v.map(L=>{var se,pe,Q,ue;return{objectId:(se=L.objectItem)==null?void 0:se.id,objectName:(pe=L.objectItem)==null?void 0:pe.name,fieldId:(Q=L.fieldItem)==null?void 0:Q.fieldId,fieldName:(ue=L.fieldItem)==null?void 0:ue.value,operator:L.operator,value:L.value}}),{id:Z,spaceCode:me,nameSpace:ie}=e.selectSpaceData,W={id:e.editData.id,spaceId:Z,spaceCode:me,spaceName:ie,publishDataFieldList:y};e.submiting=!0,Ye(W).then(L=>{L.code==="0000"?(P({type:"success",title:"更新成功"}),B(),u("save")):P({type:"error",title:"更新失败",message:L.message})}).catch(L=>{P({type:"error",title:"更新错误",message:L.message})}).finally(()=>{e.submiting=!1})}})}}else b.dialogType===w.EDIT&&i(j.value).then(t=>{if(t){const{id:h,aliasName:x,status:V,description:v}=e.editData,y={id:h,aliasName:x,status:V,description:v};e.submiting=!0,Je(y).then(Z=>{e.submiting=!1,Z.code==="0000"?(P({type:"success",title:"编辑成功"}),B(),u("save")):P({type:"error",title:"编辑失败",message:Z.message})}).catch(Z=>{e.submiting=!1,P({type:"error",title:"编辑错误",message:Z.message})})}})}return(a,t)=>{const h=D("ArrowLeft"),x=D("el-icon"),V=D("el-form-item"),v=D("el-input"),y=D("el-switch"),Z=D("el-radio"),me=D("el-radio-group"),ie=D("el-form"),W=D("el-table-column"),L=D("el-popconfirm"),se=D("el-table"),pe=D("Plus"),Q=D("el-button"),ue=D("el-checkbox"),he=ge("loading");return f(),S(te,null,[d(c(Le),{id:"graph-server-full-dialog",modelValue:e.dialogVisible,"onUpdate:modelValue":t[8]||(t[8]=ae=>e.dialogVisible=ae),class:"full-dialog common-full-dialog","append-to-dom":a.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:M,onClosed:B},{default:p(()=>{var ae,De,Se,Ce;return[H((f(),S("div",Bt,[s("div",Rt,[d(x,{onClick:B},{default:p(()=>[d(h)]),_:1}),s("span",null,C((c(ct).get(a.dialogType)||"查看")+"服务"),1)]),H((f(),S("div",{ref_key:"mainRef",ref:_,class:"main","element-loading-text":"获取预览数据中..."},[s("div",Mt,[Ot,s("div",Wt,[d(ie,{ref_key:"editFormRef",ref:j,class:"form edit-form",inline:"",model:e.editData,rules:e.rules,"label-width":"auto","label-position":"right"},{default:p(()=>[s("div",Ht,[d(V,{label:"服务标识",prop:"name"},{default:p(()=>[s("span",null,C(e.editData.name),1)]),_:1}),d(V,{label:"服务名称",prop:"aliasName"},{default:p(()=>[a.dialogType===c(w).EDIT?(f(),E(v,{key:0,modelValue:e.editData.aliasName,"onUpdate:modelValue":t[0]||(t[0]=m=>e.editData.aliasName=m),type:"text",placeholder:"请输入服务名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])):(f(),S("span",jt,C(e.editData.aliasName),1))]),_:1})]),s("div",Ft,[d(V,{label:"服务类型",prop:"type"},{default:p(()=>[s("span",null,C(e.editData.type||"图谱服务"),1)]),_:1}),a.dialogType!==c(w).UPDATE?(f(),E(V,{key:0,label:"服务状态",prop:"status"},{default:p(()=>[a.dialogType===c(w).EDIT?(f(),E(y,{key:0,modelValue:e.editData.status,"onUpdate:modelValue":t[1]||(t[1]=m=>e.editData.status=m),class:"swith-btn","active-value":0,"inactive-value":1},null,8,["modelValue"])):(f(),S("span",Gt,C(e.editData.status===0?"已启动":"已停止"),1))]),_:1})):(f(),E(V,{key:1}))]),s("div",Kt,[d(V,{label:"服务说明",prop:"description"},{default:p(()=>[a.dialogType===c(w).EDIT?(f(),E(v,{key:0,modelValue:e.editData.description,"onUpdate:modelValue":t[2]||(t[2]=m=>e.editData.description=m),type:"text",placeholder:"请输入服务说明",clearable:""},null,8,["modelValue"])):(f(),S("span",{key:1,class:re(["description",e.editData.description?"":"empty"])},C(e.editData.description||"未说明"),3))]),_:1})]),a.dialogType!==c(w).UPDATE?(f(),S("div",qt,[d(V,{label:"发布人",prop:"creator"},{default:p(()=>[s("span",null,C(e.editData.creator),1)]),_:1}),d(V,{label:"发布时间",prop:"publishTime"},{default:p(()=>[s("span",null,C(e.editData.publishTime),1)]),_:1})])):ee("",!0),a.dialogType!==c(w).UPDATE?(f(),S("div",Zt,[d(V,{label:"服务地址",prop:"url"},{default:p(()=>[s("span",Xt,C(e.editData.url),1)]),_:1})])):(f(),S("div",Yt,[d(V,{label:"更新方式",required:""},{default:p(()=>[d(me,{modelValue:k.value,"onUpdate:modelValue":t[3]||(t[3]=m=>k.value=m)},{default:p(()=>[d(Z,{label:"data"},{default:p(()=>[N("选择数据更新")]),_:1}),d(Z,{label:"version"},{default:p(()=>[N("选择已有版本更新")]),_:1})]),_:1},8,["modelValue"])]),_:1})]))]),_:1},8,["model","rules"])])]),a.dialogType===c(w).CHECK||a.dialogType===c(w).UPDATE&&k.value==="version"?(f(),S("div",Jt,[Qt,s("div",ea,[d(ie,{ref_key:"tableFormRef",ref:F,class:"table-form edit-form",model:e.editData},{default:p(()=>[H((f(),E(se,{ref:"versionsTable",class:"versionsTable",data:e.editData.versions,"row-key":"id","element-loading-text":"数据加载中..."},{default:p(()=>[d(W,{align:"center",prop:"versionName",label:"版本号"},{default:p(m=>[s("span",{class:re(["version-info",m.row.id===e.curVersionInfo.id?"cur":""])},C(m.row.versionName)+C(m.row.id===e.curVersionInfo.id?"（当前版本）":""),3)]),_:1}),d(W,{align:"center",prop:"spaceName",label:"图谱空间名称"},{default:p(m=>[s("span",{title:m.row.spaceName},C(m.row.spaceName),9,ta)]),_:1}),d(W,{align:"center",prop:"updateTime",label:"更新时间",width:"190"}),d(W,{width:"240px",label:"操作",align:"center","class-name":"operate"},{default:p(m=>[a.dialogType!==c(w).CHECK?(f(),E(L,{key:0,title:`将【${m.row.versionName}】数据服务设置为当前版本，是否继续？`,width:"250px","confirm-button-text":"是","cancel-button-text":"否",disabled:m.row.id===e.curVersionInfo.id,onConfirm:ne=>R(m.row)},{reference:p(()=>[s("span",{class:re({disabled:m.row.id===e.curVersionInfo.id})}," 使用此版本 ",2)]),_:2},1032,["title","disabled","onConfirm"])):ee("",!0),s("span",{onClick:G(ne=>O(m.row),["stop"])},"预览",8,aa),a.dialogType!==c(w).CHECK?(f(),E(L,{key:1,title:`删除【${m.row.versionName}】数据服务，是否继续？`,width:"220px",disabled:m.row.id===e.curVersionInfo.id,onConfirm:ne=>U(m.row)},{reference:p(()=>[s("span",{class:re(["delete",{disabled:m.row.id===e.curVersionInfo.id}])}," 删除 ",2)]),_:2},1032,["title","disabled","onConfirm"])):ee("",!0)]),_:1})]),_:1},8,["data"])),[[he,e.loadingVersion]])]),_:1},8,["model"])])])):ee("",!0),H(s("div",oa,[s("div",{class:"subtitle"},[la,s("span",{class:"func-btn",onClick:Y}," 点击选择数据 ")]),H(s("div",ia,[d(ie,{class:"form edit-form",inline:"",model:e.selectSpaceData,"label-width":"auto","label-position":"right"},{default:p(()=>[s("div",sa,[d(V,{label:"图谱空间标识"},{default:p(()=>{var m;return[s("span",null,C((m=e.selectSpaceData)==null?void 0:m.spaceCode),1)]}),_:1}),d(V,{label:"图谱空间名称"},{default:p(()=>{var m;return[s("span",null,C((m=e.selectSpaceData)==null?void 0:m.nameSpace),1)]}),_:1})])]),_:1},8,["model"])],512),[[oe,!!((ae=e.selectSpaceData)!=null&&ae.id)]]),H(s("div",na,"未选择",512),[[oe,!((De=e.selectSpaceData)!=null&&De.id)]])],512),[[oe,a.dialogType===c(w).UPDATE&&k.value==="data"]]),H(s("div",da,[ra,H(d(se,{class:"filter-table",data:e.boxList,"empty-text":"无筛选条件"},{default:p(()=>[d(W,null,{header:p(()=>[ca]),_:1}),d(W,{label:"字段"}),d(W,{label:"操作符"}),d(W,{label:"值"}),d(W,{width:"60px",label:"操作",align:"center","class-name":"tableOperate"})]),_:1},8,["data"]),[[oe,e.boxList.length>0]]),s("div",null,[(f(!0),S(te,null,ye(e.boxList,m=>{var ne;return f(),E(Ge,{key:m,ref_for:!0,ref:ve=>{ve&&(g.value[m]=ve)},"space-id":(ne=e.selectSpaceData)==null?void 0:ne.id,onDelete:ve=>l(m)},null,8,["space-id","onDelete"])}),128))]),a.dialogType===c(w).UPDATE&&k.value==="data"&&((Se=e.selectSpaceData)!=null&&Se.id)?(f(),S("div",pa,[s("div",{class:"addTableBtn",onClick:o},[d(x,null,{default:p(()=>[d(pe)]),_:1}),N("添加筛选条件 ")])])):ee("",!0),ua],512),[[oe,a.dialogType===c(w).UPDATE&&k.value==="data"&&!!((Ce=e.selectSpaceData)!=null&&Ce.id)]])])),[[he,e.isLoadingData]]),s("div",fa,[d(Q,{onClick:B},{default:p(()=>[N("取消")]),_:1}),a.dialogType===c(w).CHECK?(f(),S(te,{key:0},[d(Q,{type:"primary",onClick:t[4]||(t[4]=m=>K(c(w).EDIT))},{default:p(()=>[N("编辑")]),_:1}),d(Q,{type:"primary",onClick:t[5]||(t[5]=m=>K(c(w).UPDATE))},{default:p(()=>[N("更新")]),_:1})],64)):(f(),S(te,{key:1},[a.dialogType===c(w).UPDATE&&k.value==="version"?ee("",!0):(f(),E(Q,{key:0,type:"primary",loading:e.submiting,disabled:a.dialogType===c(w).UPDATE&&!I.value,onClick:n},{default:p(()=>[N(" 保存 ")]),_:1},8,["loading","disabled"]))],64)),a.dialogType===c(w).UPDATE&&k.value==="data"?(f(),E(ue,{key:2,modelValue:I.value,"onUpdate:modelValue":t[6]||(t[6]=m=>I.value=m),label:"更新完成后将替换原服务数据",style:{"margin-left":"12px"}},null,8,["modelValue"])):ee("",!0)]),d(_t,{visible:e.spaceDialogVisible,"onUpdate:visible":t[7]||(t[7]=m=>e.spaceDialogVisible=m),onSave:r},null,8,["visible"])])),[[he,e.loading]])]}),_:1},8,["modelValue","append-to-dom"]),d(Ue,{visible:e.previewDialogVisible,"onUpdate:visible":t[9]||(t[9]=ae=>e.previewDialogVisible=ae),"container-id":"graph-viewer--container","preview-data":e.previewData},null,8,["visible","preview-data"])],64)}}});function ma(){const A=ce({searchOptions:[{label:"关键字",key:"keyword",type:"text",placeholder:"标识/名称/发布人",span:5},{label:"服务状态",key:"status",type:"select",value:-1,placeholder:"选择数据类型",span:5,options:[{label:"所有",value:-1},{label:"已停止",value:1},{label:"已启动",value:0}],clearable:!0}],columns:[{prop:"name",label:"服务标识",minWidth:120,slot:"name",sortable:!0},{prop:"aliasName",label:"服务名称",minWidth:120,slot:"aliasName",sortable:!0},{prop:"type",label:"服务类型",minWidth:120,sortable:!0},{prop:"creator",label:"发布人",minWidth:120,sortable:!0},{prop:"publishTime",label:"发布时间",minWidth:120},{prop:"status",label:"服务状态",minWidth:120,slot:"status"}]});return we(async()=>{}),{...Oe(A)}}const ha={class:"operate-container"},Ea=fe({__name:"index",setup(A){const{searchOptions:J,columns:j}=ma(),F=z(),_=z(),b=ce({domId:"dialog-wrap",isLoadingTable:!1,selection:[],dialogVisible:!1,dialogType:w.CHECK,curEditData:{},previewDialogVisible:!1,previewData:{nodes:[],edges:[]},isLoadingData:!1}),u={status:-1},{data:g,total:T,pageNo:e,pageSize:k,loading:I,multipleSelection:M,handleSizeChange:B,handleCurrentChange:K,handleSelectionChange:q,handleSearch:X,initData:R}=ot(Qe,u);we(()=>{R()});function U(n,a){g.value.length!==0&&et(a.id,a.status).then(t=>{t.code==="0000"?P({title:"提示",message:`服务已${a.status?"禁用":"启动"}！`,type:"success",duration:2e3}):$({type:"warning",message:"服务状态更改失败"}),R()}).catch(t=>{$({type:"error",message:t.message}),R()})}function O(n){b.curEditData=be(n),b.dialogType=w.CHECK,b.dialogVisible=!0}function Y(n){b.isLoadingData=!0,Ne(n.url).then(a=>{const{code:t,data:{edges:h,nodes:x}}=a;t==="0000"?(b.previewData.nodes=x??[],b.previewData.edges=h??[],b.previewDialogVisible=!0):$({type:"error",message:"获取预览数据失败"})}).catch(()=>{$({type:"error",message:"获取预览数据错误"})}).finally(()=>{b.isLoadingData=!1})}function r(n,a=w.EDIT){b.curEditData=be(n),b.dialogType=a,b.dialogVisible=!0}function o(n){b.dialogType=n}function l(n){Ve.confirm(`删除【${n.name}】服务, 是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{I.value=!0,Ie(n.id).then(a=>{I.value=!1,a.code==="0000"&&R()}).catch(()=>{I.value=!1})}).catch(()=>{})}function i(){Ve.confirm("是否批量删除选中服务?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{I.value=!0;const a=be(M.value).map(t=>t.id).join(",");Ie(a).then(t=>{I.value=!1,t.code==="0000"&&(R(),M.value=[])}).catch(()=>{I.value=!1})}).catch(()=>{})}return(n,a)=>{const t=D("el-link"),h=D("el-switch"),x=D("el-button"),V=ge("loading");return H((f(),E(c(nt),{id:"dialog-wrap",ref_key:"mainContainerRef",ref:F,background:"","element-loading-text":"获取预览数据中..."},{default:p(()=>[d(c(lt),{padding:"1 1 0",border:""},{default:p(()=>[d(c($e),{ref_key:"SmartSearchRef",ref:_,options:c(J),"query-permission":"",onHandleSearch:c(X)},null,8,["options","onHandleSearch"])]),_:1}),d(c(it),null,{default:p(()=>[d(c(st),{ref:"baseTable","operation-width":"220",columns:c(j),"table-data":c(g),"current-page":c(e),"page-size":c(k),total:c(T),"pagination-is-need":!0,"operation-is-need":!0,loading:c(I),"search-form-ref":_.value,"selection-is-need":!0,"index-is-need":!1,"is-batch-slot-visible":!0,"desc-options":!1,onSizeChange:c(B),onCurrentChange:c(K),onSelectionChange:c(q)},{name:p(({scope:v})=>[d(t,{type:"primary",onClick:G(y=>O(v.row),["stop"])},{default:p(()=>[N(C(v.row.name),1)]),_:2},1032,["onClick"])]),aliasName:p(({scope:v})=>[d(t,{type:"primary",onClick:G(y=>O(v.row),["stop"])},{default:p(()=>[N(C(v.row.aliasName),1)]),_:2},1032,["onClick"])]),status:p(({scope:v})=>[d(h,{modelValue:v.row.status,"onUpdate:modelValue":y=>v.row.status=y,class:"swith-btn","active-value":0,"inactive-value":1,onChange:y=>U(y,v.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),"smart-table_batch-operation":p(()=>[s("div",{class:"operate-row",onClick:i},[d(x,{"el-button":"",type:"danger",icon:c(We),link:""},{default:p(()=>[N("批量删除")]),_:1},8,["icon"])])]),operation:p(({scope:v})=>[s("div",ha,[d(x,{type:"primary",link:"",onClick:G(y=>Y(v.row),["stop"])},{default:p(()=>[N(" 预览 ")]),_:2},1032,["onClick"]),d(x,{type:"primary",link:"",onClick:G(y=>r(v.row,c(w).UPDATE),["stop"])},{default:p(()=>[N(" 更新 ")]),_:2},1032,["onClick"]),d(x,{type:"primary",link:"",onClick:G(y=>r(v.row),["stop"])},{default:p(()=>[N("编辑")]),_:2},1032,["onClick"]),d(x,{type:"danger",link:"",class:re({delete:!0}),onClick:G(y=>l(v.row),["stop"])},{default:p(()=>[N(" 删除 ")]),_:2},1032,["onClick"])])]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1}),d(ga,{visible:b.dialogVisible,"onUpdate:visible":a[0]||(a[0]=v=>b.dialogVisible=v),"dom-id":b.domId,"dialog-type":b.dialogType,"cur-edit-data":b.curEditData,onSave:c(R),onChangeEdit:o},null,8,["visible","dom-id","dialog-type","cur-edit-data","onSave"]),d(Ue,{visible:b.previewDialogVisible,"onUpdate:visible":a[1]||(a[1]=v=>b.previewDialogVisible=v),"container-id":"main-graph-viewer--container","preview-data":b.previewData},null,8,["visible","preview-data"])]),_:1})),[[V,b.isLoadingData]])}}});export{Ea as default};
