import{r as d,t as ie,y as ne,A as se,H as re}from"./login.a4e9287e.js";import{r as U,S as W,c as z,n as B,d as pe,b as ue,e as g,t as de,o as C,f as ce,g as O,j as r,u as t,k as s,v as D,x as N,l as y,B as me,a6 as fe,ak as L}from"./element-plus.59ccb443.js";import{s as c}from"../../app-config.js";import{_ as he}from"./error.229cea25.js";import"./lodash.22f463b4.js";function ge(){const a=U({searchOptions:[{label:"状态",key:"status",type:"select",labelWidth:"80px",options:[{value:"",label:"所有"},{value:"1",label:"已开启"},{value:"0",label:"未开启"}],span:4},{label:"关键词",key:"keyword",type:"text",placeholder:"应用名称，描述",span:6}],columns:[{prop:"applicationName",label:"应用名称",minWidth:100},{prop:"redirectUrl",label:"重定向地址",minWidth:100},{prop:"applicationKey",label:"应用key",minWidth:130},{prop:"applicationSecretKey",label:"应用秘钥",width:200},{prop:"description",label:"描述",minWidth:100},{prop:"status",label:"状态",width:80,slot:"status"}],formOptionList:[{label:"应用名称",key:"applicationName",type:"input",span:24,labelWidth:"120px"},{label:"重定向地址",key:"redirectUrl",type:"input",span:24,labelWidth:"120px"},{key:"status",label:"状态",span:24,type:"switch",labelWidth:"120px"},{key:"description",label:"描述",type:"input",span:24,labelWidth:"120px",inputType:"textarea",rows:"2"}],formRules:{applicationName:[{required:!0,message:"请输入应用名称",trigger:"blur"}],redirectUrl:[{required:!0,message:"请输入重定向地址",trigger:"blur"},{trigger:"blur",validator:(e,v,m)=>{/^(((ht|f)tps?):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/.test(v)?m():m(new Error("请输入正确的重定向地址"))}}]}});return{...W(a)}}const ye=(a={})=>d.doGetPromise(`${c.system}/application/page`,a),ve=(a={})=>d.doPostPromiseJson(`${c.system}/application/save`,a),_e=(a={})=>d.doPostPromiseJson(`${c.system}/application/update`,a),be=(a={})=>d.doPostPromiseJson(`${c.system}/application/delete`,a),Se=(a={})=>d.doPostPromiseJson(`${c.system}/application/updateKey`,a),Ce=(a={})=>d.doPostPromiseJson(`${c.system}/application/operateStatus`,a),we=(a={})=>d.doPostPromiseJson(`${c.system}/application/operateAuthorityStatus`,a);function ke(a){const e=U({dialogVisible:!1,formValue:null,formDisabled:!1,dialogType:"",formOptionShowList:[],formRef:null,saveLoading:!1,editData:null}),v=()=>{e.formValue=null,e.formOptionShowList=[],e.dialogVisible=!1,B(()=>{e.formRef&&e.formRef.restoreForm()})},m=(p,i=null)=>{switch(e.dialogVisible=!0,e.dialogType=p,p){case"add":B(()=>{e.formRef&&e.formRef.restoreForm()}),e.formDisabled=!1,e.formOptionShowList=[...a.value];break;case"edit":e.editData=i,e.formValue=i,e.formDisabled=!0,e.formOptionShowList=a.value;break}},S=z(()=>{const p={add:"应用新增",edit:"应用信息"};return p[e.dialogType]?p[e.dialogType]:""}),w=p=>{if(e.dialogType==="edit"&&e.formDisabled){e.formDisabled=!1;return}e.formRef.getValue().then(i=>{i&&(e.saveLoading=!0,e.dialogType==="edit"&&(i.id=e.editData.id),i.authorityStatus=i.authorityStatus===""?0:i.authorityStatus,i.status=i.status===""?0:i.status,(e.dialogType==="add"?ve:_e)(i).then(()=>{e.dialogVisible=!1,p()}).catch(()=>{}).finally(()=>{e.saveLoading=!1}))})};return{...W(e),handleCancel:v,handleOpenDialog:m,handleSave:w,dialogTitle:S}}const xe={class:"ApplicationManagement"},Te={class:"common-search-container"},Ve={class:"dialog-footer"},De=pe({__name:"index",setup(a){const e=ue(),{searchOptions:v,columns:m,formOptionList:S,formRules:w}=ge(),{data:p,total:i,pageNo:P,pageSize:J,loading:f,handleSizeChange:E,handleCurrentChange:K,handleSelectionChange:q,handleSearch:F,initData:_}=ie(ye),{dialogVisible:k,formValue:H,formDisabled:x,dialogType:T,formOptionShowList:I,formRef:j,saveLoading:M,handleCancel:R,handleOpenDialog:A,dialogTitle:G,handleSave:Q}=ke(S),X=z(()=>T.value==="edit"&&x.value?"编辑":T.value==="add"?"确定":T.value==="edit"&&!x.value?"保存":"确定"),Y=(o=null)=>{L.confirm("更新秘钥后，开发人员需同步修改该应用的秘钥配置，是否继续？",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{f.value=!0;const l={id:o.id,applicationName:o.applicationName,redirectUrl:o.redirectUrl};Se(l).then(()=>{_()}).catch(()=>{}).finally(()=>{f.value=!1})})},Z=(o=null)=>{L.confirm("此操作将永久删除应用，是否继续？",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{f.value=!0;const l={id:o==null?void 0:o.id,applicationName:o==null?void 0:o.applicationName,redirectUrl:o==null?void 0:o.redirectUrl};be(l).then(()=>{_()}).catch(()=>{}).finally(()=>{f.value=!1})})},ee=(o,l)=>{if(!l.id)return;const b={id:l.id,status:o?1:0};Ce(b).then(()=>{_()}).catch(()=>{}).finally(()=>{f.value=!1})},te=(o,l)=>{if(!l.id)return;const b={id:l.id,authorityStatus:o?1:0};we(b).then(()=>{_()}).catch(()=>{})};return(o,l)=>{const b=g("Plus"),ae=g("el-icon"),h=g("el-button"),$=g("el-switch"),oe=g("el-main"),le=g("el-dialog"),V=de("action");return C(),ce("div",xe,[O("div",Te,[r(t(ne),{ref_key:"SmartSearchRef",ref:e,options:t(v),"query-permission":"sys_application_page",onHandleSearch:t(F)},null,8,["options","onHandleSearch"])]),r(oe,null,{default:s(()=>[r(t(se),{"operation-width":"190",columns:t(m),"table-data":t(p),"index-is-need":!1,"pagination-is-need":!0,"operation-is-need":!0,loading:t(f),total:t(i),"page-size":t(J),"current-page":t(P),"search-form-ref":e.value,onSizeChange:t(E),onCurrentChange:t(K),onSelectionChange:t(q)},{"smart-table_operation":s(()=>[D((C(),N(h,{type:"primary",onClick:l[0]||(l[0]=n=>t(A)("add"))},{default:s(()=>[r(ae,{class:"el-icon--left"},{default:s(()=>[r(b)]),_:1}),y(" 新增应用 ")]),_:1})),[[V,"sys_application_save"]])]),status:s(({scope:n})=>[r($,{"model-value":n.row.status,"active-value":1,"inactive-value":0,onChange:u=>ee(u,n.row)},null,8,["model-value","active-value","inactive-value","onChange"])]),authorityStatus:s(({scope:n})=>[r($,{modelValue:n.row.authorityStatus,"onUpdate:modelValue":u=>n.row.authorityStatus=u,"active-value":1,"inactive-value":0,onChange:u=>te(u,n.row)},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value","onChange"])]),operation:s(({scope:n})=>[r(h,{link:"",type:"primary",onClick:u=>t(A)("edit",n.row)},{default:s(()=>[y(" 详情 ")]),_:2},1032,["onClick"]),r(h,{link:"",type:"primary",onClick:u=>Y(n.row)},{default:s(()=>[y(" 更新秘钥 ")]),_:2},1032,["onClick"]),D((C(),N(h,{type:"danger",link:"",onClick:u=>Z(n.row)},{default:s(()=>[y(" 删除 ")]),_:2},1032,["onClick"])),[[V,"sys_application_delete"]])]),_:1},8,["columns","table-data","loading","total","page-size","current-page","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1}),r(le,{modelValue:t(k),"onUpdate:modelValue":l[2]||(l[2]=n=>fe(k)?k.value=n:null),title:t(G),onClose:t(R)},{footer:s(()=>[O("span",Ve,[r(h,{onClick:t(R)},{default:s(()=>[y(" 取消 ")]),_:1},8,["onClick"]),D((C(),N(h,{type:"primary",loading:t(M),onClick:l[1]||(l[1]=n=>t(Q)(t(_)))},{default:s(()=>[y(me(X.value),1)]),_:1},8,["loading"])),[[V,"sys_application_update"]])])]),default:s(()=>[r(t(re),{ref_key:"formRef",ref:j,rules:t(w),options:t(I),"form-value":t(H),"form-disabled":t(x)},null,8,["rules","options","form-value","form-disabled"])]),_:1},8,["modelValue","title","onClose"])])}}});const Be=he(De,[["__scopeId","data-v-3639f59f"]]);export{Be as default};
