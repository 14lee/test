import{d as X,r as ae,w as te,e as k,t as le,o as d,x as f,k as a,u as n,j as l,l as b,v as ne,f as pe,g as p,B as c,z as N,U as ce,aj as P,b as R,c as q,N as oe,n as re,ca as ue,ak as de,ai as O,T as ye,bG as he,X as Se}from"./element-plus.59ccb443.js";import{r as U,x as H,m as _e,S as F,V as me,y as ve,z as se,A as fe,v as ie}from"./login.a4e9287e.js";import{i as ee}from"./index.e0e8e942.js";import{j as G}from"./lodash.22f463b4.js";import{_ as be}from"./error.229cea25.js";import{_ as we}from"./ServiceInfoDialog.vue_vue_type_script_setup_true_lang.94bc06b6.js";import"../../app-config.js";import"./index.81042689.js";const Ce=(t,m,v,g)=>U.doGetPromise("/sceneservice/scene/apply/searchApprovalList",{approvalStatus:t,keyword:m,page:v,rows:g}),ke=({id:t,approvalStatus:m,validDays:v,approvalReason:g=""})=>U.doPostPromise("/sceneservice/scene/apply/approve",{id:t,approvalStatus:m,validDays:v,approvalReason:g},{}),Ie=({ids:t,approvalStatus:m=1})=>U.doPostPromise("/sceneservice/scene/apply/batchUpdateSceneApprove",{applyRecordIds:t,approvalStatus:m},{}),De=(t,m,v,g)=>U.doGetPromise("/mapserver/service/apply/searchApprovalList",{approvalStatus:t,keyword:m,page:v,rows:g}),Te=({id:t,approvalStatus:m,validDays:v,approvalReason:g=""})=>U.doPostPromise("/mapserver/service/apply/approve",{id:t,approvalStatus:m,validDays:v,approvalReason:g},{}),Re=({ids:t,approvalStatus:m=1})=>U.doPostPromise("/mapserver/service/apply/batchUpdateServiceApprove",{applyRecordIds:t,approvalStatus:m},{}),Ve=["TERRAIN","VECTORICON","IOT","WFS"],K=new Map([[0,"待审核"],[1,"已通过"],[2,"已拒绝"],[3,"已过期"],[5,"已删除"]]),W=new Map([[7,"7天"],[30,"1个月"],[90,"3个月"],[36500,"永久"]]),xe=t=>!Ve.includes(t),Ae={class:"modal-content","element-loading-text":"处理中..."},Ne=["href"],Pe={key:0,class:"quickMsg"},ze=X({__name:"ApprovalDialog",props:{visible:{type:Boolean,default:!1},type:{type:String,default:""},currentItem:{type:Object,default:()=>{}}},emits:["closed","handleSave"],setup(t,{emit:m}){const v=m,g={sceneApprove:ke,serviceApprove:Te},_=t,e=ae({iSceneBrowserUrl:ee,approvalStatusMap:K,validDaysMap:W,dialogVisible:!1,approvalValidDays:7,isProcessing:!1,currentItem:{}});te(()=>_.visible,h=>{e.dialogVisible=h});function z(){var h;e.currentItem=G(_.currentItem),e.approvalValidDays=e.currentItem.validDays||7,(h=_.currentItem)!=null&&h.phone&&(e.currentItem.phone=_e(_.currentItem.phone)||"")}function S(){v("closed")}function I(h){e.currentItem.approvalReason=h?"同意使用":"申请理由不清楚"}function V(){const{id:h,approvalReason:u}=e.currentItem,s=_.type==="scene"?"sceneApprove":"serviceApprove",C={id:h,approvalStatus:1,validDays:e.approvalValidDays,approvalReason:u||"同意使用"};x(s,C)}function T(){const{id:h,approvalReason:u}=e.currentItem,s=_.type==="scene"?"sceneApprove":"serviceApprove",C={id:h,approvalStatus:2,validDays:e.approvalValidDays,approvalReason:u||"申请理由不清楚"};x(s,C)}function x(h,u){e.isProcessing=!0,g[h](u).then(s=>{s.code===F.SUCCESS?setTimeout(()=>{e.isProcessing=!1,P({type:"success",message:"审批操作成功"}),v("handleSave"),S()},800):(e.isProcessing=!1,P({type:"warning",message:u.message}))}).catch(s=>{P({type:"error",message:s.message}),e.isProcessing=!1})}return(h,u)=>{const s=k("el-form-item"),C=k("el-radio"),B=k("el-radio-group"),M=k("el-input"),$=k("el-form"),w=k("el-button"),L=k("el-dialog"),j=le("loading");return d(),f(L,{modelValue:e.dialogVisible,"onUpdate:modelValue":u[4]||(u[4]=D=>e.dialogVisible=D),class:"approvalDialog",title:"审批单详情","close-on-click-modal":!1,width:"660px",top:t.currentItem.approvalStatus===1?"4vh":"10vh",center:"",onOpen:z,onClosed:S},{footer:a(()=>[e.currentItem.approvalStatus===0?(d(),f(n(H),{key:0,justify:"end"},{default:a(()=>[l(w,{type:"danger",disabled:e.isProcessing,onClick:T},{default:a(()=>[b(" 拒 绝 ")]),_:1},8,["disabled"]),l(w,{type:"primary",disabled:e.isProcessing,onClick:V},{default:a(()=>[b(" 通 过 ")]),_:1},8,["disabled"])]),_:1})):(d(),f(n(H),{key:1,justify:"end"},{default:a(()=>[l(w,{type:"primary",onClick:S},{default:a(()=>[b("关 闭")]),_:1})]),_:1}))]),default:a(()=>[ne((d(),pe("div",Ae,[l($,{ref:"approvalForm",class:"approvalForm",model:t.currentItem,"label-width":"160px"},{default:a(()=>[t.type==="scene"?(d(),f(s,{key:0,label:"申请场景 : ",prop:"sceneName"},{default:a(()=>[p("span",null,c(t.currentItem.sceneName),1)]),_:1})):N("",!0),t.type==="service"?(d(),f(s,{key:1,label:"服务名称 : ",prop:"serviceName"},{default:a(()=>[p("span",null,c(t.currentItem.serviceName),1)]),_:1})):N("",!0),t.type==="service"?(d(),f(s,{key:2,label:"服务别名 : ",prop:"serviceAlisName"},{default:a(()=>[p("span",null,c(t.currentItem.serviceAlisName),1)]),_:1})):N("",!0),t.type==="service"&&t.currentItem.approvalStatus===1?(d(),f(s,{key:3,label:"服务链接 : "},{default:a(()=>[p("span",null,[p("a",{href:n(ee)+"1110749070?maid="+t.currentItem.serviceId,target:"_blank"},c(n(ee)+"1110749070?maid="+t.currentItem.serviceId||"— —"),9,Ne)])]),_:1})):N("",!0),l(s,{label:"申请人 : ",prop:"applyName"},{default:a(()=>[p("span",null,c(t.currentItem.applyName),1)]),_:1}),l(s,{label:"所属部门 : ",prop:"applyBelongDept"},{default:a(()=>[p("span",null,c(t.currentItem.applyBelongDept),1)]),_:1}),l(s,{label:"手机号码 : ",prop:"phone"},{default:a(()=>[p("span",null,c(e.currentItem.phone),1)]),_:1}),l(s,{label:"电子邮箱 : ",prop:"email"},{default:a(()=>[p("span",null,c(t.currentItem.email),1)]),_:1}),l(s,{label:"申请时间 : "},{default:a(()=>[p("span",null,c(t.currentItem.applyTime),1)]),_:1}),l(s,{label:"有效期 : ",prop:"validDays"},{default:a(()=>[p("span",null,c(n(W).get(t.currentItem.validDays)||"7天"),1)]),_:1}),l(s,{label:"申请理由 : ",prop:"applyReason"},{default:a(()=>[p("span",null,c(t.currentItem.applyReason),1)]),_:1}),l(s,{class:"approvalStatus",label:"审核情况 : ",prop:"approvalStatus"},{default:a(()=>[p("span",{class:ce([{primary:t.currentItem.approvalStatus===0},{success:t.currentItem.approvalStatus===1},{fail:t.currentItem.approvalStatus===2},{overtime:t.currentItem.approvalStatus===3||t.currentItem.approvalStatus===5}])},c(n(K).get(t.currentItem.approvalStatus)||"— —"),3)]),_:1}),t.currentItem.approvalStatus!==0?(d(),f(s,{key:4,label:"审核人 : ",prop:"approvalName"},{default:a(()=>[p("span",null,c(t.currentItem.approvalName),1)]),_:1})):N("",!0),t.currentItem.approvalStatus!==0?(d(),f(s,{key:5,label:"审核时间 : ",prop:"approvalTime"},{default:a(()=>[p("span",null,c(t.currentItem.approvalTime),1)]),_:1})):N("",!0),t.currentItem.approvalStatus===0?(d(),f(s,{key:6,label:"有效期 : "},{default:a(()=>[l(B,{modelValue:e.approvalValidDays,"onUpdate:modelValue":u[0]||(u[0]=D=>e.approvalValidDays=D)},{default:a(()=>[l(C,{label:7},{default:a(()=>[b("7天")]),_:1}),l(C,{label:30},{default:a(()=>[b("1个月")]),_:1}),l(C,{label:90},{default:a(()=>[b("3个月")]),_:1}),t.type==="service"?(d(),f(C,{key:0,label:36500},{default:a(()=>[b("永久")]),_:1})):N("",!0)]),_:1},8,["modelValue"])]),_:1})):(d(),f(s,{key:7,label:"有效期 : "},{default:a(()=>[p("span",null,c(n(W).get(t.currentItem.validDays)||"—— ——"),1)]),_:1})),l(s,{label:"审核意见 : ",prop:"approvalReason"},{default:a(()=>[t.currentItem.approvalStatus===0?(d(),pe("div",Pe,[p("a",{class:"success",onClick:u[1]||(u[1]=D=>I(!0))},"同意使用"),p("a",{class:"fail",onClick:u[2]||(u[2]=D=>I(!1))},"申请理由不清楚")])):N("",!0),l(M,{modelValue:e.currentItem.approvalReason,"onUpdate:modelValue":u[3]||(u[3]=D=>e.currentItem.approvalReason=D),type:"textarea",readonly:t.currentItem.approvalStatus!==0,placeholder:"请输入审核意见",autosize:{minRows:3,maxRows:4},maxlength:"50","show-word-limit":""},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["model"])])),[[j,e.isProcessing]])]),_:1},8,["modelValue","top"])}}});const ge=be(ze,[["__scopeId","data-v-f5f8b4e4"]]),Be=p("div",null,null,-1),Me=X({__name:"SceneApproval",setup(t,{expose:m}){const v=R(),g=R(),_=R(),e=ae({statusOptions:[{value:"",label:"所有"},{value:0,label:"待审核"},{value:1,label:"已通过"},{value:2,label:"已拒绝"},{value:3,label:"已过期"}],approvalStatus:0,keyword:"",selection:[],isLoadingTableData:!1,tableData:[],colData:[{prop:"applyName",label:"申请人",minWidth:120},{prop:"sceneName",label:"场景名称",minWidth:120},{prop:"validDays",label:"使用时长",minWidth:120,slot:!0},{prop:"applyReason",label:"申请理由",minWidth:120},{prop:"applyTime",label:"申请时间",sortable:!0,minWidth:160},{prop:"approvalName",label:"审核人",minWidth:120,slot:!0},{prop:"approvalTime",label:"审核时间",sortable:!0,minWidth:120,slot:!0},{prop:"approvalStatus",label:"状态",minWidth:80,slot:!0}],dialogVisible:!1,currentItem:{}}),z=[{label:"关键字",key:"keyword",type:"text",placeholder:"场景名/申请人/审核人",span:10,clearable:!0},{label:"审批状态",key:"approvalStatus",type:"select",value:e.approvalStatus,options:e.statusOptions,span:8}],{currentPage:S,pageSize:I,pageSizes:V,total:T,handleSizeChange:x,handleCurrentPageChange:h,handleClearSelection:u,resize:s}=me(g,v,L),C=q(()=>i=>{const{row:o}=i;return{0:"warning",1:"success",2:"danger",3:"info",5:"info"}[`${o.approvalStatus}`]}),B=q(()=>e.selection.length>0);te(()=>B.value,()=>{M()}),oe(()=>{$()});function M(){re(()=>{s()})}function $(){L()}function w(i){i&&(e.approvalStatus=i.approvalStatus,e.keyword=i.keyword),S.value=1,L()}function L(){e.isLoadingTableData=!0,Ce(e.approvalStatus,e.keyword,S.value,I.value).then(i=>{i.code===F.SUCCESS?(e.tableData=i.data.records,T.value=i.data.total,M()):P({type:"warning",message:"请求数据失败"}),e.isLoadingTableData=!1}).catch(i=>{P({type:"error",message:i.message}),e.isLoadingTableData=!1})}function j(){de.confirm("批量通过选中申请, 是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{const i=e.selection.join(",");Ie({ids:i,approvalStatus:1}).then(o=>{o.code===F.SUCCESS?(O({type:"success",title:"批量通过成功"}),w(),e.selection=[],u()):O({type:"warning",title:"批量通过失败，请重试"})}).catch(o=>{O({type:"error",title:"操作错误",message:o.message||"服务有错"})})}).catch(()=>{})}function D(i,o){i.stopPropagation(),e.currentItem=G(o),e.dialogVisible=!0}function J(i){Q(i)}function Q(i){e.currentItem=G(i),e.dialogVisible=!0}function Y(i){e.selection=i.map(o=>o.id)}return m({resizeTable:M}),(i,o)=>{const y=k("el-button"),A=k("el-text"),Z=le("action");return d(),f(n(ie),{id:"scene-approval",ref_key:"mainContainerRef",ref:g},{default:a(()=>[l(n(H),{justify:"space-between",padding:"1 1 0",border:""},{default:a(()=>[Be,l(n(ve),{ref_key:"SmartSearchRef",ref:_,"full-width":!1,justify:"end",width:"800px",options:z,onHandleSearch:w},null,512)]),_:1}),l(n(se),null,{default:a(()=>[l(n(fe),{"table-data":e.tableData,loading:e.isLoadingTableData,columns:e.colData,"selection-is-need":!0,"current-page":n(S),"page-size":n(I),"page-sizes":n(V),total:n(T),"pagination-is-need":!0,"desc-options":{isRefresh:!1},"search-form-ref":_.value,onSizeChange:n(x),onCurrentChange:n(h),onRowDblclick:J,onSelectionChange:Y},{"smart-table_batch-operation":a(()=>[l(y,{link:"",type:"primary",icon:n(ue),onClick:j},{default:a(()=>[b(" 批量通过 ")]),_:1},8,["icon"])]),"approval-name":a(({scope:r})=>[p("span",null,c(r.row.approvalName||"— —"),1)]),"valid-days":a(({scope:r})=>[b(c(n(W).get(r.row.validDays)||"7天"),1)]),"approval-time":a(({scope:r})=>[b(c(r.row.approvalTime||"— —"),1)]),"approval-status":a(({scope:r})=>[l(A,{type:C.value(r)},{default:a(()=>[b(c(n(K).get(r.row.approvalStatus)||"— —"),1)]),_:2},1032,["type"])]),operation:a(({scope:r})=>[ne((d(),f(y,{disabled:r.row.approvalStatus!==0,type:"primary",link:"",onClick:E=>D(E,r.row)},{default:a(()=>[b("审批")]),_:2},1032,["disabled","onClick"])),[[Z,"scene_apply_approve"]])]),_:1},8,["table-data","loading","columns","current-page","page-size","page-sizes","total","search-form-ref","onSizeChange","onCurrentChange"])]),_:1}),l(ge,{visible:e.dialogVisible,type:"scene","current-item":e.currentItem,onClosed:o[0]||(o[0]=r=>e.dialogVisible=!1),onHandleSave:w},null,8,["visible","current-item"])]),_:1},512)}}}),Le=p("div",null,null,-1),Oe=X({__name:"ServiceApproval",setup(t,{expose:m}){const v=R(),g=R(),_=R(),e=ae({statusOptions:[{value:"",label:"所有"},{value:0,label:"待审核"},{value:1,label:"已通过"},{value:2,label:"已拒绝"},{value:3,label:"已过期"}],approvalStatus:0,keyword:"",selection:[],isLoadingTableData:!1,tableData:[],colData:[{prop:"applyName",label:"申请人",width:180},{prop:"serviceName",label:"服务名称",width:180},{prop:"serviceAlisName",label:"服务别名",width:180},{prop:"serviceCategoryAliasName",label:"服务类型",width:180},{prop:"validDays",label:"使用时长",width:180},{prop:"applyReason",label:"申请理由",width:180},{prop:"applyTime",label:"申请时间",sortable:!0,width:180},{prop:"approvalName",label:"审核人",width:180,slot:!0},{prop:"approvalTime",label:"审核时间",sortable:!0,width:180,slot:!0},{prop:"approvalStatus",label:"状态",width:80,slot:!0}],dialogVisible:!1,serviceDialogVisible:!1,currentItem:{},serviceItem:{}}),z=[{label:"关键字",key:"keyword",type:"text",placeholder:"服务名/申请人/审核人",span:10,clearable:!0},{label:"审批状态",key:"approvalStatus",type:"select",value:e.approvalStatus,options:e.statusOptions,span:8}],{currentPage:S,pageSize:I,pageSizes:V,total:T,handleSizeChange:x,handleCurrentPageChange:h,handleClearSelection:u,resize:s}=me(g,v,w),C=q(()=>e.selection.length>0);te(()=>C.value,()=>{B()}),oe(()=>{M()});function B(){re(()=>{s()})}function M(){w()}function $(o){o&&(e.approvalStatus=o.approvalStatus,e.keyword=o.keyword),S.value=1,w()}function w(){e.isLoadingTableData=!0,De(e.approvalStatus,e.keyword,S.value,I.value).then(o=>{o.code===F.SUCCESS?(e.tableData=o.data.records,T.value=o.data.total,B()):P({type:"warning",message:"请求数据失败"}),e.isLoadingTableData=!1}).catch(o=>{P({type:"error",message:o.message}),e.isLoadingTableData=!1})}function L(){de.confirm("批量通过选中申请, 是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{const o=e.selection.join(",");Re({ids:o,approvalStatus:1}).then(y=>{y.code===F.SUCCESS?(O({type:"success",title:"批量通过成功"}),w(),e.selection=[],u()):O({type:"warning",title:"批量通过失败，请重试"})}).catch(y=>{O({type:"error",title:"操作错误",message:y.message||"服务有错"})})}).catch(()=>{})}function j(o,y){o.stopPropagation(),e.currentItem=G(y),e.dialogVisible=!0}function D(o,y){o.stopPropagation();const A=`${window.location.origin}/#/ServicePreview?id=${y.serviceId}`;if(!A)return P.error("预览服务出错, 请稍后重试!"),!1;window.open(A)}function J(o){Q(o)}function Q(o){e.currentItem=G(o),e.dialogVisible=!0}function Y(o){e.selection=o.map(y=>y.id)}function i(o){return!xe(o)}return m({resizeTable:B}),(o,y)=>{const A=k("el-button"),Z=le("action");return d(),f(n(ie),{id:"service-approval",ref_key:"mainContainerRef",ref:g},{default:a(()=>[l(n(H),{justify:"space-between",border:"",padding:"1 1 0"},{default:a(()=>[Le,l(n(ve),{ref_key:"SmartSearchRef",ref:_,"full-width":!1,justify:"end",width:"800px",options:z,onHandleSearch:$},null,512)]),_:1}),l(n(se),null,{default:a(()=>[l(n(fe),{"pagination-is-need":"","selection-is-need":"",columns:e.colData,"table-data":e.tableData,loading:e.isLoadingTableData,"page-size":n(I),"page-sizes":n(V),total:n(T),"current-page":n(S),"desc-options":{isRefresh:!1},"search-form-ref":_.value,onSelectionChange:Y,onSizeChange:n(x),onCurrentChange:n(h),onRowDblclick:J},{"smart-table_batch-operation":a(()=>[l(A,{link:"",type:"primary",icon:n(ue),onClick:L},{default:a(()=>[b(" 批量通过 ")]),_:1},8,["icon"])]),"approval-name":a(({scope:r})=>[b(c(r.row.approvalName||"- -"),1)]),"approval-time":a(({scope:r})=>[b(c(n(W).get(r.row.approvalTime)||"7天"),1)]),"approval-status":a(({scope:r})=>[p("span",{class:ce([{isWaiting:r.row.approvalStatus===0},{isPass:r.row.approvalStatus===1},{isRefuse:r.row.approvalStatus===2},{isOver:r.row.approvalStatus===3||r.row.approvalStatus===5}])},c(n(K).get(r.row.approvalStatus)||"— —"),3)]),operation:a(({scope:r})=>[ne((d(),f(A,{disabled:r.row.approvalStatus!==0,type:"primary",link:"",onClick:E=>j(E,r.row)},{default:a(()=>[b("审批")]),_:2},1032,["disabled","onClick"])),[[Z,"mapserver_apply_approve"]]),l(A,{type:"primary",link:"",title:"预览服务",disabled:i(r.row.serviceCategory),onClick:E=>D(E,r.row)},{default:a(()=>[b("预览")]),_:2},1032,["disabled","onClick"])]),_:1},8,["columns","table-data","loading","page-size","page-sizes","total","current-page","search-form-ref","onSizeChange","onCurrentChange"])]),_:1}),l(ge,{visible:e.dialogVisible,type:"service","current-item":e.currentItem,onClosed:y[0]||(y[0]=r=>e.dialogVisible=!1),onHandleSave:w},null,8,["visible","current-item"]),l(we,{"dialog-top":"10vh","current-item":e.serviceItem,visible:e.serviceDialogVisible,onClosed:y[1]||(y[1]=r=>e.serviceDialogVisible=!1)},null,8,["current-item","visible"])]),_:1},512)}}}),Ue=X({__name:"index",setup(t){const m=R(),v=R("scene"),g=R(),_=q(()=>({scene:Me,service:Oe})[v.value]);function e(){re(()=>{var S;(S=g.value)==null||S.resizeTable()})}oe(()=>{z()}),ye(()=>{});function z(){v.value="scene"}return(S,I)=>{const V=k("el-radio-button"),T=k("el-radio-group");return d(),f(n(ie),{id:"approval-manage",ref_key:"mainBox",ref:m,background:""},{default:a(()=>[l(n(H),{class:"approvalManage-radio__group"},{default:a(()=>[l(T,{modelValue:v.value,"onUpdate:modelValue":I[0]||(I[0]=x=>v.value=x),onChange:e},{default:a(()=>[l(V,{label:"scene"},{default:a(()=>[b("场景")]),_:1}),l(V,{label:"service"},{default:a(()=>[b("服务")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(n(se),{padding:"0 0"},{default:a(()=>[(d(),f(he,null,[(d(),f(Se(_.value),{ref_key:"componentRef",ref:g},null,512))],1024))]),_:1})]),_:1},512)}}});const Ke=be(Ue,[["__scopeId","data-v-1b813695"]]);export{Ke as default};
