import{d as Se,b as N,r as ge,c as we,w as Ve,N as _e,e as _,t as me,o as d,x as m,k as l,v as $,f as b,g as u,j as i,B as w,u as n,aK as Ye,z as E,U as ke,l as y,b1 as Me,bK as je,F as pe,y as ve,ad as fe,ae as Ge,n as Ee,aj as Ie,ak as F,ai as U,S as We,bo as Je}from"./element-plus.59ccb443.js";import{Y as Qe,h as Ze,_ as Xe,Z as ea,a0 as aa,a7 as ta,d as la}from"./index-a95bb620.js";import{t as na,x as oa,y as ia,z as da,A as sa,v as ra}from"./login.a4e9287e.js";import{D as c,d as ca,S as ua,g as pa}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{u as ma,t as fa,d as ga,A as H,a as xe,b as Ne,k as _a}from"./useTemplateData.bd428139.js";import{q as P,j as ya}from"./lodash.22f463b4.js";import{_ as ba}from"./error.229cea25.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"../../app-config.js";import"./smart-ui.e8e0134c.js";const ha={class:"main-content"},Ta={class:"title"},Da={class:"card"},Ca=u("div",{class:"subtitle"},"基本信息",-1),wa={class:"content-wrap"},Va={class:"item-wrap item2"},ka={key:1},va={key:1};const Ea={class:"item-wrap"},Ia={key:1,class:"item-wrap item2"},xa={class:"card"},Na=u("div",{class:"subtitle fieldTitle"},"字段信息",-1),Sa={key:0,class:"content-wrap TableBtnsContainer"},La={class:"content-wrap"},Ua=u("span",{style:{"font-size":"16px",color:"#ff8282"}},"*",-1),$a=u("div",null,[y(" 若该模板用于数据库表，需按数据库列名规范设置，请勿使用保留关键词 "),u("br"),y(" 例如：INTEGER, STRING, INT64, INT32, INT16, INT8, DOUBLE, "),u("br"),y(" FLOAT, DECIMAL, DATE, DATETIME, TIME, DURATION, BOOL "),u("br"),y(" BOOLEAN, LIST, SET, MAP, POINT, LINESTRING, POLYGON ")],-1),Ha={key:1},Ka=u("p",null,[u("span",{style:{"font-size":"16px",color:"#ff8282"}},"*"),y(" 中文名称 ")],-1),Ra={key:1},Ba=u("p",null,[u("span",{style:{"font-size":"16px",color:"#ff8282"}},"*"),y(" 数据类型 ")],-1),Oa=u("p",null,"关联字典",-1),Aa={key:1},Pa={key:1},Fa={key:1},qa={key:1},za=["onClick"],Ya={key:1,class:"content-wrap"},Ma=u("div",{id:"anchorPoint",style:{overflow:"hidden"}},null,-1),ja={class:"footer"},Ga=Se({__name:"TemplateInfoDialog",props:{visible:{type:Boolean,default:!1},dialogType:{default:c.CHECK},domId:{default:""},curEditId:{default:""},curCatalogId:{default:""}},emits:["update:visible","changeEdit","save"],setup(J,{emit:te}){const q=te,S=J,z=N(),g=N(),Y=N(),M=N(),Q=N(),ye=N(),e=ge({isLoading:!1,dialogVisible:!1,submiting:!1,isHandling:!1,file:null,initData:{id:"",name:"",aliasName:"",type:null,cascaderValue:["ENTITYOBJECT"],description:""},editData:{},rules:{name:[{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]}],aliasName:[{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]},{required:!0,message:"模板名称不能为空",trigger:["blur","change"]}]},tableData:[],tableRules:{name:[{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]},{required:!0,message:"英文名称不能为空",trigger:["blur","change"]}],aliasName:[{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]},{required:!0,message:"中文名称不能为空",trigger:["blur","change"]}],type:[{required:!0,message:"数据类型不能为空",trigger:["change"]}]},selection:[],classifyTreeData:[],catalogObj:null,treeProps:{label:"name",children:"children",disabled:"no"},treeValueKey:"id"}),j=we(()=>S.dialogType!==c.CHECK),G=N(null),K=we(()=>{var a,o,s,f;return((o=(a=e.editData)==null?void 0:a.cascaderValue)==null?void 0:o[0])==="ENTITYOBJECT"||((f=(s=e.editData)==null?void 0:s.cascaderValue)==null?void 0:f[0])==="ENTITYRELATIONSHIP"}),{checkTemplateName:le,checkingUniq:ne,createTableItem:R,isSelectable:I,isRelationKey:W}=ma(k);e.rules.name.push({required:!0,validator:le,trigger:["blur","change"]}),Ve(()=>S.visible,a=>{e.dialogVisible=a}),Ve(()=>j.value,a=>{var o,s;a?ie():(o=G.value)!=null&&o.el&&((s=G.value)==null||s.destroy())}),_e(()=>{document.body.ondrop=function(a){a.preventDefault(),a.stopPropagation()},oe()});const Z=N([]),X=N([]);async function oe(){const a=await Qe(),{success:o,data:s}=a;o&&(Z.value=[...s.businessList,...s.systemList])}function ie(){var s;const o=((s=Y.value.$el)==null?void 0:s.querySelector(".sortableTable")).querySelector(".el-table__body-wrapper tbody");G.value=Ze.create(o,{disabled:!j.value,handle:".draggable-item",onEnd({newIndex:f,oldIndex:v}){const V=P.cloneDeep(e.tableData),p=V.splice(v,1)[0];V.splice(f,0,p),e.tableData=[...V]}})}async function de(){e.isLoading=!0,e.isHandling=!1,e.file=null,S.dialogType===c.ADD?(e.editData=P.cloneDeep(e.initData),e.tableData=[],e.isLoading=!1):D(S.curEditId),Ee(()=>{var a;(a=g.value)==null||a.clearValidate()})}function D(a){H.getTemplate(a).then(o=>{o.code==="0000"&&o.data?(e.editData={type:null,cascaderValue:[],...P.cloneDeep(o.data)},delete e.editData.templateDataFieldList,e.tableData=o.data.templateDataFieldList.map((s,f)=>{var v;return s.type==="DICTIONARY"&&C(s,f),{...s,initialValue:(v=s.initialValue)==null?void 0:v.split(",")}})||[],e.editData.cascaderValue=o.data.dataLayerType?[o.data.dataType,o.data.dataLayerType]:[o.data.dataType]):Ie({type:"error",message:"获取信息失败"})}).catch(()=>{Ie({type:"error",message:"获取信息错误"})}).finally(()=>{e.isLoading=!1})}function k(){var a;return((a=e.editData)==null?void 0:a.id)||""}function x(a){a.initialValue=null,a.dictTypeId=null}const B={label:"dictValue",value:"id"};async function C(a,o){if(a.dictTypeId){const s=await ea({pageNo:1,pageSize:9999,dictTypeId:a.dictTypeId}),{data:f,success:v}=s;v&&(X.value[o]=f.records)}else a.initialValue=""}function O(){const a=R(),o=P.cloneDeep([...e.tableData,a]);e.tableData=[],Ee(()=>{e.tableData=o}),setTimeout(()=>{z.value.querySelector("#anchorPoint").scrollIntoView()},20)}function Le(a){var o;I(a)&&(e.tableData=e.tableData.filter(s=>s.id!==a.id),e.selection=e.selection.filter(s=>s!==a.id),e.selection.length===0&&((o=M.value)==null||o.clearSelection()))}function Ue(){var a;e.tableData=e.tableData.filter(o=>e.selection.every(s=>o.id!==s)),e.selection=[],(a=M.value)==null||a.clearSelection()}function $e(){Q.value.click()}function He(a){return a.replace(/.+\./,"")}function Ke(a){const{files:o}=a.target;if(o.length===0)return;const s=o[0];e.isHandling=!0;const f=["xls","xlsx"],v=He(s.name).toLowerCase();if(f.includes(v))e.file=new File([s],s.name);else{F.alert("上传失败，请选择正确的文件格式上传","提示",{confirmButtonText:"确定",type:"error"}),a.target.value="",e.isHandling=!1;return}Re(),a.target.value=""}function Re(){const a=new FormData;a.append("file",e.file),H.importTemplate(a).then(o=>{if(o.code==="0000"&&(o!=null&&o.data)){const s=o.data;s.forEach(f=>{f.id=pa()}),e.tableData=P.cloneDeep(s)}else U({type:"error",title:"文件读取失败",message:o.message})}).catch(o=>{U({type:"error",title:"文件读取失败",message:o.message})}).finally(()=>{e.isHandling=!1})}function Be(a){e.selection=a.map(o=>o.id)}function se(){q("update:visible",!1)}function Oe(){q("changeEdit")}function be(a){return new Promise(o=>{a.validate(s=>{o(s)})})}function Ae(){const a=be(g.value),o=be(Y.value);Promise.all([a,o]).then(([f,v])=>{if(f&&v){const{aliasName:V,cascaderValue:p,description:he,id:ee,name:L}=e.editData;if((p==null?void 0:p[0])==="ENTITYRELATIONSHIP"&&e.tableData[0].name!==xe&&e.tableData[1].name!==Ne){F.alert(`字段信息【${xe}】和【${Ne}】需分别排列在第一和第二行`,"提示",{confirmButtonText:"确定",type:"warning"});return}if(aa(e.tableData,"name")){F.alert("英文名称存在相同的值，需唯一，请检查后再保存","提示",{confirmButtonText:"确定",type:"warning"});return}const h=_a.map(T=>T.toLocaleLowerCase());if(e.tableData.some(T=>h.includes(T.name.toLocaleLowerCase()))){F.alert("英文名称存在特殊关键词，请检查后再保存","提示",{confirmButtonText:"确定",type:"warning"});return}const re=P.cloneDeep(e.tableData).map(T=>({...T,initialValue:Array.isArray(T.initialValue)?T.initialValue.join(","):T.initialValue})),ce={id:ee,name:L,aliasName:V,dataType:p==null?void 0:p[0],dataLayerType:(p==null?void 0:p[1])||null,description:he,templateDataFieldList:re};e.submiting=!0,H.saveOrUpdateTemplate(ce).then(T=>{T.code==="0000"?(U({type:"success",title:`${S.dialogType===c.ADD?"新增":"保存"}模板成功`}),q("save"),se()):U({type:"error",title:`${S.dialogType===c.ADD?"新增":"保存"}模板失败`,message:T.message})}).catch(T=>{U({type:"error",title:`${S.dialogType===c.ADD?"新增":"保存"}模板错误`,message:T.message})}).finally(()=>{e.submiting=!1})}})}return(a,o)=>{const s=_("ArrowLeft"),f=_("el-icon"),v=_("Loading"),V=_("el-input"),p=_("el-form-item"),he=_("ss-select-tree-new"),ee=_("el-form"),L=_("el-button"),h=_("el-table-column"),re=_("QuestionFilled"),ce=_("el-tooltip"),T=_("el-option"),Te=_("el-select"),ue=_("el-checkbox"),De=_("el-input-number"),Pe=_("el-cascader"),Fe=_("Plus"),qe=me("action"),ze=me("loading");return d(),m(n(ua),{id:"template-full-dialog",modelValue:e.dialogVisible,"onUpdate:modelValue":o[5]||(o[5]=ae=>e.dialogVisible=ae),class:"full-dialog common-full-dialog","append-to-dom":a.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:de,onClosed:se},{default:l(()=>{var ae,Ce;return[$((d(),b("div",ha,[u("div",Ta,[i(f,{onClick:se},{default:l(()=>[i(s)]),_:1}),u("span",null,w((n(ca).get(a.dialogType)||"查看")+"模板"),1)]),u("div",{ref_key:"mainRef",ref:z,class:"main"},[u("div",Da,[Ca,u("div",wa,[i(ee,{ref_key:"formRef",ref:g,class:"form edit-form",inline:"",model:e.editData,rules:e.rules,"label-width":"auto","label-position":"right"},{default:l(()=>[u("div",Va,[i(p,{label:"模板标识",prop:"name"},{default:l(()=>[a.dialogType!==n(c).CHECK?(d(),m(V,{key:0,modelValue:e.editData.name,"onUpdate:modelValue":o[0]||(o[0]=t=>e.editData.name=t),type:"text",placeholder:"请输入模板标识",maxlength:"50","show-word-limit":""},Ye({_:2},[n(ne)?{name:"suffix",fn:l(()=>[i(f,{class:"el-input__icon"},{default:l(()=>[i(v)]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])):(d(),b("span",ka,w(e.editData.name),1))]),_:1}),i(p,{label:"模板名称",prop:"aliasName"},{default:l(()=>[a.dialogType!==n(c).CHECK?(d(),m(V,{key:0,modelValue:e.editData.aliasName,"onUpdate:modelValue":o[1]||(o[1]=t=>e.editData.aliasName=t),type:"text",placeholder:"请输入模板名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])):(d(),b("span",va,w(e.editData.aliasName),1))]),_:1})]),(e.classifyTreeData.length,E("",!0)),u("div",Ea,[i(p,{label:"说明",prop:"description"},{default:l(()=>[a.dialogType!==n(c).CHECK?(d(),m(V,{key:0,modelValue:e.editData.description,"onUpdate:modelValue":o[3]||(o[3]=t=>e.editData.description=t),type:"text",placeholder:"请输入说明",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])):(d(),b("span",{key:1,class:ke(["description",e.editData.description?"":"empty"])},w(e.editData.description||"未说明"),3))]),_:1})]),a.dialogType!==n(c).ADD?(d(),b("div",Ia,[i(p,{label:"创建人",prop:"creator"},{default:l(()=>[u("span",null,w(e.editData.creator),1)]),_:1}),i(p,{label:"发布时间",prop:"createTime"},{default:l(()=>[u("span",null,w(e.editData.createTime),1)]),_:1})])):E("",!0)]),_:1},8,["model","rules"])])]),$(u("div",xa,[Na,a.dialogType!==n(c).CHECK?(d(),b("div",Sa,[i(L,{type:"danger",plain:"",disabled:e.selection.length===0,onClick:Ue},{default:l(()=>[y(" 批量删除 ")]),_:1},8,["disabled"]),i(L,{type:"primary",plain:"",loading:e.isHandling,onClick:$e},{default:l(()=>[y(" 导入 ")]),_:1},8,["loading"]),u("input",{ref_key:"uploadFile",ref:Q,style:{display:"none"},type:"file",class:"uploadFile",directory:"",nwdirectory:"",accept:".xls,.xlsx",onChange:Ke},null,544)])):E("",!0),u("div",La,[i(ee,{ref_key:"tableFormRef",ref:Y,class:"table-form tableContainer",model:e},{default:l(()=>[i(n(Me),{ref_key:"tableRef",ref:M,class:"table commonTable sortableTable",data:e.tableData,"row-key":"id",onSelectionChange:Be},{default:l(()=>[j.value?(d(),m(h,{key:0,"class-name":"draggable-item",align:"center",label:"排序",width:"60"},{default:l(()=>[i(f,null,{default:l(()=>[i(n(je))]),_:1})]),_:1})):E("",!0),a.dialogType!==n(c).CHECK?(d(),m(h,{key:1,align:"center",type:"selection",label:"选中","reserve-selection":"",selectable:n(I)},null,8,["selectable"])):E("",!0),i(h,{prop:"name","min-width":"120"},{header:l(()=>[u("p",null,[Ua,y(" 英文名称 "),i(ce,{class:"item",effect:"dark",placement:"top"},{content:l(()=>[$a]),default:l(()=>[i(f,{style:{"margin-left":"4px",transform:"translateY(2px)"}},{default:l(()=>[i(re)]),_:1})]),_:1})])]),default:l(t=>[a.dialogType!==n(c).CHECK?(d(),m(p,{key:0,prop:"tableData."+t.$index+".name",rules:e.tableRules.name},{default:l(()=>{var r;return[i(V,{modelValue:t.row.name,"onUpdate:modelValue":A=>t.row.name=A,modelModifiers:{trim:!0},disabled:!n(I)(t.row)||a.dialogType===n(c).EDIT&&K.value&&!!((r=t.row)!=null&&r.templateDataId),placeholder:"请输入英文名称",onInput:A=>t.row.name=n(Xe)(A)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"])]}),_:2},1032,["prop","rules"])):(d(),b("span",Ha,w(t.row.name),1))]),_:1}),i(h,{prop:"aliasName","min-width":"120"},{header:l(()=>[Ka]),default:l(t=>[a.dialogType!==n(c).CHECK?(d(),m(p,{key:0,prop:"tableData."+t.$index+".aliasName",rules:e.tableRules.aliasName},{default:l(()=>[i(V,{modelValue:t.row.aliasName,"onUpdate:modelValue":r=>t.row.aliasName=r,placeholder:"请输入中文名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):(d(),b("span",Ra,w(t.row.aliasName),1))]),_:1}),i(h,{prop:"type","min-width":"120"},{header:l(()=>[Ba]),default:l(t=>[i(p,{prop:"tableData."+t.$index+".type",rules:e.tableRules.type},{default:l(()=>[i(Te,{modelValue:t.row.type,"onUpdate:modelValue":r=>t.row.type=r,disabled:a.dialogType===n(c).CHECK||!n(I)(t.row),placeholder:"请选择",onChange:r=>x(t.row)},{default:l(()=>[(d(!0),b(pe,null,ve(n(fa),(r,A)=>(d(),m(T,{key:A,label:r,value:A},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1032,["prop","rules"])]),_:1}),i(h,null,{header:l(()=>[Oa]),default:l(t=>[i(p,{prop:"tableData."+t.$index+".dictTypeId"},{default:l(()=>[i(Te,{modelValue:t.row.dictTypeId,"onUpdate:modelValue":r=>t.row.dictTypeId=r,disabled:a.dialogType===n(c).CHECK||!n(I)(t.row),placeholder:"请选择",clearable:"",onChange:r=>C(t.row,t.$index)},{default:l(()=>[(d(!0),b(pe,null,ve(Z.value,r=>(d(),m(T,{key:r.id,label:r.typeName,value:r.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1032,["prop"])]),_:1}),K.value?E("",!0):(d(),m(h,{key:2,prop:"primaryKey",label:"主键","min-width":"60",align:"center"},{default:l(t=>[i(p,{class:"content-center",prop:"tableData."+t.$index+".primaryKey"},{default:l(()=>[i(ue,{modelValue:t.row.primaryKey,"onUpdate:modelValue":r=>t.row.primaryKey=r,disabled:a.dialogType===n(c).CHECK},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:1})),i(h,{prop:"length",label:"字段长度","min-width":"120"},{default:l(t=>[a.dialogType!==n(c).CHECK?(d(),m(p,{key:0,prop:"tableData."+t.$index+".length"},{default:l(()=>[i(De,{modelValue:t.row.length,"onUpdate:modelValue":r=>t.row.length=r,"controls-position":"right",min:0,max:255,disabled:n(W)(t.row)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])):(d(),b("span",Aa,w(t.row.length),1))]),_:1}),i(h,{prop:"decimal",label:"小数位数","min-width":"120"},{default:l(t=>[a.dialogType!==n(c).CHECK?(d(),m(p,{key:0,prop:"tableData."+t.$index+".decimal"},{default:l(()=>[i(De,{modelValue:t.row.decimal,"onUpdate:modelValue":r=>t.row.decimal=r,"controls-position":"right",min:0,max:255},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])):(d(),b("span",Pa,w(t.row.decimal),1))]),_:1}),i(h,{prop:"required",label:"必填","min-width":"60",align:"center"},{default:l(t=>[i(p,{class:"content-center",prop:"tableData."+t.$index+".required"},{default:l(()=>[i(ue,{modelValue:t.row.required,"onUpdate:modelValue":r=>t.row.required=r,disabled:a.dialogType===n(c).CHECK||!n(I)(t.row)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:1}),K.value?(d(),m(h,{key:3,prop:"indexYn",label:"索引","min-width":"60",align:"center"},{default:l(t=>[i(p,{class:"content-center",prop:"tableData."+t.$index+".indexYn"},{default:l(()=>[i(ue,{modelValue:t.row.indexYn,"onUpdate:modelValue":r=>t.row.indexYn=r,disabled:a.dialogType===n(c).CHECK||t.row.name===n(ga)||n(W)(t.row)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:1})):E("",!0),K.value?(d(),m(h,{key:4,prop:"initialValue",label:"初始值","min-width":"120"},{default:l(t=>[t.row.type==="DICTIONARY"?(d(),m(p,{key:0,prop:"tableData."+t.$index+".initialValue"},{default:l(()=>[i(Pe,{modelValue:t.row.initialValue,"onUpdate:modelValue":r=>t.row.initialValue=r,clearable:"",options:X.value[t.$index],props:B,disabled:a.dialogType===n(c).CHECK},null,8,["modelValue","onUpdate:modelValue","options","disabled"])]),_:2},1032,["prop"])):(d(),b(pe,{key:1},[a.dialogType!==n(c).CHECK?(d(),m(p,{key:0,prop:"tableData."+t.$index+".initialValue"},{default:l(()=>[i(V,{modelValue:t.row.initialValue,"onUpdate:modelValue":r=>t.row.initialValue=r,disabled:!n(I)(t.row)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])):a.dialogType===n(c).CHECK?(d(),b("span",Fa,w(t.row.initialValue),1)):E("",!0)],64))]),_:1})):E("",!0),i(h,{prop:"description",label:"业务描述","min-width":"120"},{default:l(t=>[a.dialogType!==n(c).CHECK?(d(),m(p,{key:0,prop:"tableData."+t.$index+".description"},{default:l(()=>[i(V,{modelValue:t.row.description,"onUpdate:modelValue":r=>t.row.description=r,placeholder:"请输入业务描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])):(d(),b("span",qa,w(t.row.description),1))]),_:1}),a.dialogType!==n(c).CHECK?(d(),m(h,{key:5,width:"60px",label:"操作",align:"center",fixed:"right","class-name":"tableOperate"},{default:l(t=>[u("span",{class:ke(["delete",{disabled:!n(I)(t.row)}]),onClick:fe(r=>Le(t.row),["stop"])}," 删除 ",10,za)]),_:1})):E("",!0)]),_:1},8,["data"])]),_:1},8,["model"])]),a.dialogType!==n(c).CHECK?(d(),b("div",Ya,[u("div",{class:"addTableBtn",onClick:O},[i(f,null,{default:l(()=>[i(Fe)]),_:1}),y("新增参数 ")])])):E("",!0),Ma],512),[[Ge,((Ce=(ae=e.editData)==null?void 0:ae.cascaderValue)==null?void 0:Ce.length)>0]])],512),u("div",ja,[i(L,{onClick:o[4]||(o[4]=t=>e.dialogVisible=!1)},{default:l(()=>[y("取消")]),_:1}),a.dialogType!==n(c).CHECK?$((d(),m(L,{key:0,type:"primary",loading:e.submiting,onClick:Ae},{default:l(()=>[y("保存")]),_:1},8,["loading"])),[[qe,"meta_template_saveOrUpdate"]]):(d(),m(L,{key:1,type:"primary",onClick:Oe},{default:l(()=>[y("编辑")]),_:1}))])])),[[ze,e.isLoading]])]}),_:1},8,["modelValue","append-to-dom"])}}});function Wa(){const J=ge({searchOptions:[{label:"关键字",key:"name",type:"text",placeholder:"模板标识/名称",span:5}],columns:[{prop:"name",label:"模板标识",className:"clickable",minWidth:120,sortable:!0,slot:"name"},{prop:"aliasName",label:"模板名称",className:"clickable",minWidth:120,sortable:!0,slot:"aliasName"},{prop:"creator",label:"创建人",minWidth:120,sortable:!0},{prop:"createTime",label:"创建时间",sortable:!0,minWidth:120}]});return _e(()=>{}),{...We(J)}}const Ja=["onClick"],Qa=["onClick"],Za={class:"operate-container"},Xa=Se({__name:"index",setup(J){const{searchOptions:te,columns:q}=Wa(),{checkPermission:S}=ta(),z=N(),g=ge({domId:"template-manage",dialogVisible:!1,dialogType:c.CHECK,curEditId:""}),{data:Y,total:M,pageNo:Q,pageSize:ye,multipleSelection:e,loading:j,handleSizeChange:G,handleCurrentChange:K,handleSelectionChange:le,handleSearch:ne,initData:R}=na(H.getTemplatePageList,{});_e(()=>{R()});function I(){g.curEditId="",g.dialogType=c.ADD,g.dialogVisible=!0}function W(D){S("meta_template_info")&&(g.curEditId=D.id,g.dialogType=c.CHECK,g.dialogVisible=!0)}function Z(D){g.curEditId=D.id,g.dialogType=c.EDIT,g.dialogVisible=!0}function X(D){H.exportTemplate(D.id).then(k=>{const{data:x}=k;la(x.data,x.fileName)})}function oe(D){F.confirm(`删除【${D.name}】数据，是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{H.deleteTemplate(D.id).then(k=>{k.code==="0000"&&(U({type:"success",title:"删除成功"}),R())})}).catch(()=>{})}function ie(){const D=ya(e.value);D.length<1||F.confirm("删除选中数据，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{H.deleteTemplate(D.map(k=>k.id).join(",")).then(k=>{k.code==="0000"&&(U({type:"success",title:"删除成功"}),R(),e.value=[])})}).catch(()=>{})}function de(){g.dialogType=c.EDIT}return(D,k)=>{const x=_("el-button"),B=me("action");return d(),m(n(ra),{id:"template-manage",background:""},{default:l(()=>[i(n(oa),{padding:"1 1 0",border:""},{default:l(()=>[i(n(ia),{ref_key:"SmartSearchRef",ref:z,options:n(te),"query-permission":"",onHandleSearch:n(ne)},null,8,["options","onHandleSearch"])]),_:1}),i(n(da),null,{default:l(()=>[i(n(sa),{ref:"baseTable","operation-width":"220",columns:n(q),"table-data":n(Y),"current-page":n(Q),"page-size":n(ye),total:n(M),"pagination-is-need":!0,"operation-is-need":!0,loading:n(j),"search-form-ref":z.value,"selection-is-need":!0,"index-is-need":!1,onSizeChange:n(G),onCurrentChange:n(K),onSelectionChange:n(le)},{"smart-table_operation":l(()=>[i(x,{type:"primary",onClick:I},{default:l(()=>[y(" 新增模板 ")]),_:1})]),"smart-table_batch-operation":l(()=>[$((d(),b("div",{class:"operate-row",onClick:ie},[i(x,{type:"danger",icon:n(Je),link:""},{default:l(()=>[y("批量删除")]),_:1},8,["icon"])])),[[B,"meta_template_delete"]])]),name:l(({scope:C})=>[u("span",{class:"link",onClick:fe(O=>W(C.row),["stop"])},w(C.row.name),9,Ja)]),aliasName:l(({scope:C})=>[u("span",{class:"link",onClick:fe(O=>W(C.row),["stop"])},w(C.row.aliasName),9,Qa)]),operation:l(({scope:C})=>[u("div",Za,[$((d(),m(x,{type:"primary",link:"",onClick:O=>Z(C.row)},{default:l(()=>[y(" 编辑 ")]),_:2},1032,["onClick"])),[[B,"meta_template_saveOrUpdate"]]),$((d(),m(x,{type:"primary",link:"",onClick:O=>X(C.row)},{default:l(()=>[y(" 下载 ")]),_:2},1032,["onClick"])),[[B,"meta_template_export"]]),$((d(),m(x,{type:"danger",link:"",onClick:O=>oe(C.row)},{default:l(()=>[y(" 删除 ")]),_:2},1032,["onClick"])),[[B,"meta_template_delete"]])])]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1}),i(Ga,{visible:g.dialogVisible,"onUpdate:visible":k[0]||(k[0]=C=>g.dialogVisible=C),"dom-id":g.domId,"dialog-type":g.dialogType,"cur-edit-id":g.curEditId,onSave:n(R),onChangeEdit:de},null,8,["visible","dom-id","dialog-type","cur-edit-id","onSave"])]),_:1})}}});const pt=ba(Xa,[["__scopeId","data-v-7e299eb5"]]);export{pt as default};
