import{q as se,v as q}from"./lodash.22f463b4.js";import{r as G,S as oe,N as me,d as ue,b as J,w as ge,e as w,o as R,x as Q,k as h,g as _,j as p,l as L,f as z,F as ee,y as re,u as f,n as he,ai as E,aj as K,p as Se,bc as we,t as be,v as de,B as ye,U as Ve,z as fe,bP as Ie,bS as Le,bR as Re,bo as Oe,ak as j}from"./element-plus.59ccb443.js";import{t as Pe,x as Ee,y as xe,z as Ae,A as Ne,v as We}from"./login.a4e9287e.js";import{W as M}from"./jointPrepare.318e4ddb.js";import{u as _e,W as Be,_ as Ue}from"./WorkerInfoDialog.898a9f84.js";import{S as $e,T as Fe}from"./dataType.8bfa5e6a.js";import{_ as je}from"./BatchRerunDialog.vue_vue_type_style_index_0_lang.1fb4b07c.js";import{k as qe,m as Me,S as ze,i as pe}from"./index-a95bb620.js";import{h as te,b as Je,S as He}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{S as Ke}from"./index.cc7bef78.js";import"./error.229cea25.js";import"../../app-config.js";import"./useTableAndPagination.0c6e0294.js";import"./serviceManage.8c46f250.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";function Ge(){const{getPriorityOptions:s,priorityFormatter:W,getStatusOptions:I,statusFormatter:O}=_e(),D=G({priorityOptions:[],statusOptions:[]}),{priorityOptions:m,statusOptions:B}=oe(D),V=G({searchOptions:[{label:"关键字",key:"keyword",type:"text",placeholder:"任务名称/方案名称/创建人",labelWidth:"0px",span:4},{label:"状态",key:"status",type:"select",options:B,span:4,value:""},{label:"优先级",key:"priority",type:"select",options:m,span:4,value:""},{label:"创建时间",key:"time",type:"dateTimePicker",datePickerType:"datetimerange",rangeKey:["beginTime","endTime"],span:8}],columns:[{prop:"name",label:"任务名称",minWidth:220,slot:"name",sortable:!0},{prop:"taskName",label:"方案名称",minWidth:180,sortable:!0},{prop:"status",label:"状态",minWidth:120,formatter:(u,y,T)=>O(T),sortable:!0},{prop:"priority",label:"优先级",minWidth:120,formatter:(u,y,T)=>W(T),sortable:!0},{prop:"createTime",label:"创建时间",minWidth:180,sortable:!0},{prop:"beginTime",label:"开始时间",minWidth:180,sortable:!0},{prop:"endTime",label:"结束时间",minWidth:180,sortable:!0},{prop:"cumulativeTime",label:"运行时长",minWidth:120,sortable:!0},{prop:"creator",label:"创建人",minWidth:120,sortable:!0},{prop:"operator",label:"最后执行人",minWidth:120,sortable:!0}]}),x=async()=>{let u=s();u=u.map(y=>({value:y.code,label:y.showValue})),D.priorityOptions=[{label:"所有",value:""},...u]},A=async()=>{const u=I();D.statusOptions=[{label:"所有",value:""},...u]},k=async()=>{x(),A()};return me(async()=>{k()}),{...oe(V)}}const Qe={class:"add-resource-choose"},Xe={class:"item-wrap"},Ye={class:"item-wrap"},Ze={class:"item-wrap"},ea={class:"dialog-footer"},aa=ue({__name:"AddResourceDialog",props:{visible:{type:Boolean,default:!1},taskId:{default:""}},emits:["update:visible"],setup(s,{emit:W}){const I=s,O=W,D=J(),m=G({dialogVisible:!1,submiting:!1,form:{catalogObj:null,dataType:"",name:""},rules:{catalogObj:[{required:!0,message:"请选择所属目录",trigger:"change"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},treeProps:{label:"name",children:"children",disabled:"no"},treeValueKey:"id",classifyTreeData:[],typeOptions:[]});ge(()=>I.visible,u=>{m.dialogVisible=u}),x(),A();function B(){m.form.catalogObj=null,m.form.dataType="",m.form.name="",A(),he(()=>{var u;(u=D.value)==null||u.clearValidate()})}function V(){O("update:visible",!1)}function x(){qe("cgsjlx").then(u=>{if(u.code==="0000"){const{data:{cgsjlx:y}}=u;m.typeOptions=se.cloneDeep(y)}else m.typeOptions=[]}).catch(()=>{m.typeOptions=[]})}function A(){Me.getClassifyTree(!1).then(u=>{u.code==="0000"?m.classifyTreeData=se.cloneDeep(u.data)||[]:m.classifyTreeData=[]}).catch(()=>{m.classifyTreeData=[]})}function k(){D.value.validate(u=>{var y;if(u){m.submiting=!0;const{catalogObj:T,dataType:c,name:t}=m.form,i={workerId:I.taskId,catalogId:T.id,catalogName:T.name,dataType:c,dataTypeAliasName:((y=m.typeOptions.find(n=>n.dictKey===c))==null?void 0:y.dictValue)||"未知类型",name:t};M.addTileResultData(i).then(n=>{n.code==="0000"?(E({type:"success",title:"添加成功"}),V()):E({type:"error",title:"添加失败",message:n.message})}).catch(n=>{E({type:"error",title:"添加失败",message:n.message})}).finally(()=>{m.submiting=!1})}})}return(u,y)=>{const T=w("el-input"),c=w("el-form-item"),t=w("el-option"),i=w("el-select"),n=w("el-form"),a=w("el-button"),l=w("el-dialog");return R(),Q(l,{modelValue:m.dialogVisible,"onUpdate:modelValue":y[4]||(y[4]=g=>m.dialogVisible=g),class:"center-dialog",title:"添加至数据资源池","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"500px",onOpen:B,onClosed:V},{footer:h(()=>[_("span",ea,[p(a,{onClick:y[3]||(y[3]=g=>m.dialogVisible=!1)},{default:h(()=>[L("取 消")]),_:1}),p(a,{type:"primary",loading:m.submiting,onClick:k},{default:h(()=>[L("确 定")]),_:1},8,["loading"])])]),default:h(()=>[_("div",Qe,[p(n,{ref_key:"formRef",ref:D,class:"edit-form",inline:"",model:m.form,rules:m.rules,"label-width":"120px","label-position":"right"},{default:h(()=>[_("div",Xe,[p(c,{label:"数据名称：",prop:"name"},{default:h(()=>[p(T,{modelValue:m.form.name,"onUpdate:modelValue":y[0]||(y[0]=g=>m.form.name=g),clearable:""},null,8,["modelValue"])]),_:1})]),_("div",Ye,[p(c,{label:"数据类型：",prop:"dataType"},{default:h(()=>[p(i,{modelValue:m.form.dataType,"onUpdate:modelValue":y[1]||(y[1]=g=>m.form.dataType=g),style:{width:"100%"}},{default:h(()=>[(R(!0),z(ee,null,re(m.typeOptions,g=>(R(),Q(t,{key:g.id,label:g.dictValue,value:g.dictKey},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_("div",Ze,[p(c,{label:"所属目录：",prop:"catalogObj"},{default:h(()=>[p(f(ze),{modelValue:m.form.catalogObj,"onUpdate:modelValue":y[2]||(y[2]=g=>m.form.catalogObj=g),"tree-props":m.treeProps,"tree-data":m.classifyTreeData,"value-key":m.treeValueKey,style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data","value-key"])]),_:1})])]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}});function ta(){const s=G({defaultTileInfoForm:{taskInfo:null,taskDetailInfo:{}},tileInfoForm:{taskInfo:null,taskDetailInfo:{}},tileInfoFormRule:{taskInfo:[{required:!0,message:"方案名称不能为空",trigger:"change"}]},treeProps:{label:"name",children:"children"},taskTreeData:[],curTaskId:"",cellData:[],publishConfigList:[],isLoadingScheme:!1,showErrorTip:!1,groupIdentify:{key:"type",value:0}});function W(){s.tileInfoForm=q(s.defaultTileInfoForm),s.curTaskId="",s.cellData=[],s.publishConfigList=[],s.isLoadingScheme=!1,s.showErrorTip=!1}function I(){te.getClassifyTree().then(c=>{c.code==="0000"?(s.taskTreeData=c.data,O()):(K({type:"warning",message:"获取切片方案数据有误"}),s.taskTreeData=[])}).catch(c=>{K({type:"error",message:c.message||"获取切片方案数据有误"}),s.taskTreeData=[]})}function O(){const c=t=>{var i;for(let n=0,a=t.length;n<a;n++)t[n].type===1&&t[n].dataType?t[n].name=`(默认) ${t[n].name}`:((i=t[n].children)==null?void 0:i.length)>0&&c(t[n].children)};c(s.taskTreeData)}function D(c){let t=null;const i=n=>{var a;for(let l=0,g=n.length;l<g;l++)if(n[l].type===1&&n[l].id===c){t=n[l];break}else((a=n[l].children)==null?void 0:a.length)>0&&i(n[l].children)};i(s.taskTreeData),s.tileInfoForm.taskInfo=t,t&&(s.curTaskId=(t==null?void 0:t.id)||""),s.isLoadingScheme=!1}function m(c){c.id!==s.curTaskId&&(s.curTaskId=c.id,s.isLoadingScheme=!0,te.getSchemeInfo(s.curTaskId).then(t=>{if(t.code==="0000"){s.tileInfoForm.taskDetailInfo=q(t.data);const i=JSON.parse(t.data.scheme).cells;s.cellData=q(i),y();const n=s.cellData.filter(a=>{var l;return a.type==="algorithm.Element"&&a.algorithmType!=="READ_DATASOURCE"&&a.algorithmType!=="WRITE_DATASOURCE"&&((l=a.publishParamList)==null?void 0:l.length)>0});for(let a=0,l=n.length;a<l;a++)u(n[a]);x(i)}else s.isLoadingScheme=!1,K({type:"warning",message:"获取方案信息有误"})}).catch(t=>{s.isLoadingScheme=!1,K({type:"error",message:t.message||"获取方案信息错误"})}))}function B(c){s.isLoadingScheme=!0;const t=JSON.parse(c).cells;s.cellData=q(t),y(),x(t)}function V(c){return s.cellData.find(t=>t.id===c)}function x(c){const t=c.filter(i=>{var n;return i.type==="algorithm.Element"&&i.algorithmType!=="READ_DATASOURCE"&&i.algorithmType!=="WRITE_DATASOURCE"&&((n=i.publishParamList)==null?void 0:n.length)>0});if(t.length>0){const i=Array(t.length).fill(null);t.forEach((a,l)=>{i[l]=A(a.version.id,a.id)}),Promise.all(i).then(a=>{a.some(l=>!l)?(K({type:"warning",message:"获取参数失败！"}),s.publishConfigList=[]):(s.publishConfigList=q(a),t.forEach(l=>{s.publishConfigList.forEach(g=>{g.uid===l.id&&l.publishParamList.forEach(b=>{g.pubulishData[b]=l.data[b]})})}),s.publishConfigList.forEach(l=>{l.paramsConfigList=l.paramsConfigList.filter(g=>l.pubulishData.hasOwnProperty(g.paramName)&&g.paramDirection!=="INPUT"),l.relations=l.relations.filter(g=>l.pubulishData.hasOwnProperty(g.source)&&l.pubulishData.hasOwnProperty(g.target))}),s.isLoadingScheme=!1)})}else s.publishConfigList=[],s.isLoadingScheme=!1}function A(c,t){return new Promise(i=>{te.getAlgorithmDetailInfo(c).then(n=>{if(n.code==="0000"){const{data:a}=n,{name:l,paramsConfig:g}=a;if(pe(g)){const C=JSON.parse(g),X={paramsConfigList:C.config||[],relations:C.relations||[],type:C.type||"JOB",name:l,uid:t,pubulishData:{}};setTimeout(()=>{i(q(X))},100)}else i(!1)}else i(!1)}).catch(()=>{i(!1),s.isLoadingScheme=!1})})}function k(c,t,i){const n=s.publishConfigList.find(l=>l.uid===i);n.pubulishData[t]=c;const a=V(i);a.data[t]=c,u(a),setTimeout(()=>{y()},100)}function u(c){const{data:t={},requiredParamList:i=[],paramTypeEnums:n={}}=c;let a=!0;for(let l=0,g=i.length;l<g;l++){if(t[i[l]]===void 0||t[i[l]]===null||t[i[l]]===""){a=!1;break}if(n[i[l]]==="GEO_SRS")if(pe(t[i[l]])){const b=JSON.parse(t[i[l]]);if(!Array.isArray(b)||Array.isArray(b)&&b.length===0){a=!1;break}else if(b.some(C=>!(C!=null&&C.coordinateName)||!(C!=null&&C.geodeticDatum))){a=!1;break}}else{a=!1;break}}c.isPassValid=a}function y(c=!1,t=""){const i=q(s.cellData);return console.log({cells:i}),new Promise(n=>{let a=!0;for(let l=0,g=i.length;l<g;l++){const b=i[l];if(b.type==="algorithm.Element"&&(b.isError||!b.isPassValid)){a=!1;break}}a?(n(t?{name:t,valid:!0}:!0),s.showErrorTip=!1):(c&&K({type:"warning",message:"请正确填写参数赋值或选择正确的切片方案"}),n(t?{name:t,valid:!1}:!1),s.showErrorTip=!0)})}function T(c){return new Promise(t=>{c.validate(i=>{t(i)})})}return{...oe(s),initSchemeData:W,getAllTask:I,formatTreeData:O,handleTaskChange:m,getCellData:V,createTileInfoForm:x,getParamConfigPromise:A,handleControlChange:k,setCellPassValid:u,checkDagScheme:y,checkSchemeForm:T,getTaskInfoById:D,renderSchemeByDag:B}}const ia={class:"main-content"},la={class:"title"},na=_("span",null,"新增处理任务",-1),sa={class:"card"},oa=_("div",{class:"subtitle"},"任务信息",-1),ra={class:"content-wrap"},da={class:"item-wrap item2"},ua={class:"card"},ca=_("div",{class:"subtitle"},"参数设置",-1),fa={class:"content-wrap"},pa={class:"item-wrap item2"},ma={class:"scheme-title"},ga={class:"footer"},ha=ue({__name:"ProcessingTaskDialog",props:{visible:{type:Boolean,default:!1},domId:{default:""}},emits:["update:visible","save"],setup(s,{emit:W}){const I=J(),O=J(),D=J([]),m=J(),B=s,{tileInfoForm:V,treeProps:x,groupIdentify:A,cellData:k,tileInfoFormRule:u,taskTreeData:y,publishConfigList:T,getAllTask:c,initSchemeData:t,checkDagScheme:i,handleTaskChange:n,handleControlChange:a,checkSchemeForm:l}=ta(),g=W,b=G({isLoading:!1,dialogVisible:!1,submiting:!1,editData:{name:""},rules:{name:[{required:!0,message:"任务名称不能为空",trigger:"blur"},{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]},{validator:X,trigger:"blur",message:"该任务名称已存在"}]},initDataInfo:{srs:"EPSG:4326",srsOrigin:"0,0,0",rotate:0}});Se("getCellById",C);function C(P){var N;const v=(N=k.value)==null?void 0:N.find(U=>U.id===P);return v?{attributes:v}:{}}ge(()=>B.visible,P=>{b.dialogVisible=P}),we(()=>{D.value=[]});function X(P,v,N){M.checkname(v).then(U=>{if(!U.data)return N(new Error);N()})}function ie(){b.editData.name="",t(),c(),he(()=>{setTimeout(()=>{I.value.clearValidate(),O.value.clearValidate()},300)})}function Y(){g("update:visible",!1)}function le(){var o;(o=D.value)==null||o.forEach(e=>{e==null||e.validate()});const P=l(I.value),v=l(O.value),N=i(!0);Promise.all([P,v,N]).then(([e,r,$])=>{if(e&&r&&$){const{taskDetailInfo:{id:H,clearData:d,workType:F,expression:S,name:ae,catalog:ne,autoDependence:ke,cancelWhenFailed:ve,effectStartTime:De,effectEndTime:ce}}=V.value,Te={cells:q(k.value)},Z={taskId:H,name:b.editData.name,clearData:d??!0,workType:F,expression:S,dag:JSON.stringify(Te),taskName:ae,taskCatalog:ne};F!=="SINGLE"&&(Z.autoDependence=ke,Z.cancelWhenFailed=ve,Z.effectStartTime=De,ce&&(Z.effectEndTime=ce)),b.submiting=!0,te.runTask(Z).then(Ce=>{b.submiting=!1,Ce.code==="0000"?(E({type:"success",title:"新增处理任务成功"}),Y(),g("save")):E({type:"error",title:"新增处理任务失败"})}).catch(()=>{b.submiting=!1,E({type:"error",title:"新增处理任务失败"})})}})}return(P,v)=>{const N=w("ArrowLeft"),U=w("el-icon"),o=w("el-input"),e=w("el-form-item"),r=w("el-form"),$=w("el-button"),H=be("loading");return R(),Q(f(He),{id:"processing-task-full-dialog",modelValue:b.dialogVisible,"onUpdate:modelValue":v[3]||(v[3]=d=>b.dialogVisible=d),class:"full-dialog common-full-dialog","append-to-dom":P.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:ie,onClosed:Y},{default:h(()=>[_("div",ia,[_("div",la,[p(U,{onClick:Y},{default:h(()=>[p(N)]),_:1}),na]),de((R(),z("div",{ref_key:"mainRef",ref:m,class:"main"},[_("div",sa,[oa,_("div",ra,[p(r,{ref_key:"editFormRef",ref:I,class:"form edit-form",inline:"",model:b.editData,rules:b.rules,"label-width":"auto","label-position":"right"},{default:h(()=>[_("div",da,[p(e,{label:"任务名称",prop:"name"},{default:h(()=>[p(o,{modelValue:b.editData.name,"onUpdate:modelValue":v[0]||(v[0]=d=>b.editData.name=d),type:"text",placeholder:"请输入任务名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),p(e)])]),_:1},8,["model","rules"])])]),_("div",ua,[ca,_("div",fa,[p(r,{ref_key:"taskFormRef",ref:O,class:"form edit-form",inline:"",model:f(V),rules:f(u),"label-width":"auto","label-position":"right"},{default:h(()=>[_("div",pa,[p(e,{label:"方案名称",prop:"taskInfo"},{default:h(()=>[p(f(Je),{modelValue:f(V).taskInfo,"onUpdate:modelValue":v[1]||(v[1]=d=>f(V).taskInfo=d),style:{width:"100%"},"tree-props":f(x),"tree-data":f(y),"node-key":"id",icon:"iconCls","expand-on-click-node":!1,"default-expand-all":"",filterable:"","only-click-child":"","show-group-icon":"","group-identify":f(A),onChange:f(n)},null,8,["modelValue","tree-props","tree-data","group-identify","onChange"])]),_:1}),p(e)])]),_:1},8,["model","rules"])]),f(T).length>0?(R(!0),z(ee,{key:0},re(f(T),(d,F)=>(R(),z("div",{key:d.uid,class:"content-wrap scheme"},[d.paramsConfigList.length>0?(R(),z(ee,{key:0},[_("div",ma,ye(d.name),1),p(r,{ref_for:!0,ref:S=>{S&&(D.value[F]=S)},class:"form scheme-form__common",uid:d.uid,inline:"",model:d.pubulishData,"label-width":"auto","label-position":"right"},{default:h(()=>[(R(!0),z(ee,null,re(d.paramsConfigList,(S,ae)=>(R(),Q(e,{key:S.paramName+ae,class:Ve([{"scheme-form-item":!0,"is-left":ae%2===0}]),label:S.paramLabel,prop:S.paramName,required:S.required,rules:{required:S.required,message:`${S.paramLabel}不能为空`}},{default:h(()=>[p(f(Ke),{ref_for:!0,ref:"paramForm",modelValue:d.pubulishData[S.paramName],"onUpdate:modelValue":ne=>d.pubulishData[S.paramName]=ne,"control-name":S.paramName,uid:d.uid,type:d.type,"all-param":S,relations:d.relations,"default-data-info":b.initDataInfo,onChange:f(a)},null,8,["modelValue","onUpdate:modelValue","control-name","uid","type","all-param","relations","default-data-info","onChange"])]),_:2},1032,["class","label","prop","required","rules"]))),128))]),_:2},1032,["uid","model"])],64)):fe("",!0)]))),128)):fe("",!0)])])),[[H,b.isLoading]]),_("div",ga,[p($,{onClick:v[2]||(v[2]=d=>b.dialogVisible=!1)},{default:h(()=>[L("取消")]),_:1}),p($,{type:"primary",loading:b.submiting,onClick:le},{default:h(()=>[L("保存")]),_:1},8,["loading"])])])]),_:1},8,["modelValue","append-to-dom"])}}});const Aa=ue({__name:"index",setup(s){const W=J(),I=J(),O={workType:$e},{searchOptions:D,columns:m}=Ge(),{data:B,total:V,pageNo:x,pageSize:A,multipleSelection:k,loading:u,handleSizeChange:y,handleCurrentChange:T,handleSelectionChange:c,handleSearch:t,initData:i}=Pe(M.getWorkerPageList,O),{isRunning:n}=_e(),a=G({domId:"singleTask",isLoadingTable:!1,tableData:[],priorityOptions:[],statusOptions:[],dialogVisible:!1,curEditData:{},selection:[],currentRow:null,runTaskDialogVisible:!1,taskData:{},batchRunDialogVisible:!1,batchRunIds:[],setPriorityIds:[],addResourceDialogVisible:!1,addResoureTaskId:"",addTaskDialogVisible:!1});me(()=>{i()});function l(o){o.serviceId||j.confirm(`删除【${o.name}】任务，是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{u.value=!0,a.dialogVisible=!1,M.deleteWorker(o.id).then(e=>{var r;u.value=!1,e.code==="0000"?(E({type:"success",title:"删除任务成功"}),i(),a.selection=a.selection.filter($=>$.id!==o.id),a.selection.length===0&&((r=W.value)==null||r.clearSelection())):E({type:"warning",title:"删除失败，请重试"})}).catch(e=>{u.value=!1,E({type:"error",title:"删除错误",message:e.message||"服务有错"})})}).catch(()=>{})}function g(o){n(o.status)||P(o.id,e=>{e&&(a.taskData={id:o.id,taskId:o.taskId,dag:se.cloneDeep(e.jobInfo.scheme),customVarList:e.jobInfo.customVarList||[],nodesInfo:e.nodesInfo||[],isRunSuccess:o.status===Fe.FINISH},a.runTaskDialogVisible=!0)})}function b(o){return o.serviceId?!0:!(o.status===1||o.status===-1)}function C(o){b(o)||j.confirm(`取消【${o.name}】任务，是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",draggable:!0}).then(()=>{u.value=!0,M.cancelWorker(o.id).then(e=>{var r;u.value=!1,e.code==="0000"?(E({type:"success",title:"取消任务成功"}),i(),(r=W.value)==null||r.toggleRowSelection(o,!1)):E({type:"warning",title:"取消失败，请重试"})}).catch(e=>{u.value=!1,E({type:"error",title:"取消错误",message:e.message||"服务有错"})})}).catch(()=>{})}function X(){const o=k.value.map(e=>({name:e.name,flag:!!e.serviceId}));if(o.some(e=>e.flag)){const e=o.filter(r=>r.flag).map(r=>r.name);j.alert(`存在数据不可进行删除操作，请重新选择。
      <br/><br/>
      不可删除任务为：${e.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0});return}j.confirm("删除选中数据，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",draggable:!0}).then(()=>{u.value=!0,M.deleteWorker(k.value.map(e=>e.id).join(",")).then(e=>{u.value=!1,e.code==="0000"&&i()}).catch(()=>{u.value=!1})}).catch(()=>{})}function ie(){const o=k.value.map(e=>({name:e.name,flag:n(e.status)}));if(o.some(e=>e.flag)){const e=o.filter(r=>r.flag).map(r=>r.name);j.alert(`存在数据不可进行重新运行操作，请重新选择。
      <br/><br/>
      不可重新运行任务为：${e.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0});return}a.setPriorityIds=[],a.batchRunIds=k.value.filter(e=>!n(e.status)).map(e=>e.id),a.batchRunDialogVisible=!0}function Y(){const o=k.value.map(e=>({name:e.name,flag:b(e)}));if(o.some(e=>e.flag)){const e=o.filter(r=>r.flag).map(r=>r.name);j.alert(`存在数据不可进行取消操作，请重新选择。
      <br/><br/>
      不可取消任务为：${e.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0,confirmButtonText:"确定"});return}j.confirm("取消选中数据，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",draggable:!0}).then(()=>{u.value=!0;const e=k.value.map(r=>r.id).join(",");M.cancelWorker(e).then(r=>{u.value=!1,r.code==="0000"&&i()}).catch(()=>{u.value=!1})}).catch(()=>{})}function le(){const o=k.value.map(e=>({name:e.name,flag:e.status!==-1}));if(o.some(e=>e.flag)){const e=o.filter(r=>r.flag).map(r=>r.name);j.alert(`存在数据不可进行优先级操作，仅等待中状态的任务允许操作，请重新选择。
      <br/><br/>
      不可操作的任务为：${e.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0,confirmButtonText:"确定"});return}a.batchRunIds=[],a.setPriorityIds=k.value.map(e=>e.id),a.batchRunDialogVisible=!0}function P(o,e){M.getWorkerNodeList(o).then(r=>{r.code==="0000"?e&&e instanceof Function&&e(r.data):e&&e instanceof Function&&e(!1)}).catch(()=>{e&&e instanceof Function&&e(!1)})}function v(){P(a.curEditData.jobInfo.id,o=>{o&&(a.curEditData=o)})}function N(){a.addTaskDialogVisible=!0}function U(o){a.currentRow=o,P(o.id,e=>{e&&(a.dialogVisible=!0,a.curEditData=e)})}return(o,e)=>{const r=w("el-button"),$=w("el-link"),H=be("action");return R(),z(ee,null,[p(f(We),{id:"singleTask",background:""},{default:h(()=>[p(f(Ee),{padding:"1 1 0",border:""},{default:h(()=>[p(f(xe),{ref_key:"searchRef",ref:I,options:f(D),onHandleSearch:f(t)},null,8,["options","onHandleSearch"])]),_:1}),p(f(Ae),null,{default:h(()=>[p(f(Ne),{ref:"baseTable","operation-width":"220",columns:f(m),"table-data":f(B),"current-page":f(x),"page-size":f(A),total:f(V),"pagination-is-need":!0,"operation-is-need":!0,loading:f(u),"search-form-ref":I.value,"selection-is-need":!0,"index-is-need":!1,onSizeChange:f(y),onCurrentChange:f(T),onSelectionChange:f(c)},{"smart-table_operation":h(()=>[p(r,{type:"primary",onClick:N},{default:h(()=>[L(" 处理任务 ")]),_:1})]),"smart-table_batch-operation":h(()=>[de((R(),Q(r,{icon:f(Ie),link:"",type:"primary",onClick:ie},{default:h(()=>[L(" 重新运行 ")]),_:1},8,["icon"])),[[H,"algorithm_worker_rerun"]]),p(r,{link:"",type:"primary",icon:f(Le),onClick:le},{default:h(()=>[L(" 设优先级 ")]),_:1},8,["icon"]),de((R(),Q(r,{link:"",type:"primary",icon:f(Re),onClick:Y},{default:h(()=>[L(" 取消 ")]),_:1},8,["icon"])),[[H,"algorithm_worker_cancelWork"]]),p(r,{link:"",type:"danger",icon:f(Oe),onClick:X},{default:h(()=>[L(" 批量删除 ")]),_:1},8,["icon"])]),name:h(({scope:d})=>[p($,{type:"primary",onClick:F=>U(d.row)},{default:h(()=>[L(ye(d.row.name),1)]),_:2},1032,["onClick"])]),operation:h(({scope:d})=>[p(r,{link:"",type:"primary",disabled:f(n)(d.row.status),onClick:F=>g(d.row)},{default:h(()=>[L(" 重新运行 ")]),_:2},1032,["disabled","onClick"]),p(r,{link:"",type:"primary",disabled:b(d.row),onClick:F=>C(d.row)},{default:h(()=>[L(" 取消 ")]),_:2},1032,["disabled","onClick"]),p(r,{link:"",type:"danger",disabled:!!d.row.serviceId,onClick:F=>l(d.row)},{default:h(()=>[L(" 删除 ")]),_:2},1032,["disabled","onClick"])]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1})]),_:1}),p(Be,{visible:a.dialogVisible,"onUpdate:visible":e[0]||(e[0]=d=>a.dialogVisible=d),"dom-id":a.domId,"cur-edit-data":a.curEditData,onRefresh:v,onRefreshList:f(i),onRerun:e[1]||(e[1]=d=>g(a.currentRow)),onCancel:e[2]||(e[2]=d=>C(a.currentRow)),onDelete:e[3]||(e[3]=d=>l(a.currentRow))},null,8,["visible","dom-id","cur-edit-data","onRefreshList"]),p(Ue,{visible:a.runTaskDialogVisible,"onUpdate:visible":e[4]||(e[4]=d=>a.runTaskDialogVisible=d),"dag-data":a.taskData,onSuccess:f(i)},null,8,["visible","dag-data","onSuccess"]),p(je,{visible:a.batchRunDialogVisible,"onUpdate:visible":e[5]||(e[5]=d=>a.batchRunDialogVisible=d),"select-ids":a.batchRunIds,"set-priority-ids":a.setPriorityIds,onSuccess:f(i)},null,8,["visible","select-ids","set-priority-ids","onSuccess"]),p(aa,{visible:a.addResourceDialogVisible,"onUpdate:visible":e[6]||(e[6]=d=>a.addResourceDialogVisible=d),"task-id":a.addResoureTaskId},null,8,["visible","task-id"]),p(ha,{visible:a.addTaskDialogVisible,"onUpdate:visible":e[7]||(e[7]=d=>a.addTaskDialogVisible=d),"dom-id":a.domId,onSave:f(i)},null,8,["visible","dom-id","onSave"])],64)}}});export{Aa as default};
