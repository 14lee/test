import{d as N,b as p,r as A,L as pe,e as c,v as se,ae as ne,o as S,f as F,j as e,k as o,g as I,l as E,u as W,aJ as Y,al as ee,aj as J,ak as Z,h as te,Z as H,_ as K,w as me,z as U,N as re,x as M,c as ie,B as j,X as fe,bI as _e}from"./element-plus.59ccb443.js";import{r as T,u as G,G as B,m as oe,H as ve,I as he,v as ge}from"./login.a4e9287e.js";import{s as R}from"../../app-config.js";import{_ as q}from"./error.229cea25.js";import{j as ye}from"./lodash.22f463b4.js";import{V as we}from"./smartweb3.2d5e4c59.js";const be=(s={})=>T.doPostPromiseJson(`${R.system}/user/updateBySelf`,s),ae=()=>T.doGetPromise(`${R.system}/user/selectUserByToken`),Pe=s=>T.doPostPromiseForm(`${R.system}/file/avatar`,s),Ce=(s={})=>T.doPostPromiseJson(`${R.system}/user/updateUserPassword`,s),le=()=>T.doPostPromiseJson(`${R.system}/user/userLogout`),xe=()=>T.doGetPromise(`${R.system}/config/loginRegisterSecurityInfo`),Ie=()=>T.doGetPromise(`${R.system}/account/security`),$e=(s={})=>T.doPostPromiseJson(`${R.system}/account/security/email/captcha`,s),Ve=(s={})=>T.doPostPromiseJson(`${R.system}/account/security/email/update`,s),Se=(s={})=>T.doPostPromiseJson(`${R.system}/account/security/phone/captcha`,s),ke=(s={})=>T.doPostPromiseJson(`${R.system}/account/security/phone/update`,s),Be=(s={})=>T.doPostPromiseJson(`${R.system}/account/security/deleteBySelf`,s),ce=(s={})=>T.doPostPromiseJson(`${R.system}/account/security/matchPassword`,s),Ee=(s={})=>T.doPostPromiseJson(`${R.system}/account/security/updateUserAccountBySelf`,s),Q=s=>(H("data-v-efa3e2b2"),s=s(),K(),s),Te=Q(()=>I("h2",null,[E(" 账号是系统身份的唯一凭证，"),I("span",{style:{color:"var(--el-color-danger)"}},"只能修改一次"),E("。 ")],-1)),Re=Q(()=>I("h2",null,"该操作不可逆，请谨慎操作！",-1)),Fe=Q(()=>I("h4",null,"请在下方输入框中输入您的密码以确认操作",-1)),Ae={class:"dialog-footer"},De=N({__name:"ChangeAccountName",props:{visible:{type:Boolean,default:!1}},emits:["close","complete"],setup(s,{emit:k}){const b=G(),y=p(!0),w=p(!0),m=s,g=k,u=p(),i=A({password:void 0}),V=A({password:[{required:!0,message:"请输入密码"},{validator:(h,f,_)=>{/\s+/g.test(f)?_(new Error("密码不能包含空格，请删除空格后重试")):_()}}]}),P=()=>{setTimeout(()=>{y.value=!1},0)},a=()=>{g("close"),u.value&&u.value.resetFields()},v=p(void 0),$=async()=>{if(u.value)try{if(await u.value.validate())try{const f=await ce({userId:b.getUserInfo.id,password:B(i.password)});if(!f.success)return;if(!f.data){J.error("密码错误");return}w.value=!1,Z({title:"修改账号",confirmButtonText:"保存",cancelButtonText:"取消",showCancelButton:!0,beforeClose:async(_,C,n)=>{if(console.log(_),_==="cancel")n(),a();else if(_==="confirm")try{(await Ee({userId:b.getUserInfo.id,password:B(i.password),newLoginId:v.value})).success&&(n(),a(),g("complete"))}catch{n(),a()}},message:()=>te(Y,{label:"新账号",required:!0},()=>te(ee,{modelValue:v.value,"onUpdate:modelValue":_=>{v.value=_},maxlength:25,type:"text",showWordLimit:!0,placeholder:"请输入新账号"}))})}catch{}}catch{}};return pe(()=>{w.value=!0}),(h,f)=>{const _=c("el-form"),C=c("el-button"),n=c("el-dialog");return se((S(),F("div",null,[e(n,{"model-value":m.visible,width:500,title:"修改账号",class:"dialog",onClose:a},{footer:o(()=>[I("span",Ae,[e(C,{onClick:a},{default:o(()=>[E(" 取消 ")]),_:1}),e(C,{type:"danger",onClick:$},{default:o(()=>[E(" 确认修改 ")]),_:1})])]),default:o(()=>[Te,Re,Fe,e(_,{ref_key:"formRef",ref:u,autocomplete:"off",model:i,rules:V,size:"large","label-width":0,"label-position":"right"},{default:o(()=>[e(W(Y),{prop:"password"},{default:o(()=>[e(W(ee),{modelValue:i.password,"onUpdate:modelValue":f[0]||(f[0]=d=>i.password=d),placeholder:"请输入密码","show-password":"",clearable:"",readonly:y.value,onMousedown:P},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value"])],512)),[[ne,w.value]])}}});const Le=q(De,[["__scopeId","data-v-efa3e2b2"]]),de=s=>(H("data-v-f5bdb92a"),s=s(),K(),s),Ue={class:"info"},Ne={key:0,class:"avatar"},qe={class:"avatar-show"},Me=de(()=>I("div",{class:"avatar__upload__tip"},"仅支持JPG、JPEG、PNG格式，文件小于1M",-1)),ze=de(()=>I("div",{class:"form-tip"},"找不到SMTP服务器？",-1)),We={class:"btn"},Je={key:0},je=N({__name:"Info",setup(s){const k=G(),b=p(),y=p(!1),w=p(!1),m=A({dialogVisible:!1,changeLoading:!1,changeFormValue:{avatarInfo:{name:"",url:""},cardNo:"",email:"",id:"",phone:"",loginId:"",name:"",sex:0},changeFormoptions:[{label:"头像",key:"avatarInfo",type:"avatar",span:24,disabled:!0,labelWidth:"120px"},{label:"账号",key:"loginId",type:"input",span:24,disabled:!0,labelWidth:"120px"},{label:"用户名",key:"name",type:"input",span:24,labelWidth:"120px"},{label:"性别",key:"sex",type:"select",span:12,labelWidth:"120px",options:[{label:"男",value:1},{label:"女",value:0},{label:"保密",value:2}]},{label:"联系电话",key:"phone",type:"input",span:24,labelWidth:"120px"},{label:"联系邮箱",key:"email",type:"input",span:24,labelWidth:"120px"},{label:"身份证",key:"cardNo",type:"input",span:24,labelWidth:"120px"},{label:"SMTP服务器",key:"smtpServer",type:"select",span:24,labelWidth:"120px",tip:!0,tipText:"若下拉列表没有您的邮箱服务器，可自行搜索百度“xx邮箱SMTP服务器”，若查找无果，建议您更换邮箱",slotName:"smtp",allowCreate:!0,options:[{label:"smtp.qq.com",value:"smtp.qq.com"},{label:"smtp.139.com",value:"smtp.139.com"},{label:"smtp.163.com",value:"smtp.163.com"},{label:"smtp.gmail.com",value:"smtp.gmail.com"},{label:"smtp.mail.yahoo.com",value:"smtp.mail.yahoo.com"},{label:"smtp.sohu.com",value:"smtp.sohu.com"},{label:"smtp.sina.com.cn",value:"smtp.sina.com.cn"}]},{label:"SMTP授权码",key:"smtpCode",type:"input",span:24,labelWidth:"120px",tip:!0,tipText:"点击查看帮助文档",slotName:"code"}],rules:{loginId:[{required:!0,trigger:"blur",message:"请输入账号"}],name:[{required:!0,trigger:"blur",message:"用户名长度范围为1到15",min:1,max:15}],phone:[{message:"请输入由11位数字组成的联系电话",trigger:"blur",pattern:/^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$/}],email:[{message:"请输入正确的邮箱格式",trigger:"blur",pattern:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/}],cardNo:[{message:"请输入由18位数字或x组成的身份证",trigger:"blur",pattern:/(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)/}]}}),g=()=>{Z.confirm("确认删除用户头像？",{title:"提示",autofocus:!1,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m.changeFormValue.avatarInfo=null}).catch(()=>{})},u=async a=>{const v=["image/png","image/jpg","image/jpeg"];if(a.size/1024/1024>1){J.error("文件大小超过限制!");return}if(v.includes(a.type)){const h=new FormData;h.append("avatar",a);const f=await Pe(h);f.data&&(m.changeFormValue.avatarInfo=f.data)}else J.error("上传头像格式错误!")},i=()=>{y.value=!0},V=async()=>{b.value.getValue().then(a=>{if(a){a.cardNo&&(a.cardNo=B(a.cardNo)),a.phone&&(a.phone=B(a.phone));const v=Object.assign(k.userInfo,a,{avatarInfo:m.changeFormValue.avatarInfo?m.changeFormValue.avatarInfo:null});m.changeLoading=!0,be(v).then(()=>{ae().then($=>{k.setUserInfo($.data)}).catch()}).catch().finally(()=>{m.changeLoading=!1})}})},P=async()=>{try{const a=await ae();a.data&&k.setUserInfo(a.data)}catch{}};return me(()=>k.userInfo,a=>{if(a){const v=ye(a);m.changeFormValue={...v,avatarInfo:v.avatarInfo,cardNo:oe(v.cardNo),phone:oe(v.phone)}}},{immediate:!0}),(a,v)=>{const $=c("Delete"),h=c("ElIcon"),f=c("el-avatar"),_=c("el-button"),C=c("el-upload");return S(),F("div",Ue,[e(W(ve),{ref_key:"changeFormRef",ref:b,class:"form",rules:m.rules,options:m.changeFormoptions,"form-value":m.changeFormValue},{default:o(n=>{var d,t;return[n.option.type==="avatar"?(S(),F("div",Ne,[I("div",qe,[(d=m.changeFormValue.avatarInfo)!=null&&d.url?(S(),F("div",{key:0,class:"mask",onClick:g},[e(h,{size:26,color:"transparent"},{default:o(()=>[e($)]),_:1})])):U("",!0),e(f,{size:100,src:(t=m.changeFormValue.avatarInfo)==null?void 0:t.url},null,8,["src"])]),e(C,{action:"",limit:1,class:"avatar__upload",accept:".jpg,.png,.jpeg","show-file-list":!1,"before-upload":l=>(u(l),!1)},{tip:o(()=>[Me]),default:o(()=>[e(_,{size:"small",type:"primary"},{default:o(()=>[E(" 选择文件 ")]),_:1})]),_:1},8,["before-upload"])])):U("",!0)]}),smtp:o(()=>[ze]),code:o(()=>[I("div",{class:"form-tip",onClick:i},"如何获取授权码？")]),_:1},8,["rules","options","form-value"]),e(W(he),{visible:y.value,onClose:v[0]||(v[0]=n=>y.value=!1)},null,8,["visible"]),I("div",We,[e(_,{type:"primary",onClick:V},{default:o(()=>[E("保存")]),_:1})]),w.value?(S(),F("div",Je,[e(Le,{visible:w.value,onClose:v[1]||(v[1]=n=>w.value=!1),onComplete:P},null,8,["visible"])])):U("",!0)])}}});const Ge=q(je,[["__scopeId","data-v-f5bdb92a"]]),Oe={class:"dialog-footer"},Ze=N({__name:"ChangePassword",props:{visible:{type:Boolean,default:!1}},emits:["close","complete"],setup(s,{emit:k}){const b=p(),y=p(!0),w=p(!1),m=p(!1),g=p({allowRegistration:!1,passwordStrength:!1,passwordSecurity:!1}),u={oldPassword:[{required:!0,trigger:"blur",message:"请输入原密码"},{trigger:"blur",validator:v}],newPassword:[{trigger:"blur",required:!0,message:"请输入新密码"},{trigger:"blur",validator:(t,l,r)=>{/\s+/g.test(l)?r(new Error("密码不能包含空格，请删除空格后重试")):r()}},{trigger:"blur",validator:V},{trigger:"blur",validator:P}],newConfirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{trigger:"blur",validator:a}]},i=A({oldPassword:void 0,newPassword:void 0,newConfirmPassword:void 0});function V(t,l,r){const x=/^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-Z\W_]+$)(?![a-z0-9]+$)(?![a-z\W_]+$)(?![0-9\W_]+$)[a-zA-Z0-9\W_]{8,20}$/;/[\u4e00-\u9fa5]/.test(l)?r(new Error("密码不能包含中文，请删除后重试")):g.value.passwordSecurity&&!x.test(l)?r(new Error("必须由大写字母，小写字母，数字，特殊字符中的至少3种组成8~20位的字符串")):r()}function P(t,l,r){l===i.oldPassword?r(new Error("新密码不能和原密码相同！")):r()}function a(t,l,r){l!==i.newPassword?r(new Error("两次输入密码不一致！")):/[\u4e00-\u9fa5]/.test(l)?r(new Error("密码不能包含中文，请删除后重试")):r()}function v(t,l,r){l===""?r(new Error("请输入原密码")):/[\u4e00-\u9fa5]/.test(l)?r(new Error("密码不能包含中文，请删除后重试")):(i.newPassword!==""&&b.value.validateField("newPassword"),r())}const $=s,h=k,f=async()=>{try{const t=await xe();t.success&&(g.value=t.data)}catch{}},_=async()=>{if(b.value)try{if(b.value.validate()){const l={oldPassword:B(i.oldPassword),newPassword:B(i.newPassword),newConfirmPassword:B(i.newConfirmPassword)};Ce(l).then(r=>{r.success&&(h("complete"),h("close"))}).finally(()=>{w.value=!1})}}catch{}},C=()=>{h("close"),b.value.resetFields()},n=()=>{setTimeout(()=>{y.value=!1},0)},d=t=>{g.value.passwordStrength&&(m.value=t.type==="focus")};return re(()=>{$.visible&&f()}),(t,l)=>{const r=c("el-input"),x=c("el-form-item"),z=c("el-popover"),D=c("el-form"),O=c("el-button"),X=c("el-dialog");return S(),M(X,{"model-value":$.visible,width:500,title:"修改密码","close-on-press-escape":!1,"close-on-click-modal":!1,onClose:C},{footer:o(()=>[I("span",Oe,[e(O,{onClick:C},{default:o(()=>[E(" 取消 ")]),_:1}),e(O,{type:"primary",loading:w.value,onClick:_},{default:o(()=>[E(" 保存 ")]),_:1},8,["loading"])])]),default:o(()=>[e(D,{ref_key:"formRef",ref:b,"label-width":"110px",model:i,rules:u,"label-suffix":"："},{default:o(()=>[e(x,{label:"原密码",prop:"oldPassword"},{default:o(()=>[e(r,{modelValue:i.oldPassword,"onUpdate:modelValue":l[0]||(l[0]=L=>i.oldPassword=L),placeholder:"请输入原密码",clearable:"","show-password":"",type:"password",readonly:y.value,onMousedown:n},null,8,["modelValue","readonly"])]),_:1}),e(x,{label:"新密码",prop:"newPassword"},{default:o(()=>[e(z,{placement:"right",width:250,visible:m.value},{reference:o(()=>[e(r,{modelValue:i.newPassword,"onUpdate:modelValue":l[1]||(l[1]=L=>i.newPassword=L),placeholder:"请输入新密码",clearable:"","show-password":"",type:"password",readonly:y.value,onMousedown:n,onFocus:d,onBlur:d},null,8,["modelValue","readonly"])]),default:o(()=>[e(W(we),{password:i.newPassword},null,8,["password"])]),_:1},8,["visible"])]),_:1}),e(x,{label:"确认新密码",prop:"newConfirmPassword"},{default:o(()=>[e(r,{modelValue:i.newConfirmPassword,"onUpdate:modelValue":l[2]||(l[2]=L=>i.newConfirmPassword=L),placeholder:"请输入确认新密码",clearable:"","show-password":"",type:"password",readonly:y.value,onMousedown:n},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}});const Xe=q(Ze,[["__scopeId","data-v-6f4e80cc"]]),He={class:"captcha"},Ke={key:0},Qe={class:"dialog-footer"},Ye=N({__name:"BindEmail",props:{visible:{type:Boolean,default:!1},bindEmailDialogTitle:{}},emits:["close","complete"],setup(s,{emit:k}){const b=G(),y=[{value:"southzn.com",externalLink:"https://exmail.qq.com/login/"},{value:"qq.com",externalLink:"https://mail.qq.com/"},{value:"163.com",externalLink:"https://mail.163.com/"},{value:"126.com",externalLink:"https://mail.126.com/"},{value:"189.cn",externalLink:"https://webmail30.189.cn/"},{value:"sina.com",externalLink:"https://mail.sina.com.cn/"},{value:"hotmail.com",externalLink:"https://login.live.com/"},{value:"gmail.com",externalLink:"https://mail.google.com/"},{value:"sohu.com",externalLink:"https://mail.sohu.com/"},{value:"21cn.com",externalLink:"https://mail.21cn.com/"}],w=s,m=k,g=p(),u=p(!1),i=p(0),V=p(),P=p(!0),a=A({email:void 0,captcha:void 0}),v=(t,l,r)=>{/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(l)?r():r(new Error("请输入正确的邮箱格式"))},$=A({email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{validator:(t,l,r)=>{/\s+/g.test(l)?r(new Error("邮箱不能包含空格，请删除空格后重试")):r()}},{validator:(t,l,r)=>v(t,l,r)}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{validator:(t,l,r)=>{/\s+/g.test(l)?r(new Error("验证码不能包含空格，请删除空格后重试")):r()}}]}),h=()=>{m("close"),g.value&&g.value.resetFields()},f=t=>!t||t.indexOf("@")!==-1?[]:y.map(l=>({value:`${t}@${l.value}`})),_=ie(()=>{const t=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;return!(a.email&&t.test(a.email))}),C=async()=>{if(!a.email){J.warning("请输入邮箱");return}try{(await $e({userId:b.getUserInfo.id,email:B(a.email)})).success&&(V.value&&clearInterval(V.value),u.value=!0,i.value=60,V.value=setInterval(()=>{i.value=i.value-1,i.value===0&&(u.value=!1,clearInterval(V.value))},1e3))}catch{}},n=()=>{setTimeout(()=>{P.value=!1},0)},d=async()=>{if(g.value)try{if(await g.value.validate())try{(await Ve({userId:b.getUserInfo.id,email:B(a.email),captcha:B(a.captcha)})).success&&(h(),m("complete"))}catch{}}catch{}};return(t,l)=>{const r=c("ElAutocomplete"),x=c("el-form-item"),z=c("el-input"),D=c("el-button"),O=c("el-form"),X=c("el-dialog");return S(),M(X,{"model-value":w.visible,width:500,title:t.bindEmailDialogTitle,"close-on-press-escape":!1,"close-on-click-modal":!1,onClose:h},{footer:o(()=>[I("span",Qe,[e(D,{onClick:h},{default:o(()=>[E(" 取消 ")]),_:1}),e(D,{type:"primary",onClick:d},{default:o(()=>[E(" 确定 ")]),_:1})])]),default:o(()=>[e(O,{ref_key:"formRef",ref:g,autocomplete:"off",model:a,rules:$,size:"large","label-width":80,"label-position":"right","label-suffix":"："},{default:o(()=>[e(x,{prop:"email",label:"邮箱"},{default:o(()=>[e(r,{modelValue:a.email,"onUpdate:modelValue":l[0]||(l[0]=L=>a.email=L),style:{width:"100%"},clearable:"","fetch-suggestions":f,placeholder:"请输入邮箱地址",debounce:0,maxlength:"255",readonly:P.value,onMousedown:n},null,8,["modelValue","readonly"])]),_:1}),I("div",He,[e(x,{prop:"captcha",label:"验证码"},{default:o(()=>[e(z,{modelValue:a.captcha,"onUpdate:modelValue":l[1]||(l[1]=L=>a.captcha=L),placeholder:"请输入验证码",clearable:"",readonly:P.value,onMousedown:n},null,8,["modelValue","readonly"])]),_:1}),e(D,{plain:"",disabled:_.value||u.value,onClick:C},{default:o(()=>[I("span",null,j(u.value?"验证码已发送":"发送验证码"),1),u.value?(S(),F("span",Ke," ("+j(i.value)+"s)",1)):U("",!0)]),_:1},8,["disabled"])])]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}});const et=q(Ye,[["__scopeId","data-v-aea6c74d"]]),tt={class:"captcha"},ot={key:0},at={class:"dialog-footer"},lt=N({__name:"BindPhone",props:{visible:{type:Boolean,default:!1},bindPhoneDialogTitle:{}},emits:["close","complete"],setup(s,{emit:k}){const b=G(),y=s,w=k,m=p(),g=p(!1),u=p(0),i=p(),V=p(!0),P=A({phone:void 0,captcha:void 0}),a=(n,d,t)=>{d&&!/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/.test(d)?t(new Error("请输入正确的手机格式")):t()},v=A({phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:(n,d,t)=>{/\s+/g.test(d)?t(new Error("手机号不能包含空格，请删除空格后重试")):t()}},{validator:(n,d,t)=>a(n,d,t)}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{validator:(n,d,t)=>{/\s+/g.test(d)?t(new Error("验证码不能包含空格，请删除空格后重试")):t()}}]}),$=()=>{w("close"),m.value&&m.value.resetFields()},h=ie(()=>{const n=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;return!(P.phone&&n.test(P.phone))}),f=async()=>{if(!P.phone){J.warning("请输入手机号");return}try{(await Se({userId:b.getUserInfo.id,phone:B(P.phone)})).success&&(i.value&&clearInterval(i.value),g.value=!0,u.value=60,i.value=setInterval(()=>{u.value=u.value-1,u.value===0&&(g.value=!1,clearInterval(i.value))},1e3))}catch{}},_=()=>{setTimeout(()=>{V.value=!1},0)},C=async()=>{if(m.value)try{if(await m.value.validate())try{(await ke({userId:b.getUserInfo.id,phone:B(P.phone),captcha:B(P.captcha)})).success&&($(),w("complete"))}catch{}}catch{}};return(n,d)=>{const t=c("el-input"),l=c("el-form-item"),r=c("el-button"),x=c("el-form"),z=c("el-dialog");return S(),M(z,{"model-value":y.visible,width:500,title:n.bindPhoneDialogTitle,"close-on-press-escape":!1,"close-on-click-modal":!1,onClose:$},{footer:o(()=>[I("span",at,[e(r,{onClick:$},{default:o(()=>[E(" 取消 ")]),_:1}),e(r,{type:"primary",onClick:C},{default:o(()=>[E(" 确定 ")]),_:1})])]),default:o(()=>[e(x,{ref_key:"formRef",ref:m,autocomplete:"off",model:P,rules:v,size:"large","label-width":80,"label-position":"right","label-suffix":"："},{default:o(()=>[e(l,{prop:"phone",label:"手机号"},{default:o(()=>[e(t,{modelValue:P.phone,"onUpdate:modelValue":d[0]||(d[0]=D=>P.phone=D),clearable:"",placeholder:"请输入手机号码",maxlength:"255",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),I("div",tt,[e(l,{prop:"captcha",label:"验证码"},{default:o(()=>[e(t,{modelValue:P.captcha,"onUpdate:modelValue":d[1]||(d[1]=D=>P.captcha=D),placeholder:"请输入验证码",clearable:"",readonly:V.value,onMousedown:_},null,8,["modelValue","readonly"])]),_:1}),e(r,{plain:"",disabled:h.value||g.value,onClick:f},{default:o(()=>[I("span",null,j(g.value?"验证码已发送":"发送验证码"),1),g.value?(S(),F("span",ot," ("+j(u.value)+"s)",1)):U("",!0)]),_:1},8,["disabled"])])]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}});const st=q(lt,[["__scopeId","data-v-8c3069a6"]]),ue=s=>(H("data-v-a2ba65b9"),s=s(),K(),s),nt=ue(()=>I("h2",null,"注销账号操作不可逆，请谨慎操作！",-1)),rt=ue(()=>I("h4",null,"请在下方输入框中输入您的密码以确认操作",-1)),it={class:"dialog-footer"},ct=N({__name:"DeleteAccount",props:{visible:{type:Boolean,default:!1}},emits:["close","complete"],setup(s,{emit:k}){const b=G(),y=p(!0),w=p(!0),m=s,g=k,u=p(),i=A({password:void 0}),V=A({password:[{required:!0,message:"请输入密码"},{validator:($,h,f)=>{/\s+/g.test(h)?f(new Error("密码不能包含空格，请删除空格后重试")):f()}}]}),P=()=>{setTimeout(()=>{y.value=!1},0)},a=()=>{g("close"),u.value&&u.value.resetFields()},v=async()=>{if(u.value)try{if(await u.value.validate())try{const h=await ce({userId:b.getUserInfo.id,password:B(i.password)});if(!h.success)return;if(!h.data){J.error("密码错误");return}w.value=!1,Z.confirm(`请再次确认是否要注销账号【${b.getUserInfo.name}】，该操作不可逆，请谨慎操作！`,{confirmButtonText:"确定注销",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger",autofocus:!1}).then(async()=>{try{(await Be({userId:b.getUserInfo.id,password:B(i.password)})).success&&(a(),g("complete"))}catch{}}).catch(f=>{console.error(f),w.value=!0})}catch{}}catch{}};return($,h)=>{const f=c("el-input"),_=c("el-form-item"),C=c("el-form"),n=c("el-button"),d=c("el-dialog");return se((S(),F("div",null,[e(d,{"model-value":m.visible,width:500,title:"注销账号",class:"dialog",onClose:a},{footer:o(()=>[I("span",it,[e(n,{onClick:a},{default:o(()=>[E(" 取消 ")]),_:1}),e(n,{type:"danger",onClick:v},{default:o(()=>[E(" 注销账号 ")]),_:1})])]),default:o(()=>[nt,rt,e(C,{ref_key:"formRef",ref:u,autocomplete:"off",model:i,rules:V,size:"large","label-width":0,"label-position":"right"},{default:o(()=>[e(_,{prop:"password"},{default:o(()=>[e(f,{modelValue:i.password,"onUpdate:modelValue":h[0]||(h[0]=t=>i.password=t),placeholder:"请输入密码","show-password":"",clearable:"",readonly:y.value,onMousedown:P},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value"])],512)),[[ne,w.value]])}}});const dt=q(ct,[["__scopeId","data-v-a2ba65b9"]]),ut={class:"security"},pt={style:{display:"flex","align-items":"center"}},mt={style:{"margin-left":"8px"}},ft={key:0},_t={key:1},vt={key:2},ht={key:3},gt=N({__name:"index",setup(s){const k=G(),b=p([]),y=p(!1),w=p(!1),m=p("绑定邮箱"),g=p(!1),u=p(!1),i=p("绑定手机号"),V={email:{label:"绑定邮箱",opTrueLabel:"更换邮箱",opFalseLabel:"绑定邮箱"},phone:{label:"绑定手机号",opTrueLabel:"更换手机号",opFalseLabel:"绑定手机号"}},P=[{label:"设置密码",status:"已设置",isSet:!0,op:"修改密码",type:"changePwd"}],a=[{label:"注销账号",status:"",isSet:!0,op:"注销",type:"deleteAccount"}],v=async()=>{try{const _=await Ie(),C=[];if(_.success){for(const[n,d]of Object.entries(_.data))if(n in V){const t=d?V[n].opTrueLabel:V[n].opFalseLabel;n==="email"&&(m.value=t),C.push({label:V[n].label,status:d||"未设置",isSet:!!d,op:t,type:n})}}b.value=[...P,...a]}catch(_){console.error(_)}},$=()=>{Z.confirm("修改密码成功，请重新登录！",{confirmButtonText:"确定",type:"warning",closeOnClickModal:!1,closeOnPressEscape:!1,showCancelButton:!1,showClose:!1}).then(()=>{le().then(()=>{k.appLogout()})}).catch(()=>{})},h=async()=>{_e.service({lock:!0,text:"注销成功，即将跳转至登录页面..."});try{await le()}catch{}setTimeout(()=>{k.appLogout()},1e3)},f=_=>{switch(_){case"email":w.value=!0;break;case"changePwd":y.value=!0;break;case"deleteAccount":g.value=!0;break;case"phone":u.value=!0;break}};return re(()=>{v()}),(_,C)=>{const n=c("el-icon"),d=c("WarningFilled"),t=c("el-table-column"),l=c("el-button"),r=c("el-table");return S(),F("div",ut,[e(r,{data:b.value,style:{borderTop:"var(--el-table-border)"},"header-row-style":{display:"none"},"row-style":{height:"70px"}},{default:o(()=>[e(t,{prop:"label",label:"配置项",width:"120",align:"center"},{default:o(x=>[I("div",pt,[x.row.type!=="deleteAccount"?(S(),M(n,{key:0,color:x.row.isSet?"var(--el-color-success)":"var(--el-color-error)",size:16},{default:o(()=>[(S(),M(fe(x.row.isSet?"CircleCheckFilled":"CircleCloseFilled")))]),_:2},1032,["color"])):(S(),M(n,{key:1,size:16,color:"var(--el-color-warning)"},{default:o(()=>[e(d)]),_:1})),I("span",mt,j(x.row.label),1)])]),_:1}),e(t,{prop:"status",label:"状态",align:"center"}),e(t,{prop:"op",label:"操作",width:"120",align:"center"},{default:o(x=>[e(l,{link:"",type:x.row.type!=="deleteAccount"?"primary":"danger",onClick:z=>f(x.row.type)},{default:o(()=>[E(j(x.row.op),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"]),y.value?(S(),F("div",ft,[e(Xe,{visible:y.value,onComplete:$,onClose:C[0]||(C[0]=x=>y.value=!1)},null,8,["visible"])])):U("",!0),w.value?(S(),F("div",_t,[e(et,{visible:w.value,title:m.value,onClose:C[1]||(C[1]=x=>w.value=!1),onComplete:v},null,8,["visible","title"])])):U("",!0),g.value?(S(),F("div",vt,[e(dt,{visible:g.value,onComplete:h,onClose:C[2]||(C[2]=x=>g.value=!1)},null,8,["visible"])])):U("",!0),u.value?(S(),F("div",ht,[e(st,{visible:u.value,title:i.value,onComplete:v,onClose:C[3]||(C[3]=x=>u.value=!1)},null,8,["visible","title"])])):U("",!0)])}}});const yt=q(gt,[["__scopeId","data-v-24a841ed"]]),wt={class:"person-info"},bt=N({__name:"index",setup(s){return(k,b)=>{const y=c("el-tab-pane"),w=c("el-tabs");return S(),M(W(ge),null,{default:o(()=>[I("div",wt,[e(w,{"tab-position":"left"},{default:o(()=>[e(y,{label:"个人信息"},{default:o(()=>[e(Ge)]),_:1}),e(y,{label:"账号安全"},{default:o(()=>[e(yt)]),_:1})]),_:1})])]),_:1})}}});const St=q(bt,[["__scopeId","data-v-ba475b03"]]);export{St as default};
