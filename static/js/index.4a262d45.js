import{d as X,b as A,r as G,w as Z,e as k,t as q,o as r,x as w,k as i,g as b,j as n,l as _,u as a,v as M,f as h,B as C,F as Y,bm as ee,z as U,U as W,n as te,aj as J,ak as z,ai as I,S as ae,N as ie,bo as le}from"./element-plus.59ccb443.js";import{v as O}from"./lodash.22f463b4.js";import{D as d,d as Q,A as S}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{t as ne,x as oe,y as se,z as re,A as de,v as ce}from"./login.a4e9287e.js";import"./index-a95bb620.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"../../app-config.js";import"./error.229cea25.js";import"./smart-ui.e8e0134c.js";const ue={class:"executor-content","element-loading-text":"信息加载中..."},pe={class:"item-wrap"},me={key:1},ge={class:"item-wrap"},fe={key:1},ye=["accept"],he={key:0,class:"item-wrap tips"},_e={class:"item-wrap"},be={class:"item-wrap"},Ce={key:1,class:"item-wrap"},ve={key:2,class:"item-wrap"},Ee={class:"dialog-footer"},De=X({__name:"ExecutorInfoDialog",props:{visible:{type:Boolean,default:!1},dialogType:{default:d.REGISTER},editId:{default:""}},emits:["update:visible","changeEdit","save"],setup(V,{emit:B}){const v=V,T=B,o=A(),H=A(),e=G({dialogVisible:!1,isLoading:!1,submiting:!1,defaultEditData:{name:"",description:"",fileName:"",entryParam:""},editData:{},rules:{fileName:[{required:!0,message:"请上传执行器文件",trigger:["change"]}],name:[{required:!0,message:"执行器名称不能为空",trigger:["blur","change"]},{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]}],entryParam:[{message:"不允许输入中文",trigger:["blur","change"],validator:N}]},file:null,fileMaxSize:1,isHandling:!1,acceptList:".zip"});Z(()=>v.visible,t=>{e.dialogVisible=t});function N(t,l,s){/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/g.test(l)?s(new Error("不允许输入中文")):s()}function F(){e.isHandling=!1,e.file=null,v.dialogType===d.REGISTER?e.editData=O(e.defaultEditData):(e.isLoading=!0,R(v.editId)),te(()=>{var t;(t=o.value)==null||t.clearValidate()})}function g(){T("update:visible",!1),e.editData={}}function P(){T("changeEdit")}function R(t){S.getExecutorById(t).then(l=>{l.code==="0000"?(e.editData={fileName:"",...O(l.data)},e.isLoading=!1):(J({type:"error",message:"获取信息失败"}),e.isLoading=!1)}).catch(()=>{J({type:"error",message:"获取信息错误"}),e.isLoading=!1})}function K(){H.value.click()}function L(t){const{files:l}=t.target;if(l.length===0)return;const s=l[0];if(e.isHandling=!0,s.size&&s.size/1024/1024/1024>e.fileMaxSize){z.alert(`文件超过${e.fileMaxSize}G! 无法上传`,"提示",{confirmButtonText:"确定",type:"error"}),t.target.value="",e.isHandling=!1;return}if(x(s.name).toLowerCase()!=="zip"){z.alert("上传失败，请选择zip格式的文件上传","提示",{confirmButtonText:"确定",type:"error"}),t.target.value="",e.isHandling=!1;return}else e.file=new File([s],s.name),e.editData.fileName=s.name,e.isHandling=!1;t.target.value=""}function x(t){return t.replace(/.+\./,"")}function $(){o.value.validate(t=>{if(t){const{name:l,description:s,entryParam:p}=e.editData,f={name:l,entryParam:p,description:s,file:e.file},E=Q.get(v.dialogType);v.dialogType===d.EDIT&&(f.id=e.editData.id),e.file===null&&delete f.file,e.submiting=!0,S.registerOrUpdateExecutor(f).then(c=>{e.submiting=!1,c.code==="0000"?(I({type:"success",title:`${E}执行器成功`}),g(),T("save")):I({type:"error",title:`${E}执行器失败`,message:c.data})}).catch(c=>{e.submiting=!1,I({type:"error",title:`${E}执行器失败`,message:c.message})})}})}return(t,l)=>{const s=k("el-input"),p=k("el-form-item"),f=k("el-button"),E=k("el-form"),c=k("el-dialog"),y=q("loading"),u=q("action");return r(),w(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":l[5]||(l[5]=m=>e.dialogVisible=m),class:"center-dialog",title:(a(Q).get(t.dialogType)||"查看")+"执行器","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"500px",onOpen:F,onClosed:g},{footer:i(()=>[b("span",Ee,[n(f,{onClick:l[4]||(l[4]=m=>e.dialogVisible=!1)},{default:i(()=>[_("取 消")]),_:1}),t.dialogType!==a(d).CHECK?M((r(),w(f,{key:0,type:"primary",disabled:e.isHandling,loading:e.submiting,onClick:$},{default:i(()=>[_("确 定")]),_:1},8,["disabled","loading"])),[[u,"algorithm_executor_register"]]):M((r(),w(f,{key:1,type:"primary",onClick:P},{default:i(()=>[_(" 编辑 ")]),_:1})),[[u,"algorithm_executor_register"]])])]),default:i(()=>[M((r(),h("div",ue,[n(E,{ref_key:"editForm",ref:o,class:"edit-form",inline:"",model:e.editData,rules:e.rules,"label-width":"120px","label-position":"right"},{default:i(()=>[b("div",pe,[n(p,{label:"执行器名称：",prop:"name"},{default:i(()=>[t.dialogType!==a(d).CHECK?(r(),w(s,{key:0,modelValue:e.editData.name,"onUpdate:modelValue":l[0]||(l[0]=m=>e.editData.name=m),type:"text",placeholder:"请输入执行器名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])):(r(),h("span",me,C(e.editData.name),1))]),_:1})]),b("div",ge,[n(p,{label:"执行器文件：",prop:"fileName"},{default:i(()=>[t.dialogType!==a(d).CHECK?(r(),h(Y,{key:0},[n(s,{modelValue:e.editData.fileName,"onUpdate:modelValue":l[1]||(l[1]=m=>e.editData.fileName=m),class:"mr",type:"text",readonly:"",placeholder:"请点击右侧按钮上传文件"},null,8,["modelValue"]),n(f,{type:"primary",icon:a(ee),disabled:e.isHandling,onClick:K},{default:i(()=>[_(C(e.isHandling?"处理中":"上  传"),1)]),_:1},8,["icon","disabled"])],64)):(r(),h("span",fe,C(e.editData.fileName),1))]),_:1}),b("input",{ref_key:"uploadFile",ref:H,style:{display:"none"},type:"file",class:"uploadFile",directory:"",nwdirectory:"",accept:e.acceptList,onChange:L},null,40,ye)]),t.dialogType!==a(d).CHECK?(r(),h("div",he,"文件不超过1G")):U("",!0),b("div",_e,[n(p,{label:"入口参数：",prop:"entryParam"},{default:i(()=>[t.dialogType!==a(d).CHECK?(r(),w(s,{key:0,modelValue:e.editData.entryParam,"onUpdate:modelValue":l[2]||(l[2]=m=>e.editData.entryParam=m),type:"textarea",placeholder:"请输入入口参数",clearable:"",rows:3,maxlength:"100","show-word-limit":""},null,8,["modelValue"])):(r(),h("span",{key:1,class:W(["entryParam",e.editData.entryParam?"":"empty"])},C(e.editData.entryParam||"未填写"),3))]),_:1})]),b("div",be,[n(p,{label:"说明：",prop:"description"},{default:i(()=>[t.dialogType!==a(d).CHECK?(r(),w(s,{key:0,modelValue:e.editData.description,"onUpdate:modelValue":l[3]||(l[3]=m=>e.editData.description=m),type:"textarea",placeholder:"请输入说明",clearable:"",rows:3,maxlength:"100","show-word-limit":""},null,8,["modelValue"])):(r(),h("span",{key:1,class:W(["description",e.editData.description?"":"empty"])},C(e.editData.description||"未说明"),3))]),_:1})]),t.dialogType===a(d).CHECK?(r(),h("div",Ce,[n(p,{label:"创建人：",prop:"creator"},{default:i(()=>[b("span",null,C(e.editData.creator),1)]),_:1})])):U("",!0),t.dialogType===a(d).CHECK?(r(),h("div",ve,[n(p,{label:"创建时间：",prop:"createTime"},{default:i(()=>[b("span",null,C(e.editData.createTime),1)]),_:1})])):U("",!0)]),_:1},8,["model","rules"])])),[[y,e.isLoading]])]),_:1},8,["modelValue","title"])}}});function ke(){const V=G({classifyTreeData:[],searchOptions:[{label:"关键字",key:"keyword",type:"text",placeholder:"执行器名称",span:4}],columns:[{prop:"name",label:"执行器名称",minWidth:120,slot:"name",sortable:!0},{prop:"entryParam",label:"入口参数",minWidth:200,sortable:!0},{prop:"description",label:"说明",minWidth:120,sortable:!0},{prop:"creator",label:"创建人",width:150,sortable:!0},{prop:"createTime",label:"创建时间",width:180,sortable:!0}]});return{...ae(V)}}const Pe=X({__name:"index",setup(V){const{searchOptions:B,columns:v}=ke(),T=A(),o=G({domId:"section-container-wrap",dialogVisible:!1,dialogType:d.CHECK,curEditId:""}),{data:H,total:e,pageNo:N,pageSize:F,loading:g,handleSizeChange:P,handleCurrentChange:R,handleSelectionChange:K,handleSearch:L,initData:x,multipleSelection:$}=ne(S.getExecutorPageList);ie(()=>{x()});function t(){o.curEditId="",o.dialogType=d.REGISTER,o.dialogVisible=!0}function l(c,y=!1){y||(o.curEditId=c.id,o.dialogType=d.EDIT,o.dialogVisible=!0)}function s(c){o.curEditId=c.id,o.dialogType=d.CHECK,o.dialogVisible=!0}function p(){o.dialogType=d.EDIT}function f(c,y=!1){y||z.confirm(`删除【${c.name}】执行器, 是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{g.value=!0,S.deleteExecutorByIds(c.id).then(u=>{g.value=!1,u.code==="0000"&&x()}).catch(()=>{g.value=!1})}).catch(()=>{})}function E(){z.confirm("是否批量删除选中网格集?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.value=!0;const y=O($.value).map(u=>u.id).join(",");S.deleteExecutorByIds(y).then(u=>{g.value=!1,u.code==="0000"&&(I({type:"success",title:"批量删除网格集成功"}),x())}).catch(()=>{g.value=!1})}).catch(()=>{})}return(c,y)=>{const u=k("el-button"),m=k("el-link");return r(),h(Y,null,[n(a(ce),{id:"executor-manage",background:""},{default:i(()=>[n(a(oe),{padding:"1 1 0",border:""},{default:i(()=>[n(a(se),{ref_key:"SmartSearchRef",ref:T,options:a(B),"query-permission":"sys_message_getAnnouncementPage",onHandleSearch:a(L)},null,8,["options","onHandleSearch"])]),_:1}),n(a(re),null,{default:i(()=>[n(a(de),{ref:"baseTable","operation-width":"220",columns:a(v),"table-data":a(H),"current-page":a(N),"page-size":a(F),total:a(e),"pagination-is-need":!0,"operation-is-need":!0,loading:a(g),"search-form-ref":T.value,"selection-is-need":!0,"index-is-need":!1,onSizeChange:a(P),onCurrentChange:a(R),onSelectionChange:a(K)},{"smart-table_operation":i(()=>[n(u,{type:"primary",onClick:t},{default:i(()=>[_(" 注册执行器 ")]),_:1})]),"smart-table_batch-operation":i(()=>[n(u,{link:"",type:"danger",icon:a(le),onClick:E},{default:i(()=>[_(" 批量删除 ")]),_:1},8,["icon"])]),name:i(({scope:D})=>[n(m,{type:"primary",onClick:j=>s(D.row)},{default:i(()=>[_(C(D.row.name),1)]),_:2},1032,["onClick"])]),operation:i(({scope:D})=>[n(u,{link:"",type:"primary",onClick:j=>l(D.row)},{default:i(()=>[_(" 编辑 ")]),_:2},1032,["onClick"]),n(u,{link:"",type:"danger",onClick:j=>f(D.row)},{default:i(()=>[_(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1})]),_:1}),n(De,{visible:o.dialogVisible,"onUpdate:visible":y[0]||(y[0]=D=>o.dialogVisible=D),"dialog-type":o.dialogType,"edit-id":o.curEditId,onSave:a(x),onChangeEdit:p},null,8,["visible","dialog-type","edit-id","onSave"])],64)}}});export{Pe as default};
