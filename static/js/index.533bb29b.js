import{d as O,aD as ie,c as h,o as E,f as b,g as f,b as R,w as M,N as j,C as ue,x as k,z as w,e as T,j as I,k as C,U as K,B as y,u as V,l as de,F as U,y as $,r as _e,S as fe,v as Z,ae as pe,h as A,bN as Ee,bO as ve,n as q,t as Se,X as be,Q as W,aj as ye}from"./element-plus.59ccb443.js";import{a1 as m,a2 as he,a3 as Re,m as X}from"./index-a95bb620.js";import{u as ge,_ as J}from"./error.229cea25.js";import{e as Q,f as me}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{q as Ce}from"./lodash.22f463b4.js";const ke={class:"rect"},Te=f("div",{class:"arrow"},null,-1),Ie=[Te],ee=O({__name:"Arrow",props:{width:{},height:{},arrowSize:{default:12},arrowColor:{default:"#ccc"},lineWidth:{default:2},targetY:{}},setup(a){ie(d=>({"0fa90f0b":`${d.targetY}px`,c04acce8:`${-p.value}px`,"032129c7":`${p.value-1}px`,"0ad981fa":`${i.value}px`,"0d14e2de":`${_.value}px solid ${t.value}`,"1b4c1020":`${-n.value}px`,"60853e78":`${-_.value}px`,b6370c20:`${n.value}px solid transparent`,"2afb3a75":`${t.value}`}));const c=a,p=h(()=>c.width),i=h(()=>c.height),n=h(()=>c.arrowSize),t=h(()=>c.arrowColor),_=h(()=>c.lineWidth);return(d,s)=>(E(),b("div",ke,Ie))}}),Ue=O({__name:"Node",props:{arrowFrom:{},arrowColor:{}},setup(a,{expose:c}){const p=a,i=R(),n=R(0),t=R(0),_=R(0),d=()=>{if(!p.arrowFrom)return;const o=document.querySelector("#data-blood").querySelector(`[data-node-id=${p.arrowFrom}]`);if(!o)return;const{offsetLeft:r,offsetTop:e}=i.value,u=e-o.offsetTop,l=r-o.offsetLeft;u===0?(n.value=l-o.offsetWidth,t.value=0):(n.value=l-o.offsetWidth/2,t.value=u-o.offsetHeight/2)};return M([n,t],d),j(()=>{_.value=i.value.offsetHeight/2}),c({setArrow:d}),(s,o)=>(E(),b("div",{ref_key:"node",ref:i,class:"data-blood__node"},[ue(s.$slots,"default"),s.arrowFrom?(E(),k(ee,{key:0,width:n.value,height:t.value,"arrow-color":s.arrowColor,targetY:_.value},null,8,["width","height","arrow-color","targetY"])):w("",!0)],512))}});var S=(a=>(a.RESOURCE_DATA="RESOURCE_DATA",a.BUSINESS_RESOURCE_DATA="BUSINESS_RESOURCE_DATA",a.RESOURCE_TILES="RESOURCE_TILES",a.RESULT_DATA="RESULT_DATA",a.RESOURCE_PUBLISH="RESOURCE_PUBLISH",a.SERVICE_INFO="SERVICE_INFO",a.SERVICE_VERSION="SERVICE_VERSION",a.SERVICE_UPDATE="SERVICE_UPDATE",a.RESOURCE_SET="RESOURCE_SET",a.RESOURCE_TILES_PUBLISH="RESOURCE_TILES_PUBLISH",a.RESOURCE_COPY="RESOURCE_COPY",a.SERVICE_UPDATE_PUBLISH="SERVICE_UPDATE_PUBLISH",a))(S||{});const te=new Map([["RESOURCE_DATA","数据资源池"],["BUSINESS_RESOURCE_DATA","业务数据"],["RESOURCE_TILES","数据切片"],["RESULT_DATA","成果数据"],["RESOURCE_PUBLISH","数据发布"],["SERVICE_INFO","服务信息"],["SERVICE_VERSION","服务版本"],["SERVICE_UPDATE","服务更新"],["RESOURCE_SET","数据集"],["RESOURCE_TILES_PUBLISH","切片并发布"],["RESOURCE_COPY","发布预处理"],["SERVICE_UPDATE_PUBLISH","数据发布"]]),Oe={FILE:"本地上传",DB:"数据库上传"};function De(){const a=[{label:"操作人",key:"creator"}],c=[...a,{label:"切片开始时间",key:"beginTime",func:m},{label:"切片结束时间",key:"endTime",func:m},{label:"切片时长",key:"duration"}],p=[...a,{label:"操作时间",key:"publishTime",func:m},{label:"服务类型",key:"categoryAliasName"},{label:"发布版本",key:"version"}],i=[{label:"操作人",key:"operator"},{label:"操作时间",key:"operateTime",func:m},{label:"服务更新方式",key:"initVersion",func:d=>d?"选择数据更新":"切换版本更新"},{label:"版本号",key:"version"}],n=[...c,{label:"操作时间",key:"publishTime",func:m},{label:"版本号",key:"version"}],t=[...a,{label:"开始时间",key:"beginTime",func:m},{label:"结束时间",key:"endTime",func:m},{label:"处理时长",key:"duration"}];return{[S.RESOURCE_TILES]:c,[S.RESOURCE_PUBLISH]:p,[S.SERVICE_UPDATE]:i,[S.RESOURCE_TILES_PUBLISH]:n,[S.RESOURCE_COPY]:t,[S.SERVICE_UPDATE_PUBLISH]:p}}function Le(){const a=[{label:"数据名称",key:"name"},{label:"数据类型",key:"dataTypeAliasName"},{label:"数据大小",key:"dataSize"}],c=[{label:"创建者",key:"creator"},{label:"创建时间",key:"createTime",func:m}],i=[...[...a,{label:"数据状态",key:"status",func:e=>Q.get(e)},{label:"数据来源",key:"resourceType",func:e=>Oe[e]}],{label:"上传时间",key:"uploadTime"},...c,{label:"描述",key:"description"}],t=[...[...a,{label:"数据状态",key:"status",func:e=>Q.get(e)},{label:"数据来源",key:"name"}],...c],d=[...[{label:"服务标识",key:"name"},{label:"服务名称",key:"aliasName"},{label:"服务类型",key:"categoryAliasName"},{label:"服务状态",key:"status",func:e=>e?"已停止":"已启动"}],...c,{label:"服务地址",key:"url"},{label:"服务说明",key:"description"},{label:"当前版本",key:"versionName"},{label:"初始版本",key:"initVersionName"}],s=[{label:"操作人",key:"operator"},{label:"操作时间",key:"createTime",func:m},{label:"版本号",key:"version"},{label:"是否为服务当前使用版本",key:"useVersion",func:e=>e==="0"?"是":"否"}],o=[{label:"数据集名称",key:"name"},{label:"数据类型",key:"dataTypeAliasName"},{label:"数据格式",key:"dataFormat",func:e=>e.toLowerCase()},...c,{label:"描述",key:"description"}];return{[S.RESOURCE_DATA]:i,[S.BUSINESS_RESOURCE_DATA]:i,[S.RESULT_DATA]:t,[S.SERVICE_INFO]:d,[S.SERVICE_VERSION]:s,[S.RESOURCE_SET]:o}}const Ae=a=>a===S.RESOURCE_TILES||a===S.RESOURCE_TILES_PUBLISH||a===S.RESOURCE_COPY,we={class:"data-blood-node data-blood-node__data"},$e={class:"content"},xe=["title"],Ne={class:"content-type"},Ve={class:"tooltip node"},Pe={class:"label"},Be={class:"value"},He=O({__name:"Data",props:{data:{},currJobId:{}},setup(a){const c=ge(),p=a,i=Le(),n=h(()=>p.data),t=h(()=>{const{jobType:s}=n.value;return s===S.RESOURCE_SET?"数据集信息":"数据信息"}),_=h(()=>{try{const s={},{log:o,jobType:r}=n.value;if(!o)return{};const e=JSON.parse(o);return i[r].forEach(u=>{s[u.key]=(u.func?u.func(e[u.key]):e[u.key])||"--"}),s}catch{return{}}}),d=s=>{const{jobType:o}=s,{name:r}=_.value;let e="";o===S.RESOURCE_DATA?e="/dataCenter/DataManage":o===S.BUSINESS_RESOURCE_DATA?e="/dataCenter/businessDataManagement":o===S.RESULT_DATA?e="/dataCenter/ResultData":o===S.RESOURCE_SET?e="/dataCenter/LayerGroupManage":e="/dataCenter/ServiceManage";const u=c.resolve({path:e,query:{keyword:r}});window.open(u.href,"_blank")};return(s,o)=>{const r=T("Document"),e=T("el-icon"),u=T("el-button"),l=T("el-popover");return E(),b("div",we,[I(l,{placement:"bottom",title:t.value,width:300,trigger:"hover"},{reference:C(()=>[f("div",{class:K(["container",n.value.deprecated?"deprecated":"",n.value.jobId===s.currJobId&&s.currJobId?"border":n.value.jobId])},[f("div",null,[I(e,{size:32,color:"rgba(0, 0, 0, 0.3)"},{default:C(()=>[I(r)]),_:1})]),f("div",$e,[f("div",{class:"content-title",title:n.value.name},y(n.value.name),9,xe),f("div",Ne,y(V(te).get(n.value.jobType)),1)]),f("div",null,[I(u,{text:"",type:"primary",class:"deprecated",disabled:n.value.delFlag,title:n.value.delFlag?"数据已被删除":"定位到该数据",onClick:o[0]||(o[0]=v=>d(n.value))},{default:C(()=>[de("定位")]),_:1},8,["disabled","title"])])],2)]),default:C(()=>[f("div",Ve,[(E(!0),b(U,null,$(V(i)[n.value.jobType],v=>(E(),b("div",{key:v.key},[f("div",Pe,y(v.label),1),f("div",Be,y(_.value[v.key]),1)]))),128))])]),_:1},8,["title"])])}}}),ze=J(He,[["__scopeId","data-v-d78e0601"]]);function Me(a,c){M(()=>a,()=>{i()});const p=_e({gridSetsList:[]});j(()=>{i()});function i(){n()}function n(){me.getGridSetsList().then(s=>{s.code==="0000"&&(p.gridSetsList=s.data||[])}).catch(()=>{})}function t(s,o){return Ce.get(a,s,o)}function _(){const s=t("dataInfo.styleId");let o="";const r=(e,u)=>{for(let l=0,v=e.length;l<v;l++)if(e[l].id===u){o=e[l].name;break}else e[l].children&&e[l].children.length>0&&r(e[l].children,u)};return s?(r(c.value,s),o):""}function d(s){const o=p.gridSetsList.find(r=>r.value===s);return o?o.label:""}return{...fe(p),getValue:t,getStyleValue:_,getgridSets:d}}const Fe={class:"label"},je={class:"value"},Ye=O({__name:"OperateTileConfig",props:{tileConfig:{}},setup(a){const c=a,{getgridSets:p}=Me(c.tileConfig,R([])),i=[{label:"输出坐标",key:"srs",func:t=>`EGSP:${t}`},{label:"旋转角度",key:"rotate"},{label:"偏移量",key:"srsOrigin",func:t=>{if(t){const[_,d,s]=t.split(",");return`x: ${_} y: ${d} z: ${s}`}else return""}},{label:"输出格式",key:"format"},{label:"网格集",key:"gridSets",func:p},{label:"切片级别",key:"zoom",params:["zoomStart","zoomStop"],func:t=>{if(!t)return;const[_,d]=t;if(_&&d)return`${_} ———— ${d}`}}],n=h(()=>{const t=c.tileConfig,_={};return i.forEach(d=>{const{params:s,key:o,func:r}=d;s?_[o]=r(s.map(e=>t[e]))??"":_[o]=(r?r(t[o]):t[o])??""}),_});return(t,_)=>(E(),b(U,null,$(i,d=>f("div",{key:d.label},[n.value[d.key]?(E(),b(U,{key:0},[f("div",Fe,y(d.label),1),f("div",je,y(n.value[d.key]),1)],64)):w("",!0)])),64))}}),Ge={class:"label"},qe={class:"value"},We=O({__name:"OperateTilesLog",props:{tilesLogs:{}},setup(a){return(c,p)=>(E(!0),b(U,null,$(c.tilesLogs,i=>(E(),b("div",{key:i.label},[f("div",Ge,y(i.label),1),f("div",qe,y(i.value),1)]))),128))}}),Xe={class:"data-blood-node data-blood-node__operate"},Qe={class:"content"},Ke={class:"content-title"},Ze={ref:"tooltip",class:"tooltip node"},Je={class:"label"},et={class:"value"},tt=O({__name:"Operate",props:{data:{}},setup(a){const c=a,p=De(),i=h(()=>c.data),n=h(()=>i.value.deprecated?"rgba(0, 0, 0, 0.3)":"white"),t=R({}),_=R(null),d=R(null);M(i,r=>{try{const e={},{log:u,jobType:l}=r;if(!u)return{};const v=JSON.parse(u);p[l].forEach(D=>{e[D.key]=(D.func?D.func(v[D.key]):v[D.key])??"--"}),Ae(l)&&v.endTime&&v.beginTime&&(e.duration=he(v.endTime,v.beginTime)),t.value=e;const{tileLogs:g}=v;g&&(_.value=s(g.tileConfig),d.value=o(g.tilesLog))}catch(e){console.error(e)}},{immediate:!0});function s(r){try{return JSON.parse(r)}catch{}}function o(r){try{return JSON.parse(r)}catch{}}return(r,e)=>{const u=T("Setting"),l=T("el-icon"),v=T("el-popover");return E(),b("div",Xe,[I(v,{placement:"bottom",title:"数据信息",width:300,trigger:"hover"},{reference:C(()=>[f("div",{class:K(["container",i.value.deprecated?"deprecated":""])},[f("div",null,[I(l,{size:24,color:n.value},{default:C(()=>[I(u)]),_:1},8,["color"])]),f("div",Qe,[f("div",Ke,y(V(te).get(i.value.jobType)),1),Z(f("div",{class:"content-description"},y(V(Re)(t.value.beginTime||t.value.publishTime)),513),[[pe,t.value.beginTime||t.value.publishTime]])])],2)]),default:C(()=>[f("div",Ze,[(E(!0),b(U,null,$(V(p)[i.value.jobType],g=>(E(),b("div",{key:g.key},[f("div",Je,y(g.label),1),f("div",et,y(t.value[g.key]),1)]))),128)),_.value?(E(),k(Ye,{key:0,"tile-config":_.value},null,8,["tile-config"])):w("",!0),d.value?(E(),k(We,{key:1,"tiles-logs":d.value},null,8,["tiles-logs"])):w("",!0)],512)]),_:1})])}}}),at=J(tt,[["__scopeId","data-v-ec1bb43a"]]),ot={id:"data-blood"},st={class:"data-blood-header"},lt=O({__name:"DataBlood",props:{id:{},type:{},isResourceSet:{type:Boolean},bloodJobType:{}},setup(a){const c=a,p={x:50,y:50},i=R(!0),n=R([]),t=R([]),_=h(()=>{if(t.value.length>0){const r=Math.max(...t.value.map(u=>u.x)),e=Math.max(...t.value.map(u=>u.y));if(e||e)return{width:`${r+100+200}px`,height:`${e+100+100}px`}}return{}}),d=[{icon:A(Ee,{style:"width: 18px; height: 18px;"}),label:"流入流出数据"},{icon:A(ve,{style:"width: 18px; height: 18px;"}),label:"操作节点"},{icon:A("div",{class:"border square"}),label:"当前数据"},{icon:A("div",{class:"blood",style:"position: relative;"},[A(ee,{width:35,height:0,targetY:8,arrowColor:"rgb(128, 128, 255)",style:""})]),label:"血缘关系"},{icon:A("div",{class:"bgGrey square"}),label:"历史血缘"}];function s(r,e={x:0,y:0}){const u=[];function Y(P,F="",B={x:0,y:0}){Array.isArray(P)||(P=[P]),P.forEach((x,ae)=>{const{id:oe}=x,H={x:F?B.x+300:B.x,y:F?B.y+ae*200:B.y},se=(ne,re)=>{const L=u.filter(N=>N.y===re);if(L.length>0){let{pid:N}=ne;for(;N&&L.length>0;){const z=L.find(ce=>ce.id===N),G=L.indexOf(z);G>-1&&L.splice(G,1),N=z==null?void 0:z.pid}}return L};for(;se(x,H.y).length>0;)H.y+=200;const le={parentId:F,...H,...x};u.push(le),x.children&&Y(x.children,oe,H)})}return Y(r,"",e),u}function o(r){const e=c.type==="RESULT_DATA"?X.getResourceBloods:X.getServicesBloods,u=c.isResourceSet??!1,l=c.bloodJobType??"";e(r,u,l).then(v=>{v.code==="0000"&&v.data?(t.value=s(v.data,p),q(()=>{n.value.forEach(g=>g.setArrow()),i.value=!1})):ye({type:"error",message:"获取数据信息失败"})})}return M(()=>c.id,o),j(()=>{q(()=>{o(c.id)})}),(r,e)=>{const u=Se("loading");return E(),b("div",ot,[f("div",st,[(E(),b(U,null,$(d,l=>f("div",{key:l.label},[(E(),k(be(l.icon))),f("div",null,y(l.label),1)])),64))]),Z((E(),b("div",{class:"data-blood-graph",style:W(_.value)},[(E(!0),b(U,null,$(t.value,l=>(E(),k(Ue,{key:l.id,ref_for:!0,ref_key:"dataRefs",ref:n,"data-node-id":`n_${l.id}`,"arrow-from":l.parentId?`n_${l.parentId}`:"",style:W({left:l.x+"px",top:l.y+"px"}),"arrow-color":l.deprecated?"rgb(170, 170, 170)":"rgb(128, 128, 255)"},{default:C(()=>[l.type==="DATA"?(E(),k(ze,{key:0,data:l,"curr-job-id":r.id},null,8,["data","curr-job-id"])):w("",!0),l.type==="OPERATE"?(E(),k(at,{key:1,data:l},null,8,["data"])):w("",!0)]),_:2},1032,["data-node-id","arrow-from","style","arrow-color"]))),128))],4)),[[u,i.value]])])}}}),dt=lt;export{dt as D};
