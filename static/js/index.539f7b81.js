import{r as ee,S as $e,d as X,b as K,c as W,e as S,o as d,x as M,k as n,f as C,F as ae,y as be,g as t,Q as ye,B as P,j as a,ad as A,l as $,z as D,C as Ie,Z as fe,_ as _e,aj as k,ak as G,N as Se,w as ve,t as me,u as m,v as ge,b_ as Ae,$ as Me,U as le,a0 as Ve,bm as Re,bL as He}from"./element-plus.59ccb443.js";import{F as De,S as j,c as Je,x as pe,r as Ze,$ as qe,y as We,z as Te,v as Ge}from"./login.a4e9287e.js";import{e as Qe}from"../../app-config.js";import{D as Ke,s as Xe,a as Ye,c as he,b as et,e as tt,d as ot,p as nt,i as lt,f as at,g as st,h as it,u as rt,j as ct,k as dt,l as pt}from"./sceneManage.55882510.js";import{_ as te}from"./error.229cea25.js";import{b as Ne,c as ke,i as ue,a as de}from"./index.e0e8e942.js";import{bi as ut,j as ft}from"./lodash.22f463b4.js";import{c as _t}from"./tools.374228bf.js";function mt(l){const V=ee({levelOptions:[{label:"全部",value:4},{label:"公开",value:1},{label:"受限",value:2},{label:"私有",value:3}]}),{levelOptions:T}=$e(V),g=ee({searchOptions:[{label:"关键字",key:"keyword",type:"text",placeholder:"场景名称/创建者",span:10},{label:"场景权限",key:"type",type:"select",value:l,options:T,clearable:!0,span:8}]});return{...$e(g)}}const Ue=l=>(fe("data-v-e2f9a30c"),l=l(),_e(),l),gt={key:0,class:"no-data"},ht={key:1,class:"scene-container"},yt=["onClick"],vt={class:"default"},bt={class:"scene-visit"},St={class:"cover"},kt={class:"cover-info"},Ct={class:"cover-info__name"},wt={class:"cover-info__detail"},xt={class:"creator"},$t={class:"cerateTime"},Vt={class:"cover-description"},Tt={class:"cover-row"},Nt=Ue(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[t("rect",{x:"6.28571",y:"1.99097",width:"3.42857",height:"5.71429",fill:"#ffffff"}),t("path",{d:"M6.26242 10.0374H9.73758L8.24823 14.009H7.75178L6.26242 10.0374Z",fill:"#ffffff"}),t("path",{d:"M3.78012 10.7821C3.78012 8.45154 5.66941 6.56226 7.99996 6.56226C10.3305 6.56226 12.2198 8.45154 12.2198 10.7821H3.78012Z",fill:"#ffffff"})],-1)),Lt=["onClick"],It=["onClick"],Dt={class:"scene-info"},Ut={class:"scene-name"},Bt=Ue(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[t("rect",{x:"6.28571",y:"1.99097",width:"3.42857",height:"5.71429",fill:"#409EFF"}),t("path",{d:"M6.26242 10.0374H9.73758L8.24823 14.009H7.75178L6.26242 10.0374Z",fill:"#409EFF"}),t("path",{d:"M3.78012 10.7821C3.78012 8.45154 5.66941 6.56226 7.99996 6.56226C10.3305 6.56226 12.2198 8.45154 12.2198 10.7821H3.78012Z",fill:"#409EFF"})],-1)),Et=X({__name:"index",props:{data:{default:()=>[]}},emits:["apply","raiseTop","click"],setup(l,{expose:V,emit:T}){const g=l,{getElColor:I}=De(),e=T,H=K(),E=W(()=>g==null?void 0:g.data),p=W(()=>y=>{const s={1:I("--el-color-success"),2:I("--el-color-warning"),3:I("--el-color-danger")};return{border:`1px solid ${s[y]}`,background:`${s[y]}`}}),z=W(()=>y=>({background:`url('${Qe.VITE_APP_BASE_URL}${y}'), url('${Ke}')`,"background-position":"center center","background-size":"cover"}));function R(y){e("click",y)}function U(y){e("raiseTop",y)}return V({sceneRef:H}),(y,s)=>{const r=S("el-tooltip"),v=S("el-scrollbar");return d(),M(v,null,{default:n(()=>[E.value.length===0?(d(),C("div",gt,"暂无数据")):(d(),C("div",ht,[(d(!0),C(ae,null,be(E.value,o=>(d(),C("div",{key:o.id,class:"scene-item"},[t("div",{class:"scene-main",style:ye(z.value(o.cover)),onClick:i=>R(o)},[t("div",vt,[t("span",{class:"scene-type",style:ye(p.value(o.status))},P(o.status===1?"公开":o.status===2?"受限":"私有"),5),t("div",bt,P(o.accessCount)+"次",1)]),t("div",St,[t("div",kt,[t("div",Ct,P(o.sceneName),1),t("div",wt,[t("span",xt,P(o.creator),1),t("span",$t,P(o.createTime),1)])]),a(r,{"popper-class":"scene-tooltip",disabled:o.description.length<100,content:o.description},{default:n(()=>[t("div",Vt,P(o.description),1)]),_:2},1032,["disabled","content"]),t("div",Tt,[Nt,t("span",{onClick:A(i=>U(o),["stop"])},P(o.topOrder?"取消置顶":"点击置顶"),9,Lt),$("     "),t("span",{onClick:A(i=>R(o),["stop"])},"点击查看",8,It)])])],12,yt),t("div",Dt,[t("div",Ut,[o.topOrder?(d(),M(r,{key:0,content:"已置顶",placement:"top-start"},{default:n(()=>[Bt]),_:1})):D("",!0),$(" "+P(o.sceneName),1)])]),Ie(y.$slots,"operate",{scene:o},void 0,!0)]))),128))]))]),_:3})}}});const Pt=te(Et,[["__scopeId","data-v-e2f9a30c"]]);function jt(l){const V=async()=>{l.isLoadingTableData=!0,await Xe(l.type,l.keyword,l.pageSize,l.currentPage).then(s=>{s.code===j.SUCCESS?(l.tableData=s.data.records,l.cardData=ut(s.data.records,5),l.total=s.data.total):k({type:"warning",message:"请求数据失败"}),l.isLoadingTableData=!1}).catch(s=>{k({type:"error",message:s.message}),l.isLoadingTableData=!1})};function T(s,r,v=!0){v&&window.open(r),Ye(s).then(o=>{o.code===j.SUCCESS?V():k({message:o.message,type:"warning",duration:2e3})})}function g(s,r){const{status:v,sceneNo:o,externalScene:i}=r;v===2?he(o).then(u=>{u.code===j.SUCCESS&&(u.data?i?(l.externalSceneId=o,l.createDialogVisible=!0):T(o,`${Ne}${o}`):G.alert("您没有该场景的编辑权限, 请联系管理员开通","提示",{confirmButtonText:"确定"}))}):i?(l.externalSceneId=o,l.createDialogVisible=!0):T(o,`${Ne}${o}`)}function I(s){et(s).then(r=>{r.code===j.SUCCESS?(k({type:"success",message:"复制成功!"}),V()):k({type:"warning",message:"复制失败"})}).catch(r=>{k({type:"error",message:r.message})})}function e(s,r){if(!s){k({type:"warning",message:"数据为空!"});return}r||(r="场景.json"),typeof s=="object"&&(s=JSON.stringify(s,void 0,4));const v=new Blob([s],{type:"text/js on"}),o=document.createElement("a");o.download=r,o.href=window.URL.createObjectURL(v),o.dataset.downloadurl=["text/json",o.download,o.href].join(":"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}function H(s,r){G.confirm(`确定导出此场景【${r.sceneName}】？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{tt(r.id).then(v=>{if(v.code===j.SUCCESS){const{fileContent:o,fileName:i}=v.data;e(o,i)}else k({type:"warning",message:"导出场景失败!"})}).catch(v=>{k({type:"error",message:`导出场景错误!${v.message}`})})}).catch(()=>{})}function E(s,r){const{status:v,cover:o,sceneNo:i,sceneName:u,externalScene:B}=r;l.shareInfo={backgroundImg:ke+o,sceneNo:i,sceneName:u,externalScene:B,isExternalScene:!!B,sceneType:v},v===1?(l.shareInfo.showDuration=!1,l.shareDialogVisible=!0):v===2?he(i).then(c=>{c.code===j.SUCCESS&&(c.data?(l.shareInfo.showDuration=!0,l.shareDialogVisible=!0):G.alert("您没有该场景的分享权限, 请联系管理员开通","提示",{confirmButtonText:"确定"}))}):G.alert("该场景为私有场景, 无法分享","提示",{confirmButtonText:"确定"})}function p(s,r){G.confirm(`确认删除此场景【 ${r.sceneName} 】?`,"删除场景",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",beforeClose:(v,o,i)=>{v==="confirm"?(o.confirmButtonLoading=!0,o.confirmButtonText="删除中...",ot(r.sceneNo).then(u=>{u.code===j.SUCCESS?(i(),setTimeout(()=>{o.confirmButtonLoading=!1},300)):(k({type:"warning",message:u.message}),setTimeout(()=>{o.confirmButtonLoading=!1,o.confirmButtonText="确定"},300))}).catch(u=>{k({type:"error",message:u.message}),setTimeout(()=>{o.confirmButtonLoading=!1,o.confirmButtonText="确定"},300)})):i()}}).then(()=>{V(),k({type:"success",message:"删除成功!"})}).catch(()=>{})}function z(s,r){const{sceneNo:v,topOrder:o}=r;nt(v).then(i=>{i.code===j.SUCCESS?(l.currentPage=1,V(),k({type:"success",message:o?"取消置顶成功":"置顶成功"})):k({type:"warning",message:"请求数据失败"})}).catch(i=>{k({type:"error",message:i.message})})}function R(s,r){const{status:v,sceneNo:o,externalScene:i}=r;v===2?he(o).then(u=>{u.code===j.SUCCESS&&(u.data?i?T(o,i):T(o,`${ue}${o}`):G.alert("您没有该场景的查看权限, 请联系管理员开通","提示",{confirmButtonText:"确定"}))}):i?T(o,i):T(o,`${ue}${o}`)}function U(s){lt(s).then(r=>{r.code===j.SUCCESS?(k({type:"success",message:"导入场景成功!"}),V()):k({type:"warning",message:"导入场景失败!"})}).catch(r=>{k({type:"error",message:`导入场景错误!${r.message}`})})}function y(s,r){at(s,r).then(v=>{v.code===j.SUCCESS?(V(),k({type:"success",message:r?"场景显示设置成功":"场景隐藏设置成功"})):k({type:"warning",message:"请求数据失败"})}).catch(v=>{k({type:"error",message:v.message})})}return{getScenesList:V,handleEdit:g,copySceneById:I,handleExport:H,handleShare:E,handleDelete:p,handleTop:z,handleCheck:R,importSceneByJsonFile:U,fetchPortalShow:y,increaseVisitsAndOpen:T}}function ce(l){return l===3}function Q(l){return l===3||l===2}function zt(l){const{status:V,permissionTypeNum:T,applyStatus:g}=l;return T>0||V===1||V===2&&T===0&&g===1}function Ot(l){l.externalScene?window.open(l.externalScene):window.open(ue+l.sceneNo)}const Ft={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},At=["stroke"],Mt=["stroke"],Rt=["stroke"],Ht=["stroke"],Jt={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},Zt=["stroke"],qt=["stroke"],Wt=["stroke"],Gt=["fill"],Qt=["fill"],Kt=["fill"],Xt=X({__name:"svg",props:{name:{default:"card"},color:{default:""}},setup(l){const V=l,T=W(()=>`${V.name}`),g=W(()=>V.color);return(I,e)=>(d(),C(ae,null,[T.value==="card"?(d(),C("svg",Ft,[t("path",{stroke:g.value,d:"M6 2H2.66667C2.29848 2 2 2.29848 2 2.66667V6C2 6.3682 2.29848 6.66667 2.66667 6.66667H6C6.3682 6.66667 6.66667 6.3682 6.66667 6V2.66667C6.66667 2.29848 6.3682 2 6 2Z"},null,8,At),t("path",{stroke:g.value,d:"M6 9.33315H2.66667C2.29848 9.33315 2 9.63161 2 9.99981V13.3331C2 13.7013 2.29848 13.9998 2.66667 13.9998H6C6.3682 13.9998 6.66667 13.7013 6.66667 13.3331V9.99981C6.66667 9.63161 6.3682 9.33315 6 9.33315Z"},null,8,Mt),t("path",{stroke:g.value,d:"M13.3334 2H10C9.63184 2 9.33337 2.29848 9.33337 2.66667V6C9.33337 6.3682 9.63184 6.66667 10 6.66667H13.3334C13.7016 6.66667 14 6.3682 14 6V2.66667C14 2.29848 13.7016 2 13.3334 2Z"},null,8,Rt),t("path",{stroke:g.value,d:"M13.3334 9.33315H10C9.63184 9.33315 9.33337 9.63161 9.33337 9.99981V13.3331C9.33337 13.7013 9.63184 13.9998 10 13.9998H13.3334C13.7016 13.9998 14 13.7013 14 13.3331V9.99981C14 9.63161 13.7016 9.33315 13.3334 9.33315Z"},null,8,Ht)])):D("",!0),T.value==="table"?(d(),C("svg",Jt,[t("path",{d:"M6.5 2.99992H13.5",stroke:g.value,"stroke-linecap":"round","stroke-linejoin":"round"},null,8,Zt),t("path",{d:"M6.5 7.99992H13.5",stroke:g.value,"stroke-linecap":"round","stroke-linejoin":"round"},null,8,qt),t("path",{d:"M6.5 12.9999H13.5",stroke:g.value,"stroke-linecap":"round","stroke-linejoin":"round"},null,8,Wt),t("rect",{x:"2.5",y:"1.99992",fill:g.value,width:"2",height:"2",rx:"1"},null,8,Gt),t("rect",{x:"2.5",y:"6.99992",fill:g.value,width:"2",height:"2",rx:"1"},null,8,Qt),t("rect",{x:"2.5",y:"11.9999",fill:g.value,width:"2",height:"2",rx:"1"},null,8,Kt)])):D("",!0)],64))}});const Le=te(Xt,[["__scopeId","data-v-479fac2c"]]),Ce=""+new URL("../png/loseImg-814c5743.png",import.meta.url).href,Yt=l=>(fe("data-v-4e23ee60"),l=l(),_e(),l),eo={class:"createExternalScene"},to=["src"],oo=Yt(()=>t("p",{class:"tip"},"封面尺寸不低于350*250px，大小不要超过5M，并且为jpg或png格式",-1)),no=X({__name:"CreateScene",props:{visible:{type:Boolean,default:!1},sceneNo:{type:String,default:""}},emits:["closed","done"],setup(l,{emit:V}){const T=Je(),g=V,I=l,e=W(()=>T.getUserInfo),H=W(()=>I.sceneNo!==""?"修改外部场景":"创建外部场景"),E=K(),p=ee({dialogVisile:!1,form:{sceneNo:"",sceneName:"",belongDepartmentId:null,cover:"",externalScene:"",status:3,description:""},rules:{sceneName:[{required:!0,message:"请输入场景名称",trigger:"blur"}],externalScene:[{required:!0,message:"请输入外部场景URL",trigger:"blur"},{type:"url",message:"URL地址格式不正确",trigger:"change"}],cover:[{required:!0,message:"请上传封面图",trigger:"change"}]},departmentOptions:null,departmentValue:null,departmentProps:{label:"nodeName",children:"children"},isLoading:!1,btnLoading:!1});Se(()=>{p.dialogVisile=!0,I.sceneNo&&U(I.sceneNo)}),ve(()=>p.departmentValue,i=>{i?p.form.belongDepartmentId=i.id:p.form.belongDepartmentId=""});function z(){g("closed")}function R(i){const u=i.srcElement;u.src=Ce,u.onerror=null}function U(i){p.isLoading=!0,st(i).then(u=>{if(u.code===j.SUCCESS){const{sceneName:B,belongDepartmentId:c,cover:_,externalScene:x,status:h,description:b}=u.data;p.form={sceneName:B,belongDepartmentId:c,cover:_,externalScene:x,status:h,description:b},p.isLoading=!1}else k({type:"warning",message:u.message}),p.isLoading=!1}).catch(u=>{k({type:"error",message:u.message}),p.isLoading=!1})}function y(){E.value.validate(i=>{if(i){if(!p.form.cover)return k({type:"warning",message:"请上传封面图"}),!1;s()}else return!1})}function s(){p.btnLoading=!0;const{sceneName:i,cover:u,externalScene:B,status:c,description:_}=p.form,x={sceneName:i,cover:u,externalScene:B,status:c,description:_,creatorId:e.value.id};I.sceneNo&&(x.sceneNo=I.sceneNo),it(x).then(h=>{h.code===j.SUCCESS?(p.btnLoading=!1,g("done"),z()):(p.btnLoading=!1,k({type:"warning",message:h.message}))}).catch(h=>{p.btnLoading=!1,k({type:"error",message:h.message})})}function r(i){const u=i,B=new FormData;B.append("file",u),rt(B).then(c=>{const{code:_,message:x,data:h}=c;_===j.SUCCESS?p.form.cover=h.url:k({type:"error",message:x})})}function v(i){o(i.raw).then(B=>{const c=B;c.size/1024/1024>5?k({type:"warning",message:"上传封面图片大小不能超过 5MB!"}):r(c)}).catch(B=>{k({type:"warning",message:B})})}function o(i){const u=i.type==="image/jpeg"||i.type==="image/png";return new Promise((B,c)=>{if(!u){c("文件类型错误，请上传 JPG或PNG 格式的图片!");return}const _=new FileReader;_.onload=x=>{const h=x.target.result,b=new Image,J=b;b.onload=function(){if(i.width=J.width,i.height=J.height,i.width&&i.width<350||i.height&&i.height<250){c("封面尺寸不低于350*250px");return}B(i)},b.onerror=c,b.src=h},_.readAsDataURL(i)})}return(i,u)=>{const B=S("el-input"),c=S("el-form-item"),_=S("el-icon"),x=S("el-upload"),h=S("el-radio"),b=S("el-radio-group"),J=S("el-form"),q=S("el-button"),oe=S("el-dialog"),ne=me("loading");return d(),C("div",eo,[a(oe,{modelValue:p.dialogVisile,"onUpdate:modelValue":u[6]||(u[6]=O=>p.dialogVisile=O),title:H.value,width:"600px",top:"10vh","close-on-click-modal":!1,onClosed:z},{footer:n(()=>[a(m(pe),{justify:"end"},{default:n(()=>[a(q,{onClick:u[5]||(u[5]=O=>i.$emit("closed"))},{default:n(()=>[$("取 消")]),_:1}),a(q,{type:"primary",loading:p.btnLoading,onClick:y},{default:n(()=>[$(" 确 定 ")]),_:1},8,["loading"])]),_:1})]),default:n(()=>[ge((d(),M(J,{ref_key:"sceneFormRef",ref:E,class:"sceneForm","element-loading-text":"拼命加载中...",model:p.form,rules:p.rules,inline:"","label-width":"120px"},{default:n(()=>[a(c,{label:"场景名称：",prop:"sceneName"},{default:n(()=>[a(B,{modelValue:p.form.sceneName,"onUpdate:modelValue":u[0]||(u[0]=O=>p.form.sceneName=O),maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(c,{label:"外部场景URL：",prop:"externalScene"},{default:n(()=>[a(B,{modelValue:p.form.externalScene,"onUpdate:modelValue":u[1]||(u[1]=O=>p.form.externalScene=O),type:"textarea",rows:3,placeholder:"请填写完整URL地址"},null,8,["modelValue"])]),_:1}),a(c,{class:"imgUpload",label:"场景封面：",prop:"cover"},{default:n(()=>[a(x,{accept:".jpg,.jpeg,.png",class:"avatar-uploader","show-file-list":!1,action:"","auto-upload":!1,"on-change":v},{default:n(()=>[p.form.cover?(d(),C("img",{key:0,class:"avatar",src:m(ke)+p.form.cover,onError:u[2]||(u[2]=O=>R(O))},null,40,to)):(d(),M(_,{key:1,size:24},{default:n(()=>[a(m(Ae))]),_:1}))]),_:1}),oo]),_:1}),a(c,{label:"场景模式：",prop:"status"},{default:n(()=>[a(b,{modelValue:p.form.status,"onUpdate:modelValue":u[3]||(u[3]=O=>p.form.status=O)},{default:n(()=>[a(h,{label:1},{default:n(()=>[$("公开")]),_:1}),a(h,{label:2},{default:n(()=>[$("受限")]),_:1}),a(h,{label:3},{default:n(()=>[$("私有")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"场景描述：",prop:"description"},{default:n(()=>[a(B,{modelValue:p.form.description,"onUpdate:modelValue":u[4]||(u[4]=O=>p.form.description=O),type:"textarea",rows:3,resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[ne,p.isLoading]])]),_:1},8,["modelValue","title"])])}}});const lo=te(no,[["__scopeId","data-v-4e23ee60"]]),ao=()=>Ze.doGetPromise("/certification/manage/system/getRecipient"),so={class:"permission-config-container","element-loading-text":"数据加载中..."},io={class:"framework-tree"},ro={class:"framework-tree__header"},co={class:"custom-tree-node"},po={class:"middleBtns"},uo={class:"choosedOrgans"},fo={class:"choosedOrgans_header"},_o={class:"left"},mo={key:0,class:"right"},go={class:"choosedOrganItems"},ho=["title"],yo=X({__name:"PermissionConfigModal",props:{visible:{type:Boolean,default:!1},title:{default:"权限配置",type:String},authSenceId:{type:String,default:""}},emits:["closed"],setup(l,{emit:V}){const T=V,g=l,I=K(),e=ee({isLoading:!1,btnLoading:!1,dialogVisible:!1,filterText:"",treeProps:{label:"title",children:"children"},checkedPeople:[],peopleList:[],people:[],peopleSelected:null});ve(()=>g.visible,c=>{c?(setTimeout(()=>{e.dialogVisible=!0},15),p()):(H(),e.dialogVisible=!1)}),ve(()=>e.filterText,c=>{I.value.filter(c)});function H(){e.checkedPeople=[],e.peopleList=[],e.people=[],e.peopleSelected=null}function E(c,_,x){return c?qe(c,_,x,e.treeProps.label):!0}function p(){ao().then(c=>{c.code===j.SUCCESS?e.peopleList=c.data:k({type:"warning",message:"获取数据异常"})})}function z(c){if(e.peopleSelected=c.flag===1?null:c,c.flag===1){let _=!0;if((e.people||[]).forEach(h=>{h.id===c.id&&(_=!1)}),_){const h={id:c.id,realName:c.title,type:1};e.people.push(h)}}else return!1}function R(c){return`iconfont ${c.flag===0?"icon-buju":c.flag===1?"icon-touxiang":""}`}function U(){if(!e.peopleList||Array.isArray(e.peopleList)&&e.peopleList.length===0)return!1;const c=ft(e.peopleSelected);for(let _=0,x=e.peopleList.length;_<x;_++)e.peopleSelected=e.peopleList[_],y();setTimeout(()=>{e.peopleSelected=c},300)}function y(){if(!e.peopleSelected)return!1;const c=function(_){const{children:x}=_;if(!x||Array.isArray(x)&&x.length===0)return!1;x.forEach(h=>{if(h.flag===1){let b=!0;if((e.people||[]).forEach(q=>{q.id===h.id&&(b=!1)}),b){const q={id:h.id,realName:h.title,type:1};e.people.push(q)}}else c(h)})};c(e.peopleSelected)}function s(){e.isLoading=!0,e.filterText="",g.authSenceId&&r(g.authSenceId)}function r(c){ct(c).then(_=>{if(_.code===j.SUCCESS){const{data:x}=_;Array.isArray(x)&&x.length>0&&(e.people=x.map(h=>({id:h.userId,realName:h.userName,type:h.permissionTypeNum??1}))),setTimeout(()=>{e.isLoading=!1},200)}else k({type:"warning",message:"获取数据有误"})})}function v(){e.people=i(e.people,e.checkedPeople),e.checkedPeople=[]}function o(){e.people=[],e.checkedPeople=[]}function i(c,_){return c.filter(x=>_.every(h=>x.id!==h))}function u(){T("closed")}function B(){const c=e.people.filter(b=>b.type===1).map(b=>b.id),_=e.people.filter(b=>b.type===2).map(b=>b.id),x=e.people.filter(b=>b.type===3).map(b=>b.id),h={id:g.authSenceId,userIds:c.join(","),editUsers:_.join(","),manageUsers:x.join(",")};e.btnLoading=!0,dt(h).then(b=>{e.btnLoading=!1,b.code===j.SUCCESS?(k({type:"success",message:"权限配置成功!"}),u()):k({type:"warning",message:"权限配置服务有误 ，请重试！"})}).catch(b=>{e.btnLoading=!1})}return(c,_)=>{const x=S("el-input"),h=S("el-tree"),b=S("el-button"),J=S("el-radio"),q=S("el-radio-group"),oe=S("el-checkbox"),ne=S("el-checkbox-group"),O=S("el-dialog"),ie=me("loading");return d(),M(O,{modelValue:e.dialogVisible,"onUpdate:modelValue":_[4]||(_[4]=Y=>e.dialogVisible=Y),class:"framework-dialog permission-config-dialog",title:l.title,width:"1100px",top:"50px","append-to-body":!0,onOpen:s,onClosed:u},{default:n(()=>{var Y;return[ge((d(),C("div",so,[t("div",io,[t("div",ro,[a(x,{modelValue:e.filterText,"onUpdate:modelValue":_[0]||(_[0]=F=>e.filterText=F),placeholder:"输入名称进行过滤","prefix-icon":m(Me),clearable:""},null,8,["modelValue","prefix-icon"])]),a(h,{ref_key:"frameTree",ref:I,class:"framework-tree__wrapper",data:e.peopleList,props:e.treeProps,"node-key":"id","empty-text":"暂无数据","default-expand-all":"","highlight-current":"","expand-on-click-node":!1,"filter-node-method":E,onCurrentChange:z},{default:n(({node:F,data:N})=>[t("span",co,[t("span",null,[t("i",{class:le(R(N))},null,2),$(" "+P(F.label),1)])])]),_:1},8,["data","props"])]),t("div",po,[a(b,{size:"small",onClick:U},{default:n(()=>[$("添加所有用户")]),_:1}),a(b,{size:"small",class:"clearMargin",disabled:!e.peopleSelected,onClick:y},{default:n(()=>[$("添加组织用户")]),_:1},8,["disabled"])]),t("div",uo,[t("div",fo,[t("div",_o,"已选用户 ("+P(e.people.length)+"人)",1),((Y=e==null?void 0:e.people)==null?void 0:Y.length)>0?(d(),C("div",mo,[a(b,{size:"small",onClick:_[1]||(_[1]=F=>v())},{default:n(()=>[$("删除")]),_:1}),a(b,{size:"small",onClick:_[2]||(_[2]=F=>o())},{default:n(()=>[$("删除所有")]),_:1})])):D("",!0)]),t("div",go,[a(ne,{modelValue:e.checkedPeople,"onUpdate:modelValue":_[3]||(_[3]=F=>e.checkedPeople=F),class:"checked-list"},{default:n(()=>[(d(!0),C(ae,null,be(e.people,F=>(d(),M(oe,{key:F.id,label:F.id,class:"checkbox-content"},{default:n(()=>[t("span",{class:"name",title:F.realName},P(F.realName),9,ho),a(q,{modelValue:F.type,"onUpdate:modelValue":N=>F.type=N},{default:n(()=>[a(J,{label:3},{default:n(()=>[$("可管理")]),_:1}),a(J,{label:2},{default:n(()=>[$("可编辑")]),_:1}),a(J,{label:1},{default:n(()=>[$("可浏览")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])])])),[[ie,e.isLoading]]),a(m(pe),{justify:"end"},{default:n(()=>[a(b,{type:"primary",loading:e.btnLoading,onClick:B},{default:n(()=>[$(" 保存 ")]),_:1},8,["loading"])]),_:1})]}),_:1},8,["modelValue","title"])}}});const vo=te(yo,[["__scopeId","data-v-82665e6b"]]),bo={class:"shareScene"},So={class:"shareBody"},ko={class:"imgContainer"},Co=["src"],wo={class:"sceneNameContainer"},xo={class:"name fl"},$o={key:0,class:"timeContainer"},Vo=t("span",{class:"label"},"有效期:",-1),To={key:1,class:"successContainer"},No=t("span",{class:"statusTitle"},"创建成功",-1),Lo={class:"link"},Io={key:0,class:"code"},Do=X({__name:"ShareScene",props:{info:{type:Object,default:()=>({backgroundImg:"",sceneNo:"",sceneName:"",isExternalScene:!1,externalScene:"",sceneType:1})}},emits:["closed","handle-reset"],setup(l,{emit:V}){const T=V,g=l,I=W(()=>g.info.sceneType===1?"复制链接":"复制链接和提取码"),e=ee({dialogVisile:!1,effectiveDuration:7,isCreate:!1,shareLink:"",securityCode:""});Se(()=>{e.dialogVisile=!0});function H(){T("closed")}function E(){p()}function p(){g.info.sceneType===1&&(e.effectiveDuration=36500),pt(g.info.sceneNo,e.effectiveDuration).then(U=>{if(U.code===j.SUCCESS){e.isCreate=!0;const y=/^(http|\/\/)/.test(de)?de:window.location.origin+window.location.pathname.substring(0,window.location.pathname.indexOf("/maintenance"))+de.replace(/^(\.\.?)/,"");e.shareLink=`${y}#/share/${U.data.shortCode}`,e.securityCode=U.data.token}else k({type:"warning",message:"创建分享链接失败"})}).catch(U=>{k({type:"error",message:U.message})})}function z(){const U=`${e.shareLink}`,y=`链接： ${e.shareLink}
  提取码： ${e.securityCode}`;_t(g.info.sceneType===1?U:y)}function R(U){const y=U.srcElement;y.src=Ce,y.onerror=null}return(U,y)=>{const s=S("el-button"),r=S("el-radio"),v=S("el-radio-group"),o=S("el-dialog");return d(),C("div",bo,[a(o,{modelValue:e.dialogVisile,"onUpdate:modelValue":y[2]||(y[2]=i=>e.dialogVisile=i),title:"场景分享",width:"565px",top:"14vh","close-on-click-modal":!1,onClosed:H},{default:n(()=>[t("div",So,[t("div",ko,[t("img",{class:"image",src:l.info.backgroundImg,onError:y[0]||(y[0]=i=>R(i))},null,40,Co)]),t("div",wo,[t("p",xo,P(l.info.sceneName),1),e.isCreate?D("",!0):(d(),M(s,{key:0,class:"button fr",type:"primary",onClick:E},{default:n(()=>[$("创建链接")]),_:1}))]),!e.isCreate&&l.info.showDuration?(d(),C("div",$o,[Vo,a(v,{modelValue:e.effectiveDuration,"onUpdate:modelValue":y[1]||(y[1]=i=>e.effectiveDuration=i)},{default:n(()=>[a(r,{label:7},{default:n(()=>[$("7天")]),_:1}),a(r,{label:30},{default:n(()=>[$("1个月")]),_:1}),a(r,{label:90},{default:n(()=>[$("3个月")]),_:1})]),_:1},8,["modelValue"])])):D("",!0),e.isCreate?(d(),C("div",To,[No,t("p",Lo,"链接： "+P(e.shareLink),1),l.info.sceneType===2?(d(),C("p",Io,"提取码： "+P(e.securityCode),1)):D("",!0),a(s,{class:"button fr",type:"primary",onClick:z},{default:n(()=>[$(P(I.value),1)]),_:1})])):D("",!0)])]),_:1},8,["modelValue"])])}}});const Uo=l=>(fe("data-v-2f28ebc5"),l=l(),_e(),l),Bo=["src"],Eo=Uo(()=>t("i",null,null,-1)),Po={key:2},jo={key:3},zo={key:4},Oo=X({__name:"TableList",props:{data:{default:()=>[]},isLoadingTableData:{type:Boolean,default:!1}},setup(l,{expose:V}){const T=K(),g=l,I=W(()=>g==null?void 0:g.data),e=[{prop:"cover",label:"缩略图",width:108,sortable:!0,align:"center"},{prop:"sceneName",label:"场景名称",minWidth:148,sortable:!0,align:"center"},{prop:"creator",label:"创建者",minWidth:100,sortable:!0,align:"center"},{prop:"createTime",label:"创建时间",minWidth:126,sortable:!0,align:"center"},{prop:"sceneNo",label:"场景链接地址",minWidth:210,sortable:!0,align:"center"},{prop:"status",label:"状态",width:90,sortable:!0,align:"center"}];function H(E){const p=E.srcElement;p.src=Ce,p.onerror=null}return V({tableRef:T}),(E,p)=>{const z=S("el-table-column"),R=S("el-tooltip"),U=S("el-table"),y=me("loading");return ge((d(),M(U,{ref_key:"tableRef",ref:T,"element-loading-text":"拼命加载中...",data:I.value,"empty-text":"无相关数据"},{default:n(()=>[a(z,{label:"序号",type:"index",width:"80"}),(d(),C(ae,null,be(e,s=>a(z,{key:s.prop,prop:s.prop,label:s.label,sortable:s.sortable,width:s.width,"min-width":s.minWidth,"class-name":"tableStatus"},{default:n(r=>[s.prop==="cover"?(d(),C("img",{key:0,src:m(ke)+r.row.cover,class:"coverImg",alt:"封面图",onError:p[0]||(p[0]=v=>H(v))},null,40,Bo)):s.prop==="status"?(d(),C("div",{key:1,class:le([{isPublic:r.row[s.prop]===1},{isPartVisible:r.row[s.prop]===2},{isPrivate:r.row[s.prop]!==1&&r.row[s.prop]!==2}])},[Eo,$(" "+P(r.row[s.prop]===1?"公开":r.row[s.prop]===2?"受限":"私有"),1)],2)):s.prop==="sceneNo"?(d(),C("div",Po,P(m(ue)+r.row[s.prop]),1)):s.prop==="sceneName"?(d(),C("div",jo,[r.row.topOrder?(d(),M(R,{key:0,content:"已置顶",placement:"top-start",effect:"light"},{default:n(()=>[t("i",{class:le([{"fs-zhiding-mian":r.row.topOrder},"fontsmart topIcon"])},null,2)]),_:2},1024)):D("",!0),$(" "+P(r.row[s.prop]),1)])):(d(),C("div",zo,P(r.row[s.prop]),1))]),_:2},1032,["prop","label","sortable","width","min-width"])),64)),a(z,{label:"操作",width:"250px",fixed:"right","class-name":"tableOperate"},{default:n(s=>[Ie(E.$slots,"operate",{scene:s.row},void 0,!0)]),_:3})]),_:3},8,["data"])),[[y,E.isLoadingTableData]])}}});const Fo=te(Oo,[["__scopeId","data-v-2f28ebc5"]]),se=l=>(fe("data-v-f289be2d"),l=l(),_e(),l),Ao={class:"operate"},Mo={class:"display-card"},Ro={class:"scene-brief"},Ho={class:"scene-create-date"},Jo={class:"scene-operate-row"},Zo={class:"moreOperate"},qo=["onClick"],Wo=se(()=>t("span",null,"权限配置",-1)),Go=[Wo],Qo=["onClick"],Ko=se(()=>t("span",null,"复制场景",-1)),Xo=[Ko],Yo=["onClick"],en=se(()=>t("span",null,"导出场景",-1)),tn=[en],on=["onClick"],nn=se(()=>t("span",null,"分享",-1)),ln=[nn],an={key:4},sn=["onClick"],rn=se(()=>t("span",null,"删除",-1)),cn=[rn],dn=["onClick"],pn=["onClick"],un=["onClick"],fn=["onClick"],_n={key:4,class:"popper-btn"},mn=["onClick"],gn=X({__name:"index",setup(l){const{getElColor:V}=De(),T=K(),g=K(),I=K("card"),e=ee({currentPage:1,pageSize:15,pageSizes:[15,30,50,100],total:0,cardData:[],tableData:[],isLoadingTableData:!1,createDialogVisible:!1,externalSceneId:"",checkUserVisible:!1,authSenceId:"",shareDialogVisible:!1,shareInfo:{},type:4,keyword:""}),{searchOptions:H}=mt(e.type),{getScenesList:E,handleEdit:p,copySceneById:z,handleExport:R,handleShare:U,handleDelete:y,handleTop:s,handleCheck:r,importSceneByJsonFile:v,fetchPortalShow:o,increaseVisitsAndOpen:i}=jt(e),u=W(()=>N=>N===I.value?V("--el-color-primary"):V("--el-text-color-regular")),B=N=>{const{type:L,keyword:Z}=N;e.type=L??4,e.keyword=Z,E()},c=N=>{e.currentPage=N,E()},_=N=>{e.currentPage=1,e.pageSize=N,E()};function x(N){s(null,N)}function h(N,L){const{sceneNo:Z}=L;e.authSenceId=Z,e.checkUserVisible=!0}function b(N,L){G.confirm(`确定复制此场景【${L.sceneName}】?`,"复制场景",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{z(L.sceneNo)}).catch(()=>{})}function J(N){N==="import-scene"?ne():N==="create-outside-scene"&&oe()}function q(){window.open(de)}function oe(){e.externalSceneId="",e.createDialogVisible=!0}function ne(){var L;((L=T.value)==null?void 0:L.$el.querySelector("#importSceneFile")).click()}async function O(N){const L=N.target.files[0];if(L.type!=="application/json")G.alert("导入失败！请选择Json格式的文件！","警告",{confirmButtonText:"确定"}),N.target.value=null;else{const Z=new FormData;Z.append("file",L),await v(Z)}}function ie(N){const{id:L,portalShow:Z}=N;o(L,Z)}function Y(N){zt(N)&&(i(N.sceneNo,"",!1),Ot(N))}const F=async()=>{await E()};return Se(async()=>{await F()}),(N,L)=>{const Z=S("el-dropdown-item"),Be=S("el-dropdown-menu"),Ee=S("el-dropdown"),Pe=S("el-icon"),we=S("el-switch"),xe=S("el-popover"),re=S("el-button"),je=S("el-tooltip"),ze=S("el-space"),Oe=S("el-pagination"),Fe=me("loading");return d(),C(ae,null,[a(m(Ge),{id:"scene-container",ref_key:"sceneRef",ref:T,direction:"vertical",background:""},{default:n(()=>[t("input",{id:"importSceneFile",style:{display:"none"},type:"file",name:"sceneFile",accept:"application/json",onChange:O},null,32),a(m(pe),{padding:"1 1 0",justify:"space-between",border:""},{default:n(()=>[a(Ee,{"split-button":"",type:"primary",icon:m(Ve),onCommand:J,onClick:q},{dropdown:n(()=>[a(Be,null,{default:n(()=>[a(Z,{icon:m(Ve),command:"create-outside-scene"},{default:n(()=>[$("创建外部场景")]),_:1},8,["icon"]),a(Z,{icon:m(Re),command:"import-scene"},{default:n(()=>[$("导入场景")]),_:1},8,["icon"])]),_:1})]),default:n(()=>[$(" 创建场景 ")]),_:1},8,["icon"]),t("div",Ao,[a(m(We),{ref_key:"SmartSearchRef",ref:g,justify:"end",width:"800px",class:"operate_smart-search",options:m(H),"query-permission":"sys_district_page",onHandleSearch:B},null,8,["options"]),t("div",Mo,[t("div",{class:le(["display-row",{"active-display":I.value==="card"}]),onClick:L[0]||(L[0]=f=>I.value="card")},[a(Le,{name:"card",color:u.value("card")},null,8,["color"])],2),t("div",{class:le(["display-row",{"active-display":I.value==="table"}]),onClick:L[1]||(L[1]=f=>I.value="table")},[a(Le,{name:"table",color:u.value("table")},null,8,["color"])],2)])])]),_:1}),I.value==="card"?ge((d(),M(m(Te),{key:0},{default:n(()=>[a(Pt,{data:e.tableData,onRaiseTop:x,onClick:Y},{operate:n(({scene:f})=>[t("div",Ro,[t("div",Ho,P(f.createTime.split(" ")[0]),1),t("div",Jo,[m(Q)(f.permissionTypeNum)?(d(),M(Pe,{key:0,title:"编辑",color:m(V)("--el-text-color-placeholder"),size:"16",onClick:A(w=>m(p)(w,f),["stop"])},{default:n(()=>[a(m(He))]),_:2},1032,["color","onClick"])):D("",!0),$("     "),a(xe,{"popper-class":"sceneManagePopper","popper-style":"padding: 0 !important; min-width: auto !important;text-align: left;",width:"auto",trigger:"hover"},{reference:n(()=>[t("i",{title:"更多",class:"fontsmart fs-more",style:ye({color:m(V)("--el-text-color-placeholder")})},null,4)]),default:n(()=>[t("ul",Zo,[m(ce)(f.permissionTypeNum)?(d(),C("li",{key:0,onClick:A(w=>h(w,f),["stop"])},Go,8,qo)):D("",!0),m(Q)(f.permissionTypeNum)?(d(),C("li",{key:1,onClick:A(w=>b(w,f),["stop"])},Xo,8,Qo)):D("",!0),m(Q)(f.permissionTypeNum)&&!f.externalScene?(d(),C("li",{key:2,onClick:A(w=>m(R)(w,f),["stop"])},tn,8,Yo)):D("",!0),f.externalScene?D("",!0):(d(),C("li",{key:3,onClick:A(w=>m(U)(w,f),["stop"])},ln,8,on)),f.status!==3?(d(),C("li",an,[a(we,{modelValue:f.portalShow,"onUpdate:modelValue":w=>f.portalShow=w,class:"display-setting",size:"small",title:"显隐设置",onChange:w=>ie(f)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):D("",!0),m(ce)(f.permissionTypeNum)?(d(),C("li",{key:5,onClick:A(w=>m(y)(w,f),["stop"])},cn,8,sn)):D("",!0)])]),_:2},1024)])])]),_:1},8,["data"])]),_:1})),[[Fe,e.isLoadingTableData]]):(d(),M(m(Te),{key:1},{default:n(()=>[a(Fo,{height:"100%",data:e.tableData,"is-loading-table-data":e.isLoadingTableData},{operate:n(({scene:f})=>[m(Q)(f.permissionTypeNum)?(d(),M(re,{key:0,link:"",type:"primary",onClick:A(w=>m(s)(w,f),["stop"])},{default:n(()=>[$(P(f.topOrder?"取消置顶":"点击置顶"),1)]),_:2},1032,["onClick"])):D("",!0),a(re,{link:"",type:"primary",onClick:A(w=>m(r)(w,f),["stop"])},{default:n(()=>[$("查看")]),_:2},1032,["onClick"]),m(Q)(f.permissionTypeNum)?(d(),M(re,{key:1,link:"",type:"primary",onClick:A(w=>m(p)(w,f),["stop"])},{default:n(()=>[$("编辑")]),_:2},1032,["onClick"])):D("",!0),a(xe,{width:"auto",placement:"top",trigger:"hover","popper-style":"padding: 8px 0;min-width:auto;text-align:left;"},{reference:n(()=>[a(re,{link:"",type:"primary"},{default:n(()=>[$("...")]),_:1})]),default:n(()=>[a(ze,{direction:"vertical",size:0,fill:""},{default:n(()=>[m(ce)(f.permissionTypeNum)?(d(),C("span",{key:0,class:"popper-btn",onClick:A(w=>h(w,f),["stop"])},"权限配置",8,dn)):D("",!0),m(Q)(f.permissionTypeNum)?(d(),C("span",{key:1,class:"popper-btn",onClick:A(w=>b(w,f),["stop"])}," 复制场景 ",8,pn)):D("",!0),m(Q)(f.permissionTypeNum)&&!f.externalScene?(d(),C("span",{key:2,class:"popper-btn",onClick:A(w=>m(R)(w,f),["stop"])}," 导出场景 ",8,un)):D("",!0),f.externalScene?D("",!0):(d(),C("span",{key:3,class:"popper-btn",onClick:A(w=>m(U)(w,f),["stop"])}," 分享 ",8,fn)),f.status!==3?(d(),C("div",_n,[a(je,{content:"显影设置",effect:"light"},{default:n(()=>[a(we,{modelValue:f.portalShow,"onUpdate:modelValue":w=>f.portalShow=w,size:"small",onChange:w=>ie(f)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)])):D("",!0),m(ce)(f.permissionTypeNum)?(d(),C("span",{key:5,class:"popper-btn",onClick:A(w=>m(y)(w,f),["stop"])}," 删除 ",8,mn)):D("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","is-loading-table-data"])]),_:1})),a(m(pe),{padding:"0 1 1",justify:"end"},{default:n(()=>[a(Oe,{ref:"paginationRef","current-page":e.currentPage,"onUpdate:currentPage":L[2]||(L[2]=f=>e.currentPage=f),"page-size":e.pageSize,"onUpdate:pageSize":L[3]||(L[3]=f=>e.pageSize=f),background:"",layout:"total, sizes, prev, pager, next, jumper","page-sizes":e.pageSizes,total:e.total,onSizeChange:_,onCurrentChange:c},null,8,["current-page","page-size","page-sizes","total"])]),_:1})]),_:1},512),e.createDialogVisible?(d(),M(lo,{key:0,"scene-no":e.externalSceneId,onClosed:L[4]||(L[4]=f=>e.createDialogVisible=!1),onDone:m(E)},null,8,["scene-no","onDone"])):D("",!0),a(vo,{visible:e.checkUserVisible,"auth-sence-id":e.authSenceId,onClosed:L[5]||(L[5]=f=>e.checkUserVisible=!1)},null,8,["visible","auth-sence-id"]),e.shareDialogVisible?(d(),M(Do,{key:1,info:e.shareInfo,onClosed:L[6]||(L[6]=f=>e.shareDialogVisible=!1)},null,8,["info"])):D("",!0)],64)}}});const xn=te(gn,[["__scopeId","data-v-f289be2d"]]);export{xn as default};
