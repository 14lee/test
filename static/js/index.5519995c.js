import{r as Te,S as Ue,N as We,d as Pe,p as Fe,b as I,bc as Ct,w as Oe,c as re,e as E,t as ze,o as g,x as V,k as n,f as R,j as l,l as D,F as ce,v as ne,g as a,A as Tt,z as Ve,ae as je,u as h,bq as tt,br as at,U as ae,y as $e,B as k,n as ue,aj as ee,ai as S,a4 as Dt,T as St,X as Le,bb as Lt,bs as xt,bo as Ge,bP as Ae,bJ as Nt,bQ as Rt,Z as $t,_ as Vt,L as rt,bR as ct,ad as xe,ak as te,bS as Et}from"./element-plus.59ccb443.js";import{r as Me,_ as It,u as dt,s as ut,P as pt,x as Xe,y as ft,z as mt,A as _t,v as Ye}from"./login.a4e9287e.js";import{q as B}from"./lodash.22f463b4.js";import{u as ht}from"./useTableAndPagination.0c6e0294.js";import{C as st,a as ot,T as Ot}from"./dataType.8bfa5e6a.js";import{u as gt,_ as Wt,W as Pt}from"./WorkerInfoDialog.898a9f84.js";import{h as Bt,f as Ft,S as Ut}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{_ as jt,a as At,b as zt,W as de}from"./jointPrepare.318e4ddb.js";import{i as Ie}from"./index-a95bb620.js";import{W as Mt}from"./WorkTypeForm.285ddc00.js";import{_ as Jt}from"./error.229cea25.js";import{_ as Ht}from"./BatchRerunDialog.vue_vue_type_style_index_0_lang.1fb4b07c.js";import"../../app-config.js";import"./serviceManage.8c46f250.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";function bt(A){return Me.doGetPromise("/algorithm/manager/worker/list",A)}function nt(A){return Me.doPostPromise("/algorithm/manager/worker/delete",{ids:A},{})}function lt(A){return Me.doGetPromise("/algorithm/manager/worker/cancelWork",{ids:A})}function qt(A){return Me.doGetPromise("/algorithm/manager/worker/node/list",{jobId:A})}const Qe=0,Ke=1,vt=2,Ze=-99,et=-1,qe={[Qe]:"已失效",[Ke]:"调度中",[Ze]:"已取消",[et]:"未启动"},it={[et]:"NOTINIT",[Qe]:"FINISH",[Ke]:"RUNNING",[vt]:"FAIL",[Ze]:"CANCEL"},Gt={[Qe]:"CircleCheck",[Ke]:"VideoPlay",[vt]:"CircleClose",[Ze]:"Remove",[et]:"Timer"};function yt(){const{getPriorityOptions:A,priorityFormatter:X,isRunning:z,statusFormatter:N,statusClass:M}=gt(),O=Te({priorityOptions:[],statusOptions:[]}),{priorityOptions:W,statusOptions:Q}=Ue(O),H=Te({searchOptions:[{label:"关键字",key:"keyword",type:"text",placeholder:"任务名称/方案名称/创建人",labelWidth:"0px",span:4},{label:"调度状态",key:"status",type:"select",options:Q,span:4,value:""},{label:"优先级",key:"priority",type:"select",options:W,span:4,value:""},{label:"创建时间",key:"time",type:"dateTimePicker",datePickerType:"datetimerange",span:6}],colDatas:[{prop:"name",label:"任务名称",minWidth:150,slot:"name",fixed:"left"},{prop:"taskName",label:"方案名称",minWidth:150,fixed:"left"},{prop:"status",label:"调度状态",minWidth:120,slot:"status",fixed:"left"},{prop:"priority",label:"实例优先级",minWidth:125,slot:"priority"},{prop:"recentWorkerStatus",label:"最近实例状态",minWidth:145,slot:"recent-worker-status"},{prop:"createTime",label:"创建时间",minWidth:180},{prop:"creator",label:"创建人",minWidth:120},{prop:"operator",label:"最后执行人",minWidth:120}]});function q({row:p,column:G}){if(G.property==="status")return`${it[p.status]} status-column`;if(G.property==="recentWorkerStatus")return`${M[p.recentWorkerStatus]} status-column`}function j(p){return qe[p]}function Y(){return Object.entries(qe).map(([p,G])=>({label:G,value:p}))}const F=async()=>{let p=A();p=p.map(G=>({value:G.code,label:G.showValue})),O.priorityOptions=[{label:"所有",value:""},...p]},U=async()=>{const p=Y();O.statusOptions=[{label:"所有",value:""},...p]},P=async()=>{F(),U()};We(async()=>{P()});function v(p){return Gt[p]}return{...Ue(H),getCellClassName:q,statusFormatter:j,priorityFormatter:X,isRunning:z,exampleStatusFormatter:N,status:qe,statusClass:it,statusIconFormatter:v}}const Xt={class:"run-task-dialog"},Yt={class:"item-wrap"},Qt=a("div",null,"启用后，新生成的周期实例将使用最新方案进行调度",-1),Kt={key:0,class:"item-wrap"},Zt={class:"item-wrap"},ea=a("span",null,null,-1),ta={class:"work-type-content"},aa={class:"run-task-dialog","element-loading-text":"正在获取运行参数..."},sa={key:0},oa={class:"sub-title"},na=a("span",{class:"text"},"参数赋值",-1),la=a("span",{class:"line"},[a("span")],-1),ia=["title"],ra=["title"],ca={key:1,class:"empty-content"},da={key:2},ua={class:"sub-title"},pa=a("span",{class:"text"},"变量赋值",-1),fa=a("span",{class:"line"},[a("span")],-1),ma=["title"],_a={key:0,class:"dialog-footer"},ha={key:1,class:"dialog-footer"},ga=Pe({__name:"RerunTaskDialog",props:{visible:{type:Boolean,default:!1},dagData:{default:()=>({})},workTypeParams:{default:()=>({type:"CYCLE"})},batchRunIds:{default:()=>[]}},emits:["update:visible","success"],setup(A,{emit:X}){const z=X,N=A;Fe("getCellData",ie),Fe("getControlInfo",le),Fe("getCustomVariableList",u);const M=I(),O=I([]),W=I(),Q=e=>{e&&O.value.every(i=>i.controlName!==e.controlName)&&O.value.push(e)};Ct(()=>{O.value=[]});const H=I(!1),q=I(!1),j=I(!1),Y=I(!0),F=I(!0),U=I(!1),P=I(1);Oe(()=>N.visible,e=>{H.value=e});const v=Te({editData:{useNewSchema:!1,nodesList:[],priority:2},publishConfigList:[],cellData:[],customVarList:[],curEditCustomVarList:[],srsOptions:[]}),p=re(()=>N.batchRunIds.length!==0),G=re(()=>{const e=B.get(N.dagData,"dag");return e?Ie(e)?B.cloneDeep(JSON.parse(e)):B.cloneDeep(e):{}}),pe=re(()=>{var e;return(e=G.value)==null?void 0:e.cells}),se=re(()=>{const e=B.get(N.dagData,"customVarList");return e?B.cloneDeep(e):[]});function u(){return v.customVarList||[]}function L(){P.value=1,v.editData={useNewSchema:!1,nodesList:[],priority:2},ue(()=>{var e;(e=M.value)==null||e.clearValidate(),v.cellData=B.cloneDeep(pe.value),v.customVarList=B.cloneDeep(se.value),f()}),we()}function K(){v.curEditCustomVarList=[],z("update:visible",!1)}function f(){ue(()=>{var e,i;p.value?(e=W.value)==null||e.init("CYCLE"):(i=W.value)==null||i.formatData(N.workTypeParams)})}function be(){var e;(e=W.value)==null||e.validData().then(i=>{i&&ve()})}function ve(){Y.value=!0,F.value=!0,v.editData.useNewSchema?de.getReplaceSchema(N.dagData.id).then(e=>{if(e.code==="0000"){const{newSchema:{cells:i=[]},userVars:_=[]}=e.data;v.cellData=B.cloneDeep(i),v.customVarList=B.cloneDeep(_),fe()}else ee({type:"error",message:"获取最新方案失败"})}).catch(()=>{ee({type:"error",message:"获取最新方案错误"})}):(v.cellData=B.cloneDeep(pe.value),v.customVarList=B.cloneDeep(se.value),fe())}function fe(){j.value=!0,v.publishConfigList=[],J(),v.curEditCustomVarList=B.cloneDeep(u()),v.curEditCustomVarList.forEach(e=>{const{type:i,value:_}=e;i==="NUMBER"&&(e.value=B.isNumber(_)?_:Number(_))}),U.value=v.curEditCustomVarList.filter(e=>e.published).length>0,P.value=2}function J(){if(!v.cellData)return ee({type:"warning",message:`该数据【${N.dagData.name}】没有关联正确的 dag 信息`});const e=v.cellData.filter(i=>i.type==="algorithm.Element"&&i.publishParamList&&i.publishParamList.length>0);if(e.length>0){const i=Array(e.length).fill(void 0);e.forEach((T,b)=>{i[b]=ye(T.version.id,T.id)}),Promise.all(i).then(T=>{T.some(b=>!b)?ee({type:"warning",message:"获取运行参数失败！请检查算法版本后重试"}):(j.value=!1,v.publishConfigList=B.cloneDeep(T),e.forEach(b=>{v.publishConfigList.forEach(o=>{o.uid===b.id&&(b.publishParamList.forEach(C=>{o.pubulishData[C]=b.data[C]}),o.name=b.name)})}),v.publishConfigList.forEach(b=>{b.paramsConfigList=b.paramsConfigList.filter(o=>b.pubulishData.hasOwnProperty(o.paramName)),b.relations=b.relations.filter(o=>b.pubulishData.hasOwnProperty(o.source)&&b.pubulishData.hasOwnProperty(o.target))}))})}else j.value=!1}function ye(e,i){return new Promise((_,T)=>{Bt.getAlgorithmDetailInfo(e).then(b=>{if(b.code==="0000"){const{data:o}=b,{name:C,paramsConfig:x}=o;if(Ie(x)){const oe=JSON.parse(x),ge={paramsConfigList:oe.config||[],relations:oe.relations||[],type:oe.type||"JOB",name:C,uid:i,pubulishData:{}};setTimeout(()=>{_(B.cloneDeep(ge))},100)}else _(!1)}else _(!1)}).catch(()=>{_(!1)})})}function De(e,i,_){const T=ie(_);T.data[i]=e,he(T)}function me(e,i,_){const T=ie(_);T.customVarEnums.forEach(b=>{b.key===i&&(b.isUsed=e)}),he(T)}function ke(e,i){v.curEditCustomVarList.forEach(_=>{_.name===i&&(_.value=e)})}function _e(e,i){v.curEditCustomVarList.forEach(_=>{_.name===i&&(_.value=JSON.stringify(e))})}function he(e){const{data:i={},requiredParamList:_=[],customVarEnums:T=[]}=e;let b=!0;for(let o=0,C=_.length;o<C;o++)if(i[_[o]]===void 0||i[_[o]]===null||i[_[o]]===""){const x=T.find(Z=>Z.key===_[o]);if(x){if(!x.isUsed){b=!1;break}}else{b=!1;break}}e.isPassValid=b}function we(){Ft.getSrsList().then(e=>{e.code==="0000"?v.srsOptions=e.data:(v.srsOptions=[],ee({type:"error",message:"获取坐标系统失败"}))}).catch(()=>{v.srsOptions=[],ee({type:"error",message:"获取坐标系统错误"})})}function Se(e,i){const _=O.value.find(T=>T.controlName===e&&T.uid===i);return _||null}function le(e,i){const _=Se(e,i);return _?_.allParam:null}function ie(e){return v.cellData.find(i=>i.id===e)}function m(){const e=B.cloneDeep(v.cellData);return new Promise((i,_)=>{let T=!0;for(let b=0,o=e.length;b<o;b++){const C=e[b];if(C.type==="algorithm.Element"&&(C.isError||!C.isPassValid)){T=!1;break}}i(!!T)})}function d(){const e=B.cloneDeep(v.curEditCustomVarList);return new Promise((i,_)=>{let T=!0;for(let b=0,o=e.length;b<o;b++){const C=e[b];if(C.value!==0&&!C.value){T=!1;break}}i(!!T)})}function t(){c()}function c(){var e,i;if(p.value)(e=W.value)==null||e.validData().then(_=>{if(_){const{workType:T,formData:b}=_,{expression:o,autoDependence:C,cancelWhenFailed:x,effectStartTime:Z,effectEndTime:oe}=b,ge=N.batchRunIds.map(Ee=>{const Re={id:Ee,useNewSchema:v.editData.useNewSchema,priority:v.editData.priority,workType:T,expression:o,autoDependence:C,cancelWhenFailed:x,effectStartTime:Z};return oe&&(Re.effectEndTime=oe),Re});w(ge)}});else{const _=m(),T=d(),b=(i=W.value)==null?void 0:i.validData();Promise.all([_,T,b]).then(([C,x,Z])=>{if((!C||!x)&&ee({type:"warning",message:`请正确填写 ${C?"":"【参数赋值】"}  ${x?"":"【变量赋值】"}`}),C&&x){const{workType:oe,formData:ge}=Z,{expression:Ee,autoDependence:Re,cancelWhenFailed:Je,effectStartTime:Ce,effectEndTime:Be}=ge,He={cells:B.cloneDeep(v.cellData)},y={id:N.dagData.id,dag:JSON.stringify(He),customVarList:B.cloneDeep(v.curEditCustomVarList),useNewSchema:v.editData.useNewSchema,workType:oe,expression:Ee,autoDependence:Re,cancelWhenFailed:Je,effectStartTime:Ce};Be&&(y.effectEndTime=Be),w([y])}})}}function w(e){q.value=!0,de.rerunWorker(e).then(i=>{i.code==="0000"?(S({type:"success",title:"重新运行成功"}),z("success"),K()):S({type:"warning",title:"重新运行失败，请重试"})}).catch(i=>{S({type:"error",title:"重新运行错误",message:i.message||"服务有错"})}).finally(()=>{q.value=!1})}function r(){}Fe("getCellById",s);function s(e){var _;const i=(_=v.cellData)==null?void 0:_.find(T=>T.id===e);return i?{attributes:i}:{}}return(e,i)=>{const _=E("el-checkbox"),T=E("QuestionFilled"),b=E("el-icon"),o=E("el-tooltip"),C=E("el-form-item"),x=E("el-radio"),Z=E("el-radio-group"),oe=E("el-form"),ge=E("el-input"),Ee=E("el-input-number"),Re=E("el-option"),Je=E("el-select"),Ce=E("el-button"),Be=E("el-dialog"),He=ze("loading");return g(),V(Be,{modelValue:H.value,"onUpdate:modelValue":i[7]||(i[7]=y=>H.value=y),class:"task-dialog",title:p.value?"批量重新运行":"重新运行任务","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,top:"8vh",width:"540px",onOpen:L,onClosed:K},{footer:n(()=>[p.value?(g(),R("span",_a,[l(Ce,{disabled:j.value,onClick:i[4]||(i[4]=y=>H.value=!1)},{default:n(()=>[D("取 消")]),_:1},8,["disabled"]),l(Ce,{type:"primary",loading:q.value,disabled:j.value,onClick:t},{default:n(()=>[D(" 确 定 ")]),_:1},8,["loading","disabled"])])):(g(),R("span",ha,[l(Ce,{disabled:j.value,onClick:i[5]||(i[5]=y=>H.value=!1)},{default:n(()=>[D("取 消")]),_:1},8,["disabled"]),P.value===1?(g(),V(Ce,{key:0,type:"primary",onClick:be},{default:n(()=>[D(" 下一步 ")]),_:1})):(g(),R(ce,{key:1},[l(Ce,{type:"primary",plain:"",onClick:i[6]||(i[6]=y=>P.value=1)},{default:n(()=>[D(" 上一步 ")]),_:1}),l(Ce,{type:"primary",loading:q.value,disabled:j.value,onClick:t},{default:n(()=>[D(" 确 定 ")]),_:1},8,["loading","disabled"])],64))]))]),default:n(()=>[ne(a("div",Xt,[l(oe,{ref_key:"editFormRef",ref:M,class:"edit-form",inline:"",model:v.editData,"label-width":"150px","label-position":"right",onKeyup:Tt(t,["enter"])},{default:n(()=>[a("div",Yt,[l(C,{label:"使用最新方案：",prop:"useNewSchema"},{default:n(()=>[l(_,{modelValue:v.editData.useNewSchema,"onUpdate:modelValue":i[0]||(i[0]=y=>v.editData.useNewSchema=y),disabled:p.value?!1:!e.dagData.taskId,onChange:r},null,8,["modelValue","disabled"]),l(o,{class:"item",effect:"dark",placement:"top"},{content:n(()=>[Qt]),default:n(()=>[l(b,{style:{"margin-left":"12px"}},{default:n(()=>[l(T)]),_:1})]),_:1})]),_:1})]),p.value?(g(),R("div",Kt,[l(C,{label:"任务优先级：",prop:"priority"},{default:n(()=>[l(Z,{modelValue:v.editData.priority,"onUpdate:modelValue":i[1]||(i[1]=y=>v.editData.priority=y)},{default:n(()=>[l(x,{label:2},{default:n(()=>[D("高")]),_:1}),l(x,{label:1},{default:n(()=>[D("中")]),_:1}),l(x,{label:0},{default:n(()=>[D("低")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):Ve("",!0),a("div",Zt,[l(C,{label:"任务调度属性："},{default:n(()=>[ea]),_:1})]),a("div",ta,[l(Mt,{ref_key:"workTypeFormRef",ref:W,"hide-type":""},null,512)])]),_:1},8,["model"])],512),[[je,P.value===1]]),ne((g(),R("div",aa,[v.publishConfigList.length>0?(g(),R("div",sa,[a("div",oa,[na,a("span",{class:"icon",onClick:i[2]||(i[2]=y=>Y.value=!Y.value)},[Y.value?(g(),V(b,{key:0},{default:n(()=>[l(h(tt))]),_:1})):(g(),V(b,{key:1},{default:n(()=>[l(h(at))]),_:1}))]),la]),a("div",{class:ae(["publish-main-box",Y.value?"height-full":"height-none"])},[(g(!0),R(ce,null,$e(v.publishConfigList,y=>(g(),R("div",{key:y.uid,class:"publish-form-box"},[a("div",{class:"p-title",title:y.name},k(y.name),9,ia),l(oe,{class:"publish-params-form",inline:"",model:y.pubulishData,"label-width":"100px","label-position":"right"},{default:n(()=>[(g(!0),R(ce,null,$e(y.paramsConfigList,($,kt)=>(g(),R("div",{key:$.paramName,class:"item-wrap"},[(g(),V(C,{key:$.paramName+kt,prop:$.paramName,"label-width":$.controlType==="CHECK_BOX_XX"?"":"150px"},{label:n(()=>[a("span",{class:ae({labelBox:!0,isRequired:$.required}),title:$.paramLabel},k($.paramLabel+"："),11,ra)]),default:n(()=>[l(jt,{ref_for:!0,ref:Q,modelValue:y.pubulishData[$.paramName],"onUpdate:modelValue":wt=>y.pubulishData[$.paramName]=wt,"control-name":$.paramName,uid:y.uid,type:y.type,"all-param":$,relations:y.relations,onChange:De,onChangeCustomVar:me},null,8,["modelValue","onUpdate:modelValue","control-name","uid","type","all-param","relations"])]),_:2},1032,["prop","label-width"]))]))),128))]),_:2},1032,["model"])]))),128))],2)])):(g(),R("div",ca,"未设置发布参数")),U.value?(g(),R("div",da,[a("div",ua,[pa,a("span",{class:"icon",onClick:i[3]||(i[3]=y=>F.value=!F.value)},[F.value?(g(),V(b,{key:0},{default:n(()=>[l(h(tt))]),_:1})):(g(),V(b,{key:1},{default:n(()=>[l(h(at))]),_:1}))]),fa]),a("div",{class:ae(["custom-var-main-box",F.value?"height-full":"height-none"])},[l(oe,{class:"publish-params-form",inline:"","label-width":"100px","label-position":"right"},{default:n(()=>[(g(!0),R(ce,null,$e(v.curEditCustomVarList,y=>(g(),R(ce,null,[y.published?(g(),R("div",{key:y.id,class:"item-wrap"},[l(C,{"label-width":"150px"},{label:n(()=>[a("span",{class:ae({labelBox:!0,isRequired:!0}),title:y.alisaName||y.name},k((y.alisaName||y.name)+"："),9,ma)]),default:n(()=>[y.type==="TEXT"?(g(),V(ge,{key:0,modelValue:y.value,"onUpdate:modelValue":$=>y.value=$,type:"text",placeholder:"请输入变量值"},null,8,["modelValue","onUpdate:modelValue"])):y.type==="NUMBER"?(g(),V(Ee,{key:1,modelValue:y.value,"onUpdate:modelValue":$=>y.value=$,style:{width:"100%"},"controls-position":"right",placeholder:"请输入数值"},null,8,["modelValue","onUpdate:modelValue"])):y.type==="SQL"||y.type==="REGULAR"?(g(),V(ge,{key:2,modelValue:y.value,"onUpdate:modelValue":$=>y.value=$,type:"textarea",style:{width:"100%"},placeholder:"请输入",rows:4},null,8,["modelValue","onUpdate:modelValue"])):y.type==="SRS"?(g(),V(Je,{key:3,modelValue:y.value,"onUpdate:modelValue":$=>y.value=$,style:{width:"100%"},filterable:"","allow-create":"",placeholder:"请输入或选择坐标系统"},{default:n(()=>[(g(!0),R(ce,null,$e(v.srsOptions,$=>(g(),V(Re,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):y.type==="DATASOURCE"?(g(),V(At,{key:4,modelValue:y.value,"onUpdate:modelValue":$=>y.value=$,"control-name":y.name,onChange:ke},null,8,["modelValue","onUpdate:modelValue","control-name"])):y.type==="TEMPLATE"?(g(),V(zt,{key:5,modelValue:y.value,"onUpdate:modelValue":$=>y.value=$,"control-name":y.name,onChange:_e},null,8,["modelValue","onUpdate:modelValue","control-name"])):(g(),V(ge,{key:6,modelValue:y.value,"onUpdate:modelValue":$=>y.value=$,type:"text"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)])):Ve("",!0)],64))),256))]),_:1})],2)])):Ve("",!0)])),[[je,P.value===2],[He,j.value]])]),_:1},8,["modelValue","title"])}}});const Ne=A=>($t("data-v-f25829d8"),A=A(),Vt(),A),ba={class:"main-content"},va={class:"header"},ya={class:"left"},ka={class:"scheme-name"},wa={class:"scheme-status"},Ca={class:"right"},Ta={class:"display-container"},Da={id:"scheme-container",class:"scheme-container"},Sa={class:"status-des"},La={class:"txt"},xa={class:"dag-container"},Na={key:0,class:"job info"},Ra={class:"tab-container"},$a={class:"content"},Va={class:"title"},Ea={class:"name"},Ia={key:0,class:"info-box"},Oa={class:"item-wrap"},Wa={class:"value"},Pa={class:"item-wrap"},Ba={class:"value"},Fa={class:"item-wrap"},Ua={class:"value"},ja={class:"item-wrap"},Aa={class:"value"},za={class:"item-wrap"},Ma={class:"value"},Ja={key:1,class:"info-box"},Ha={class:"item-wrap"},qa={class:"value"},Ga={class:"item-wrap"},Xa={class:"value"},Ya={class:"item-wrap"},Qa={class:"form-part-container"},Ka=Ne(()=>a("div",{class:"subTitle"},[a("div",{class:"text"},"时间属性")],-1)),Za={class:"expand-content"},es={class:"item-wrap"},ts={class:"value"},as=Ne(()=>a("br",null,null,-1)),ss=Ne(()=>a("br",null,null,-1)),os={class:"item-wrap"},ns={class:"value"},ls={class:"form-part-container"},is=Ne(()=>a("div",{class:"subTitle"},[a("div",{class:"text"},"基本信息")],-1)),rs={class:"expand-content"},cs={class:"item-wrap"},ds={class:"value"},us={class:"item-wrap"},ps={class:"value"},fs={class:"item-wrap"},ms={class:"value"},_s={class:"item-wrap"},hs={class:"value"},gs={class:"item-wrap"},bs={class:"value"},vs={class:"item-wrap"},ys={class:"value"},ks={key:1,class:"node info"},ws={class:"tab-container"},Cs={class:"title"},Ts={class:"name"},Ds={class:"info-box"},Ss={class:"item-wrap"},Ls={class:"value"},xs={class:"item-wrap"},Ns={class:"value"},Rs={class:"item-wrap"},$s={class:"value"},Vs={class:"item-wrap"},Es={class:"value"},Is={class:"item-wrap"},Os={class:"value"},Ws={key:0,class:"item-wrap"},Ps={class:"value operator"},Bs={key:1,class:"log-content"},Fs=Ne(()=>a("p",{class:"showLogBox log"},null,-1)),Us=[Fs],js={class:"info-box"},As={class:"item-wrap"},zs={class:"value"},Ms={class:"item-wrap"},Js={class:"value"},Hs={class:"form-part-container"},qs=Ne(()=>a("div",{class:"subTitle"},[a("div",{class:"text"},"算法参数")],-1)),Gs={class:"expand-content"},Xs={class:"param-label"},Ys={class:"param-value"},Qs={class:"form-part-container"},Ks=Ne(()=>a("div",{class:"subTitle"},[a("div",{class:"text"},"高级属性")],-1)),Zs={class:"expand-content"},eo={class:"item-wrap"},to={class:"value"},ao={class:"dialog-footer"},so=Pe({__name:"TaskInfoDialog",props:{visible:{type:Boolean,default:!1},curEditData:{default:()=>({})},domId:{default:""}},emits:["update:visible","refresh","rerun","cancel","delete","refreshList"],setup(A,{emit:X}){const z=X,N=A,{isRunning:M,statusFormatter:O,statusIconFormatter:W,priorityFormatter:Q,status:H,statusClass:q}=yt();We(()=>{It(()=>import("./jointPlug.cfec54db.js"),["./jointPlug.cfec54db.js","./jointPrepare.318e4ddb.js","./element-plus.59ccb443.js","./lodash.22f463b4.js","../css/element-plus-a5bc9350.css","./login.a4e9287e.js","./error.229cea25.js","../css/error-ab7d0c80.css","../../app-config.js","../css/login-8a4effaf.css","./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js","./index-a95bb620.js","./echarts.39e3cf74.js","./wujie-vue3.9ecbe737.js","./smartweb3.2d5e4c59.js","../css/smartweb3-f9bf067f.css","./smart-ui.e8e0134c.js","../css/smart-ui-6d875ea0.css","../css/index-fc6a8528.css","../css/index-05133815.css","./useTableAndPagination.0c6e0294.js","../css/jointPrepare-41e4096f.css"],import.meta.url).then(()=>{ue(()=>{J()})})});const j=I(!1),Y=I(!1),F=I(!1),U=I(!0),P=I(!1),v=I(null),p=Te({scheme:{},currentNodeInfo:{},paramsArray:[],curClickId:"",activeSchemeName:"prop",activeNodeName:"prop"}),G=I(),pe=I(),se=I(),u=Dt({paper:null,graph:null}),L=re(()=>{var t;return((t=N.curEditData)==null?void 0:t.jobInfo)||{}}),K=re(()=>{var t;return we((t=p.currentNodeInfo)==null?void 0:t.id)}),f=re(()=>{var t;return((t=K.value)==null?void 0:t.name)||""}),be=re(()=>{var t,c;return((c=(t=K.value)==null?void 0:t.version)==null?void 0:c.label)||""}),ve=re(()=>{var c;const t=((c=K.value)==null?void 0:c.timeout)??0;return t===0?"无限制":`${t}小时`}),fe=re(()=>{const{beginTime:t,endTime:c}=p.currentNodeInfo;return t&&c?ie(c,t):""});Oe(()=>N.visible,t=>{j.value=t}),Oe(()=>N.curEditData,t=>{var c,w;if(t&&Ie((c=t==null?void 0:t.jobInfo)==null?void 0:c.scheme)){const s=B.cloneDeep(JSON.parse(t.jobInfo.scheme)).cells.filter(e=>e.type==="algorithm.Element");ke(s,(w=t==null?void 0:t.jobInfo)==null?void 0:w.status)}},{deep:!0}),St(()=>{clearInterval(v.value),v.value=null});function J(){u.graph=new window.joint.dia.Graph,u.paper=new window.joint.dia.Paper({el:G.value,model:u.graph,width:"100%",height:"100%",gridSize:10,defaultLink:new window.joint.shapes.app.Link,interactive:!1,async:!0,sorting:window.joint.dia.Paper.sorting.APPROX}),u.paper.on("blank:pointerup",(t,c,w)=>{if(U.value=!0,p.curClickId!==""){const r=u.graph.getCell(p.curClickId);u.paper.findViewByModel(r).removeTools()}p.curClickId=""}),u.paper.on("cell:pointerup",(t,c,w)=>{const r=t.model;if(r.isElement()){if(p.curClickId!==r.id){if(p.curClickId!==""){const s=u.graph.getCell(p.curClickId);u.paper.findViewByModel(s).removeTools()}p.curClickId=r.id,p.activeNodeName="prop",ye(t)}else return;U.value=!1,P.value=!0,de.getWorkerNodeInfo({id:r.id,jobId:L.value.id}).then(s=>{var e;s.code==="0000"?(p.currentNodeInfo=s.data,_e(),(e=p.currentNodeInfo)!=null&&e.log&&he()):S({type:"warning",title:"查询详情失败，请重试"})}).catch(s=>{S({type:"error",title:"查询详情失败",message:s.message||"服务有错"})}).finally(()=>{P.value=!1})}}),u.paper.on("cell:mouseover",t=>{t.model.isElement()&&t.$box[0].querySelector(".name").classList.add("show")}),u.paper.on("cell:mouseout",t=>{t.model.isElement()&&t.$box[0].querySelector(".name").classList.remove("show")})}function ye(t){const c=window.joint.elementTools,w=new window.joint.dia.ToolsView({name:"element-pointerdown",tools:[new c.Boundary({padding:5})]});t.addTools(w)}function De(){P.value=!0,de.getWorkerNodeInfo({id:p.curClickId,jobId:L.value.id}).then(t=>{var c;t.code==="0000"&&(p.currentNodeInfo=t.data,_e(),(c=p.currentNodeInfo)!=null&&c.log&&he())}).finally(()=>{P.value=!1})}function me(){var t,c,w,r;if(u.graph.clear(),Ie((c=(t=N.curEditData)==null?void 0:t.jobInfo)==null?void 0:c.scheme)){p.scheme=JSON.parse(N.curEditData.jobInfo.scheme);const s=B.cloneDeep(p.scheme);u.graph.fromJSON(s),Y.value=!1;const e=s.cells.filter(i=>i.type==="algorithm.Element");ke(e,(r=(w=N.curEditData)==null?void 0:w.jobInfo)==null?void 0:r.status)}}function ke(t,c){const w={isCancelled:!1,isRunning:!1,isSuccess:!1,isWaiting:!1};t.forEach(r=>{const s=u.graph.getCell(r.id);if(s){let e=B.cloneDeep(w);c===-1?e={...e,isCancelled:!0}:c===1?e={...e,isRunning:!0}:c===0?e={...e,isSuccess:!0}:c===-99&&(e={...e,isWaiting:!0}),s.prop("testStatus",e)}})}function _e(){const{paramsConfig:t}=p.currentNodeInfo,c=JSON.parse(t).config,{data:w}=K.value;p.paramsArray=c.map(r=>{const{paramLabel:s,paramName:e,controlType:i,paramTypeEnums:_}=r;let T=w[e];if(i==="SELECT_TREE"&&_==="TEMPLATE"&&Ie(T)){const b=JSON.parse(T);T=b==null?void 0:b.name}return{label:s,value:T}}),U.value=!1}function he(){const{log:t}=p.currentNodeInfo;ue(()=>{var w;const c=(w=pe.value)==null?void 0:w.querySelector(".showLogBox");c&&(c.innerText=t)})}function we(t){return p.scheme.cells.find(c=>c.id===t)}function Se(){v.value=null,U.value=!0,p.activeSchemeName="prop",p.activeNodeName="prop",p.curClickId="",J(),me()}function le(){var t,c,w;clearInterval(v.value),v.value=null,(c=(t=u.graph)==null?void 0:t.clear)==null||c.call(t),(w=u.paper)==null||w.removeTools(),z("update:visible",!1),z("refreshList")}function ie(t,c){const i=new Date(t).getTime()-new Date(c).getTime(),_=Math.floor(i/864e5),T=i%864e5,b=Math.floor(T/36e5),o=T%36e5,C=Math.floor(o/6e4),x=o%6e4,Z=Math.round(x/1e3);return`${_?`${_}天`:""}${b?`${b}时`:""}${C?`${C}分`:""}${Z}秒`}function m(){const{log:t}=p.currentNodeInfo;ue(()=>{se.value&&(se.value.innerText=t)})}function d(){const{id:t}=p.currentNodeInfo,{id:c}=L.value;de.logDownload({nodeId:t,jobId:c}).then(w=>{var r;try{const s=new Blob([w.data.data],{type:"application/octet-stream"});if("download"in document.createElement("a")){const e=document.createElement("a");e.download=`${K.value.name}.txt`,e.style.display="none",e.href=URL.createObjectURL(s),document.body.appendChild(e),e.click(),URL.revokeObjectURL(e.href),document.body.removeChild(e)}else(r=window.navigator)==null||r.msSaveBlob(s,`${K.value.name}.txt`)}catch(s){S({type:"error",title:"下载日志失败",message:s.message||"服务有错"})}}).catch(w=>{S({type:"error",title:"下载日志失败",message:w.message||"服务有错"})})}return(t,c)=>{const w=E("ArrowLeftBold"),r=E("el-icon"),s=E("el-button"),e=E("el-form-item"),i=E("el-form"),_=E("el-checkbox"),T=E("el-dialog"),b=ze("loading");return g(),V(h(Ut),{id:"worker-scheme-dialog",modelValue:j.value,"onUpdate:modelValue":c[10]||(c[10]=o=>j.value=o),class:"full-dialog","append-to-dom":t.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:Se,onClosed:le},{default:n(()=>[a("div",ba,[a("div",va,[a("div",ya,[a("div",{class:"back-icon",onClick:le},[l(r,null,{default:n(()=>[l(w)]),_:1})]),a("div",ka,k(L.value.name),1),a("div",wa,[l(r,{class:ae([h(q)[L.value.status]])},{default:n(()=>[(g(),V(Le(h(W)(L.value.status))))]),_:1},8,["class"]),D(" "+k(h(O)(L.value.status)),1)])]),a("div",Ca,[l(s,{type:"primary",text:"",icon:h(Lt),disabled:h(M)(L.value.status),onClick:c[0]||(c[0]=o=>z("rerun"))},{default:n(()=>[D(" 重新运行 ")]),_:1},8,["icon","disabled"]),l(s,{type:"primary",text:"",icon:h(xt),disabled:L.value.status===-99||L.value.status===0,onClick:c[1]||(c[1]=o=>z("cancel"))},{default:n(()=>[D(" 取消 ")]),_:1},8,["icon","disabled"]),l(s,{type:"primary",text:"",icon:h(Ge),onClick:c[2]||(c[2]=o=>z("delete"))},{default:n(()=>[D(" 删除 ")]),_:1},8,["icon"])])]),a("div",Ta,[ne((g(),R("div",Da,[a("div",Sa,[(g(!0),R(ce,null,$e(h(H),(o,C)=>(g(),R("div",{key:C,class:"list"},[a("span",{class:ae(["point",h(q)[C]])},null,2),a("span",La,k(o),1)]))),128))]),a("div",xa,[a("div",{id:"dagCanvas",ref_key:"canvas",ref:G,class:"canvas view-dag"},null,512)])])),[[b,Y.value]]),U.value?(g(),R("div",Na,[a("div",Ra,[a("div",{class:ae(["tabName",p.activeSchemeName==="prop"?"active":""]),onClick:c[3]||(c[3]=o=>p.activeSchemeName="prop")}," 任务详情 ",2)]),a("div",$a,[a("div",Va,[a("div",Ea,k(p.activeSchemeName==="log"?"任务日志":"任务详情"),1),l(s,{type:"primary",text:"",icon:h(Ae),onClick:c[4]||(c[4]=o=>z("refresh"))},{default:n(()=>[D(" 刷新 ")]),_:1},8,["icon"])]),p.activeSchemeName==="log"?(g(),R("div",Ia,[l(i,{ref:"infoForm",class:"task-info-form",inline:"","label-width":"90px","label-position":"left"},{default:n(()=>[a("div",Oa,[l(e,{label:"创建时间："},{default:n(()=>{var o;return[a("span",Wa,k((o=L.value)==null?void 0:o.createTime),1)]}),_:1})]),a("div",Pa,[l(e,{label:"开始时间："},{default:n(()=>{var o;return[a("span",Ba,k((o=L.value)==null?void 0:o.beginTime),1)]}),_:1})]),a("div",Fa,[l(e,{label:"结束时间："},{default:n(()=>{var o;return[a("span",Ua,k((o=L.value)==null?void 0:o.endTime),1)]}),_:1})]),a("div",ja,[l(e,{label:"运行时长："},{default:n(()=>{var o;return[a("span",Aa,k((o=L.value)==null?void 0:o.cumulativeTime),1)]}),_:1})]),a("div",za,[l(e,{label:"执行人："},{default:n(()=>{var o;return[a("span",Ma,k((o=L.value)==null?void 0:o.operator),1)]}),_:1})])]),_:1},512)])):(g(),R("div",Ja,[l(i,{ref:"infoForm",class:"task-info-form",inline:"","label-width":"90px","label-position":"left"},{default:n(()=>[a("div",Ha,[l(e,{label:"任务名称："},{default:n(()=>{var o;return[a("span",qa,k((o=L.value)==null?void 0:o.name),1)]}),_:1})]),a("div",Ga,[l(e,{label:"优先级："},{default:n(()=>{var o;return[a("span",Xa,k(h(Q)((o=L.value)==null?void 0:o.priority)),1)]}),_:1})]),a("div",Ya,[l(e,{class:"clearData-item",label:"删除过程数据："},{default:n(()=>[l(_,{modelValue:L.value.clearData,"onUpdate:modelValue":c[5]||(c[5]=o=>L.value.clearData=o),disabled:""},null,8,["modelValue"])]),_:1})]),a("div",Qa,[Ka,a("div",Za,[a("div",es,[l(e,{label:"生效时间："},{default:n(()=>{var o,C;return[a("span",ts,[D(k((o=L.value)==null?void 0:o.effectStartTime),1),as,D(" ~"),ss,D(" "+k(((C=L.value)==null?void 0:C.effectEndTime)||"持续生效"),1)])]}),_:1})]),a("div",os,[l(e,{label:"表达式："},{default:n(()=>{var o;return[a("span",ns,k((o=L.value)==null?void 0:o.expression),1)]}),_:1})])])]),a("div",ls,[is,a("div",rs,[a("div",cs,[l(e,{label:"方案名称："},{default:n(()=>{var o;return[a("span",ds,k((o=L.value)==null?void 0:o.taskName),1)]}),_:1})]),a("div",us,[l(e,{label:"方案分组："},{default:n(()=>{var o;return[a("span",ps,k((o=L.value)==null?void 0:o.taskCatalog),1)]}),_:1})]),a("div",fs,[l(e,{label:"描述："},{default:n(()=>{var o;return[a("span",ms,k(((o=L.value)==null?void 0:o.description)||"未描述"),1)]}),_:1})]),a("div",_s,[l(e,{label:"创建人："},{default:n(()=>{var o;return[a("span",hs,k((o=L.value)==null?void 0:o.creator),1)]}),_:1})]),a("div",gs,[l(e,{label:"创建时间："},{default:n(()=>{var o;return[a("span",bs,k((o=L.value)==null?void 0:o.createTime),1)]}),_:1})]),a("div",vs,[l(e,{label:"更新时间："},{default:n(()=>{var o;return[a("span",ys,k((o=L.value)==null?void 0:o.updateTime),1)]}),_:1})])])])]),_:1},512)]))])])):(g(),R("div",ks,[a("div",ws,[a("div",{class:ae(["tabName",p.activeNodeName==="prop"?"active":""]),onClick:c[6]||(c[6]=o=>p.activeNodeName="prop")}," 节点属性 ",2)]),ne((g(),R("div",{ref_key:"contentRef",ref:pe,class:"content"},[a("div",Cs,[a("div",Ts,k(p.activeNodeName==="log"?"节点日志":"节点属性"),1),l(s,{type:"primary",text:"",icon:h(Ae),onClick:De},{default:n(()=>[D(" 刷新 ")]),_:1},8,["icon"])]),ne(a("div",Ds,[l(i,{ref:"logForm",class:"task-log-form",inline:"","label-width":"90px","label-position":"left"},{default:n(()=>{var o,C;return[a("div",Ss,[l(e,{label:"节点状态："},{default:n(()=>{var x;return[a("span",Ls,k(h(O)((x=p.currentNodeInfo)==null?void 0:x.status)),1)]}),_:1})]),a("div",xs,[l(e,{label:"开始时间："},{default:n(()=>{var x;return[a("span",Ns,k((x=p.currentNodeInfo)==null?void 0:x.beginTime),1)]}),_:1})]),a("div",Rs,[l(e,{label:"结束时间："},{default:n(()=>{var x;return[a("span",$s,k((x=p.currentNodeInfo)==null?void 0:x.endTime),1)]}),_:1})]),a("div",Vs,[l(e,{label:"运行时长："},{default:n(()=>[a("span",Es,k(fe.value),1)]),_:1})]),a("div",Is,[l(e,{label:"失败重试："},{default:n(()=>{var x;return[a("span",Os,k(((x=p.currentNodeInfo)==null?void 0:x.restartTimes)||"--")+"次",1)]}),_:1})]),(o=p.currentNodeInfo)!=null&&o.log?(g(),R("div",Ws,[l(e,{label:"任务日志："},{default:n(()=>[a("span",Ps,[a("span",{title:"弹窗查看",onClick:c[7]||(c[7]=x=>F.value=!0)},[l(r,null,{default:n(()=>[l(h(Nt))]),_:1})]),a("span",{title:"下载日志",onClick:d},[l(r,null,{default:n(()=>[l(h(Rt))]),_:1})])])]),_:1})])):Ve("",!0),(C=p.currentNodeInfo)!=null&&C.log?(g(),R("div",Bs,Us)):Ve("",!0)]}),_:1},512)],512),[[je,p.activeNodeName==="log"]]),ne(a("div",js,[l(i,{ref:"paramsForm",class:"task-params-form",inline:"","label-width":"90px","label-position":"left"},{default:n(()=>[a("div",As,[l(e,{label:"算法名称："},{default:n(()=>[a("span",zs,k(f.value),1)]),_:1})]),a("div",Ms,[l(e,{label:"算法版本："},{default:n(()=>[a("span",Js,k(be.value),1)]),_:1})]),a("div",Hs,[qs,a("div",Gs,[(g(!0),R(ce,null,$e(p.paramsArray,(o,C)=>(g(),R("div",{key:o.label+C,class:"item-wrap custom-form-item"},[a("div",Xs,k(o.label+"："),1),a("div",Ys,k(o.value),1)]))),128))])]),a("div",Qs,[Ks,a("div",Zs,[a("div",eo,[l(e,{label:"节点超时："},{default:n(()=>[a("span",to,k(ve.value),1)]),_:1})])])])]),_:1},512)],512),[[je,p.activeNodeName==="prop"]])])),[[b,P.value]])]))])]),l(T,{ref:"logDialogRef",modelValue:F.value,"onUpdate:modelValue":c[9]||(c[9]=o=>F.value=o),title:"任务日志",class:"center-dialog log-read-dialog","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"50%",onOpen:m},{footer:n(()=>[a("span",ao,[l(s,{onClick:c[8]||(c[8]=o=>F.value=!1)},{default:n(()=>[D("关闭")]),_:1}),l(s,{type:"primary",onClick:d},{default:n(()=>[D("下载")]),_:1})])]),default:n(()=>[a("p",{ref_key:"logTextRef",ref:se,class:"log-txt"},k(p.currentNodeInfo.log),513)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","append-to-dom"])}}});const oo=Jt(so,[["__scopeId","data-v-f25829d8"]]),no={class:"expand-content-box"},lo={class:"common status-box"},io=a("div",{class:"label"},"任务实例：",-1),ro={class:"example-status RUNNING",title:"运行中"},co={class:"example-status NOTINIT",title:"等待中"},uo={class:"example-status FINISH",title:"成功"},po={class:"example-status FAIL",title:"失败"},fo={class:"example-status CANCEL",title:"已取消"},mo={class:"expand-content-box"},_o={class:"common status-box"},ho=a("div",{class:"label"},"生效时间：",-1),go={class:"example-value"},bo=a("div",{class:"label"},"表达式：",-1),vo={class:"example-value"},yo={class:"status-box"},ko=a("span",{class:"point"},null,-1),wo={key:0,class:"point common-point"},Co=Pe({__name:"index",emits:["handleSearchExample"],setup(A,{expose:X,emit:z}){const N=z,M=I(),O=I(),W=I(),{searchOptions:Q,getCellClassName:H,colDatas:q,statusFormatter:j,priorityFormatter:Y,isRunning:F,exampleStatusFormatter:U}=yt(),P=dt(),{userInfo:v}=ut(P),{currentPage:p,pageSize:G,pageSizes:pe,total:se,handleSizeChange:u,handleCurrentPageChange:L,resize:K}=ht(M,O,J,void 0,w),f=Te({domId:"cycle-task-container",isLoadingTable:!1,tableData:[],form:{keyword:"",status:"",priority:"",time:[]},priorityOptions:[],statusOptions:[],dialogVisible:!1,curEditData:{},selection:[],currentRow:null,runTaskDialogVisible:!1,taskData:{},batchRunDialogVisible:!1,batchRunIds:[],websocket:null});Oe(()=>v.value.id,r=>{var s;r?c():window.WebSocket&&((s=f.websocket)==null||s.close())});const be=I({type:"CYCLE"});We(()=>{ue(()=>{J(),c()})}),rt(()=>{var r;window.WebSocket&&((r=f.websocket)==null||r.close())});function ve(r){p.value=1,J(),w()}function fe(){var e;const r=(e=W.value)==null?void 0:e.getForm(),s={page:p.value,rows:G.value,workType:st,...r};return r!=null&&r.time&&([s.beginTime,s.endTime]=r.time),delete s.time,s}function J(){const r=fe();f.isLoadingTable=!0,bt(r).then(s=>{f.isLoadingTable=!1,s.code==="0000"?(f.tableData=s.data?s.data.records:[],f.tableData||(f.tableData=[]),se.value=s.data?s.data.total:0):ee({type:"error",message:s.message||"获取周期任务列表失败"})}).catch(s=>{f.isLoadingTable=!1,ee({type:"error",message:s.message||"获取周期实例列表错误"})})}function ye(r,s,e,i){s.label==="任务名称"&&(f.currentRow=r,le(r.id,_=>{_&&(f.dialogVisible=!0,f.curEditData=_)}))}function De(r){N("handleSearchExample",r)}function me(r){te.confirm(`删除【${r.name}】任务，是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{f.isLoadingTable=!0,f.dialogVisible=!1,nt(r.id).then(s=>{var e,i;f.isLoadingTable=!1,s.code==="0000"?(S({type:"success",title:"删除任务成功"}),J(),(i=(e=O.value)==null?void 0:e.toggleRowSelection)==null||i.call(e,r,!1)):S({type:"warning",title:"删除失败，请重试"})}).catch(s=>{f.isLoadingTable=!1,S({type:"error",title:"删除错误",message:s.message||"服务有错"})})}).catch(()=>{})}function ke(){const{selection:r}=f;r.length<1||te.confirm("删除选中数据，是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{f.isLoadingTable=!0,nt(r.map(s=>s.id).join(",")).then(s=>{var e;f.isLoadingTable=!1,s.code==="0000"?(S({type:"success",title:"删除成功"}),J(),(e=O.value)==null||e.clearSelection()):S({type:"warning",title:"删除失败，请重试"})}).catch(s=>{f.isLoadingTable=!1,S({type:"error",title:"删除错误",message:s.message||"服务有错"})})}).catch(()=>{})}function _e(r){F(r.status)||le(r.id,s=>{s&&(f.taskData={id:r.id,taskId:r.taskId,dag:B.cloneDeep(s.jobInfo.scheme),customVarList:s.jobInfo.customVarList||[],nodesInfo:s.nodesInfo||[]},be.value={type:"CYCLE",formData:{expression:r.expression,autoDependence:r.autoDependence,cancelWhenFailed:r.cancelWhenFailed,effectStartTime:r.effectStartTime,effectEndTime:r.effectEndTime||""}},f.batchRunIds=[],f.runTaskDialogVisible=!0)})}function he(){const{selection:r}=f;if(r.length<1)return;const s=r.map(e=>({name:e.name,flag:F(e.status)}));if(s.some(e=>e.flag)){const e=s.filter(i=>i.flag).map(i=>i.name);te.alert(`存在数据不可进行重新运行操作，请重新选择。
      <br/><br/>
      不可重新运行任务为：${e.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0});return}f.batchRunIds=r.filter(e=>!F(e.status)).map(e=>e.id),f.runTaskDialogVisible=!0}function we(r){r.status===-99||r.status===0||te.confirm(`取消【${r.name}】任务，是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{f.isLoadingTable=!0,lt(r.id).then(s=>{var e;f.isLoadingTable=!1,s.code==="0000"?(S({type:"success",title:"取消任务成功"}),J(),(e=O.value)==null||e.toggleRowSelection(r,!1)):S({type:"warning",title:"取消失败，请重试"})}).catch(s=>{f.isLoadingTable=!1,S({type:"error",title:"取消错误",message:s.message||"服务有错"})})}).catch(()=>{})}function Se(){const{selection:r}=f;if(r.length<1)return;const s=r.map(e=>({name:e.name,flag:e.status===-99||e.status===0}));if(s.some(e=>e.flag)){const e=s.filter(i=>i.flag).map(i=>i.name);te.alert(`存在数据不可进行取消操作，请重新选择。
      <br/><br/>
      不可取消任务为：${e.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0,confirmButtonText:"确定"});return}te.confirm("取消选中数据，是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{f.isLoadingTable=!0;const e=r.map(i=>i.id).join(",");lt(e).then(i=>{var _;f.isLoadingTable=!1,i.code==="0000"?(S({type:"success",title:"取消成功"}),J(),(_=O.value)==null||_.clearSelection()):S({type:"warning",title:"取消失败，请重试"})}).catch(i=>{f.isLoadingTable=!1,S({type:"error",title:"取消错误",message:i.message||"服务有错"})})}).catch(()=>{})}function le(r,s){qt(r).then(e=>{e.code==="0000"?s&&s instanceof Function&&s(e.data):(S({type:"warning",title:"查询详情失败，请重试"}),s&&s instanceof Function&&s(!1))}).catch(e=>{S({type:"error",title:"查询详情失败",message:e.message||"服务有错"}),s&&s instanceof Function&&s(!1)})}function ie(){ue(()=>{K()})}function m(){le(f.curEditData.jobInfo.id,r=>{r&&(f.curEditData=r)})}function d(r,s){var i;if(((i=r==null?void 0:r.workerStatusCounts)==null?void 0:i.length)===0)return 0;const e=r.workerStatusCounts.find(_=>_.status===s);return(e==null?void 0:e.num)||0}function t(){J(),f.dialogVisible&&m()}function c(){var r,s;window.WebSocket&&((r=f.websocket)==null||r.close()),(s=v.value)!=null&&s.id&&window.WebSocket&&(f.websocket=new WebSocket(`${pt}/algorithm/websocket/workerRefresh?userId=${v.value.id}&type=${st}`),f.websocket.onopen=()=>{w()},f.websocket.onclose=()=>{},f.websocket.onmessage=e=>{const i=JSON.parse(e.data),{workerRefresh:_}=i;_&&(f.tableData=_.records||[],se.value=_.total||0)},f.websocket.onerror=()=>{ee({type:"error",message:"websocket连接错误！"})})}function w(){var s,e;const r=fe();r.userId=v.value.id,((s=f.websocket)==null?void 0:s.readyState)===1&&((e=f.websocket)==null||e.send(JSON.stringify(r)))}return X({resizeTable:ie}),(r,s)=>{const e=E("el-button"),i=E("el-divider"),_=E("el-icon"),T=E("el-link"),b=ze("action");return g(),R(ce,null,[l(h(Ye),{id:"task-page",ref_key:"mainContainerRef",ref:M},{default:n(()=>[l(h(Xe),{border:"",padding:"1 1 0"},{default:n(()=>[l(h(ft),{ref_key:"searchRef",ref:W,options:h(Q),"query-permission":"algorithm_worker_list","class-name":"commonSearchForm",onHandleSearch:ve},null,8,["options"])]),_:1}),l(h(mt),null,{default:n(()=>[l(h(_t),{ref_key:"tableRef",ref:O,loading:f.isLoadingTable,"element-loading-text":"拼命加载中...","class-name":"cycle-task-table","table-data":f.tableData,columns:h(q),"search-form-ref":W.value,"default-expand-all":!1,"cell-class-name":h(H),"pagination-is-need":"","selection-is-need":"","page-size":h(G),"page-sizes":h(pe),total:h(se),"current-page":h(p),"operation-width":"300","table-expand-is-need":!0,"index-is-need":!1,"desc-options":!1,onSizeChange:h(u),onCurrentChange:h(L),onCellClick:ye,onSelectionChange:s[0]||(s[0]=o=>f.selection=o)},{"smart-table_batch-operation":n(()=>[ne((g(),V(e,{type:"primary",icon:h(Ae),link:"",onClick:he},{default:n(()=>[D(" 重新运行 ")]),_:1},8,["icon"])),[[b,"algorithm_worker_rerun"]]),l(i,{direction:"vertical"}),ne((g(),V(e,{type:"primary",icon:h(ct),link:"",onClick:Se},{default:n(()=>[D(" 取消 ")]),_:1},8,["icon"])),[[b,"algorithm_worker_cancelWork"]]),l(i,{direction:"vertical"}),l(e,{type:"danger",icon:h(Ge),link:"",onClick:ke},{default:n(()=>[D(" 批量删除 ")]),_:1},8,["icon"])]),"table-expand":n(({scope:o})=>{var C,x,Z;return[a("div",no,[a("div",lo,[io,a("div",ro,[l(_,{class:ae(["RUNNING"])},{default:n(()=>[(g(),V(Le("VideoPlay")))]),_:1}),D(" "+k(d(o.row,"1")),1)]),a("div",co,[l(_,{class:ae(["NOTINIT"])},{default:n(()=>[(g(),V(Le("Timer")))]),_:1}),D(" "+k(d(o.row,"-1")),1)]),a("div",uo,[l(_,{class:ae(["FINISH"])},{default:n(()=>[(g(),V(Le("CircleCheck")))]),_:1}),D(" "+k(d(o.row,"0")),1)]),a("div",po,[l(_,{class:ae(["FAIL"])},{default:n(()=>[(g(),V(Le("CircleClose")))]),_:1}),D(" "+k(d(o.row,"2")),1)]),a("div",fo,[l(_,{class:ae(["CANCEL"])},{default:n(()=>[(g(),V(Le("Remove")))]),_:1}),D(" "+k(d(o.row,"-99")),1)])])]),a("div",mo,[a("div",_o,[ho,a("div",go,k((C=o.row)==null?void 0:C.effectStartTime)+" ~ "+k(((x=o.row)==null?void 0:x.effectEndTime)||"持续生效"),1),bo,a("div",vo,k(((Z=o.row)==null?void 0:Z.expression)||"* * * * * ? *"),1)])])]}),name:n(({scope:o})=>[l(T,{type:"primary"},{default:n(()=>[D(k(o.row.name),1)]),_:2},1024)]),status:n(({scope:o})=>[a("div",yo,[ko,a("span",null,k(h(j)(o.row.status)),1)])]),"recent-worker-status":n(({scope:o})=>[h(B.isNull)(o.row.recentWorkerStatus)?Ve("",!0):(g(),R("span",wo)),a("span",null,k(h(U)(o.row.recentWorkerStatus)),1)]),priority:n(({scope:o})=>[D(k(h(Y)(o.row.priority)),1)]),operation:n(({scope:o})=>[ne((g(),V(e,{link:"",type:"primary",disabled:h(F)(o.row.status),onClick:xe(C=>_e(o.row),["stop"])},{default:n(()=>[D(" 重新运行 ")]),_:2},1032,["disabled","onClick"])),[[b,"algorithm_worker_rerun"]]),l(e,{type:"primary",link:"",onClick:xe(C=>De(o.row),["stop"])},{default:n(()=>[D(" 查看实例 ")]),_:2},1032,["onClick"]),l(e,{link:"",type:"primary",disabled:o.row.status===-99||o.row.status===0,onClick:xe(C=>we(o.row),["stop"])},{default:n(()=>[D(" 取消 ")]),_:2},1032,["disabled","onClick"]),l(e,{link:"",type:"danger",onClick:xe(C=>me(o.row),["stop"])},{default:n(()=>[D(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns","search-form-ref","cell-class-name","page-size","page-sizes","total","current-page","onSizeChange","onCurrentChange"])]),_:1})]),_:1},512),l(oo,{visible:f.dialogVisible,"onUpdate:visible":s[1]||(s[1]=o=>f.dialogVisible=o),"dom-id":f.domId,"cur-edit-data":f.curEditData,onRefresh:m,onRefreshList:J,onRerun:s[2]||(s[2]=o=>_e(f.currentRow)),onCancel:s[3]||(s[3]=o=>we(f.currentRow)),onDelete:s[4]||(s[4]=o=>me(f.currentRow))},null,8,["visible","dom-id","cur-edit-data"]),l(ga,{visible:f.runTaskDialogVisible,"onUpdate:visible":s[5]||(s[5]=o=>f.runTaskDialogVisible=o),"dag-data":f.taskData,"work-type-params":be.value,"batch-run-ids":f.batchRunIds,onSuccess:t},null,8,["visible","dag-data","work-type-params","batch-run-ids"])],64)}}});function To(){const{getPriorityOptions:A,getCellClassName:X,getStatusOptions:z,statusFormatter:N,priorityFormatter:M,isRunning:O}=gt(),W=Te({priorityOptions:[],statusOptions:[]}),{priorityOptions:Q,statusOptions:H}=Ue(W),q=Te({searchOptions:[{label:"关键字",key:"keyword",type:"text",placeholder:"实例标识/任务名称/创建人",labelWidth:"0px",span:4,value:""},{label:"状态",key:"status",type:"select",options:H,span:4,value:""},{label:"优先级",key:"priority",type:"select",options:Q,span:4,value:""},{label:"创建时间",key:"time",type:"dateTimePicker",datePickerType:"datetimerange",span:6}],colDatas:[{prop:"name",label:"实例标识",minWidth:150,fixed:"left",slot:"name"},{prop:"scheduleName",label:"任务名称",minWidth:150,fixed:"left"},{prop:"taskName",label:"方案名称",minWidth:150,fixed:"left"},{prop:"status",label:"状态",minWidth:120,fixed:"left",slot:"status"},{prop:"priority",label:"优先级",minWidth:95,slot:"priority"},{prop:"createTime",label:"创建时间",minWidth:180},{prop:"beginTime",label:"开始时间",minWidth:180},{prop:"endTime",label:"结束时间",minWidth:180},{prop:"cumulativeTime",label:"运行时长",minWidth:160},{prop:"operator",label:"最后执行人",minWidth:120}]}),j=async()=>{let U=A();U=U.map(P=>({value:P.code,label:P.showValue})),W.priorityOptions=[{label:"所有",value:""},...U]},Y=async()=>{let U=z();U=U.map(P=>({value:P.code,label:P.showValue})),W.statusOptions=[{label:"所有",value:""},...U]},F=async()=>{j(),Y()};return We(async()=>{F()}),{...Ue(q),getCellClassName:X,statusFormatter:N,priorityFormatter:M,isRunning:O}}const Do=a("span",{class:"point"},null,-1),So=Pe({__name:"index",setup(A,{expose:X}){const z=I(),N=I(),M=I(),{searchOptions:O,getCellClassName:W,colDatas:Q,statusFormatter:H,priorityFormatter:q,isRunning:j}=To(),Y=dt(),{userInfo:F}=ut(Y),{currentPage:U,pageSize:P,pageSizes:v,total:p,handleSizeChange:G,handleCurrentPageChange:pe,resize:se}=ht(z,N,f,void 0,ie),u=Te({domId:"cycle-task-container",isLoadingTable:!1,tableData:[],form:{keyword:"",status:"",priority:"",time:[]},priorityOptions:[],statusOptions:[],dialogVisible:!1,curEditData:{},selection:[],currentRow:null,runTaskDialogVisible:!1,taskData:{},batchRunDialogVisible:!1,batchRunIds:[],setPriorityIds:[],websocket:null});Oe(()=>F.value.id,m=>{var d;m?le():window.WebSocket&&((d=u.websocket)==null||d.close())}),We(()=>{ue(()=>{f(),le()})}),rt(()=>{var m;window.WebSocket&&((m=u.websocket)==null||m.close())});function L(m){U.value=1,f(),ie()}function K(){var t;const m=(t=M.value)==null?void 0:t.getForm(),d={page:U.value,rows:P.value,workType:ot,...m};return m!=null&&m.time&&([d.beginTime,d.endTime]=m.time),delete d.time,d}function f(){const m=K();u.isLoadingTable=!0,bt(m).then(d=>{u.isLoadingTable=!1,d.code==="0000"?(u.tableData=d.data?d.data.records:[],u.tableData||(u.tableData=[]),p.value=d.data?d.data.total:0):ee({type:"error",message:d.message||"获取周期任务列表失败"})}).catch(d=>{u.isLoadingTable=!1,ee({type:"error",message:d.message||"获取周期实例列表错误"})})}function be(m,d,t,c){var w;d.label==="实例标识"?(u.currentRow=m,J(m.id,r=>{r&&(u.dialogVisible=!0,u.curEditData=r)})):d.label==="选中"&&((w=N.value)==null||w.toggleRowSelection(m))}function ve(m){te.confirm(`删除【${m.name}】任务，是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{u.isLoadingTable=!0,u.dialogVisible=!1,de.deleteWorker(m.id).then(d=>{var t;u.isLoadingTable=!1,d.code==="0000"?(S({type:"success",title:"删除任务成功"}),f(),(t=N.value)==null||t.toggleRowSelection(m,!1)):S({type:"warning",title:"删除失败，请重试"})}).catch(d=>{u.isLoadingTable=!1,S({type:"error",title:"删除错误",message:d.message||"服务有错"})})}).catch(()=>{})}function fe(){const{selection:m}=u;m.length<1||te.confirm("删除选中数据，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",draggable:!0}).then(()=>{u.isLoadingTable=!0,de.deleteWorker(m.map(d=>d.id).join(",")).then(d=>{var t;u.isLoadingTable=!1,d.code==="0000"?(S({type:"success",title:"删除成功"}),f(),(t=N.value)==null||t.clearSelection()):S({type:"warning",title:"删除失败，请重试"})}).catch(d=>{u.isLoadingTable=!1,S({type:"error",title:"删除错误",message:d.message||"服务有错"})})}).catch(()=>{})}function J(m,d){de.getWorkerNodeList(m).then(t=>{t.code==="0000"?d&&d instanceof Function&&d(t.data):(S({type:"warning",title:"查询详情失败，请重试"}),d&&d instanceof Function&&d(!1))}).catch(t=>{S({type:"error",title:"查询详情失败",message:t.message||"服务有错"}),d&&d instanceof Function&&d(!1)})}function ye(m){j(m.status)||J(m.id,d=>{d&&(u.taskData={id:m.id,taskId:m.taskId,dag:B.cloneDeep(d.jobInfo.scheme),customVarList:d.jobInfo.customVarList||[],nodesInfo:d.nodesInfo||[],isRunSuccess:m.status===Ot.FINISH},u.runTaskDialogVisible=!0)})}function De(){const{selection:m}=u;if(m.length<1)return;const d=m.map(t=>({name:t.name,flag:j(t.status)}));if(d.some(t=>t.flag)){const t=d.filter(c=>c.flag).map(c=>c.name);te.alert(`存在数据不可进行重新运行操作，请重新选择。
      <br/><br/>
      不可重新运行任务为：${t.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0});return}u.setPriorityIds=[],u.batchRunIds=m.filter(t=>!j(t.status)).map(t=>t.id),u.batchRunDialogVisible=!0}function me(m){m.status===0||m.status===2||m.status===-99||te.confirm(`取消【${m.name}】任务，是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",draggable:!0}).then(()=>{u.isLoadingTable=!0,de.cancelWorker(m.id).then(d=>{var t;u.isLoadingTable=!1,d.code==="0000"?(S({type:"success",title:"取消任务成功"}),f(),(t=N.value)==null||t.toggleRowSelection(m,!1)):S({type:"warning",title:"取消失败，请重试"})}).catch(d=>{u.isLoadingTable=!1,S({type:"error",title:"取消错误",message:d.message||"服务有错"})})}).catch(()=>{})}function ke(){const{selection:m}=u;if(m.length<1)return;const d=m.map(t=>({name:t.name,flag:t.status===0||t.status===2||t.status===-99}));if(d.some(t=>t.flag)){const t=d.filter(c=>c.flag).map(c=>c.name);te.alert(`存在数据不可进行取消操作，请重新选择。
      <br/><br/>
      不可取消任务为：${t.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0,confirmButtonText:"确定"});return}te.confirm("取消选中数据，是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{u.isLoadingTable=!0;const t=m.map(c=>c.id).join(",");de.cancelWorker(t).then(c=>{var w;u.isLoadingTable=!1,c.code==="0000"?(S({type:"success",title:"取消成功"}),f(),(w=N.value)==null||w.clearSelection()):S({type:"warning",title:"取消失败，请重试"})}).catch(c=>{u.isLoadingTable=!1,S({type:"error",title:"取消错误",message:c.message||"服务有错"})})}).catch(()=>{})}function _e(){const{selection:m}=u;if(m.length<1)return;const d=m.map(t=>({name:t.name,flag:t.status!==-1}));if(d.some(t=>t.flag)){const t=d.filter(c=>c.flag).map(c=>c.name);te.alert(`存在数据不可进行优先级操作，仅等待中状态的任务允许操作，请重新选择。
      <br/><br/>
      不可操作的任务为：${t.join(" , ")}`,"提示",{type:"warning",dangerouslyUseHTMLString:!0,confirmButtonText:"确定"});return}u.batchRunIds=[],u.setPriorityIds=m.map(t=>t.id),u.batchRunDialogVisible=!0}function he(){J(u.curEditData.jobInfo.id,m=>{m&&(u.curEditData=m)})}function we(m){var d,t;(d=M.value)==null||d.resetForm(),(t=M.value)==null||t.setFormValue("keyword",m)}function Se(){ue(()=>{se()})}function le(){var m,d;window.WebSocket&&((m=u.websocket)==null||m.close()),(d=F.value)!=null&&d.id&&window.WebSocket&&(u.websocket=new WebSocket(`${pt}/algorithm/websocket/workerRefresh?userId=${F.value.id}&type=${ot}`),u.websocket.onopen=()=>{ie()},u.websocket.onclose=()=>{},u.websocket.onmessage=t=>{const c=JSON.parse(t.data),{workerRefresh:w}=c;w&&(u.tableData=w.records||[],p.value=w.total||0)},u.websocket.onerror=()=>{ee({type:"error",message:"websocket连接错误！"})})}function ie(){var d,t;const m=K();m.userId=F.value.id,((d=u.websocket)==null?void 0:d.readyState)===1&&((t=u.websocket)==null||t.send(JSON.stringify(m)))}return X({resizeTable:Se,searchByName:we}),(m,d)=>{const t=E("el-button"),c=E("el-divider"),w=E("el-link"),r=ze("action");return g(),R(ce,null,[l(h(Ye),{ref_key:"mainContainerRef",ref:z},{default:n(()=>[l(h(Xe),{padding:"1 1 0"},{default:n(()=>[l(h(ft),{ref_key:"searchRef",ref:M,options:h(O),"query-permission":"algorithm_worker_list","class-name":"commonSearchForm",onHandleSearch:L},null,8,["options"])]),_:1}),l(h(mt),null,{default:n(()=>[l(h(_t),{ref_key:"tableRef",ref:N,loading:u.isLoadingTable,"element-loading-text":"拼命加载中...","class-name":"task-example-table","table-data":u.tableData,columns:h(Q),"pagination-is-need":"","selection-is-need":"","page-size":h(P),"page-sizes":h(v),total:h(p),"current-page":h(U),"operation-width":"200","index-is-need":!1,"desc-options":!1,"cell-class-name":h(W),onSizeChange:h(G),onCurrentChange:h(pe),onCellClick:be,onSelectionChange:d[0]||(d[0]=s=>u.selection=s)},{"smart-table_batch-operation":n(()=>[l(t,{type:"primary",icon:h(Ae),link:"",onClick:De},{default:n(()=>[D(" 重新运行 ")]),_:1},8,["icon"]),l(c,{direction:"vertical"}),l(t,{type:"warning",icon:h(Et),link:"",onClick:_e},{default:n(()=>[D(" 设优先级 ")]),_:1},8,["icon"]),l(c,{direction:"vertical"}),ne((g(),V(t,{type:"primary",icon:h(ct),link:"",onClick:ke},{default:n(()=>[D("取消")]),_:1},8,["icon"])),[[r,"algorithm_worker_cancelWork"]]),l(t,{type:"danger",icon:h(Ge),link:"",onClick:fe},{default:n(()=>[D(" 批量删除 ")]),_:1},8,["icon"])]),name:n(({scope:s})=>[l(w,{type:"primary"},{default:n(()=>[D(k(s.row.name||"--"),1)]),_:2},1024)]),status:n(({scope:s})=>[Do,a("span",null,k(h(H)(s.row.status)),1)]),priority:n(({scope:s})=>[D(k(h(q)(s.row.priority)),1)]),operation:n(({scope:s})=>[ne((g(),V(t,{type:"primary",link:"",disabled:h(j)(s.row.status),onClick:xe(e=>ye(s.row),["stop"])},{default:n(()=>[D(" 重新运行 ")]),_:2},1032,["disabled","onClick"])),[[r,"algorithm_worker_rerun"]]),ne((g(),V(t,{type:"primary",link:"",disabled:s.row.status===0||s.row.status===2||s.row.status===-99,onClick:xe(e=>me(s.row),["stop"])},{default:n(()=>[D(" 取消 ")]),_:2},1032,["disabled","onClick"])),[[r,"algorithm_worker_cancelWork"]]),l(t,{type:"danger",link:"",onClick:xe(e=>ve(s.row),["stop"])},{default:n(()=>[D(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["loading","table-data","columns","page-size","page-sizes","total","current-page","cell-class-name","onSizeChange","onCurrentChange"])]),_:1}),l(Wt,{visible:u.runTaskDialogVisible,"onUpdate:visible":d[1]||(d[1]=s=>u.runTaskDialogVisible=s),"dag-data":u.taskData,"hide-new-schema":"",onSuccess:f},null,8,["visible","dag-data"]),l(Ht,{visible:u.batchRunDialogVisible,"onUpdate:visible":d[2]||(d[2]=s=>u.batchRunDialogVisible=s),"select-ids":u.batchRunIds,"set-priority-ids":u.setPriorityIds,"hide-new-schema":"",onSuccess:f},null,8,["visible","select-ids","set-priority-ids"])]),_:1},512),l(Pt,{visible:u.dialogVisible,"onUpdate:visible":d[3]||(d[3]=s=>u.dialogVisible=s),"dom-id":u.domId,"cur-edit-data":u.curEditData,"is-cycle-instance":"",onRefresh:he,onRefreshList:f,onRerun:d[4]||(d[4]=s=>ye(u.currentRow)),onCancel:d[5]||(d[5]=s=>me(u.currentRow)),onDelete:d[6]||(d[6]=s=>ve(u.currentRow))},null,8,["visible","dom-id","cur-edit-data"])],64)}}});const Jo=Pe({__name:"index",setup(A){const X=I("task"),z=I(),N=re(()=>({task:Co,example:So})[X.value]);function M(O){X.value="example",ue(()=>{var W;(W=z.value)==null||W.searchByName(O.name)})}return(O,W)=>{const Q=E("el-tab-pane"),H=E("el-tabs");return g(),V(h(Ye),{id:"cycle-task-container",background:""},{default:n(()=>[l(h(Xe),{padding:"0 1 0 1",border:""},{default:n(()=>[l(H,{modelValue:X.value,"onUpdate:modelValue":W[0]||(W[0]=q=>X.value=q),class:"db-tabs"},{default:n(()=>[l(Q,{label:"周期任务",name:"task"}),l(Q,{label:"周期实例",name:"example"})]),_:1},8,["modelValue"])]),_:1}),(g(),V(Le(N.value),{ref_key:"componentRef",ref:z,onHandleSearchExample:M},null,544))]),_:1})}}});export{Jo as default};
