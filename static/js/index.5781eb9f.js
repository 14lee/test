import{r as ve,N as aa,S as ga,aj as _e,d as be,i as he,c as se,b as Z,e as T,o as i,f as L,g as m,j as o,k as a,x as w,B as Q,u as s,l as P,F as re,y as ge,z as q,U as Re,aM as _a,n as Te,R as Le,t as $e,$ as qe,v as ye,b1 as ze,a6 as Ne,w as Oe,p as Ie,ad as Ee,ak as Ue,Z as Ke,_ as Ge,bH as ya,bc as va,ai as ke,ae as Qe}from"./element-plus.59ccb443.js";import{_ as Fe,u as ba,e as ta}from"./error.229cea25.js";import{q as ue}from"./lodash.22f463b4.js";import{d as Da,D as la,v as Pe,z as Ze,x as oa,t as ha,w as Ta,y as Sa,A as Ca}from"./login.a4e9287e.js";import{R as De,D as we,t as Ia,i as ka,a as Me,b as je,d as Be,c as We,e as He,u as sa,_ as ea,f as wa,g as Va,A as Ve,h as Oa}from"./useLayerGroupCommon.69b653b4.js";import{D as U,b as $a,S as ia,d as Ce}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{_ as na}from"./CatalogTree.vue_vue_type_script_setup_true_lang.900e7dde.js";import{k as Ea,S as Ra,a4 as ra,a5 as da,j as Fa,m as ca,h as Na,i as xa,a7 as La}from"./index-a95bb620.js";import{D as Pa}from"./index.533bb29b.js";import{u as Xe}from"./useTableAndPagination.0c6e0294.js";import{A as Aa}from"./stylesManage.d0073bf5.js";import{S as Ua}from"./serviceManage.8c46f250.js";import{S as za}from"./index.cc7bef78.js";import"../../app-config.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";function Ye(){const R=ve({searchOptions:[{label:"关键字",key:"keywords",type:"text",placeholder:"数据集名称/创建人",span:5},{label:"数据类型",key:"dataType",type:"select",placeholder:"选择数据类型",span:5,options:[],clearable:!0,labelKey:"dictValue",valueKey:"dictKey"}],columns:[{prop:"name",label:"数据集名称",minWidth:120,slot:"name"},{prop:"catalogName",label:"所属目录",minWidth:120},{prop:"dataType",label:"数据类型",minWidth:120,slot:"dataType"},{prop:"creator",label:"创建人",minWidth:120},{prop:"createTime",label:"创建时间",minWidth:120}],dataTypeOptions:[{dictValue:"所有",dictKey:"",id:"ALL"}],allServiceCategoryOptions:[],cascaderOptions:[]});async function ae(){await Ea("sjjsjlx").then(K=>{if(K.code==="0000"){const{data:{sjjsjlx:M}}=K;R.dataTypeOptions=R.dataTypeOptions.concat(M),R.dataTypeOptions=R.dataTypeOptions.filter(D=>!["WMS","WMTS"].includes(D.dictKey)),R.allServiceCategoryOptions=M||[],R.allServiceCategoryOptions=R.allServiceCategoryOptions.map(D=>({code:D.dictKey,showValue:D.dictValue,id:D.id})),R.allServiceCategoryOptions.unshift({code:"",showValue:"所有",id:"ALL"}),R.cascaderOptions=M||[],R.cascaderOptions=R.cascaderOptions.filter(D=>!["WMS","WMTS"].includes(D.dictKey)),R.cascaderOptions.forEach(D=>{var y,r;D.code=D.dictKey,D.text=D.dictValue,((y=D.children)==null?void 0:y.length)===0?delete D.children:(r=D.children)==null||r.forEach(N=>{var A;N.code=N.dictKey,N.text=N.dictValue,((A=N.children)==null?void 0:A.length)===0&&delete N.children})}),R.searchOptions[1].options=R.dataTypeOptions||[]}else _e({type:"warning",message:"请求数据类型失败"})}).catch(K=>{_e({type:"error",message:K.message})})}return aa(async()=>{await ae()}),{...ga(R)}}const Ma={class:"card"},ja=m("div",{class:"subtitle"},"数据集信息",-1),Ba={class:"content-wrap"},Wa={class:"item-wrap"},Ha={key:1},qa={class:"item-wrap item2"},Ka={class:"item-wrap item2"},Ga={key:0,class:"item-wrap item2"},Za={key:1,class:"item-wrap item2"},Xa={class:"item-wrap"},Ya=be({__name:"DataGroupInfoForm",emits:["changeType"],setup(R,{expose:ae,emit:K}){const{cascaderOptions:M}=Ye(),D=K,y=he("getDialogType"),r=se(()=>(y==null?void 0:y())||U.CHECK),N=se(()=>r.value===U.EDIT||r.value===U.ADD),A=Z(),W=Z(),l=ve({editData:{id:"",name:"",curDataType:[],description:"",creator:"",createTime:"",catalogId:"",catalogName:"",resourcesetDataType:De.THREE_DIMENSION,dataFormatType:we.ORIGINAL},rules:{name:[{required:!0,message:"数据集名称不能为空",trigger:["blur","change"]},{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]}],curDataType:[{required:!0,message:"数据类型不能为空",trigger:["blur"]}]},classifyTreeData:[],catalogObj:null,treeProps:{label:"name",children:"children",disabled:"no"},treeValueKey:"id"}),k=c=>Ia.includes(c),t=se(()=>l.editData.resourcesetDataType===De.TWO_DIMENSION?M.value.filter(n=>k(n.code)):M.value.filter(n=>n.code!=="VECTOR"));async function _(c){if(l.editData={id:"",name:"",curDataType:"",description:"",creator:"",createTime:"",catalogId:"",catalogName:"",resourcesetDataType:De.THREE_DIMENSION,dataFormatType:we.ORIGINAL},l.classifyTreeData=await ra(da.RESOURCESET),c==="#"){const n=l.classifyTreeData.find(V=>V.isDefault);l.catalogObj={id:n==null?void 0:n.id,name:""}}else l.catalogObj={id:c,name:""};return new Promise(n=>{setTimeout(()=>{var V;(V=A.value)==null||V.clearValidate(),l.catalogObj=W.value.getTypeObj(l.catalogObj.id),n(!0)},50)})}function x(c){const{id:n,name:V,description:h,resourcesetDataType:g,dataFormatType:e,creator:d,createTime:$,dataType:E,catalogId:ee}=c;if(ee){const O=Fa(l.classifyTreeData);l.catalogObj={id:ee,name:O.value.get(ee)}}l.editData={id:n,name:V,curDataType:E,description:h,creator:d,createTime:$,catalogId:l.catalogObj.id,catalogName:l.catalogObj.name,resourcesetDataType:g,dataFormatType:e},Te(()=>{var O,f;(O=A.value)==null||O.clearValidate(),l.catalogObj=(f=W.value)==null?void 0:f.getTypeObj(l.catalogObj.id)})}function z(){const{dataFormatType:c,curDataType:n,resourcesetDataType:V}=l.editData;D("changeType",{dataType:n,dataFormatType:c,resourcesetDataType:V})}function X(c){c===De.THREE_DIMENSION?l.editData.curDataType="":l.editData.curDataType=[],z()}function j(){return l.editData.catalogId=l.catalogObj.id,l.editData.catalogName=l.catalogObj.name,new Promise((c,n)=>{var V;N.value?(V=A.value)==null||V.validate(h=>{c(h&&Le({...l.editData}))}):c(Le(l.editData))})}return ae({validData:j,init:_,formatData:x}),(c,n)=>{const V=T("el-input"),h=T("el-form-item"),g=T("el-radio"),e=T("el-radio-group"),d=T("el-option"),$=T("el-select");return i(),L("div",Ma,[ja,m("div",Ba,[o(s(_a),{ref_key:"editFormRef",ref:A,class:"form edit-form",inline:"",model:l.editData,rules:l.rules,"label-width":"auto","label-position":"right"},{default:a(()=>[m("div",Wa,[o(h,{label:"数据集名称",prop:"name"},{default:a(()=>[N.value?(i(),w(V,{key:0,modelValue:l.editData.name,"onUpdate:modelValue":n[0]||(n[0]=E=>l.editData.name=E),type:"text",placeholder:"请输入数据集名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])):(i(),L("span",Ha,Q(l.editData.name),1))]),_:1})]),m("div",qa,[o(h,{label:"数据集类型"},{default:a(()=>[o(e,{modelValue:l.editData.resourcesetDataType,"onUpdate:modelValue":n[1]||(n[1]=E=>l.editData.resourcesetDataType=E),disabled:r.value!==s(U).ADD,onChange:X},{default:a(()=>[o(g,{label:s(De).THREE_DIMENSION},{default:a(()=>[P("三维数据集")]),_:1},8,["label"]),o(g,{label:s(De).TWO_DIMENSION},{default:a(()=>[P("二维复合数据集")]),_:1},8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1})]),m("div",Ka,[o(h,{label:"数据类型",prop:"curDataType"},{default:a(()=>[l.editData.resourcesetDataType===s(De).TWO_DIMENSION?(i(),w($,{key:0,modelValue:l.editData.curDataType,"onUpdate:modelValue":n[2]||(n[2]=E=>l.editData.curDataType=E),disabled:r.value!==s(U).ADD,class:"search-cascader",clearable:"",multiple:"",placeholder:"请选择数据类型",style:{width:"400px"},onChange:z},{default:a(()=>[(i(!0),L(re,null,ge(t.value,E=>(i(),w(d,{key:E.id,label:E.text,value:E.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])):(i(),w($,{key:1,modelValue:l.editData.curDataType,"onUpdate:modelValue":n[3]||(n[3]=E=>l.editData.curDataType=E),disabled:r.value!==s(U).ADD,class:"search-cascader",clearable:"",placeholder:"请选择数据类型",style:{width:"400px"},onChange:z},{default:a(()=>[(i(!0),L(re,null,ge(t.value,E=>(i(),w(d,{key:E.id,label:E.text,value:E.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]))]),_:1}),o(h,{label:"数据格式类型"},{default:a(()=>[o(e,{modelValue:l.editData.dataFormatType,"onUpdate:modelValue":n[4]||(n[4]=E=>l.editData.dataFormatType=E),disabled:r.value!==s(U).ADD,onChange:z},{default:a(()=>[o(g,{label:s(we).ORIGINAL},{default:a(()=>[P("原始数据")]),_:1},8,["label"]),o(g,{label:s(we).LIGHTWEIGHT},{default:a(()=>[P("切片数据")]),_:1},8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1})]),r.value===s(U).CHECK||r.value===s(U).EDIT?(i(),L("div",Ga,[o(h,{label:"创建人",prop:"creator"},{default:a(()=>[m("span",null,Q(l.editData.creator),1)]),_:1}),o(h,{label:"创建时间",prop:"createTime"},{default:a(()=>[m("span",null,Q(l.editData.createTime),1)]),_:1})])):q("",!0),l.classifyTreeData.length?(i(),L("div",Za,[o(h,{label:"所属目录"},{default:a(()=>[o(s(Ra),{ref_key:"selectTreeRef",ref:W,modelValue:l.catalogObj,"onUpdate:modelValue":n[5]||(n[5]=E=>l.catalogObj=E),"tree-props":l.treeProps,"tree-data":l.classifyTreeData,"value-key":l.treeValueKey,disabled:r.value===s(U).CHECK||r.value===s(U).PUBLISH,style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data","value-key","disabled"])]),_:1}),o(h)])):q("",!0),m("div",Xa,[o(h,{label:"描述",prop:"description"},{default:a(()=>[N.value?(i(),w(V,{key:0,modelValue:l.editData.description,"onUpdate:modelValue":n[6]||(n[6]=E=>l.editData.description=E),type:"text",placeholder:"请输入描述",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])):(i(),L("span",{key:1,class:Re(["description",l.editData.description?"":"valueEmpty"])},Q(l.editData.description||"未描述"),3))]),_:1})])]),_:1},8,["model","rules"])])])}}}),ua=Da("dataStore",{state:()=>({dataList:[]}),actions:{setDataList(R){this.dataList=ue.cloneDeep(R)}},getters:{getList(){return this.dataList}}}),Ja=["title"],Qa={class:"table-footer"},et={class:"operation"};var pa=(R=>(R.ORIGIN="ORIGIN_DATAFORMAT",R.TILESET="TILESET_DATAFORMAT",R))(pa||{});const at=be({__name:"DataPoolPane",props:{dataType:{},dataFormatType:{}},setup(R,{expose:ae}){const K=R,M=Z(),D=Z(),{currentPage:y,pageSize:r,pageSizes:N,total:A,handleSizeChange:W,handleCurrentPageChange:l}=Xe(M,D,j,void 0),k=[{prop:"name",label:"数据名称",minWidth:160},{prop:"dataTypeAliasName",label:"数据类型",width:200},{prop:"dataSize",label:"数据大小",width:130},{prop:"creator",label:"创建者",width:130},{prop:"createTime",label:"创建时间",width:180}],t=ve({tableData:[],isLoadingTable:!1,form:{keyword:"",status:"PROCESSED,PUBLISHED",dataType:"",catalogId:"",dataFormatDictCode:""},selection:[]}),_=he("getImportedList"),x=se(()=>{var e;return(e=_==null?void 0:_())==null?void 0:e.filter(d=>d.structureType==="RESOURCE")});function z(e){var d;return!((d=x.value)!=null&&d.some($=>$.resourceId===e.resourceId))}function X(){y.value=1,j()}function j(){t.isLoadingTable=!0;const e={page:y.value,rows:r.value,...t.form};ca.getDataPageList(e).then(d=>{t.isLoadingTable=!1,d.code==="0000"?(t.tableData=d.data?d.data.records:[],t.tableData||(t.tableData=[]),A.value=d.data?d.data.total:0):_e({type:"error",message:d.message||"获取表格数据失败"})}).catch(d=>{t.isLoadingTable=!1,_e({type:"error",message:d.message||"获取表格数据错误"})})}function c(e){t.selection=e}function n(e){t.form.catalogId=e,j()}function V(){var $;const{dataType:e,dataFormatType:d}=K;t.form.dataType=typeof e=="string"?e:e.join(","),t.form.dataFormatDictCode=pa[d],t.tableData=[],t.selection=[],t.form.keyword="",($=D.value)==null||$.clearSelection()}function h(e,d=!0){e.forEach($=>{var E;(E=D.value)==null||E.toggleRowSelection($,d)})}function g(){V(),j(),Te(()=>{h(x.value,!0)})}return ae({init:g,getSelection:()=>t.selection}),(e,d)=>{const $=T("el-input"),E=T("el-table-column"),ee=T("el-pagination"),O=$e("loading");return i(),w(s(Pe),{background:"",class:"data-import-content"},{default:a(()=>[o(s(la),{ref:"treeAsideRef"},{default:a(()=>[o(na,{type:"RESOURCE",editable:!1,onChange:n})]),_:1},512),o(s(Pe),null,{default:a(()=>[o(s(Ze),{class:"table-wrapper"},{default:a(()=>[o($,{modelValue:t.form.keyword,"onUpdate:modelValue":d[0]||(d[0]=f=>t.form.keyword=f),class:"search-input",clearable:"",placeholder:"输入关键字查询","prefix-icon":s(qe),onClear:X,onChange:X},null,8,["modelValue","prefix-icon"]),ye((i(),w(s(ze),{ref_key:"tableRef",ref:D,clsss:"table-main","element-loading-text":"拼命加载中...",data:t.tableData,style:{width:"100%"},"max-height":400,"row-key":"resourceId",stripe:"","highlight-current-row":"",onSelectionChange:c},{default:a(()=>[o(E,{align:"center",type:"selection",label:"选中","reserve-selection":"",selectable:z}),(i(),L(re,null,ge(k,f=>o(E,{key:f.prop,prop:f.prop,label:f.label,width:f.width,"min-width":f.minWidth,align:"center"},{default:a(u=>[m("span",{title:`${u.row[f.prop]}`},[f.prop==="dataTypeAliasName"?(i(),L(re,{key:0},[P(Q(u.row.dataTypeAliasName||"null"),1)],64)):f.prop==="dataSize"?(i(),L(re,{key:1},[P(Q(u.row[f.prop]||"--"),1)],64)):(i(),L(re,{key:2},[P(Q(u.row[f.prop]),1)],64))],8,Ja)]),_:2},1032,["prop","label","width","min-width"])),64))]),_:1},8,["data"])),[[O,t.isLoadingTable]]),m("footer",Qa,[m("div",et,"共选中 "+Q(t.selection.length)+" 条",1),s(A)&&s(A)>0?(i(),w(ee,{key:0,"current-page":s(y),"onUpdate:currentPage":d[1]||(d[1]=f=>Ne(y)?y.value=f:null),"page-size":s(r),"onUpdate:pageSize":d[2]||(d[2]=f=>Ne(r)?r.value=f:null),layout:"total, sizes, prev, pager, next","page-sizes":s(N),total:s(A),onSizeChange:s(W),onCurrentChange:s(l)},null,8,["current-page","page-size","page-sizes","total","onSizeChange","onCurrentChange"])):q("",!0)])]),_:1})]),_:1})]),_:1})}}});const tt=Fe(at,[["__scopeId","data-v-c0fd9ebe"]]),lt=["title"],ot={class:"table-footer"},st={class:"operation"},it=be({__name:"DatasetPane",props:{dataType:{},resourcesetDataType:{}},setup(R,{expose:ae}){const K=R,M=Z(),D=Z(),{currentPage:y,pageSize:r,pageSizes:N,total:A,handleSizeChange:W,handleCurrentPageChange:l}=Xe(M,D,c,void 0),k=[{prop:"name",label:"数据名称",minWidth:160},{prop:"dataTypeAliasName",label:"数据类型",width:200},{prop:"dataSize",label:"文件数量",width:130},{prop:"creator",label:"创建者",width:130},{prop:"createTime",label:"创建时间",width:180}],t=ve({tableData:[],isLoadingTable:!1,form:{dataType:"",keywords:"",resourcesetDataType:"TWO_DIMENSION"},selection:[]}),_=he("getImportedList"),x=se(()=>{var d;return(d=_==null?void 0:_())==null?void 0:d.filter($=>$.structureType==="RESOURCE_SET")}),z=se(()=>K.resourcesetDataType===De.TWO_DIMENSION);function X(d){var $;return!(($=x.value)!=null&&$.some(E=>E.resourceId===d.resourceId))}function j(){y.value=1,c()}function c(){t.isLoadingTable=!0;const d={page:y.value,rows:r.value,...t.form};ca.getConvertDataPageList(d).then($=>{t.isLoadingTable=!1,$.code==="0000"?(t.tableData=$.data?$.data.records:[],t.tableData||(t.tableData=[]),A.value=$.data?$.data.total:0):_e({type:"error",message:$.message||"获取表格数据失败"})}).catch($=>{t.isLoadingTable=!1,_e({type:"error",message:$.message||"获取表格数据错误"})})}function n(d){t.selection=d}function V(d){return z.value?"二维复合数据集":d.dataTypeAliasName||"null"}function h(){var E;const{dataType:d,resourcesetDataType:$}=K;t.tableData=[],t.selection=[],t.form.keywords="",t.form.dataType=z.value?"":d,t.form.resourcesetDataType=$,(E=D.value)==null||E.clearSelection()}function g(d,$=!0){d.forEach(E=>{var ee;(ee=D.value)==null||ee.toggleRowSelection(E,$)})}function e(){h(),c(),Te(()=>{g(x.value,!0)})}return ae({init:e,getSelection:()=>t.selection}),(d,$)=>{const E=T("el-input"),ee=T("el-table-column"),O=T("el-pagination"),f=$e("loading");return i(),w(s(Pe),{background:"",class:"data-import-content"},{default:a(()=>[o(s(Ze),{class:"table-wrapper"},{default:a(()=>[o(E,{modelValue:t.form.keywords,"onUpdate:modelValue":$[0]||($[0]=u=>t.form.keywords=u),class:"search-input",clearable:"",placeholder:"输入关键字查询","prefix-icon":s(qe),onClear:j,onChange:j},null,8,["modelValue","prefix-icon"]),ye((i(),w(s(ze),{ref_key:"tableRef",ref:D,clsss:"table-main","element-loading-text":"拼命加载中...",data:t.tableData,style:{width:"100%"},"max-height":400,"row-key":"resourceId",stripe:"","highlight-current-row":"",onSelectionChange:n},{default:a(()=>[o(ee,{align:"center",type:"selection",label:"选中","reserve-selection":"",selectable:X}),(i(),L(re,null,ge(k,u=>o(ee,{key:u.prop,prop:u.prop,label:u.label,width:u.width,"min-width":u.minWidth,align:"center"},{default:a(S=>[m("span",{title:`${S.row[u.prop]}`},[u.prop==="dataTypeAliasName"?(i(),L(re,{key:0},[P(Q(V(S.row)),1)],64)):u.prop==="dataSize"?(i(),L(re,{key:1},[P(Q(S.row[u.prop]||"--"),1)],64)):(i(),L(re,{key:2},[P(Q(S.row[u.prop]),1)],64))],8,lt)]),_:2},1032,["prop","label","width","min-width"])),64))]),_:1},8,["data"])),[[f,t.isLoadingTable]]),m("footer",ot,[m("div",st,"共选中 "+Q(t.selection.length)+" 条",1),s(A)&&s(A)>0?(i(),w(O,{key:0,"current-page":s(y),"onUpdate:currentPage":$[1]||($[1]=u=>Ne(y)?y.value=u:null),"page-size":s(r),"onUpdate:pageSize":$[2]||($[2]=u=>Ne(r)?r.value=u:null),layout:"total, sizes, prev, pager, next","page-sizes":s(N),total:s(A),onSizeChange:s(W),onCurrentChange:s(l)},null,8,["current-page","page-size","page-sizes","total","onSizeChange","onCurrentChange"])):q("",!0)])]),_:1})]),_:1})}}});const nt=Fe(it,[["__scopeId","data-v-15400dd9"]]),rt=be({__name:"ImportDataDialog",props:{visible:{type:Boolean,default:!1},dataType:{},dataFormatType:{},resourcesetDataType:{}},emits:["update:visible","save"],setup(R,{emit:ae}){const K=R,M=ae,D=Z(),y=Z(),r=Z(!1),N=Z("dataPool"),A=se(()=>{var z,X;const _=((z=D.value)==null?void 0:z.getSelection())||[],x=((X=y.value)==null?void 0:X.getSelection())||[];return[..._,...x]});Oe(()=>K.visible,_=>{r.value=_});function W(){var _,x;N.value="dataPool",(_=D.value)==null||_.init(),(x=y.value)==null||x.init()}function l(){M("update:visible",!1)}function k(){M("save",ue.cloneDeep(A.value)),l()}function t(_){N.value=_}return(_,x)=>{const z=T("el-tab-pane"),X=T("el-tabs"),j=T("el-button"),c=T("el-dialog");return i(),w(c,{modelValue:r.value,"onUpdate:modelValue":x[1]||(x[1]=n=>r.value=n),class:"center-dialog import-data-dialog",width:"1200px","append-to-body":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,title:"导入数据",onOpen:W,onClosed:l},{footer:a(()=>[m("div",null,[o(j,{onClick:l},{default:a(()=>[P("取 消")]),_:1}),o(j,{type:"primary",disabled:A.value.length===0,onClick:k},{default:a(()=>[P(" 确 定 ")]),_:1},8,["disabled"])])]),default:a(()=>[o(X,{modelValue:N.value,"onUpdate:modelValue":x[0]||(x[0]=n=>N.value=n),class:"demo-tabs",onTabClick:t},{default:a(()=>[o(z,{label:"数据资源池",name:"dataPool"},{default:a(()=>[o(tt,{ref_key:"dataPoolRef",ref:D,"data-type":_.dataType,"data-format-type":_.dataFormatType,"resourceset-data-type":_.resourcesetDataType},null,8,["data-type","data-format-type","resourceset-data-type"])]),_:1}),o(z,{label:_.resourcesetDataType===s(De).TWO_DIMENSION?"二维复合数据集":"三维数据集",name:"dataset"},{default:a(()=>[o(nt,{ref_key:"datasetRef",ref:y,"data-type":_.dataType,"resourceset-data-type":_.resourcesetDataType},null,8,["data-type","resourceset-data-type"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}});const dt=Fe(rt,[["__scopeId","data-v-1de1f46f"]]),ct={key:0,class:"item-wrap"},ut={class:"list-item"},pt=m("span",null," — — ",-1),ft={key:1,class:"item-wrap"},mt={class:"origin"},gt={key:2,class:"item-wrap"},_t={class:"rotate"},yt={class:"dialog-footer"},vt=be({__name:"SettingDataDialog",props:{visible:{type:Boolean,default:!1},dataType:{default:""},editId:{default:""}},emits:["update:visible","save"],setup(R,{emit:ae}){const K=ae,M=R,D=Z(),y=Z(),r=ve({dialogVisible:!1,srsOptions:[],srsCopyOptions:[],editData:{srs:"",origin:{x:"",y:"",z:""},rotate:0},rules:{srs:[{required:!0,message:"坐标系统不能为空",trigger:"change"}],origin:{type:"object",required:!0,fields:{x:{required:!0,validator:x,trigger:["blur","change"]},y:{required:!0,validator:x,trigger:["blur","change"]},z:{required:!0,validator:x,trigger:["blur","change"]}}}}}),N=he("getImportedList"),A=he("getSrsOptions"),W=se(()=>N==null?void 0:N());Oe(()=>M.visible,c=>{r.dialogVisible=c});function l(){var n,V;t();let c={};if(M.editId?c=(n=W.value)==null?void 0:n.find(h=>h.resourceId===M.editId):c=(V=W.value)==null?void 0:V[0],c){const{srs:h=Be,srsOrigin:g=We,rotate:e=He}=c;r.editData.srs=h;const d=g.split(",");r.editData.origin={x:d[0],y:d[1],z:d[2]},r.editData.rotate=e}Te(()=>{y.value.clearValidate()})}function k(){K("update:visible",!1)}function t(){r.srsOptions=A==null?void 0:A(),r.srsCopyOptions=ue.cloneDeep(r.srsOptions)}function _(c){c?r.srsOptions=ue.cloneDeep(r.srsCopyOptions).filter(n=>n.label.toLowerCase().includes(c.toLowerCase())||n.value.toLowerCase().includes(c.toLowerCase())):r.srsOptions=ue.cloneDeep(r.srsCopyOptions)}function x(c,n,V){const h=!!r.editData.origin.x,g=!!r.editData.origin.y,e=!!r.editData.origin.z;h&&g&&e?V():V(new Error(`请完整填写偏移量，${h?"":" X"}${g?"":" Y"}${e?"":" Z"}不能为空`))}function z(c){r.editData.origin[c]=r.editData.origin[c].replace(/^\.+|[^\d.]/g,"")}function X(){y.value.validate(c=>{c&&(K("save",ue.cloneDeep(r.editData),M.editId),k())})}function j(c,n){return typeof n=="string"?c.includes(n):n.some(V=>c.includes(V))}return(c,n)=>{const V=T("el-option"),h=T("el-select"),g=T("el-form-item"),e=T("el-input"),d=T("el-input-number"),$=T("el-form"),E=T("el-button"),ee=T("el-dialog");return i(),w(ee,{modelValue:r.dialogVisible,"onUpdate:modelValue":n[8]||(n[8]=O=>r.dialogVisible=O),class:"center-dialog setting-data-dialog",width:"420px","append-to-body":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,title:"批量设置",onOpen:l,onClosed:k},{footer:a(()=>[m("div",yt,[o(E,{onClick:k},{default:a(()=>[P("取 消")]),_:1}),o(E,{type:"primary",onClick:X},{default:a(()=>[P(" 确 定 ")]),_:1})])]),default:a(()=>[m("div",{ref_key:"mainContainerRef",ref:D,class:"main-container"},[o($,{ref_key:"editForm",ref:y,class:"form edit-form",inline:"",model:r.editData,rules:r.rules,"label-width":"100px","label-position":"right"},{default:a(()=>[j(s(ka),c.dataType)?(i(),L("div",ct,[o(g,{key:"srs",label:"坐标系统：",prop:"srs"},{default:a(()=>[o(h,{modelValue:r.editData.srs,"onUpdate:modelValue":n[0]||(n[0]=O=>r.editData.srs=O),style:{width:"100%"},"popper-class":"srs-select",filterable:"","filter-method":_,placeholder:"请选择坐标系统"},{default:a(()=>[(i(!0),L(re,null,ge(r.srsOptions,O=>(i(),w(V,{key:O.value,label:O.value,value:O.value},{default:a(()=>[m("div",ut,[m("span",null,Q(O.value),1),pt,m("span",null,Q(O.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):q("",!0),j(s(Me),c.dataType)?(i(),L("div",ft,[o(g,{label:"偏移量：",prop:"origin"},{default:a(()=>[m("div",mt,[o(e,{modelValue:r.editData.origin.x,"onUpdate:modelValue":n[1]||(n[1]=O=>r.editData.origin.x=O),placeholder:"请输入X坐标",onInput:n[2]||(n[2]=O=>z("x"))},{prepend:a(()=>[P("X :")]),_:1},8,["modelValue"]),o(e,{modelValue:r.editData.origin.y,"onUpdate:modelValue":n[3]||(n[3]=O=>r.editData.origin.y=O),placeholder:"请输入Y坐标",onInput:n[4]||(n[4]=O=>z("y"))},{prepend:a(()=>[P("Y :")]),_:1},8,["modelValue"]),o(e,{modelValue:r.editData.origin.z,"onUpdate:modelValue":n[5]||(n[5]=O=>r.editData.origin.z=O),placeholder:"请输入Z坐标",onInput:n[6]||(n[6]=O=>z("z"))},{prepend:a(()=>[P("Z :")]),_:1},8,["modelValue"])])]),_:1})])):q("",!0),j(s(je),c.dataType)?(i(),L("div",gt,[o(g,{label:"旋转角度：",prop:"rotate"},{default:a(()=>[m("div",_t,[o(d,{modelValue:r.editData.rotate,"onUpdate:modelValue":n[7]||(n[7]=O=>r.editData.rotate=O),placeholder:"请输入旋转角度","controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})])):q("",!0)]),_:1},8,["model","rules"])],512)]),_:1},8,["modelValue"])}}});const bt={class:"top"},Dt={class:"table center"},ht={style:{display:"none"}},Tt={class:"dialog-footer"},St=be({__name:"SettingStyleDialog",props:{visible:{type:Boolean,default:!1},editId:{default:""}},emits:["update:visible","save"],setup(R,{emit:ae}){const K=ae,M=R,D=Z(),y=Z(),{currentPage:r,pageSize:N,pageSizes:A,total:W,handleSizeChange:l,handleCurrentPageChange:k}=Xe(D,y,c,void 0),t=[{prop:"name",label:"样式名称",minWidth:160},{prop:"format",label:"文件格式",width:80},{prop:"description",label:"样式描述",minWidth:120},{prop:"creator",label:"创建者",width:130},{prop:"createTime",label:"创建时间",width:180}],_=ve({dialogVisible:!1,tableData:[],isLoadingTable:!1,form:{name:""},curSelectObj:{}}),x=Z("");Oe(()=>M.visible,h=>{_.dialogVisible=h});function z(){_.form.name="",x.value="",_.curSelectObj={},_.tableData=[],c()}function X(){_.curSelectObj={},_.tableData=[],K("update:visible",!1)}function j(){r.value=1,c()}function c(){_.isLoadingTable=!0;const h={page:r.value,rows:N.value,catalogId:"#",..._.form};Aa.getStylesPageList(h).then(g=>{_.isLoadingTable=!1,g.code==="0000"?(_.tableData=g.data?g.data.records:[],_.tableData||(_.tableData=[]),W.value=g.data?g.data.total:0):_e({type:"error",message:g.message||"获取表格数据失败"})}).catch(g=>{_.isLoadingTable=!1,_e({type:"error",message:g.message||"获取表格数据错误"})})}function n(h){_.curSelectObj=ue.cloneDeep(h),x.value=(h==null?void 0:h.id)??""}function V(){K("save",_.curSelectObj,M.editId),X()}return(h,g)=>{const e=T("el-input"),d=T("el-radio"),$=T("el-table-column"),E=T("el-pagination"),ee=T("el-button"),O=T("el-dialog"),f=$e("loading");return i(),w(O,{modelValue:_.dialogVisible,"onUpdate:modelValue":g[4]||(g[4]=u=>_.dialogVisible=u),class:"center-dialog import-data-dialog",width:"900px","append-to-body":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,title:"选择样式",onOpen:z,onClosed:X},{footer:a(()=>{var u;return[m("div",Tt,[s(W)&&s(W)>0?(i(),w(E,{key:0,"current-page":s(r),"onUpdate:currentPage":g[2]||(g[2]=S=>Ne(r)?r.value=S:null),"page-size":s(N),"onUpdate:pageSize":g[3]||(g[3]=S=>Ne(N)?N.value=S:null),layout:"total, sizes, prev, pager, next","page-sizes":s(A),total:s(W),onSizeChange:s(l),onCurrentChange:s(k)},null,8,["current-page","page-size","page-sizes","total","onSizeChange","onCurrentChange"])):q("",!0),m("div",null,[o(ee,{onClick:X},{default:a(()=>[P("取 消")]),_:1}),o(ee,{type:"primary",disabled:!((u=_.curSelectObj)!=null&&u.id),onClick:V},{default:a(()=>[P(" 确 定 ")]),_:1},8,["disabled"])])])]}),default:a(()=>[m("div",{ref_key:"mainContainerRef",ref:D,class:"main-import-content"},[m("div",bt,[o(e,{modelValue:_.form.name,"onUpdate:modelValue":g[0]||(g[0]=u=>_.form.name=u),class:"search-input",clearable:"",placeholder:"输入关键字查询","prefix-icon":s(qe),onClear:j,onChange:j},null,8,["modelValue","prefix-icon"])]),m("div",Dt,[ye((i(),w(s(ze),{ref_key:"tableRef",ref:y,class:"data-table","element-loading-text":"拼命加载中...",style:{width:"100%"},data:_.tableData,"max-height":420,"row-key":"id",stripe:"","highlight-current-row":"","row-class-name":"table-row",onCurrentChange:n},{default:a(()=>[o($,{align:"center",label:"选中",width:"60px"},{default:a(u=>{var S;return[o(d,{modelValue:x.value,"onUpdate:modelValue":g[1]||(g[1]=F=>x.value=F),label:(S=u.row)==null?void 0:S.id},{default:a(()=>{var F;return[m("div",ht,Q((F=u.row)==null?void 0:F.name),1)]}),_:2},1032,["modelValue","label"])]}),_:1}),(i(),L(re,null,ge(t,u=>o($,{key:u.prop,prop:u.prop,label:u.label,width:u.width,"min-width":u.minWidth,align:"center"},null,8,["prop","label","width","min-width"])),64))]),_:1},8,["data"])),[[f,_.isLoadingTable]])])],512)]),_:1},8,["modelValue"])}}});const fa=R=>(Ke("data-v-eca35784"),R=R(),Ge(),R),Ct={key:0,class:"card"},It={class:"subtitle"},kt=fa(()=>m("span",{class:"text"},"数据信息",-1)),wt={key:0,class:"tip"},Vt={class:"content-wrap"},Ot=fa(()=>m("input",{id:"importCoordinateFile",style:{display:"none"},type:"file",class:"importCoordinateFile",directory:"",nwdirectory:"",accept:".xml"},null,-1)),$t={class:"content-wrap"},Et={key:0},Rt={key:1,style:{color:"#c0c4cc"}},Ft=be({__name:"DataInfoForm",emits:["open"],setup(R,{expose:ae,emit:K}){const M=K,{srsOptions:D}=sa(()=>{},()=>{}),y=ua(),r=he("getDialogType"),N=he("getDataType"),A=he("getDataFormatType"),W=he("getResourcesetDataType"),l=se(()=>(r==null?void 0:r())||U.CHECK),k=se(()=>N==null?void 0:N()),t=se(()=>A==null?void 0:A()),_=se(()=>W==null?void 0:W()),x=se(()=>k.value==="VECTOR"||k.value.includes("VECTOR")),z=se(()=>l.value===U.EDIT||l.value===U.ADD),X=se(()=>t.value),j=se(()=>t.value===we.ORIGINAL),c=se(()=>{var I;return typeof k.value=="string"?Me.includes(k.value):(I=k.value)==null?void 0:I.some(b=>Me.includes(b))}),n=se(()=>{var I;return typeof k.value=="string"?je.includes(k.value):(I=k.value)==null?void 0:I.some(b=>je.includes(b))}),V=Z(),h=Z(),g=Z(null);Oe([()=>z.value,()=>V.value],([I,b])=>{var p,B;I&&b?C(b):(p=g.value)!=null&&p.el&&((B=g.value)==null||B.destroy())});const e=ve({editData:{resourceDatas:[]},selection:[],isLoadingTable:!1,importDataDialogVisible:!1,curSettingDataId:"",settingDataDialogVisible:!1,settingStyleDialogVisible:!1,curImportCoordinateId:""});Ie("getImportedList",()=>e.editData.resourceDatas||[]),Ie("getSrsOptions",()=>D.value||[]),Oe(()=>e.editData.resourceDatas,I=>{y.setDataList(I)},{deep:!0});function d(){e.editData.resourceDatas=[]}function $(I){e.editData.resourceDatas=ue.cloneDeep(I),e.editData.resourceDatas.forEach(b=>{let{dataInfo:p}=b;if(p&&xa(p)&&(p=JSON.parse(p)),b.srs=p!=null&&p.srs?`EPSG:${p.srs}`:Be,b.srsOrigin=(p==null?void 0:p.srsOrigin)??We,b.rotate=(p==null?void 0:p.rotate)??He,x.value){const{styleId:B,styleName:J}=p;B&&J?b.styleInfo={id:B,name:J}:b.styleInfo=null}})}function E(){e.importDataDialogVisible=!0}function ee(I){if(X.value===we.LIGHTWEIGHT)e.editData.resourceDatas=[...I];else if(j.value){e.isLoadingTable=!0;const b=ue.cloneDeep(e.editData.resourceDatas);e.editData.resourceDatas=[],setTimeout(()=>{e.editData.resourceDatas=[...I],b.forEach(p=>{const B=e.editData.resourceDatas.find(J=>J.resourceId===p.resourceId);B&&(B.srs=p.srs,B.srsOrigin=p.srsOrigin,B.rotate=p.rotate,x.value&&(B.styleInfo=p.styleInfo))}),e.editData.resourceDatas.forEach(p=>{p.srs||(p.srs=Be),p.srsOrigin?p.srsOrigin=p.srsOrigin.replace(/\s*/g,""):p.srsOrigin=We,p.rotate||(p.rotate=He),x.value&&!Reflect.has(p,"styleInfo")&&(p.styleInfo=null)}),e.isLoadingTable=!1},200)}}function O(I,b){const{srs:p,origin:{x:B,y:J,z:te},rotate:pe}=I;b?e.editData.resourceDatas.forEach(le=>{le.resourceId===b&&(le.srs=p,le.srsOrigin=`${B},${J},${te}`,le.rotate=pe)}):e.editData.resourceDatas.forEach(le=>{le.srs=p,le.srsOrigin=`${B},${J},${te}`,le.rotate=pe})}function f(I,b){b?e.editData.resourceDatas.forEach(p=>{p.resourceId===b&&(p.styleInfo=ue.cloneDeep(I))}):e.editData.resourceDatas.forEach(p=>{p.styleInfo=ue.cloneDeep(I)})}function u(I){e.selection=I.map(b=>b.resourceId)}function S(){var I;e.editData.resourceDatas=e.editData.resourceDatas.filter(b=>e.selection.every(p=>b.resourceId!==p)),e.selection=[],(I=h.value)==null||I.clearSelection()}function F(I){var b;(b=h.value)==null||b.toggleRowSelection(I,!1),e.editData.resourceDatas=e.editData.resourceDatas.filter(p=>p.resourceId!==I.resourceId)}function v(I){e.curSettingDataId=I,e.settingDataDialogVisible=!0}function H(I){e.curSettingDataId=I,e.settingStyleDialogVisible=!0}function G(){e.curImportCoordinateId="",de()}function Y(I){e.curImportCoordinateId=I,de()}function de(){var I,b;(I=document.getElementById("importCoordinateFile"))==null||I.click(),(b=document.getElementById("importCoordinateFile"))==null||b.addEventListener("change",p=>{const{files:B}=p.target;if(B.length===0)return;const J=B[0];if(!/\.xml$/g.test(J.name)){Ue.alert("仅支持导入xml格式！","提示",{confirmButtonText:"确定",type:"error"}),p.target.value="";return}ie(J,te=>{const{system:pe,origin:{x:le,y:Se,z:oe}}=te;e.curImportCoordinateId?e.editData.resourceDatas.forEach(fe=>{fe.resourceId===e.curImportCoordinateId&&(fe.srs=pe,c.value&&(fe.srsOrigin=`${le},${Se},${oe}`))}):e.editData.resourceDatas.forEach(fe=>{fe.srs=pe,c.value&&(fe.srsOrigin=`${le},${Se},${oe}`)}),_e({type:"success",message:`导入${e.curImportCoordinateId?"":"全局"}文件成功!`})}),p.target.value=""})}function ie(I,b){const p=new FileReader;p.onload=B=>{var Se,oe;const J=B.target.result,te={},pe=J.match(/<SRS[^>]*>([\s\S]*?)<\/SRS>/);let le=J.match(/<SRSOrigin[^>]*>([\s\S]*?)<\/SRSOrigin>/);if(c.value){if(!pe||!le){Ue.alert("文件未包含必要信息！请检查后重新导入！","提示",{confirmButtonText:"确定",type:"error"});return}}else if(!pe){Ue.alert("文件未包含必要信息！请检查后重新导入！","提示",{confirmButtonText:"确定",type:"error"});return}[,te.system]=pe,le=(oe=(Se=le[1])==null?void 0:Se.replace(/\s*/g,""))==null?void 0:oe.split(","),te.origin={x:le[0],y:le[1],z:le[2]},b&&b(te)},p.readAsBinaryString(I)}function ce(I){if(I){const b=I.split(",");return`X: ${b[0]}    Y: ${b[1]}    Z: ${b[2]}`}return"X: 0    Y: 0    Z: 0"}function C(I){var B;const b=(B=I.$el)==null?void 0:B.querySelector(".dataListTable"),p=b==null?void 0:b.querySelector(".el-table__body-wrapper tbody");g.value=Na.create(p,{disabled:!1,handle:".draggable-item",onEnd({newIndex:J,oldIndex:te}){const pe=ue.cloneDeep(e.editData.resourceDatas),le=pe.splice(te,1)[0];pe.splice(J,0,le),e.editData.resourceDatas=[...pe]}})}function me(){M("open")}function ne(){return new Promise((I,b)=>{var p;z.value?((p=e.editData.resourceDatas)==null?void 0:p.length)>0?(e.editData.resourceDatas.forEach(B=>{var te;const J={};c.value&&Reflect.set(J,"srsOrigin",B.srsOrigin),n.value&&Reflect.set(J,"rotate",B.rotate),Reflect.set(J,"srs",(te=B.srs)==null?void 0:te.replace("EPSG:","")),x.value&&(Reflect.set(J,"styleId",B.styleInfo?B.styleInfo.id:null),Reflect.set(J,"styleName",B.styleInfo?B.styleInfo.name:null)),B.dataInfo=JSON.stringify(J)}),I(Le(e.editData.resourceDatas))):I(!1):I(!0)})}return ae({validData:ne,init:d,formatData:$}),(I,b)=>{var Se;const p=T("el-button"),B=T("Operation"),J=T("el-icon"),te=T("el-table-column"),pe=T("el-form"),le=$e("loading");return i(),L(re,null,[k.value&&X.value!==s(we).NONE?(i(),L("div",Ct,[m("div",It,[kt,((Se=e.editData.resourceDatas)==null?void 0:Se.length)===0?(i(),L("span",wt," 请导入数据 ")):q("",!0),l.value===s(U).PUBLISH?(i(),w(p,{key:1,link:"",type:"primary",class:"btn",onClick:Ee(me,["stop"])},{default:a(()=>[P(" 编辑 ")]),_:1})):q("",!0)]),m("div",Vt,[z.value?(i(),w(s(oa),{key:0,padding:"0 0 1 0"},{default:a(()=>{var oe,fe,xe;return[o(p,{type:"primary",onClick:E},{default:a(()=>[P(" 导入数据 ")]),_:1}),o(p,{type:"danger",disabled:e.selection.length===0,onClick:S},{default:a(()=>[P(" 删除数据 ")]),_:1},8,["disabled"]),j.value?(i(),w(p,{key:0,type:"primary",disabled:((oe=e.editData.resourceDatas)==null?void 0:oe.length)===0,onClick:b[0]||(b[0]=Ae=>v(""))},{default:a(()=>[P(" 批量设置 ")]),_:1},8,["disabled"])):q("",!0),x.value?(i(),w(p,{key:1,type:"primary",disabled:((fe=e.editData.resourceDatas)==null?void 0:fe.length)===0,onClick:b[1]||(b[1]=Ae=>H(""))},{default:a(()=>[P(" 全局样式 ")]),_:1},8,["disabled"])):q("",!0),j.value?(i(),w(p,{key:2,type:"primary",disabled:((xe=e.editData.resourceDatas)==null?void 0:xe.length)===0,onClick:G},{default:a(()=>[P(" 导入全局文件 ")]),_:1},8,["disabled"])):q("",!0),Ot]}),_:1})):q("",!0)]),m("div",$t,[o(pe,{ref_key:"tableForm",ref:V,class:"table-form edit-form",model:e.editData},{default:a(()=>[ye((i(),w(s(ze),{ref_key:"dataListTable",ref:h,class:"sortableTable dataListTable",data:e.editData.resourceDatas,"row-key":"resourceId",onSelectionChange:u},{default:a(()=>[z.value?(i(),w(te,{key:0,"class-name":"draggable-item",align:"center",label:"排序",width:"60"},{default:a(()=>[o(J,null,{default:a(()=>[o(B)]),_:1})]),_:1})):q("",!0),z.value?(i(),w(te,{key:1,align:"center",type:"selection",label:"选中","reserve-selection":"",selectable:()=>z.value},null,8,["selectable"])):q("",!0),o(te,{prop:"name",label:"数据名称","min-width":"120"}),j.value?(i(),w(te,{key:2,"min-width":"120",prop:"srs",label:"EPSG"})):q("",!0),j.value&&c.value?(i(),w(te,{key:3,"min-width":"120",prop:"srsOrigin",label:"偏移量"},{default:a(oe=>[m("span",null,Q(ce(oe.row.srsOrigin)),1)]),_:1})):q("",!0),j.value&&n.value?(i(),w(te,{key:4,"min-width":"120",prop:"rotate",label:"旋转角度"})):q("",!0),x.value?(i(),w(te,{key:5,prop:"styleInfo",label:"样式设置"},{default:a(oe=>{var fe,xe,Ae;return[(fe=oe.row)!=null&&fe.styleInfo?(i(),L("span",Et,Q((Ae=(xe=oe.row)==null?void 0:xe.styleInfo)==null?void 0:Ae.name),1)):(i(),L("span",Rt,"未设置"))]}),_:1})):q("",!0),z.value?(i(),w(te,{key:6,width:x.value?250:j.value?190:120,label:"操作",fixed:"right","class-name":"tableOperate"},{default:a(oe=>[j.value?(i(),w(p,{key:0,link:"",type:"primary",onClick:Ee(fe=>Y(oe.row.resourceId),["stop"])},{default:a(()=>[P(" 导入文件")]),_:2},1032,["onClick"])):q("",!0),x.value?(i(),w(p,{key:1,link:"",type:"primary",onClick:Ee(fe=>H(oe.row.resourceId),["stop"])},{default:a(()=>[P(" 样式 ")]),_:2},1032,["onClick"])):q("",!0),j.value?(i(),w(p,{key:2,link:"",type:"primary",onClick:Ee(fe=>v(oe.row.resourceId),["stop"])},{default:a(()=>[P(" 设置 ")]),_:2},1032,["onClick"])):q("",!0),o(p,{link:"",type:"danger",onClick:Ee(fe=>F(oe.row),["stop"])},{default:a(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["width"])):q("",!0)]),_:1},8,["data"])),[[le,e.isLoadingTable]])]),_:1},8,["model"])])])):q("",!0),o(dt,{visible:e.importDataDialogVisible,"onUpdate:visible":b[2]||(b[2]=oe=>e.importDataDialogVisible=oe),"data-type":k.value,"data-format-type":t.value,"resourceset-data-type":_.value,onSave:ee},null,8,["visible","data-type","data-format-type","resourceset-data-type"]),o(vt,{visible:e.settingDataDialogVisible,"onUpdate:visible":b[3]||(b[3]=oe=>e.settingDataDialogVisible=oe),"data-type":k.value,"edit-id":e.curSettingDataId,onSave:O},null,8,["visible","data-type","edit-id"]),o(St,{visible:e.settingStyleDialogVisible,"onUpdate:visible":b[4]||(b[4]=oe=>e.settingStyleDialogVisible=oe),"edit-id":e.curSettingDataId,onSave:f},null,8,["visible","edit-id"])],64)}}});const ma=Fe(Ft,[["__scopeId","data-v-eca35784"]]),Nt=R=>(Ke("data-v-7acea517"),R=R(),Ge(),R),xt={class:"card"},Lt=Nt(()=>m("div",{class:"subtitle",style:{"margin-top":"16px"}},"服务信息",-1)),Pt={class:"content-wrap"},At={class:"item-wrap item2"},Ut={class:"item-wrap item2"},zt={class:"item-wrap"},Mt=be({__name:"ServiceInfoForm",emits:["changeServiceType"],setup(R,{expose:ae,emit:K}){const{allServiceCategoryOptions:M}=Ye(),D=K,y=he("getDataType"),r=se(()=>y==null?void 0:y()),N=se(()=>r.value==="VECTOR"||r.value.includes("VECTOR")),A=se(()=>typeof r.value=="string"?ea.includes(r.value):r.value.some(c=>ea.includes(c))),W=Z(),l=ve({checkNameing:!1,checkTimer:null,editData:{publishService:!0,serviceId:"",serverName:"",serverAliasName:"",serviceType:"",description:"",catalogId:""},treeProps:{label:"name",children:"children",disabled:"no"},rules:{serverName:[{required:!0,validator:z,trigger:["blur","change"]},{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]}],serverAliasName:[{required:!0,message:"服务名称不能为空",trigger:["blur","change"]},{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]}],catalogId:[{required:!0,message:"请选择服务目录",trigger:["change"]}]},serviceOptions:[]});async function k(){return l.editData={publishService:!0,serviceId:"",serverName:"",serverAliasName:"",serviceType:"",description:"",catalogId:""},await _(),new Promise(c=>{setTimeout(()=>{var n;(n=W.value)==null||n.clearValidate(),c(!0)},50)})}const t=Z([]);async function _(){var c;t.value=await ra(da.SERVICE),l.editData.catalogId=((c=t.value[0])==null?void 0:c.id)||""}async function x(){var c,n,V,h;if(r.value&&A.value)l.serviceOptions=(c=M.value)==null?void 0:c.filter(g=>typeof r.value=="string"?g.code===r.value:r.value.includes(g.code)),l.serviceOptions.length>0&&(l.editData.serviceType=l.serviceOptions[0].code);else if(l.serviceOptions=(n=M.value)==null?void 0:n.filter(g=>g.code==="WMS"||g.code==="WMTS"),N.value)l.editData.serviceType="WMS";else{const g=(V=M.value)==null?void 0:V.filter(e=>typeof r.value=="string"?e.code===r.value:r.value.includes(e.code));l.serviceOptions.unshift(...g),l.editData.serviceType=(h=g[0])==null?void 0:h.code}D("changeServiceType",l.editData.serviceType)}function z(c,n,V){if(n){const h=n.match(/[\W_]/);(h==null?void 0:h.length)>0?V(new Error("服务标识不能输入汉字、空格和特殊符号")):(l.checkNameing=!0,l.checkTimer&&clearTimeout(l.checkTimer),l.checkTimer=setTimeout(()=>{Ua.checkServiceName(n,l.editData.serviceType).then(g=>{l.checkNameing=!1,g.code==="0000"?g.data?V(new Error("该服务标识已被使用")):V():(_e({type:"warning",message:g.message}),V(new Error("后台验证失败，无法通过")))}).catch(()=>{_e({type:"error",message:"验证是否重名接口失败"}),V(new Error("后台验证失败，无法通过"))})},500))}else l.checkTimer&&clearTimeout(l.checkTimer),l.checkNameing=!1,V(new Error("服务标识不能为空"))}function X(c){D("changeServiceType",c)}function j(){return new Promise((c,n)=>{var V;l.editData.publishService?(V=W.value)==null||V.validate(h=>{if(h){const g=l.serviceOptions.find(e=>e.code===l.editData.serviceType);c(Le({...l.editData,serviceTypeAliasName:g==null?void 0:g.showValue}))}else c(h)}):c(Le(l.editData))})}return ae({validData:j,init:k,formatData:x}),(c,n)=>{const V=T("Loading"),h=T("el-icon"),g=T("el-input"),e=T("el-form-item"),d=T("el-option"),$=T("el-select"),E=T("el-tree-select"),ee=T("el-form");return i(),L("div",xt,[l.editData.publishService?(i(),L(re,{key:0},[Lt,m("div",Pt,[o(ee,{ref_key:"editFormRef",ref:W,class:"form edit-form",inline:"",model:l.editData,rules:l.rules,"label-width":"auto"},{default:a(()=>[m("div",At,[o(e,{label:"服务标识",prop:"serverName"},{default:a(()=>[o(g,{modelValue:l.editData.serverName,"onUpdate:modelValue":n[0]||(n[0]=O=>l.editData.serverName=O),type:"text",placeholder:"请输入服务标识",maxlength:"50","show-word-limit":""},{suffix:a(()=>[l.checkNameing?(i(),w(h,{key:0,class:"el-input__icon"},{default:a(()=>[o(V)]),_:1})):q("",!0)]),_:1},8,["modelValue"])]),_:1}),o(e,{label:"服务名称",prop:"serverAliasName"},{default:a(()=>[o(g,{modelValue:l.editData.serverAliasName,"onUpdate:modelValue":n[1]||(n[1]=O=>l.editData.serverAliasName=O),type:"text",placeholder:"请输入服务名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})]),m("div",Ut,[o(e,{label:"服务类型",prop:"serviceType"},{default:a(()=>[o($,{modelValue:l.editData.serviceType,"onUpdate:modelValue":n[2]||(n[2]=O=>l.editData.serviceType=O),class:"search-select",style:{width:"100%"},onChange:X},{default:a(()=>[(i(!0),L(re,null,ge(l.serviceOptions,O=>(i(),w(d,{key:O.code,label:O.showValue,value:O.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(e,{label:"所属目录",prop:"catalogId"},{default:a(()=>[o(E,{modelValue:l.editData.catalogId,"onUpdate:modelValue":n[3]||(n[3]=O=>l.editData.catalogId=O),data:t.value,props:l.treeProps,"value-key":"id",filterable:"",style:{width:"100%"}},null,8,["modelValue","data","props"])]),_:1})]),m("div",zt,[o(e,{label:"描述",prop:"description"},{default:a(()=>[o(g,{modelValue:l.editData.description,"onUpdate:modelValue":n[4]||(n[4]=O=>l.editData.description=O),type:"text",placeholder:"请输入描述",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})])]),_:1},8,["model","rules"])])],64)):q("",!0)])}}});const jt=Fe(Mt,[["__scopeId","data-v-7acea517"]]),Je=R=>(Ke("data-v-5b18e571"),R=R(),Ge(),R),Bt={class:"card"},Wt={class:"subtitle"},Ht=Je(()=>m("span",{class:"text"},"参数设置",-1)),qt={key:0,class:"tip"},Kt={key:0,class:"content-wrap"},Gt={class:"item-wrap"},Zt={class:"list-item"},Xt=Je(()=>m("span",null," — — ",-1)),Yt={key:0,class:"item-wrap"},Jt={key:1,class:"item-wrap item2"},Qt=Je(()=>m("span",{style:{margin:"0 15px"}},"——",-1)),el={key:1,class:"content-wrap","element-loading-text":"正在获取方案参数..."},al={class:"item-wrap item2"},tl=be({__name:"PublishParamsForm",setup(R,{expose:ae}){const K=he("getDataType"),M=se(()=>K==null?void 0:K()),D=Z(),y=ua(),{tileInfoForm:r,cellData:N,showErrorTip:A,isLoadingScheme:W,tileInfoFormRule:l,taskTreeData:k,publishConfigList:t,handleTaskChange:_,handleControlChange:x,getAllTask:z,checkDagScheme:X}=wa(M,!1),{srsOptions:j,srsFilterFunc:c,treeProps:n,groupIdentify:V,gridSetsList:h,checkFormPass:g}=sa(()=>{},()=>{}),e=Z([]),d=ve({serviceType:"",otherTileInfoForm:{srs:"",format:["png"],gridSets:"",level:["",""]},levelRules:{type:"array",required:!0,trigger:"change",len:2,fields:{0:{type:"number",required:!0,message:"请完整填写切片级别"},1:{type:"number",required:!0,message:"请完整填写切片级别"}}},levelOptions:[]});ya(()=>{z()}),va(()=>{e.value=[]});function $(){return d.otherTileInfoForm={srs:"",format:["png"],gridSets:"",level:["",""]},new Promise(S=>{setTimeout(()=>{var F;(F=D.value)==null||F.clearValidate(),S(!0)},50)})}function E(S){d.serviceType=S}function ee(S){d.otherTileInfoForm.level[0]="",d.otherTileInfoForm.level[1]="";const F=h.value.find(H=>H.value===S),v=Array(F.max+1).fill(1);d.levelOptions=[],v.forEach((H,G)=>{d.levelOptions.push({value:G,lebel:G})})}function O(){return new Promise((S,F)=>{if(d.serviceType==="WMS"||d.serviceType==="WMTS")g(D).then(H=>{if(H){const G={},Y={srs:d.otherTileInfoForm.srs.replace("EPSG:","")};d.serviceType==="WMTS"&&(Y.format=d.otherTileInfoForm.format.join(","),Y.gridSets=d.otherTileInfoForm.gridSets,[Y.zoomStart,Y.zoomStop]=d.otherTileInfoForm.level),G.tileConfig=JSON.stringify(Y),S(G)}else S(!1)});else{const v=e.value;(v==null?void 0:v.length)>0?X(!0).then(G=>{if(G){const Y={},{taskInfo:de}=r.value;Y.taskId=de.id;const ie={cells:ue.cloneDeep(N.value)};Y.dag=JSON.stringify(ie),S(Y)}else S(!1)}):(_e({type:"warning",message:"请选择正确的切片方案！"}),g(D),S(!1))}})}function f(S){S(y.getList)}Ie("getCellById",u);function u(S){var v;const F=(v=N.value)==null?void 0:v.find(H=>H.id===S);return F?{attributes:F}:{}}return ae({validData:O,init:$,initServiceType:E}),(S,F)=>{const v=T("el-option"),H=T("el-select"),G=T("el-form-item"),Y=T("el-checkbox"),de=T("el-checkbox-group"),ie=T("el-form"),ce=$e("loading");return i(),L("div",Bt,[m("div",Wt,[Ht,d.serviceType!=="WMS"&&d.serviceType!=="WMTS"&&s(A)?(i(),L("span",qt," 请正确设置方案参数 ")):q("",!0)]),d.serviceType==="WMS"||d.serviceType==="WMTS"?(i(),L("div",Kt,[o(ie,{ref_key:"editTileInfoForm",ref:D,class:"form edit-form",inline:"",model:d.otherTileInfoForm,"label-width":"auto","label-position":"right"},{default:a(()=>[m("div",Gt,[o(G,{key:"otherTileInfoForm.srs",label:"输出坐标",prop:"srs",rules:{required:!0,message:"输出坐标不能为空",trigger:"change"}},{default:a(()=>[o(H,{modelValue:d.otherTileInfoForm.srs,"onUpdate:modelValue":F[0]||(F[0]=C=>d.otherTileInfoForm.srs=C),style:{width:"100%"},"popper-class":"srs-select",filterable:"","filter-method":s(c),placeholder:"请选择坐标系统"},{default:a(()=>[(i(!0),L(re,null,ge(s(j),C=>(i(),w(v,{key:C.value,label:C.value,value:C.value},{default:a(()=>[m("div",Zt,[m("span",null,Q(C.value),1),Xt,m("span",null,Q(C.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","filter-method"])]),_:1})]),d.serviceType==="WMTS"?(i(),L("div",Yt,[o(G,{key:"otherTileInfoForm.format",label:"输出格式",prop:"format",rules:{required:!0,message:"至少选择一种输出格式",trigger:"change"}},{default:a(()=>[o(de,{modelValue:d.otherTileInfoForm.format,"onUpdate:modelValue":F[1]||(F[1]=C=>d.otherTileInfoForm.format=C)},{default:a(()=>[s(Va).includes(M.value)?(i(),w(Y,{key:0,label:"gif"},{default:a(()=>[P(" gif ")]),_:1})):(i(),w(Y,{key:1,label:"geojson"},{default:a(()=>[P("geojson")]),_:1})),o(Y,{label:"jpeg"},{default:a(()=>[P("jpeg")]),_:1}),o(Y,{label:"png",disabled:""},{default:a(()=>[P("png")]),_:1}),o(Y,{label:"png8"},{default:a(()=>[P("png8")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):q("",!0),d.serviceType==="WMTS"?(i(),L("div",Jt,[o(G,{key:"otherTileInfoForm.gridSets",label:"网格集",prop:"gridSets",rules:{required:!0,message:"网格集不能为空",trigger:"change"}},{default:a(()=>[o(H,{modelValue:d.otherTileInfoForm.gridSets,"onUpdate:modelValue":F[2]||(F[2]=C=>d.otherTileInfoForm.gridSets=C),style:{width:"100%"},filterable:"",placeholder:"请选择网格集",onChange:ee},{default:a(()=>[(i(!0),L(re,null,ge(s(h),C=>(i(),w(v,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(G,{key:"otherTileInfoForm.level",label:"切片级别",prop:"level",rules:d.levelRules},{default:a(()=>[o(H,{modelValue:d.otherTileInfoForm.level[0],"onUpdate:modelValue":F[3]||(F[3]=C=>d.otherTileInfoForm.level[0]=C),style:{width:"38%"},filterable:"",placeholder:"请选择","no-data-text":"请先选择网格集"},{default:a(()=>[(i(!0),L(re,null,ge(d.levelOptions,C=>(i(),w(v,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Qt,o(H,{modelValue:d.otherTileInfoForm.level[1],"onUpdate:modelValue":F[4]||(F[4]=C=>d.otherTileInfoForm.level[1]=C),style:{width:"38%"},filterable:"",placeholder:"请选择","no-data-text":"请先选择网格集"},{default:a(()=>[(i(!0),L(re,null,ge(d.levelOptions,C=>(i(),w(v,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"])])):q("",!0)]),_:1},8,["model"])])):ye((i(),L("div",el,[o(ie,{ref_key:"editTileInfoForm",ref:D,class:"form edit-form",inline:"",model:s(r),rules:s(l),"label-width":"auto","label-position":"right"},{default:a(()=>[m("div",al,[o(G,{label:"切片方案",prop:"taskInfo"},{default:a(()=>[o(s($a),{modelValue:s(r).taskInfo,"onUpdate:modelValue":F[5]||(F[5]=C=>s(r).taskInfo=C),style:{width:"100%"},"tree-props":s(n),"tree-data":s(k),"node-key":"id",icon:"iconCls","expand-on-click-node":!1,"default-expand-all":"",filterable:"","only-click-child":"","show-group-icon":"","group-identify":s(V),onChange:s(_)},null,8,["modelValue","tree-props","tree-data","group-identify","onChange"])]),_:1}),o(G)])]),_:1},8,["model","rules"]),s(t).length>0?(i(!0),L(re,{key:0},ge(s(t),(C,me)=>(i(),w(ie,{ref_for:!0,ref:ne=>{ne&&(e.value[me]=ne)},key:C.uid,class:"form scheme-form__common",uid:C.uid,inline:"",model:C.pubulishData,"label-width":"auto","label-position":"right"},{default:a(()=>[(i(!0),L(re,null,ge(C.paramsConfigList,(ne,I)=>(i(),w(G,{key:ne.paramName+I,class:Re([{"scheme-form-item":!0,"is-left":I%2===0}]),label:ne.paramLabel,prop:ne.paramName,required:ne.required,rules:{required:ne.required,message:`${ne.paramLabel}不能为空`}},{default:a(()=>[o(s(za),{ref_for:!0,ref:"paramForm",modelValue:C.pubulishData[ne.paramName],"onUpdate:modelValue":b=>C.pubulishData[ne.paramName]=b,"control-name":ne.paramName,uid:C.uid,type:C.type,"all-param":ne,relations:C.relations,"is-batch-data":"",onChange:s(x),onGetDataList:f},null,8,["modelValue","onUpdate:modelValue","control-name","uid","type","all-param","relations","onChange"])]),_:2},1032,["class","label","prop","required","rules"]))),128))]),_:2},1032,["uid","model"]))),128)):q("",!0)])),[[ce,s(W)]])])}}});const ll=Fe(tl,[["__scopeId","data-v-5b18e571"]]),ol={class:"main-content"},sl={class:"title"},il=m("span",null," 编辑数据 ",-1),nl={class:"main"},rl={class:"footer"},dl=m("span",{class:"tips"},"保存后将更新原数据集信息",-1),cl=be({__name:"EditResourceDatasDialog",props:{visible:{type:Boolean,default:!1},domId:{default:""},editId:{default:""},resourceDatas:{default:()=>[]}},emits:["update:visible","save"],setup(R,{emit:ae}){const K=ae,M=R,D=Z(),y=ve({dialogType:U.EDIT,isLoading:!1,dialogVisible:!1,submiting:!1,curDataType:"",curDataFormat:""});Ie("getDialogType",()=>U.EDIT),Oe(()=>M.visible,k=>{y.dialogVisible=k});function r(){Te(()=>{var k;(k=D.value)==null||k.init()})}function N(){r(),Te(()=>{var k;(k=D.value)==null||k.formatData(M.resourceDatas)})}function A(){var k;(k=D.value)==null||k.formatData(M.resourceDatas),K("update:visible",!1),y.curDataFormat=""}function W(){var k;(k=D.value)==null||k.validData().then(t=>{if(t){const _={id:M.editId,resourceDatas:t};l(_)}}).catch(()=>{})}function l(k){y.submiting=!0,Ve.updateResourceset(k).then(t=>{y.submiting=!1,t.code==="0000"?(ke({type:"success",title:`${Ce.get(y.dialogType)}数据集成功`}),K("save",k.resourceDatas),A()):ke({type:"error",title:`${Ce.get(y.dialogType)}数据集失败`,message:t.message})}).catch(t=>{y.submiting=!1,ke({type:"error",title:`${Ce.get(y.dialogType)}数据集错误`,message:t.message})})}return(k,t)=>{const _=T("ArrowLeft"),x=T("el-icon"),z=T("el-divider"),X=T("el-button"),j=$e("loading");return i(),w(s(ia),{id:"eidt-resource-datas-dialog",modelValue:y.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=c=>y.dialogVisible=c),class:"full-dialog common-full-dialog","append-to-dom":k.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:N,onClosed:A},{default:a(()=>[ye((i(),L("div",ol,[m("div",sl,[o(x,{onClick:A},{default:a(()=>[o(_)]),_:1}),o(z,{direction:"vertical"}),il]),m("div",nl,[o(ma,{ref_key:"DataInfoRef",ref:D},null,512)]),m("div",rl,[o(X,{onClick:t[0]||(t[0]=c=>y.dialogVisible=!1)},{default:a(()=>[P("取消")]),_:1}),o(X,{type:"primary",loading:y.submiting,onClick:W},{default:a(()=>[P(" 保存 ")]),_:1},8,["loading"]),dl])])),[[j,y.isLoading]])]),_:1},8,["modelValue","append-to-dom"])}}});const ul={class:"common-wrapper"},pl={class:"dataCenter-header"},fl={class:"header-content"},ml={class:"left-content"},gl={class:"dataCenter-tab-title"},_l={key:0,class:"dataCenter-main main-overflow"},yl={class:"dataCenter-main main-overflow"},vl={key:1,class:"dataCenter-footer"},bl={class:"dialog-main"},Dl={class:"title"},hl=m("div",null,"接下来您可以:",-1),Tl=m("div",null,"将该数据集发布为数据服务",-1),Sl={class:"dialog-footer"},Cl=be({__name:"OperateDialog",props:{visible:{type:Boolean,default:!1},dialogType:{default:U.CHECK},domId:{default:""},curEditData:{default:()=>{}},editDataFromDataManagement:{default:()=>{}},curCatalogId:{default:""},isFromDataManagement:{type:Boolean,default:!1}},emits:["update:visible","changeType","save"],setup(R,{emit:ae}){const K=ba(),M=ta(),D=ae,y=R,r=Z(),N=Z(),A=Z(),W=Z(),l=Z(0),k=Z(""),t=ve({isLoading:!1,dialogVisible:!1,submiting:!1,checking:!1,curDataType:"",curDataFormat:"",dataFormatType:"",resourcesetDataType:"",editDialogVisible:!1,editResourceDatas:[],passDialogVisible:!1,showDataName:"",publishDataId:""});Ie("getDialogType",()=>y.dialogType),Ie("getDataType",()=>t.curDataType),Ie("getDataFormatType",()=>t.dataFormatType),Ie("getResourcesetDataType",()=>t.resourcesetDataType),Oe(()=>y.visible,f=>{t.dialogVisible=f});function _(){return l.value=0,k.value="",t.curDataType="",t.curDataFormat="",t.dataFormatType="",t.resourcesetDataType="",t.editResourceDatas=[],t.showDataName="",t.publishDataId="",Te(async()=>{var f,u,S,F;return(f=N.value)==null||f.init(),Promise.all([(u=W.value)==null?void 0:u.init(),(S=A.value)==null?void 0:S.init(),(F=r.value)==null?void 0:F.init(y.curCatalogId)]).then(()=>Promise.resolve(!0)).catch(()=>Promise.resolve(!1))})}async function x(){if(!await _())return console.error("初始化失败");const{dialogType:u,curEditData:S,isFromDataManagement:F}=y;if(u===U.CHECK&&(k.value=S==null?void 0:S.id),u!==U.ADD&&j(S==null?void 0:S.id),u===U.ADD&&F){const{editDataFromDataManagement:v}=y;O(v)}}function z(){D("update:visible",!1),t.curDataFormat="",k.value="",Object.keys(M.query).length&&K.go(-1)}function X(){D("changeType",U.EDIT)}function j(f){t.isLoading=!0,Ve.getResourcesetById(f).then(u=>{u.code==="0000"?O(u.data):_e({type:"error",message:"获取数据集信息失败"})}).catch(()=>{_e({type:"error",message:"获取数据集信息错误"})}).finally(()=>{t.isLoading=!1})}function c(){var S,F,v,H;t.checking=!0;const f=[];f[0]=(S=r.value)==null?void 0:S.validData(),f[1]=(F=N.value)==null?void 0:F.validData(),y.dialogType===U.PUBLISH&&(f[2]=(v=A.value)==null?void 0:v.validData(),f[3]=(H=W.value)==null?void 0:H.validData()),Promise.all(f).then(G=>{if(t.checking=!1,!G.some(Y=>!Y)){const Y=G[0],de=G[1];if(y.dialogType===U.ADD||y.dialogType===U.EDIT){const{id:ie,name:ce,curDataType:C,description:me,catalogId:ne,catalogName:I,resourcesetDataType:b,dataFormatType:p}=Y,B={id:ie,name:ce,description:me,dataType:typeof C=="string"?C:C.join(","),dataFormat:"",dataTypeAliasName:ee(C),resourceDatas:de,catalogId:ne,catalogName:I,resourcesetDataType:b,dataFormatType:p};n(B)}else if(y.dialogType===U.PUBLISH){const ie=G[2],ce=G[3],{serviceType:C,serviceTypeAliasName:me,description:ne,serverName:I,serverAliasName:b,publishService:p,catalogId:B}=ie,{taskId:J,tileConfig:te,dag:pe}=ce,le={serviceType:C,serviceTypeAliasName:me,description:ne,taskId:J,tileConfig:te,dag:pe,addVersion:!1,serviceId:"",serverName:I,serverAliasName:b,resourceSetId:Y.id,catalogId:B};n(le,p)}}}).catch(()=>{t.checking=!1})}function n(f,u){const{dialogType:S}=y,F=S===U.PUBLISH?Ve.publishResourceset:S===U.ADD?Ve.addResourceset:Ve.updateResourceset,v={};S===U.PUBLISH&&(v.publishService=u),t.submiting=!0,F(f,v).then(H=>{t.submiting=!1,H.code==="0000"?(D("save"),S===U.PUBLISH?(ke({type:"success",customClass:"custom-relese-notification",title:"发布成功，数据切片处理中，前往查看",onClick:()=>{V()}}),z()):(ke({type:"success",title:`${Ce.get(S)}数据集成功`}),t.publishDataId=S===U.EDIT?f.id:H.data,t.showDataName=f.name,t.passDialogVisible=!0)):ke({type:"error",title:`${Ce.get(S)}数据集失败`,message:H.message})}).catch(H=>{t.submiting=!1,ke({type:"error",title:`${Ce.get(S)}数据集错误`,message:H.message})})}function V(){const f={path:"/dataCenter/PublishTaskManage",params:{initSlice:"true"}};K.push(f)}function h({dataType:f,dataFormatType:u,resourcesetDataType:S}){var F;t.curDataType=f,t.dataFormatType=u,t.resourcesetDataType=S,(F=N.value)==null||F.init()}function g(f){var u;(u=W.value)==null||u.initServiceType(f)}function e(){t.editDialogVisible=!0}function d(f){t.editResourceDatas=ue.cloneDeep(f),Te(()=>{var u;(u=N.value)==null||u.formatData(t.editResourceDatas)})}function $(){t.isLoading=!0,D("changeType",U.PUBLISH,t.publishDataId),t.passDialogVisible=!1,j(t.publishDataId),x()}function E(){t.passDialogVisible=!1,z()}function ee(f){return typeof f=="string"?Oa[f]:"二维复合数据集"}function O(f){if(!f||!Object.keys(f).length)return;const{dataType:u,dataFormatType:S,resourcesetDataType:F,resourceDatas:v}=f,H=F===De.THREE_DIMENSION?u:u.split(",");t.curDataType=u,t.dataFormatType=S||we.NONE,t.resourcesetDataType=F,t.editResourceDatas=ue.cloneDeep(v),Te(()=>{var G,Y,de;(G=r.value)==null||G.formatData({...f,dataType:H}),(Y=N.value)==null||Y.formatData(v),(de=A.value)==null||de.formatData()})}return(f,u)=>{const S=T("ArrowLeft"),F=T("el-icon"),v=T("el-button"),H=T("CircleCheck"),G=T("el-dialog"),Y=$e("loading");return i(),w(s(ia),{id:"layer-group-operate-dialog",modelValue:t.dialogVisible,"onUpdate:modelValue":u[5]||(u[5]=de=>t.dialogVisible=de),class:"full-dialog common-full-dialog","append-to-dom":f.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:x,onClosed:z},{default:a(()=>{var de;return[ye((i(),L("div",ul,[m("div",pl,[m("div",fl,[m("div",ml,[o(F,{onClick:z},{default:a(()=>[o(S)]),_:1}),m("span",null,Q((s(Ce).get(f.dialogType)||"查看")+"数据集"),1)])]),ye(m("div",gl,[m("div",{class:Re(["btn",{actived:l.value===0}]),onClick:u[0]||(u[0]=ie=>l.value=0)}," 数据集详情 ",2),m("div",{class:Re(["btn",{actived:l.value===1}]),onClick:u[1]||(u[1]=ie=>l.value=1)}," 数据血缘 ",2)],512),[[Qe,f.dialogType===s(U).CHECK]])]),k.value&&l.value?(i(),L("div",_l,[o(s(Pa),{id:k.value,type:"RESULT_DATA","is-resource-set":""},null,8,["id"])])):q("",!0),ye(m("div",yl,[f.dialogType===s(U).PUBLISH?(i(),w(jt,{key:0,ref_key:"ServiceInfoRef",ref:A,onChangeServiceType:g},null,512)):q("",!0),o(Ya,{ref_key:"DataGroupInfoRef",ref:r,onChangeType:h},null,512),o(ma,{ref_key:"DataInfoRef",ref:N,onOpen:e},null,512),t.dialogVisible&&f.dialogType===s(U).PUBLISH?(i(),w(ll,{key:1,ref_key:"PublishParamsRef",ref:W},null,512)):q("",!0)],512),[[Qe,!l.value]]),f.dialogType===s(U).CHECK&&l.value?q("",!0):(i(),L("div",vl,[o(v,{onClick:u[2]||(u[2]=ie=>t.dialogVisible=!1)},{default:a(()=>[P("取消")]),_:1}),f.dialogType!==s(U).CHECK?(i(),w(v,{key:0,type:"primary",disabled:t.checking,loading:t.submiting,onClick:c},{default:a(()=>[P(Q(f.dialogType===s(U).PUBLISH?"发布":"保存"),1)]),_:1},8,["disabled","loading"])):(i(),w(v,{key:1,type:"primary",onClick:X},{default:a(()=>[P("编辑")]),_:1}))])),o(cl,{visible:t.editDialogVisible,"onUpdate:visible":u[3]||(u[3]=ie=>t.editDialogVisible=ie),"dom-id":f.domId,"edit-id":(de=f.curEditData)==null?void 0:de.id,"resource-datas":t.editResourceDatas,onSave:d},null,8,["visible","dom-id","edit-id","resource-datas"]),o(G,{modelValue:t.passDialogVisible,"onUpdate:modelValue":u[4]||(u[4]=ie=>t.passDialogVisible=ie),title:"提示","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"400px",class:"center-dialog success-pass-dialog","show-close":!1},{footer:a(()=>[m("span",Sl,[o(v,{onClick:E},{default:a(()=>[P("取 消")]),_:1}),o(v,{type:"primary",onClick:$},{default:a(()=>[P(" 进入发布 ")]),_:1})])]),default:a(()=>[m("div",bl,[m("div",Dl,[o(F,null,{default:a(()=>[o(H)]),_:1}),m("span",null,"数据集"+Q(s(Ce).get(f.dialogType))+"成功",1)]),m("div",null,"数据集名称:  "+Q(t.showDataName),1),hl,Tl])]),_:1},8,["modelValue"])])),[[Y,t.isLoading]])]}),_:1},8,["modelValue","append-to-dom"])}}});const Il={key:0,class:"delete-icon"},kl=["onClick"],wl={class:"operate-container"},Vl=be({__name:"index",setup(R){const{searchOptions:ae,columns:K}=Ye(),M=Z(),D={catalogId:"#"},{data:y,total:r,pageNo:N,pageSize:A,loading:W,handleSizeChange:l,handleCurrentChange:k,handleSelectionChange:t,handleSearch:_,initData:x}=ha(Ve.getResourcesetPageList,D),{checkPermission:z}=La(),X=Z(),j=se(()=>{var v;return(v=X.value)==null?void 0:v.$el}),c=ta(),n=se(()=>{var v;return((v=c.query)==null?void 0:v.keyword)||""}),V=Z(),h=Z(!1),g=[{prop:"name",label:"数据名称"},{prop:"dataType",label:"数据类型"},{prop:"creator",label:"创建人"},{prop:"createTime",label:"创建时间"}],e=ve({domId:"layer-group--manage",dialogVisible:!1,dialogType:U.CHECK,curEditData:{},editDataFromDataManagement:{},curCatalogId:"#"});Oe(n,v=>{console.log(v)},{immediate:!0}),aa(()=>{x(),$()});function d(){e.curEditData={},e.dialogType=U.ADD,e.dialogVisible=!0}async function $(){const{from:v,resourceId:H}=c.query;if(!v||v!=="DataManage")return;h.value=!0;const{success:G,data:Y}=await Ve.buildDataByresourceId(H);G&&Y&&(e.editDataFromDataManagement=Y,d())}function E(v){z("resourceset_get")&&(e.curEditData=ue.cloneDeep(v),e.dialogType=U.CHECK,e.dialogVisible=!0)}function ee(v,H){v===U.PUBLISH&&(e.curEditData.id=H),e.dialogType=v}function O(v){e.curEditData=ue.cloneDeep(v),e.dialogType=U.EDIT,e.dialogVisible=!0}function f(v){e.curEditData=ue.cloneDeep(v),e.dialogType=U.PUBLISH,e.dialogVisible=!0}function u(v){Ue.confirm(`删除【${v.name}】数据集, 是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{W.value=!0,Ve.deleteResourcesetByIdArr([v.id]).then(H=>{W.value=!1,H.code==="0000"&&(ke({type:"success",title:"删除数据集成功"}),x())}).catch(()=>{W.value=!1})}).catch(()=>{})}function S(v){e.curCatalogId=v,v!==D.catalogId&&(D.catalogId=v,_())}function F(v){const{resourcesetDataType:H,dataTypeAliasName:G}=v;return H===De.TWO_DIMENSION?"二维复合数据集":G}return(v,H)=>{const G=T("el-table-column"),Y=T("el-table"),de=T("el-button"),ie=$e("action");return i(),w(s(Pe),{id:"layer-group--manage",background:""},{default:a(()=>[o(s(la),{ref_key:"asideRef",ref:X},{default:a(()=>[o(na,{type:"RESOURCESET",onChange:S})]),_:1},512),o(s(Pe),{id:"service-manage",ref_key:"mainContainerRef",ref:V},{default:a(()=>[o(s(Ta),{target:j.value},null,8,["target"]),o(s(oa),{padding:"1 1 0",border:""},{default:a(()=>[o(s(Sa),{ref_key:"SmartSearchRef",ref:M,options:s(ae),"query-permission":"",onHandleSearch:s(_)},null,8,["options","onHandleSearch"])]),_:1}),o(s(Ze),null,{default:a(()=>[o(s(Ca),{ref:"baseTable","operation-width":"220",columns:s(K),"table-data":s(y),"current-page":s(N),"page-size":s(A),total:s(r),"pagination-is-need":!0,"operation-is-need":!0,loading:s(W),"search-form-ref":M.value,"selection-is-need":!1,"index-is-need":!1,"table-expand-is-need":!0,onSizeChange:s(l),onCurrentChange:s(k),onSelectionChange:s(t)},{"table-expand":a(({scope:ce})=>[o(Y,{class:"expandTable",data:ce.row.resourceDatas,border:!1},{default:a(()=>[(i(),L(re,null,ge(g,C=>o(G,{key:C.prop,prop:C.prop,label:C.label},{default:a(me=>{var ne,I,b,p,B,J;return[C.prop==="dataType"?(i(),L("span",{key:0,class:Re({is_delete:((ne=me.row)==null?void 0:ne.delFlag)===1})},Q((I=me.row)==null?void 0:I.dataTypeAliasName)+" / "+Q((p=(b=me.row)==null?void 0:b.dataFormat)==null?void 0:p.toLowerCase()),3)):(i(),L("span",{key:1,class:Re({is_delete:((B=me.row)==null?void 0:B.delFlag)===1})},[C.prop==="name"&&((J=me.row)==null?void 0:J.delFlag)===1?(i(),L("i",Il)):q("",!0),P(" "+Q(me.row[C.prop]),1)],2))]}),_:2},1032,["prop","label"])),64))]),_:2},1032,["data"])]),dataType:a(({scope:ce})=>[m("span",null,Q(F(ce.row)||"null"),1)]),name:a(({scope:ce})=>[m("span",{class:"link",onClick:Ee(C=>E(ce.row),["stop"])},Q(ce.row.name),9,kl)]),"smart-table_operation":a(()=>[ye((i(),w(de,{type:"primary",onClick:d},{default:a(()=>[P(" 新增数据集 ")]),_:1})),[[ie,"resourceset_saveOrUpdateAndPublish"]])]),operation:a(({scope:ce})=>[m("div",wl,[ye((i(),w(de,{type:"primary",link:"",onClick:C=>O(ce.row)},{default:a(()=>[P(" 编辑 ")]),_:2},1032,["onClick"])),[[ie,"resourceset_get"]]),ye((i(),w(de,{type:"primary",link:"",onClick:C=>f(ce.row)},{default:a(()=>[P(" 发布 ")]),_:2},1032,["onClick"])),[[ie,"resourceset_saveOrUpdateAndPublish"]]),ye((i(),w(de,{type:"danger",link:"",class:Re({delete:!0}),onClick:Ee(C=>u(ce.row),["stop"])},{default:a(()=>[P("删除")]),_:2},1032,["onClick"])),[[ie,"resourceset_delete"]])])]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1}),o(Cl,{visible:e.dialogVisible,"onUpdate:visible":H[0]||(H[0]=ce=>e.dialogVisible=ce),"dom-id":e.domId,"is-from-data-management":h.value,"edit-data-from-data-management":e.editDataFromDataManagement,"dialog-type":e.dialogType,"cur-edit-data":e.curEditData,"cur-catalog-id":e.curCatalogId,onSave:s(x),onChangeType:ee},null,8,["visible","dom-id","is-from-data-management","edit-data-from-data-management","dialog-type","cur-edit-data","cur-catalog-id","onSave"])]),_:1},512)]),_:1})}}});const Kl=Fe(Vl,[["__scopeId","data-v-f3145c77"]]);export{Kl as default};
