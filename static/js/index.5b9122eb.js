import{d as ke,b as Z,w as ie,r as be,N as Ce,n as Se,L as Te,T as Ae,aj as v,o as u,f as _,z as L,c as Ie,e as h,t as pe,v as E,x as k,k as a,j as l,u as f,l as I,B as N,g as c,bn as Ne,bo as Ve,U as z,F as ce,y as ye,ad as $,bO as Ee,be as Pe,c2 as Ge,ak as ne,Z as Ue,_ as ze,bL as $e,a0 as Oe,ai as ee}from"./element-plus.59ccb443.js";import{o as qe,a as Ke,b as fe,x as se,y as Re,z as je,v as we,D as Ze,U as Ye,E as He,w as We}from"./login.a4e9287e.js";import{q as Je}from"./lodash.22f463b4.js";import{a7 as Be,aa as Xe,ab as O}from"./index-a95bb620.js";import{l as De}from"./loseImg1.511f080c.js";import{B as Qe}from"./index.be2de979.js";import{q as et,f as tt,_ as ot,z as lt,t as at,a as nt,j as ue,k as st,G as me,S as it,l as j}from"./smart3d.ce055bc9.js";import{_ as Fe}from"./error.229cea25.js";import"../../app-config.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";const rt={key:0,style:{position:"absolute",top:"50%",left:"50%","font-size":"30px",color:"#dcdfe6",transform:"translate(-50%, -50%)"}},dt=ke({__name:"SmartMap",props:{isFull:{type:Boolean,default:!1},form:{type:Object,default:()=>{}},defaultAxis:{type:String,default:"Y"}},emits:["update-cover","hideControlBtn"],setup(B,{expose:Y,emit:H}){const P=H,g=B;Y({setCover:C});const b=Z();ie(()=>g.isFull,m=>{m?(b.value.querySelector("canvas").width=document.body.clientWidth,b.value.querySelector("canvas").height=document.body.clientHeight):(b.value.querySelector("canvas").width=700,b.value.querySelector("canvas").height=600)}),ie(()=>g.defaultAxis,m=>{m&&J(m,null)});const t=be({viewer:null,model:null,loadError:!1});Ce(()=>{qe(window,"resize",q),Se(()=>{G()})}),Te(()=>{Ke(window,"resize",q)}),Ae(()=>{var m;t.loadError=!1,t.viewer&&((m=t.viewer)==null||m.destroy())});function q(){g.isFull&&(b.value.querySelector("canvas").width=document.body.clientWidth,b.value.querySelector("canvas").height=document.body.clientHeight)}function G(){t.viewer=new et("mapContainer",{terrainProvider:tt.createSTKTerrain(),navigation:!1,location:!1,copyrightLogo:!1,helper:!1}),t.viewer._fullscreen._container.style.display="none",t.viewer._bottomWidget.destroy();const{screenSpaceCameraController:m}=t.viewer.scene;m.enableCollisionDetection=!1,m.maximumZoomDistance=1e5,m.minimumZoomDistance=0,m.maximumPitchDegrees=90,t.viewer.scene.terrainProvider=new ot({}),t.viewer.scene.globe.show=!1,t.viewer.scene.skyAtmosphere.show=!1,t.viewer.scene.skyBox.show=!1,t.viewer.scene.moon.show=!1,t.viewer.scene.sun.show=!1,t.viewer.clock.shouldAnimate=!0,t.viewer.scene.backgroundColor=lt.fromCssColorString("#ccc"),t.viewer.postProcessStages.fxaa.enabled=!0,t.viewer.clock.currentTime=at.fromIso8601("1599-12-25");const w=t.viewer.scene.screenSpaceCameraController;if(w._zoomFactor=2,w.inertiaZoom=.5,!g.form.url){v({type:"warning",message:"获取模型地址错误！"});return}const y=W(g.form.url);if(y==="glb"||y==="gltf")e(fe+g.form.url);else if(y==="json"){const M=t.viewer.scene.primitives.add(new nt({url:fe+g.form.url}));M.readyPromise.then(()=>{const{boundingSphere:x}=M,{radius:S}=x,T=g.form.defaultAngle||{},{x:d=S*2,y:r=S*2,z:p=S*2}=T;t.viewer.camera.lookAt(x.center,new ue(d,r,p)),t.viewer.scene.screenSpaceCameraController.maximumZoomDistance=S*3})}}function W(m){return m.replace(/.+\./,"")}function e(m,w){t.loadError=!1,t.model=t.viewer.scene.primitives.add(st.fromGltf({url:m,clampAnimations:!1,scale:100,upAxis:me.Z,forwardAxis:me.X})),t.model.readyPromise.then(y=>{y.activeAnimations.addAll({multiplier:1,loop:it.REPEAT}),J(g.defaultAxis,g.form.defaultAngle)})}async function C(){const{position:m}=t.viewer.camera,w=await t.viewer.saveSceneAsIMG();P("update-cover",w,m)}function J(m,w){if(t.loadError)return;const y=j.IDENTITY.clone();switch(m){case"Y":{j.multiplyTransformation(y,me.Y_UP_TO_Z_UP,y),j.multiplyTransformation(y,me.Z_UP_TO_X_UP,y);break}}t.model.modelMatrix=y;const{boundingSphere:M}=t.model;let x=j.multiplyByTranslation(y,M.center,new j);x=j.fromTranslation(j.getTranslation(x,new ue));let S;if(w)S=new ue(w.x,w.y,w.z);else{const T=M.radius*2;S=new ue(T,T,T)}t.viewer.camera.lookAtTransform(x,S)}return(m,w)=>(u(),_("div",{id:"mapContainer",ref_key:"mapContainerRef",ref:b,class:"mapContainer",style:{width:"100%",height:"100%"}},[t.loadError?(u(),_("div",rt," 模型无法加载 ")):L("",!0)],512))}}),ct=B=>(Ue("data-v-5ff50d56"),B=B(),ze(),B),ut={key:0,class:"empty"},mt=["onClick"],pt={key:0,src:De,alt:"封面图"},ft=["src"],gt={class:"info"},_t={class:"titleName"},ht={class:"title"},vt={class:"other"},yt={class:"size"},wt={class:"num"},kt={class:"operate"},bt={class:"edit common"},Ct=["onClick"],xt={class:"delete common"},St=["onClick"],It={key:0,class:"model-preview-container"},Vt={class:"map-box"},Bt={key:0,class:"mapIcon fullScreen"},Dt={key:1,class:"mapIcon mapConfig"},Ft={class:"container"},Lt={key:0,class:"info-box"},Mt={class:"close"},Tt={class:"title"},At={class:"center-content"},Nt={class:"cover"},Et={class:"left"},Pt={key:0,src:De,alt:"封面图"},Gt=["src"],Ut={class:"right"},zt=ct(()=>c("span",{class:"des"},"将当前视角设置为模型封面和默认视角",-1)),$t={class:"bottomOperation"},Ot={class:"dialog-footer"},qt=ke({__name:"ModelView",props:{modelGroupId:{type:String,required:!0,default:"#"},groupOptions:{type:Array,required:!0,default:()=>[{id:"",name:""}]}},setup(B){const{checkPermission:Y}=Be(),H=[{label:"关键字",key:"keyword",type:"text",placeholder:"模型名称",span:16}],P=B,g=Xe(),b=Ie(()=>g.isSearchData);ie(()=>b.value,i=>{i&&C()});const t=Z(),q=Z(),G=Z(),W=(i,o,s)=>{o===""?s(new Error("请输入模型名称")):o.length>50?s(new Error("字符超过限制长度")):s()},e=be({isLoading:!1,searchName:"",currentPage:1,pageSize:20,pageSizes:[20,40,100,200],total:0,modelList:[],cardWidth:200,checkedList:[],showPreview:!1,detailForm:null,isEdit:!1,isFullScreen:!1,moveDialogVisible:!1,moveBtnLoading:!1,moveGroupId:"1",defaultAxis:"Y",showModelConfig:!0,showMapControlBtn:!0,isBatching:!1});ie(()=>P.modelGroupId,i=>{e.checkedList=[],e.currentPage=1,C(),g.setSelectedGroupId(i)}),Ce(()=>{C()});function C(){if(!Y("scene_modelInfo_query"))return;e.isLoading=!0,g.setIsSearchData(!1);const i={modelGroupId:P.modelGroupId,modelName:e.searchName,page:e.currentPage,rows:e.pageSize};O.getModelInfoList(i).then(o=>{e.isLoading=!1,o.code==="0000"?(e.modelList=o.data.records,e.modelList.forEach(s=>{s.isCheck=e.checkedList.indexOf(s.id)>-1}),e.total=o.data.total):v({type:"warning",message:o.message})}).catch(o=>{e.isLoading=!1,v({type:"error",message:o.message})})}function J(){e.isBatching&&x(!1),e.isBatching=!e.isBatching}function m(){g.setVisible(!0),g.setMiniDialogVisible(!1)}function w(){if(e.checkedList.length===0){ne.alert("请选择数据！","提示",{confirmButtonText:"确定",type:"warning"});return}const i=P.groupOptions[0];e.moveGroupId=i.id,e.moveDialogVisible=!0}function y(){e.moveBtnLoading=!0;const i={modelGroupId:e.moveGroupId,modelIds:e.checkedList.join(",")};O.moveModelsToGruop(i).then(o=>{o.code==="0000"?(v({type:"success",message:"批量移动成功！"}),e.moveBtnLoading=!1,e.moveDialogVisible=!1,e.checkedList=[],C()):(e.moveBtnLoading=!1,v({type:"warning",message:o.message||"批量移动失败!请重试"}))}).catch(o=>{e.moveBtnLoading=!1,v({type:"error",message:o.message})})}function M(i){e.searchName=i.keyword,e.checkedList=[],C()}function x(i){i?(e.modelList.forEach(o=>{o.isCheck=!0}),e.modelList.forEach(o=>{e.checkedList.some(s=>s===o.id)||e.checkedList.push(o.id)})):S()}function S(){e.modelList.forEach(i=>{i.isCheck=!1}),e.checkedList=[]}function T(i){return/^(data:image)/.test(i)?i:`${fe}${i}`}function d(i,o=!1){if(!i.url){v.warning("模型数据出错，请重新上传");return}e.detailForm=Je.cloneDeep(i);const s=JSON.parse(e.detailForm.tileConfig);e.defaultAxis=s?s.defaultAxis:"Y",e.detailForm.defaultAngle=s?s.defaultAngle:null,e.showModelConfig=e.detailForm.url.replace(/.+\./,"")!=="json",e.isFullScreen=!1,e.isEdit=o,e.showPreview=!0,e.showMapControlBtn=!0}function r(i){ne.confirm("删除后，相关应用中的模型将不可使用，是否确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",draggable:!0}).then(()=>{V(i.id,!0)}).catch(()=>{})}function p(){if(e.checkedList.length===0){ne.alert("请选择数据！","提示",{confirmButtonText:"确定",type:"warning"});return}ne.confirm("删除选中模型，删除后，相关应用中的模型将不可使用，是否确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",draggable:!0}).then(()=>{const i=e.checkedList.join(",");V(i)}).catch(()=>{})}function V(i,o=!1){O.deleteModelById(i).then(s=>{s.code==="0000"?(v({type:"success",message:"删除成功"}),e.checkedList=o?e.checkedList.filter(D=>D!==i):[],C()):v({type:"warning",message:"删除失败，请重试"})}).catch(s=>{v({type:"error",message:s.message||"服务有错"})})}function X(i,o){i?e.checkedList.push(o):e.checkedList=e.checkedList.filter(s=>s!==o)}function A(){q.value.setCover()}function ge(i,o){var s;e.detailForm.defaultAngle=o,e.detailForm.cover=i,(s=t.value)==null||s.validateField("cover")}function te(){e.isFullScreen=!e.isFullScreen}function _e(i){var s;const o=P.groupOptions;e.detailForm.modelGroupName=((s=o.find(D=>D.id===i))==null?void 0:s.name)||"",e.detailForm.parentId=i}function oe(){var i;(i=t.value)==null||i.validate(o=>{if(o){const{id:s,name:D,cover:Q,description:U,modelGroupId:re,modelGroupName:he,defaultAngle:le}=e.detailForm,ae={defaultAxis:e.defaultAxis,defaultAngle:le},F={id:s,parentId:re,modelGroupId:re,modelGroupName:he,name:D,cover:Q,description:U,tileConfig:JSON.stringify(ae)};O.addOrUpdateModel(F).then(K=>{K.code==="0000"?(v({type:"success",message:`模型「${D}」编辑成功`}),C(),e.showPreview=!1):v({type:"warning",message:K.message})}).catch(K=>{v({type:"error",message:K.message})})}})}return(i,o)=>{const s=h("el-button"),D=h("el-checkbox"),Q=h("el-tooltip"),U=h("el-scrollbar"),re=h("el-pagination"),he=h("FullScreen"),le=h("el-icon"),ae=h("el-input"),F=h("el-form-item"),K=h("el-option"),xe=h("el-select"),ve=h("el-form"),Le=h("el-dialog"),de=pe("action"),Me=pe("loading");return E((u(),k(f(we),{"element-loading-text":"数据加载中"},{default:a(()=>[l(f(se),{justify:"space-between",padding:"1 1 0",border:""},{default:a(()=>[l(f(se),null,{default:a(()=>[l(s,{type:"primary",onClick:m},{default:a(()=>[I(" 上传数据 ")]),_:1}),l(s,{type:"primary",onClick:J},{default:a(()=>[I(N(e.isBatching?"取消操作":"批量操作"),1)]),_:1})]),_:1}),E(l(f(Re),{ref_key:"SmartSearchRef",ref:G,justify:"end",width:"400px","full-width":!1,options:H,onHandleSearch:M},null,512),[[de,"scene_modelInfo_query"]])]),_:1}),l(f(se),{padding:e.isBatching?"1 1 0":"0 0"},{default:a(()=>[l(f(Qe),{"hidden-right":"",visible:e.isBatching,"select-number":e.checkedList.length},{right:a(()=>[c("div",{class:"operate__right-row",onClick:o[0]||(o[0]=n=>x(!0))},"全选"),c("div",{class:"operate__right-row",onClick:o[1]||(o[1]=n=>x(!1))},"取消选择")]),default:a(()=>[E((u(),_("div",{class:"operate-row",onClick:w},[l(s,{type:"primary",icon:f(Ne),link:""},{default:a(()=>[I("批量移动")]),_:1},8,["icon"])])),[[de,"scene_modelInfo_moveModelsToGruop"]]),c("div",{class:"operate-row",onClick:p},[l(s,{"el-button":"",type:"danger",icon:f(Ve),link:""},{default:a(()=>[I("批量删除")]),_:1},8,["icon"])])]),_:1},8,["visible","select-number"])]),_:1},8,["padding"]),l(U,null,{default:a(()=>[l(f(je),{class:z(["mainContent",e.modelList.length===0?"isEmpty":""])},{default:a(()=>[e.modelList.length===0?(u(),_("div",ut,"暂无数据")):(u(!0),_(ce,{key:1},ye(e.modelList,n=>(u(),_("div",{key:n.id,class:z({"model-card":!0,"is-checked":n.isCheck})},[c("div",{class:"showBox",onClick:$(R=>d(n),["stop"])},[n.cover?(u(),_("img",{key:1,src:f(fe)+n.cover,onerror:"this.classList.add('errorImg');"},null,8,ft)):(u(),_("img",pt)),c("div",{class:z({cover:!0,"is-checked":n.isCheck,show:e.isBatching})},[l(D,{modelValue:n.isCheck,"onUpdate:modelValue":R=>n.isCheck=R,onClick:o[2]||(o[2]=$(R=>R.stopPropagation(),["stop"])),onChange:R=>X(n.isCheck,n.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])],2)],8,mt),c("div",gt,[c("div",_t,[l(Q,{disabled:n.name.length<12,content:n.name,placement:"bottom-start"},{default:a(()=>[c("p",ht,N(n.name),1)]),_:2},1032,["disabled","content"])]),c("div",vt,[c("div",yt,[c("p",wt,N(n.dataSize),1)]),c("div",kt,[c("div",bt,[c("i",{title:"编辑",class:"fontsmart fs-bianji primary",onClick:$(R=>d(n,!0),["stop"])},null,8,Ct)]),E((u(),_("div",xt,[c("i",{title:"删除",class:"fontsmart fs-shanchu danger",onClick:$(R=>r(n),["stop"])},null,8,St)])),[[de,"scene_modelInfo_delete"]])])])])],2))),128))]),_:1},8,["class"])]),_:1}),l(f(se),{justify:"end",padding:"1",class:"border-top"},{default:a(()=>[l(re,{"current-page":e.currentPage,"onUpdate:currentPage":o[3]||(o[3]=n=>e.currentPage=n),"page-size":e.pageSize,"onUpdate:pageSize":o[4]||(o[4]=n=>e.pageSize=n),layout:"total, sizes, prev, pager, next","page-sizes":e.pageSizes,background:"",total:e.total,onSizeChange:C,onCurrentChange:C},null,8,["current-page","page-size","page-sizes","total"])]),_:1}),e.showPreview?(u(),_("div",It,[c("div",{class:z({centerBox:!0,full:e.isFullScreen})},[c("div",Vt,[l(dt,{ref_key:"smartMap",ref:q,form:e.detailForm,"is-full":e.isFullScreen,"default-axis":e.defaultAxis,onUpdateCover:ge,onHideControlBtn:o[5]||(o[5]=n=>e.showMapControlBtn=!1)},null,8,["form","is-full","default-axis"]),e.showMapControlBtn?(u(),_("div",Bt,[e.isFullScreen?(u(),k(le,{key:0,title:"退出全屏",onClick:te},{default:a(()=>[l(he)]),_:1})):(u(),_("i",{key:1,title:"全屏",class:z(["fontsmart","fs-quanping"]),onClick:te}))])):L("",!0),e.showMapControlBtn&&e.showModelConfig?(u(),_("div",Dt,[l(Q,{"popper-class":"modelAxisPopper",trigger:"click",placement:"left"},{content:a(()=>[c("div",Ft,[c("p",{class:z({"is-selected":e.defaultAxis==="Y"}),onClick:o[6]||(o[6]=n=>e.defaultAxis="Y")}," Y轴向上 ",2),c("p",{class:z({"is-selected":e.defaultAxis==="Z"}),onClick:o[7]||(o[7]=n=>e.defaultAxis="Z")}," Z轴向上 ",2)])]),default:a(()=>[l(le,null,{default:a(()=>[l(f(Ee))]),_:1})]),_:1})])):L("",!0)]),e.isFullScreen?L("",!0):(u(),_("div",Lt,[c("div",Mt,[c("span",Tt,N(e.isEdit?"模型编辑":"模型查看"),1),l(le,{title:"关闭",onClick:o[8]||(o[8]=$(n=>e.showPreview=!1,["stop"]))},{default:a(()=>[l(f(Pe))]),_:1})]),c("div",At,[l(ve,{ref_key:"detailFormRef",ref:t,class:"detailForm commonForm","label-position":"top","label-width":"100px",model:e.detailForm},{default:a(()=>[l(F,{label:"模型名称：",prop:"name",rules:[{required:!0,message:"请输入模型名称",trigger:"blur"},{required:!0,message:"请输入模型名称",trigger:"change"},{validator:W,trigger:"blur"},{validator:W,trigger:"change"}]},{default:a(()=>[l(ae,{modelValue:e.detailForm.name,"onUpdate:modelValue":o[9]||(o[9]=n=>e.detailForm.name=n),maxlength:"50","show-word-limit":"",readonly:!e.isEdit},null,8,["modelValue","readonly"])]),_:1},8,["rules"]),l(F,{label:"模型分组：",prop:"modelGroupId"},{default:a(()=>[e.isEdit?(u(),k(xe,{key:1,modelValue:e.detailForm.modelGroupId,"onUpdate:modelValue":o[11]||(o[11]=n=>e.detailForm.modelGroupId=n),style:{width:"100%"},placeholder:"请选择分组",onChange:_e},{default:a(()=>[(u(!0),_(ce,null,ye(B.groupOptions,n=>(u(),k(K,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(u(),k(ae,{key:0,modelValue:e.detailForm.modelGroupName,"onUpdate:modelValue":o[10]||(o[10]=n=>e.detailForm.modelGroupName=n),readonly:""},null,8,["modelValue"]))]),_:1}),l(F,{label:"模型说明：",prop:"description"},{default:a(()=>[l(ae,{modelValue:e.detailForm.description,"onUpdate:modelValue":o[12]||(o[12]=n=>e.detailForm.description=n),type:"textarea",autosize:{minRows:3,maxRows:3},placeholder:"请输入内容",maxlength:"100","show-word-limit":"",readonly:!e.isEdit},null,8,["modelValue","readonly"])]),_:1}),l(F,{label:"模型封面：",required:"",prop:"cover",rules:[{required:!0,message:"请设置封面",trigger:"change"}]},{default:a(()=>[c("div",Nt,[c("div",Et,[e.detailForm.cover?(u(),_("img",{key:1,src:T(e.detailForm.cover),onerror:"this.classList.add('errorImg');"},null,8,Gt)):(u(),_("img",Pt))]),c("div",Ut,[l(s,{type:"primary",icon:f(Ge),disabled:!e.isEdit,onClick:A},{default:a(()=>[I("设置封面和视角")]),_:1},8,["icon","disabled"]),zt])])]),_:1})]),_:1},8,["model"]),l(ve,{class:"otherDetailForm commonForm","label-width":"85px",model:e.detailForm},{default:a(()=>[l(F,{label:"数据大小："},{default:a(()=>[c("span",null,N(e.detailForm.dataSize),1)]),_:1}),l(F,{label:"发布人："},{default:a(()=>[c("span",null,N(e.detailForm.creator),1)]),_:1}),l(F,{label:"修改时间："},{default:a(()=>[c("span",null,N(e.detailForm.updateTime),1)]),_:1})]),_:1},8,["model"])]),c("div",$t,[e.isEdit?(u(),_(ce,{key:0},[l(s,{onClick:o[13]||(o[13]=n=>e.showPreview=!1)},{default:a(()=>[I("取消")]),_:1}),E((u(),k(s,{type:"primary",onClick:oe},{default:a(()=>[I(" 保存 ")]),_:1})),[[de,"scene_modelInfo_save"]])],64)):(u(),k(s,{key:1,onClick:o[14]||(o[14]=n=>e.showPreview=!1)},{default:a(()=>[I("关闭")]),_:1}))])]))],2)])):L("",!0),l(Le,{modelValue:e.moveDialogVisible,"onUpdate:modelValue":o[17]||(o[17]=n=>e.moveDialogVisible=n),title:"批量移动",width:"300px",top:"25vh"},{footer:a(()=>[c("span",Ot,[l(s,{onClick:o[16]||(o[16]=n=>e.moveDialogVisible=!1)},{default:a(()=>[I("取 消")]),_:1}),l(s,{type:"primary",loading:e.moveBtnLoading,onClick:y},{default:a(()=>[I(N(e.moveBtnLoading?"移动中":"确 定"),1)]),_:1},8,["loading"])])]),default:a(()=>[l(ve,{ref:"moveForm","label-width":"90px"},{default:a(()=>[l(F,{label:"分类名称："},{default:a(()=>[l(xe,{modelValue:e.moveGroupId,"onUpdate:modelValue":o[15]||(o[15]=n=>e.moveGroupId=n),placeholder:"请选择分类名称"},{default:a(()=>[(u(!0),_(ce,null,ye(B.groupOptions,n=>(u(),k(K,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},512)]),_:1},8,["modelValue"])]),_:1})),[[Me,e.isLoading]])}}});const Kt=Fe(qt,[["__scopeId","data-v-5ff50d56"]]),Rt={key:0,class:"db-node__toolbar"},jt={class:"main-content"},Zt=ke({__name:"index",setup(B){const{checkPermission:Y}=Be(),H=Z(),P=Ie(()=>{var d;return(d=H.value)==null?void 0:d.$el}),g=Z(),b=Z(),t=be({isLoading:!1,filterText:"",modelTypeData:null,treeProps:{label:"name",children:"children"},defaultExpandedkeys:["#"],currentNodeKey:"#",submiting:!1,currentItem:{type:"look",editData:{id:"",name:"",description:""}},dialogVisible:!1,groupOptions:[]});ie(()=>t.filterText,d=>{var r;(r=g.value)==null||r.filter(d)}),Ce(()=>{q()});function q(){G()}function G(){Y("scene_modelgroup_getAll")&&O.getModelGroupAll().then(d=>{d.code==="0000"?(t.groupOptions=d.data,t.modelTypeData=[...d.data],Se(()=>{var r,p;(p=(r=g.value)==null?void 0:r.smartTreeRef.value)==null||p.setCurrentKey(t.currentNodeKey)})):v({type:"warning",message:"请求模型分组数据失败"})}).catch(()=>{v({type:"error",message:"请求模型分组数据错误"})})}function W(d,r){return d?r[t.treeProps.label].indexOf(d)!==-1:!0}function e({id:d}){var r;t.currentNodeKey=d,(r=g.value)==null||r.changeCheckBoxStatus(!1)}function C({id:d,name:r,description:p}){t.currentItem={type:"edit",editData:{id:d,name:r,description:p}},t.dialogVisible=!0}function J(){var d;(d=b.value)==null||d.clearValidate()}function m(){t.currentItem={type:"add",editData:{id:"",name:"",description:""}},t.dialogVisible=!0}function w({id:d}){ne.confirm("删除后，该分类下的模型将一并删除，是否确定？","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{O.deleteModelGroup(d).then(r=>{r.code==="0000"?(ee({type:"success",title:"删除成功"}),t.currentNodeKey===d&&(t.currentNodeKey="#"),G()):ee({type:"warning",title:"删除失败，请重试"})}).catch(r=>{ee({type:"error",title:"删除错误",message:r.message||"服务有错"})})}).catch(()=>{})}function y(){var d;(d=b.value)==null||d.validate(r=>{if(r){const{name:p,description:V,id:X}=t.currentItem.editData;t.submiting=!0,O.addOrUpdateModelGroup({id:X,name:p,description:V,parentId:"#"}).then(A=>{t.submiting=!1,A.code==="0000"?(ee({type:"success",title:`${p}保存成功`}),t.dialogVisible=!1,G()):(t.submiting=!1,ee({type:"error",title:"保存失败",message:A.message}))}).catch(A=>{t.submiting=!1,ee({type:"error",title:"保存失败",message:A.message})})}})}function M(d){return Y("scene_modelgroup_updateModelGroupOrder")?d.data.id!=="#":!1}function x(d,r,p){return r.data.id==="#"?p==="inner":p!=="inner"}function S(){const r=t.modelTypeData[0].children.map(p=>p.id).join(",");O.updateModelGroupOrder(r).then(p=>{p.code==="0000"?G():v({type:"warning",message:"拖拽操作失败"})}).catch(()=>{v({type:"error",message:"拖拽操作错误"})})}function T(){var d,r,p,V;t.currentNodeKey==="#"?(t.currentNodeKey=t.modelTypeData[0].id,(r=(d=g.value)==null?void 0:d.smartTreeRef.value)==null||r.setCurrentKey(t.currentNodeKey)):(t.currentNodeKey="#",(V=(p=g.value)==null?void 0:p.smartTreeRef.value)==null||V.setCurrentKey(t.currentNodeKey))}return(d,r)=>{const p=h("el-icon"),V=h("el-tooltip"),X=h("el-input"),A=h("el-form-item"),ge=h("el-form"),te=h("el-button"),_e=h("el-dialog"),oe=pe("action"),i=pe("loading");return u(),k(f(we),{id:"modelManage",background:""},{default:a(()=>[E((u(),k(f(Ze),{ref_key:"treeAsideRef",ref:H,class:"dbase-aside","element-loading-text":"拼命加载中..."},{default:a(()=>[l(f(Ye),{ref_key:"modelTypeTree",ref:g,data:t.modelTypeData,props:t.treeProps,"node-key":"id","empty-text":"暂无数据","default-expanded-keys":t.defaultExpandedkeys,"operate-config":{showCheckBox:!0,showBtn:!0},"current-node-key":t.currentNodeKey,"highlight-current":"","expand-on-click-node":!1,"filter-node-method":W,draggable:!0,"allow-drag":M,"allow-drop":x,onNodeDragEnd:S,onNodeClick:e,onCheckBoxChange:T,onClickBtn:m},{"smart-tree__node":a(({node:o,data:s})=>[l(f(He),{"custom-class":"db-node__content",text:o.label},{content:a(({setSlotRef:D,ellipsis:Q})=>[c("div",{ref:U=>D(U),class:z({"db-node__label":!0,"db-text__ellipsis":Q})},N(o.label),3),t.currentNodeKey===s.id?(u(),_("div",Rt,[l(V,{content:"编辑",placement:"bottom",effect:"light","show-after":350},{default:a(()=>[s.id!=="#"&&s.id!=="1"?E((u(),k(p,{key:0,onClick:$(U=>C(s),["stop"])},{default:a(()=>[l(f($e))]),_:2},1032,["onClick"])),[[oe,"scene_modelgroup_save"]]):L("",!0)]),_:2},1024),l(V,{content:"新增分类",placement:"bottom",effect:"light","show-after":350},{default:a(()=>[s.id==="#"?E((u(),k(p,{key:0,onClick:r[0]||(r[0]=$(U=>m(),["stop"]))},{default:a(()=>[l(f(Oe))]),_:1})),[[oe,"scene_modelgroup_save"]]):L("",!0)]),_:2},1024),l(V,{content:"删除",placement:"bottom",effect:"light","show-after":350},{default:a(()=>[s.id!=="#"&&s.id!=="1"?E((u(),k(p,{key:0,color:"var(--el-color-danger)",onClick:$(U=>w(s),["stop"])},{default:a(()=>[l(f(Ve))]),_:2},1032,["onClick"])),[[oe,"scene_modelgroup_delete"]]):L("",!0)]),_:2},1024)])):L("",!0)]),_:2},1032,["text"])]),_:1},8,["data","props","default-expanded-keys","current-node-key"])]),_:1})),[[i,t.isLoading]]),l(f(we),null,{default:a(()=>[l(f(We),{target:P.value},null,8,["target"]),l(Kt,{"model-group-id":t.currentNodeKey,"group-options":t.groupOptions},null,8,["model-group-id","group-options"])]),_:1}),l(_e,{modelValue:t.dialogVisible,"onUpdate:modelValue":r[4]||(r[4]=o=>t.dialogVisible=o),class:"model-dialog","append-to-dom":"modelManage","modal-append-to-body":!1,title:t.currentItem.type==="edit"?"编辑分类":t.currentItem.type==="add"?"新增分类":"查看分类",width:"500px","close-on-press-escape":!1,onOpened:J},{footer:a(()=>[l(f(se),{justify:"end"},{default:a(()=>[l(te,{onClick:r[3]||(r[3]=o=>t.dialogVisible=!1)},{default:a(()=>[I("取消")]),_:1}),t.currentItem.type!=="look"?(u(),k(te,{key:0,type:"primary",loading:t.submiting,onClick:y},{default:a(()=>[I("确定")]),_:1},8,["loading"])):L("",!0)]),_:1})]),default:a(()=>[c("div",jt,[l(ge,{ref_key:"typeForm",ref:b,model:t.currentItem.editData,"label-width":"100px",disabled:t.currentItem.type==="look"},{default:a(()=>[l(A,{label:"分类名称：",prop:"name",rules:[{required:!0,message:"分类名称不能为空",trigger:"blur"},{required:!0,message:"分类名称不能为空",trigger:"change"}]},{default:a(()=>[l(X,{modelValue:t.currentItem.editData.name,"onUpdate:modelValue":r[1]||(r[1]=o=>t.currentItem.editData.name=o),modelModifiers:{trim:!0},placeholder:"请输入分类名称",maxlength:"6","show-word-limit":"",clearable:""},null,8,["modelValue"])]),_:1}),l(A,{label:"分类描述："},{default:a(()=>[l(X,{modelValue:t.currentItem.editData.description,"onUpdate:modelValue":r[2]||(r[2]=o=>t.currentItem.editData.description=o),modelModifiers:{trim:!0},type:"textarea",placeholder:"请输入分类描述",maxlength:"50","show-word-limit":"",autosize:{minRows:3}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])])]),_:1},8,["modelValue","title"])]),_:1})}}});const io=Fe(Zt,[["__scopeId","data-v-975156c8"]]);export{io as default};
