import{t as ba,s as ha,D as ya,v as la,w as Ia,x as Sa,y as Fa,z as Ta,A as Ca}from"./login.a4e9287e.js";import{v as be,q as ia}from"./lodash.22f463b4.js";import{u as He,_ as ra,e as ka}from"./error.229cea25.js";import{d as Ce,b as X,N as da,ai as ee,aj as se,w as Me,L as Da,e as S,o as _,f as q,g as t,j as e,k as a,u as i,bV as wa,l as R,bE as Va,F as te,y as pe,x as B,B as re,z as ve,c as Be,Z as ca,_ as ua,r as ke,S as ma,i as Te,n as Ne,bW as qe,p as Ge,bc as pa,t as Ke,bm as fa,v as me,ae as Re,U as We,ak as ye,R as Na}from"./element-plus.59ccb443.js";import{m as he,k as Oa,a4 as Ye,a5 as Ze,S as Xe,i as oa,w as Ea}from"./index-a95bb620.js";import{f as sa,b as aa,h as ea,S as $a,D as Je,e as Aa}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{b as xa}from"./config.d740378b.js";import{l as La}from"./loseImg1.511f080c.js";import{_ as Pa}from"./CatalogTree.vue_vue_type_script_setup_true_lang.900e7dde.js";import{u as je,_ as Ra}from"./useReleaseForm.629f3403.js";import{D as Ma,a as Ua,_ as Ba}from"./DataSourceChooseDialog.vue_vue_type_style_index_0_lang.2da7576b.js";import{S as ga}from"./index.cc7bef78.js";import{A as Wa}from"./datasourceManage.013f4c4a.js";import"../../app-config.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";import"./serviceManage.8c46f250.js";import"./SmartMap.vue_vue_type_style_index_0_lang.6bf21d60.js";import"./smart3d.ce055bc9.js";import"./index.533bb29b.js";import"./useTableAndPagination.0c6e0294.js";import"./useTemplateData.bd428139.js";const ta=j=>(ca("data-v-a7af828b"),j=j(),ua(),j),Ga={class:"card"},qa=ta(()=>t("div",{class:"subtitle",style:{"margin-bottom":"10px"}},"参数设置",-1)),ja={class:"content-wrap"},za={class:"item-wrap item2"},Ja={class:"link-box"},Ha={class:"item-wrap"},Ka={class:"list-item"},Ya=ta(()=>t("span",null," — — ",-1)),Za={class:"item-wrap"},Xa={class:"item-wrap"},Qa={class:"item-wrap item2"},et=ta(()=>t("span",{style:{margin:"0 15px"}},"——",-1)),at=Ce({__name:"index",props:{styleType:{default:"WMS"},dataType:{default:""},isCheckType:{type:Boolean,default:!1}},setup(j,{expose:A}){const c=X("WMTS"),L=He(),F=X({cqlFilter:"",srs:"",format:["png"],gridSets:"",level:["",""],styleInfo:null}),J=X({type:"array",required:!0,trigger:"change",len:2,fields:{0:{type:"number",required:!0,message:"请完整填写切片级别"},1:{type:"number",required:!0,message:"请完整填写切片级别"}}}),u=X([]),O=X([]),l=X([]),g=X([]),M=X([]),Q=["TERRAIN","IMAGEDATA"],K=X(),P=j,E={label:"name",children:"children"},D={key:"type",value:0};function T(){const w=L.resolve({path:"/dataCenter/StylesManage"});window.open(w.href,"_blank")}s(),da(()=>{O.value.length===0&&v()});async function v(){await he.getStylesList().then(w=>{w.code==="0000"?O.value=w.data||[]:ee({type:"error",title:"获取样式列表失败",message:w.message})}).catch(w=>{ee({type:"error",title:"获取样式列表错误",message:w.message})})}function s(){sa.getSrsList().then(w=>{w.code==="0000"?(l.value=w.data,l.value.forEach(o=>{o.value=`EPSG:${o.value}`})):(l.value=[],se({type:"error",message:"获取坐标系统失败"}))}).catch(()=>{l.value=[],se({type:"error",message:"获取坐标系统错误"})}).finally(()=>{g.value=be(l.value)})}function d(w){w?l.value=be(g.value).filter(o=>o.label.toLowerCase().includes(w.toLowerCase())||o.value.toLowerCase().includes(w.toLowerCase())):l.value=be(g.value)}function k(w){F.value.level[0]="",F.value.level[1]="";const o=M.value.find(r=>r.value===w),le=Array(o.max+1).fill(1);u.value=[],le.forEach((r,ae)=>{u.value.push({value:ae,lebel:ae})})}function h(){sa.getGridSetsList().then(w=>{w.code==="0000"?M.value=w.data||[]:ee({type:"error",title:"获取网格集数据失败",message:w.message})}).catch(w=>{ee({type:"error",title:"获取网格集数据错误",message:w.message})})}Me(()=>P.styleType,w=>{c.value=w,w==="WMTS"&&h()},{immediate:!0});function y(w){return new Promise(o=>{K.value?K.value.validate(le=>{o(w?{name:w,valid:le}:le)}):o(w?{name:w,valid:!1}:!1)})}async function W(w){const o=JSON.parse(w);F.value.srs=o.srs?`EPSG:${o.srs}`:"",F.value.cqlFilter=o.cqlFilter;const le=o.styleId||"";if(O.value.length===0&&await v(),le){const ae=I(O.value).value.get(le);F.value.styleInfo=ae}}function x(w){F.value=w}function V(){var w;(w=K.value)==null||w.resetFields()}A({styleInfoData:F,checkFormPass:y,setStyleInfoData:W,resetForm:V,initStyleFormInfo:x});function I(w){return Be(()=>{const o=new Map,le=r=>{r.forEach(ae=>{var ne;o.set(ae.id,ae),((ne=ae==null?void 0:ae.children)==null?void 0:ne.length)>0&&le(ae.children)})};return le(be(w)),o})}return Da(()=>{var w;(w=K.value)==null||w.resetFields()}),(w,o)=>{const le=S("el-button"),r=S("el-form-item"),ae=S("el-option"),ne=S("el-select"),De=S("el-input"),Ie=S("el-checkbox"),Oe=S("el-checkbox-group"),we=S("el-form");return _(),q("div",Ga,[qa,t("div",ja,[e(we,{ref_key:"tileInfoForm",ref:K,class:"form edit-form",inline:"",model:F.value,"label-width":"auto","label-position":"right",disabled:P.isCheckType},{default:a(()=>[t("div",za,[e(r,{key:"styleInfo",class:"style-item",label:"样式设置",prop:"styleInfo"},{default:a(()=>[e(i(aa),{modelValue:F.value.styleInfo,"onUpdate:modelValue":o[0]||(o[0]=U=>F.value.styleInfo=U),style:{width:"100%"},"tree-props":E,"tree-data":O.value,"node-key":"id",icon:"iconCls","expand-on-click-node":!1,"default-expand-all":"",clearable:"",filterable:"","only-click-child":"","show-group-icon":"","group-identify":D},null,8,["modelValue","tree-data"]),t("div",Ja,[e(le,{type:"primary",link:"",icon:i(wa),onClick:T},{default:a(()=>[R(" 样式管理 ")]),_:1},8,["icon"]),e(le,{link:"",icon:i(Va),onClick:o[1]||(o[1]=U=>v())},{default:a(()=>[R(" 刷新 ")]),_:1},8,["icon"])])]),_:1})]),t("div",Ha,[e(r,{key:"wmtsTileInfoForm.srs",label:"输出坐标",prop:"srs",rules:{required:!0,message:"输出坐标不能为空",trigger:"change"}},{default:a(()=>[e(ne,{modelValue:F.value.srs,"onUpdate:modelValue":o[2]||(o[2]=U=>F.value.srs=U),style:{width:"100%"},"popper-class":"srs-select",filterable:"","filter-method":d,placeholder:"请选择坐标系统"},{default:a(()=>[(_(!0),q(te,null,pe(l.value,U=>(_(),B(ae,{key:U.value,label:U.value,value:U.value},{default:a(()=>[t("div",Ka,[t("span",null,re(U.value),1),Ya,t("span",null,re(U.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),t("div",Za,[e(r,{label:"过滤条件",prop:"cqlFilter"},{default:a(()=>[e(De,{modelValue:F.value.cqlFilter,"onUpdate:modelValue":o[3]||(o[3]=U=>F.value.cqlFilter=U),type:"textarea",rows:2,placeholder:"请输入过滤条件"},null,8,["modelValue"])]),_:1})]),c.value==="WMTS"?(_(),q(te,{key:0},[t("div",Xa,[e(r,{key:"wmtsTileInfoForm.format",label:"输出格式",prop:"format",rules:{required:!0,message:"至少选择一种输出格式",trigger:"change"}},{default:a(()=>[e(Oe,{modelValue:F.value.format,"onUpdate:modelValue":o[4]||(o[4]=U=>F.value.format=U)},{default:a(()=>[Q.includes(P.dataType)?(_(),B(Ie,{key:0,label:"gif"},{default:a(()=>[R("gif")]),_:1})):(_(),B(Ie,{key:1,label:"geojson"},{default:a(()=>[R("geojson")]),_:1})),e(Ie,{label:"jpeg"},{default:a(()=>[R("jpeg")]),_:1}),e(Ie,{label:"png",disabled:""},{default:a(()=>[R("png")]),_:1}),e(Ie,{label:"png8"},{default:a(()=>[R("png8")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),t("div",Qa,[e(r,{key:"wmtsTileInfoForm.gridSets",label:"网格集",prop:"gridSets",rules:{required:!0,message:"网格集不能为空",trigger:"change"}},{default:a(()=>[e(ne,{modelValue:F.value.gridSets,"onUpdate:modelValue":o[5]||(o[5]=U=>F.value.gridSets=U),style:{width:"100%"},filterable:"",placeholder:"请选择网格集",onChange:k},{default:a(()=>[(_(!0),q(te,null,pe(M.value,U=>(_(),B(ae,{key:U.value,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{key:"wmtsTileInfoForm.level",label:"切片级别",prop:"level",rules:J.value},{default:a(()=>[e(ne,{modelValue:F.value.level[0],"onUpdate:modelValue":o[6]||(o[6]=U=>F.value.level[0]=U),style:{width:"38%"},filterable:"",placeholder:"请选择","no-data-text":"请先选择网格集"},{default:a(()=>[(_(!0),q(te,null,pe(u.value,U=>(_(),B(ae,{key:U.value,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),et,e(ne,{modelValue:F.value.level[1],"onUpdate:modelValue":o[7]||(o[7]=U=>F.value.level[1]=U),style:{width:"38%"},filterable:"",placeholder:"请选择","no-data-text":"请先选择网格集"},{default:a(()=>[(_(!0),q(te,null,pe(u.value,U=>(_(),B(ae,{key:U.value,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"])])],64)):ve("",!0)]),_:1},8,["model","disabled"])])])}}}),tt=ra(at,[["__scopeId","data-v-a7af828b"]]),na=tt,lt=[{label:"所有",value:""},{label:"处理成功",value:"PROCESSED"},{value:"PROCESSING",label:"正在处理"},{value:"UPLOADING",label:"正在上传"},{value:"UPLOAD_FAIL",label:"上传失败"},{value:"PROCESS_FAIL",label:"处理失败"}];function ot(){const j=X([]),A=ke({searchOptions:[{label:"关键字",key:"keyword",type:"text",span:5,placeholder:"数据名称/创建者"},{label:"数据类型",key:"searchCategory",type:"cascader",placeholder:"请选择数据类型",options:[],clearable:!0,cascaderProps:{expandTrigger:"hover",value:"code",label:"text"},span:6},{label:"数据状态",key:"status",type:"select",clearable:!0,span:5,options:lt}],columns:[{prop:"thumbnailUrl",label:"缩略图",minWidth:120,showTooltip:!0,slot:"thumbnailUrl"},{prop:"name",label:"数据名称",minWidth:280,showTooltip:!0,sortable:!0,sortMethod:st,slot:"name"},{prop:"catalogName",label:"所属目录",minWidth:120,sortable:!0},{prop:"dataTypeAliasName",label:"数据类型",minWidth:200,sortable:!0,formatter:it},{prop:"resourceType",label:"数据来源",minWidth:130,sortable:!0,slot:"resourceType"},{prop:"dataSize",label:"数据大小",minWidth:130,sortable:!0},{prop:"creator",label:"创建者",minWidth:130,sortable:!0},{prop:"createTime",label:"创建时间",minWidth:180,sortable:!0},{prop:"status",label:"数据状态",minWidth:130,slot:"status",sortable:!0,sortMethod:nt,fixed:"right"}]});async function c(){const L=await Oa("DATATYPE");if(L.code==="0000"){const{data:{DATATYPE:F}}=L;j.value=F||[],j.value.forEach(J=>{var u,O,l;J.code=J.dictKey,J.text=J.dictValue,((u=J.children)==null?void 0:u.length)===0?delete J.children:((O=J.children)==null||O.unshift({code:"",text:"所有格式",dictKey:"",dictValue:"所有格式"}),(l=J.children)==null||l.forEach(g=>{var M;g.code=g.dictKey,g.text=g.dictValue,((M=g.children)==null?void 0:M.length)===0&&delete g.children}))}),j.value.unshift({code:"",text:"所有数据"}),A.searchOptions[1].options=j.value}}return c(),{...ma(A)}}function st(j,A,c){let L=0,F=0;return j[c.prop]&&(L=Number(j[c.prop].replace("M",""))),A[c.prop]&&(F=Number(A[c.prop].replace("M",""))),L-F}function nt(j,A){const c=new Map;c.set("SLICING",0),c.set("UPLOAD_FAIL",1),c.set("NOT_PROCESS",2),c.set("PROCESSED",3),c.set("PUBLISHED",4),c.set("UPLOADING",5),c.set("PROCESSING",6);const L=c.get(j.status)||0,F=c.get(A.status)||0;return L-F}function it(j){return`${j.dataTypeAliasName} / ${j.dataFormat||"--"}`}const rt={class:"main"},dt={class:"card"},ct=t("div",{class:"subtitle"},"服务信息",-1),ut={class:"content-wrap"},mt={class:"item-wrap item2"},pt={class:"item-wrap item2"},ft={class:"item-wrap"},gt={class:"card"},vt=t("div",{class:"subtitle"},"数据信息",-1),_t={class:"content-wrap"},bt={class:"footer"},ht=Ce({__name:"Serve3DTilesForm",setup(j){const{submiting:A,checkNameing:c,releseDataInfo:L,checkServiceName:F,checkFormPass:J,goToServiceManage:u}=je(Q,()=>L.value.dataType),O=X(),l=ke({serviceInfoForm:{publishService:!0,name:"",aliasName:"",categoryAliasName:"",description:"",category:"",catalogObj:null},treeProps:{label:"name",children:"children",disabled:"no"},dataInfoForm:{},dataInfoTableData:[],servicesOptions:[]}),g=Te("handleClosed"),M=Te("handleSave");function Q(){Ne(()=>{var D;(D=O.value)==null||D.clearValidate()}),P(),K()}async function K(){l.servicesOptions=await Ye(Ze.SERVICE);const D=l.servicesOptions[0];l.serviceInfoForm.catalogObj=D}function P(){const{dataTypeAliasName:D,dataFormat:T,name:v,dataSize:s,createTime:d}=L.value;l.dataInfoForm.dataName=v,l.dataInfoForm.dataTypeAliasName=D,l.dataInfoForm.dataFormat=T,l.dataInfoForm.dataSize=s,l.dataInfoForm.createTime=d,l.dataInfoTableData=[l.dataInfoForm],l.serviceInfoForm.name="",l.serviceInfoForm.aliasName=v,l.serviceInfoForm.description="",l.serviceInfoForm.categoryAliasName=D,l.serviceInfoForm.catalogObj=null}function E(){J(O).then(T=>{if(T){const v={resourceId:L.value.resourceId,name:l.serviceInfoForm.name,publishService:l.serviceInfoForm.publishService,aliasName:l.serviceInfoForm.aliasName,description:l.serviceInfoForm.description,catalogId:l.serviceInfoForm.catalogObj.id,category:L.value.dataType,categoryAliasName:L.value.dataTypeAliasName};A.value=!0,he.publishService([v]).then(s=>{A.value=!1,s.code==="0000"?(ee({type:"success",customClass:"custom-relese-notification",title:"服务发布成功，前往查看",onClick:()=>{u("/dataCenter/ServiceManage")}}),M==null||M(),g==null||g()):ee({type:"error",title:"服务发布失败",message:s.message})}).catch(s=>{A.value=!1,ee({type:"error",title:"服务发布错误",message:s.message})})}})}return(D,T)=>{const v=S("el-icon"),s=S("el-input"),d=S("el-form-item"),k=S("el-form"),h=S("el-table-column"),y=S("el-table"),W=S("el-button");return _(),q(te,null,[t("div",rt,[t("div",dt,[ct,t("div",ut,[e(k,{ref_key:"editServeInfoForm",ref:O,class:"form edit-form",inline:"",model:l.serviceInfoForm,"label-width":"auto","label-position":"right"},{default:a(()=>[t("div",mt,[e(d,{label:"服务标识",prop:"name",rules:[{validator:i(F),trigger:["change"]}]},{default:a(()=>[e(s,{modelValue:l.serviceInfoForm.name,"onUpdate:modelValue":T[0]||(T[0]=x=>l.serviceInfoForm.name=x),type:"text",placeholder:"英文大小写字母和数字",maxlength:"50","show-word-limit":""},{suffix:a(()=>[i(c)?(_(),B(v,{key:0,class:"el-input__icon"},{default:a(()=>[e(i(qe))]),_:1})):ve("",!0)]),_:1},8,["modelValue"])]),_:1},8,["rules"]),e(d,{label:"服务名称",prop:"aliasName",rules:[{required:!0,message:"服务名称不能为空",trigger:["blur","change"]}]},{default:a(()=>[e(s,{modelValue:l.serviceInfoForm.aliasName,"onUpdate:modelValue":T[1]||(T[1]=x=>l.serviceInfoForm.aliasName=x),type:"text",placeholder:"请输入服务名称"},null,8,["modelValue"])]),_:1})]),t("div",pt,[e(d,{label:"服务类型",prop:"categoryAliasName"},{default:a(()=>[t("span",null,re(l.serviceInfoForm.categoryAliasName),1)]),_:1}),e(d,{label:"服务目录",prop:"catalogObj",rules:[{required:!0,message:"请选择服务目录",trigger:["change"]}]},{default:a(()=>[e(i(Xe),{modelValue:l.serviceInfoForm.catalogObj,"onUpdate:modelValue":T[2]||(T[2]=x=>l.serviceInfoForm.catalogObj=x),"tree-props":l.treeProps,"tree-data":l.servicesOptions,"value-key":"id",style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data"])]),_:1})]),t("div",ft,[e(d,{label:"服务说明",prop:"description"},{default:a(()=>[e(s,{modelValue:l.serviceInfoForm.description,"onUpdate:modelValue":T[3]||(T[3]=x=>l.serviceInfoForm.description=x),type:"textarea",rows:2,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"])])]),t("div",gt,[vt,t("div",_t,[e(k,{ref:"tableFormRef",class:"table-form tableContainer",model:l},{default:a(()=>[e(y,{ref:"tableRef",class:"table commonTable sortableTable",data:l.dataInfoTableData},{default:a(()=>[e(h,{prop:"dataName",label:"数据名称"}),e(h,{prop:"dataTypeAliasName",label:"数据类型"}),e(h,{prop:"dataFormat",label:"数据格式"}),e(h,{prop:"createTime",label:"创建时间"})]),_:1},8,["data"])]),_:1},8,["model"])])])]),t("div",bt,[e(W,{onClick:i(g)},{default:a(()=>[R("取消")]),_:1},8,["onClick"]),e(W,{type:"primary",loading:i(A),onClick:E},{default:a(()=>[R("保存")]),_:1},8,["loading"])])],64)}}}),yt={class:"main"},It={class:"card"},St=t("div",{class:"subtitle"},"服务信息",-1),Ft={class:"content-wrap"},Tt={class:"item-wrap item2"},Ct={class:"item-wrap item2"},kt={class:"item-wrap"},Dt={class:"card"},wt=t("div",{class:"subtitle"},"数据信息",-1),Vt={class:"content-wrap"},Nt={class:"card"},Ot=t("div",{class:"subtitle"},"参数设置",-1),Et={class:"content-wrap"},$t={class:"item-wrap item2"},At={class:"footer"},xt=Ce({__name:"ServeIOTForm",setup(j){const{submiting:A,checkNameing:c,releseDataInfo:L,checkServiceName:F,checkFormPass:J,goToServiceManage:u}=je(K,()=>L.value.dataType),O=X(),l=X(),g=ke({serviceInfoForm:{publishService:!0,name:"",aliasName:"",categoryAliasName:"",description:"",category:"",protocol:""},protocolTypeOptions:[{value:"HTTP",label:"HTTP协议"},{value:"WEBSOCKET",label:"WebSocket协议"}],dataInfoForm:{},dataInfoTableData:[]}),M=Te("handleClosed"),Q=Te("handleSave");function K(){Ne(()=>{var D,T;(D=O.value)==null||D.clearValidate(),(T=l==null?void 0:l.value)==null||T.clearValidate()}),P()}function P(){const{dataTypeAliasName:D,dataFormat:T,name:v,dataSize:s,storagetype:d,tableName:k,createTime:h}=L.value;g.dataInfoForm.dataName=v,g.dataInfoForm.dataTypeAliasName=D,g.dataInfoForm.dataFormat=T,g.dataInfoForm.dataSize=s,g.dataInfoForm.storagetype=d,g.dataInfoForm.tableName=k,g.dataInfoForm.createTime=h,g.dataInfoTableData=[g.dataInfoForm],g.serviceInfoForm.name="",g.serviceInfoForm.aliasName=v,g.serviceInfoForm.description="",g.serviceInfoForm.categoryAliasName=D,g.serviceInfoForm.protocol="HTTP"}function E(){J(O).then(T=>{if(T){const v={protocol:g.serviceInfoForm.protocol},s={resourceId:L.value.resourceId,name:g.serviceInfoForm.name,aliasName:g.serviceInfoForm.aliasName,description:g.serviceInfoForm.description,publishService:g.serviceInfoForm.publishService,category:L.value.dataType,categoryAliasName:L.value.dataTypeAliasName,tileConfig:JSON.stringify(v)};A.value=!0,he.publishService([s]).then(d=>{A.value=!1,d.code==="0000"?(ee({type:"success",customClass:"custom-relese-notification",title:"服务发布成功，前往查看",onClick:()=>{u("/IOTServiceManage")}}),Q==null||Q(),M==null||M()):ee({type:"error",title:"服务发布失败",message:d.message})}).catch(d=>{A.value=!1,ee({type:"error",title:"服务发布错误",message:d.message})})}})}return(D,T)=>{const v=S("el-icon"),s=S("el-input"),d=S("el-form-item"),k=S("el-form"),h=S("el-table-column"),y=S("el-table"),W=S("el-option"),x=S("el-select"),V=S("el-button");return _(),q(te,null,[t("div",yt,[t("div",It,[St,t("div",Ft,[e(k,{ref_key:"editServeInfoForm",ref:O,class:"form edit-form",inline:"",model:g.serviceInfoForm,"label-width":"auto","label-position":"right"},{default:a(()=>[t("div",Tt,[e(d,{label:"服务标识",prop:"name",rules:[{validator:i(F),trigger:["change"]}]},{default:a(()=>[e(s,{modelValue:g.serviceInfoForm.name,"onUpdate:modelValue":T[0]||(T[0]=I=>g.serviceInfoForm.name=I),type:"text",placeholder:"英文大小写字母和数字",maxlength:"50","show-word-limit":""},{suffix:a(()=>[i(c)?(_(),B(v,{key:0,class:"el-input__icon"},{default:a(()=>[e(i(qe))]),_:1})):ve("",!0)]),_:1},8,["modelValue"])]),_:1},8,["rules"]),e(d,{label:"服务名称",prop:"aliasName",rules:[{required:!0,message:"服务名称不能为空",trigger:["blur","change"]}]},{default:a(()=>[e(s,{modelValue:g.serviceInfoForm.aliasName,"onUpdate:modelValue":T[1]||(T[1]=I=>g.serviceInfoForm.aliasName=I),type:"text",placeholder:"请输入服务名称"},null,8,["modelValue"])]),_:1})]),t("div",Ct,[e(d,{label:"服务类型",prop:"categoryAliasName"},{default:a(()=>[t("span",null,re(g.serviceInfoForm.categoryAliasName),1)]),_:1}),e(d)]),t("div",kt,[e(d,{label:"服务说明",prop:"description"},{default:a(()=>[e(s,{modelValue:g.serviceInfoForm.description,"onUpdate:modelValue":T[2]||(T[2]=I=>g.serviceInfoForm.description=I),type:"textarea",rows:2,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"])])]),t("div",Dt,[wt,t("div",Vt,[e(k,{ref:"tableFormRef",class:"table-form tableContainer",model:g},{default:a(()=>[e(y,{ref:"tableRef",class:"table commonTable sortableTable",data:g.dataInfoTableData},{default:a(()=>[e(h,{prop:"dataName",label:"数据名称"}),e(h,{prop:"dataTypeAliasName",label:"数据类型"}),e(h,{prop:"dataFormat",label:"数据格式"}),e(h,{prop:"createTime",label:"创建时间"})]),_:1},8,["data"])]),_:1},8,["model"])])]),t("div",Nt,[Ot,t("div",Et,[e(k,{ref_key:"paramsForm",ref:l,class:"form edit-form",inline:"",model:g.serviceInfoForm,"label-width":"auto","label-position":"right"},{default:a(()=>[t("div",$t,[e(d,{key:"protocol",label:"协议类型",prop:"protocol",rules:{required:!0,message:"协议类型不能为空",trigger:"change"}},{default:a(()=>[e(x,{modelValue:g.serviceInfoForm.protocol,"onUpdate:modelValue":T[3]||(T[3]=I=>g.serviceInfoForm.protocol=I),style:{width:"100%"},placeholder:"请选择"},{default:a(()=>[(_(!0),q(te,null,pe(g.protocolTypeOptions,I=>(_(),B(W,{key:I.value,label:I.label,value:I.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d)])]),_:1},8,["model"])])])]),t("div",At,[e(V,{onClick:i(M)},{default:a(()=>[R("取消")]),_:1},8,["onClick"]),e(V,{type:"primary",loading:i(A),onClick:E},{default:a(()=>[R("保存")]),_:1},8,["loading"])])],64)}}}),Lt={class:"main"},Pt={class:"card"},Rt=t("div",{class:"subtitle"},"服务信息",-1),Mt={class:"content-wrap"},Ut={class:"item-wrap item2"},Bt={class:"item-wrap item2"},Wt={class:"item-wrap"},Gt={class:"card"},qt=t("div",{class:"subtitle"},"数据信息",-1),jt={class:"content-wrap"},zt={class:"footer"},Jt=Ce({__name:"ServeMapTilePackgeForm",setup(j){const{submiting:A,checkNameing:c,releseDataInfo:L,checkServiceName:F,checkFormPass:J,goToServiceManage:u}=je(Q,()=>L.value.dataType),O=X(),l=ke({serviceInfoForm:{publishService:!0,name:"",aliasName:"",categoryAliasName:"",description:"",category:"",catalogObj:null},serviceNameList:[{value:"MBTILES",label:"MBTiles服务"},{value:"TMSTILE",label:"TMS服务"}],dataInfoForm:{},dataInfoTableData:[],treeProps:{label:"name",children:"children",disabled:"no"},servicesOptions:[]}),g=Te("handleClosed"),M=Te("handleSave");function Q(){Ne(()=>{var D;(D=O.value)==null||D.clearValidate()}),P(),K()}async function K(){l.servicesOptions=await Ye(Ze.SERVICE);const D=l.servicesOptions[0];l.serviceInfoForm.catalogObj=D}function P(){var y;const{dataTypeAliasName:D,dataFormat:T,name:v,dataSize:s,storagetype:d,tableName:k,createTime:h}=L.value;l.dataInfoForm.dataName=v,l.dataInfoForm.dataTypeAliasName=D,l.dataInfoForm.dataFormat=T,l.dataInfoForm.dataSize=s,l.dataInfoForm.storagetype=d,l.dataInfoForm.tableName=k,l.dataInfoForm.createTime=h,l.dataInfoTableData=[l.dataInfoForm],l.serviceInfoForm.name="",l.serviceInfoForm.aliasName=v,l.serviceInfoForm.description="",l.serviceInfoForm.categoryAliasName=(y=l.serviceNameList.find(W=>W.value===T))==null?void 0:y.label,l.serviceInfoForm.catalogObj=null}function E(){J(O).then(T=>{if(T){const v={resourceId:L.value.resourceId,name:l.serviceInfoForm.name,aliasName:l.serviceInfoForm.aliasName,description:l.serviceInfoForm.description,publishService:l.serviceInfoForm.publishService,category:L.value.dataType,categoryAliasName:l.serviceInfoForm.categoryAliasName,catalogId:l.serviceInfoForm.catalogObj.id};A.value=!0,he.publishService([v]).then(s=>{A.value=!1,s.code==="0000"?(ee({type:"success",customClass:"custom-relese-notification",title:"服务发布成功，前往查看",onClick:()=>{u("/dataCenter/ServiceManage")}}),M==null||M(),g==null||g()):ee({type:"error",title:"服务发布失败",message:s.message})}).catch(s=>{A.value=!1,ee({type:"error",title:"服务发布错误",message:s.message})})}})}return(D,T)=>{const v=S("el-icon"),s=S("el-input"),d=S("el-form-item"),k=S("el-form"),h=S("el-table-column"),y=S("el-table"),W=S("el-button");return _(),q(te,null,[t("div",Lt,[t("div",Pt,[Rt,t("div",Mt,[e(k,{ref_key:"editServeInfoForm",ref:O,class:"form edit-form",inline:"",model:l.serviceInfoForm,"label-width":"auto","label-position":"right"},{default:a(()=>[t("div",Ut,[e(d,{label:"服务标识",prop:"name",rules:[{validator:i(F),trigger:["change"]}]},{default:a(()=>[e(s,{modelValue:l.serviceInfoForm.name,"onUpdate:modelValue":T[0]||(T[0]=x=>l.serviceInfoForm.name=x),type:"text",placeholder:"英文大小写字母和数字",maxlength:"50","show-word-limit":""},{suffix:a(()=>[i(c)?(_(),B(v,{key:0,class:"el-input__icon"},{default:a(()=>[e(i(qe))]),_:1})):ve("",!0)]),_:1},8,["modelValue"])]),_:1},8,["rules"]),e(d,{label:"服务名称",prop:"aliasName",rules:[{required:!0,message:"服务名称不能为空",trigger:["blur","change"]}]},{default:a(()=>[e(s,{modelValue:l.serviceInfoForm.aliasName,"onUpdate:modelValue":T[1]||(T[1]=x=>l.serviceInfoForm.aliasName=x),type:"text",placeholder:"请输入服务名称"},null,8,["modelValue"])]),_:1})]),t("div",Bt,[e(d,{label:"服务类型",prop:"categoryAliasName"},{default:a(()=>[t("span",null,re(l.serviceInfoForm.categoryAliasName),1)]),_:1}),e(d,{label:"服务目录",prop:"catalogObj",rules:[{required:!0,message:"请选择服务目录",trigger:["change"]}]},{default:a(()=>[e(i(Xe),{modelValue:l.serviceInfoForm.catalogObj,"onUpdate:modelValue":T[2]||(T[2]=x=>l.serviceInfoForm.catalogObj=x),"tree-props":l.treeProps,"tree-data":l.servicesOptions,"value-key":"id",style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data"])]),_:1})]),t("div",Wt,[e(d,{label:"服务说明",prop:"description"},{default:a(()=>[e(s,{modelValue:l.serviceInfoForm.description,"onUpdate:modelValue":T[3]||(T[3]=x=>l.serviceInfoForm.description=x),type:"textarea",rows:2,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"])])]),t("div",Gt,[qt,t("div",jt,[e(k,{ref:"tableFormRef",class:"table-form tableContainer",model:l},{default:a(()=>[e(y,{ref:"tableRef",class:"table commonTable sortableTable",data:l.dataInfoTableData},{default:a(()=>[e(h,{prop:"dataName",label:"数据名称"}),e(h,{prop:"dataTypeAliasName",label:"数据类型"}),e(h,{prop:"dataFormat",label:"数据格式"}),e(h,{prop:"createTime",label:"创建时间"})]),_:1},8,["data"])]),_:1},8,["model"])])])]),t("div",zt,[e(W,{onClick:i(g)},{default:a(()=>[R("取消")]),_:1},8,["onClick"]),e(W,{type:"primary",loading:i(A),onClick:E},{default:a(()=>[R("保存")]),_:1},8,["loading"])])],64)}}});function va(j,A=!0){const c=ke({defaultTileInfoForm:{taskInfo:[]},tileInfoForm:{taskInfo:[]},tileInfoFormRule:{taskInfo:[{required:!0,message:"切片方案不能为空",trigger:"change"}]},treeProps:{label:"name",children:"children"},taskTreeData:[],curTaskId:"",cellData:[],publishConfigList:[],isLoadingScheme:!1,showErrorTip:!1});function L(){c.tileInfoForm=be(c.defaultTileInfoForm),c.curTaskId="",c.cellData=[],c.publishConfigList=[],c.isLoadingScheme=!1,c.showErrorTip=!1}function F(){ea.getClassifyTree().then(v=>{v.code==="0000"?(c.taskTreeData=v.data,J()):(se({type:"warning",message:"获取切片方案数据有误"}),c.taskTreeData=[])}).catch(v=>{se({type:"error",message:v.message||"获取切片方案数据有误"}),c.taskTreeData=[]})}function J(){const v=s=>{var d;for(let k=0,h=s.length;k<h;k++)s[k].type===1&&s[k].dataType?s[k].name=`(默认) ${s[k].name}`:((d=s[k].children)==null?void 0:d.length)>0&&v(s[k].children)};v(c.taskTreeData),A&&u()}function u(){let v=null;const s=d=>{var k;for(let h=0,y=d.length;h<y;h++)if(d[h].type===1&&d[h].dataType&&d[h].dataType===j.value){v=d[h];break}else((k=d[h].children)==null?void 0:k.length)>0&&s(d[h].children)};s(c.taskTreeData),c.tileInfoForm.taskInfo=v,v&&l(v)}function O(v){let s=null;const d=k=>{var h;for(let y=0,W=k.length;y<W;y++)if(k[y].type===1&&k[y].id===v){s=k[y];break}else((h=k[y].children)==null?void 0:h.length)>0&&d(k[y].children)};d(c.taskTreeData),c.tileInfoForm.taskInfo=s,s&&(c.curTaskId=(s==null?void 0:s.id)||""),c.isLoadingScheme=!1}function l(v){v.id!==c.curTaskId&&(c.curTaskId=v.id,c.isLoadingScheme=!0,ea.getSchemeInfo(c.curTaskId).then(s=>{if(s.code==="0000"){const d=JSON.parse(s.data.scheme).cells;c.cellData=be(d),D();const k=c.cellData.filter(h=>{var y;return h.type==="algorithm.Element"&&h.algorithmType!=="READ_DATASOURCE"&&h.algorithmType!=="WRITE_DATASOURCE"&&((y=h.publishParamList)==null?void 0:y.length)>0});for(let h=0,y=k.length;h<y;h++)E(k[h]);Q(d)}else c.isLoadingScheme=!1,se({type:"warning",message:"获取方案信息有误"})}).catch(s=>{c.isLoadingScheme=!1,se({type:"error",message:s.message||"获取方案信息错误"})}))}function g(v){c.isLoadingScheme=!0;const s=JSON.parse(v).cells;c.cellData=be(s),D(),Q(s)}function M(v){return c.cellData.find(s=>s.id===v)}function Q(v){const s=v.filter(d=>{var k;return d.type==="algorithm.Element"&&d.algorithmType!=="READ_DATASOURCE"&&d.algorithmType!=="WRITE_DATASOURCE"&&((k=d.publishParamList)==null?void 0:k.length)>0});if(s.length>0){const d=Array(s.length).fill(null);s.forEach((h,y)=>{d[y]=K(h.version.id,h.id)}),Promise.all(d).then(h=>{h.some(y=>!y)?(se({type:"warning",message:"获取参数失败！"}),c.publishConfigList=[]):(c.publishConfigList=be(h),s.forEach(y=>{c.publishConfigList.forEach(W=>{W.uid===y.id&&y.publishParamList.forEach(x=>{W.pubulishData[x]=y.data[x]})})}),c.publishConfigList.forEach(y=>{y.paramsConfigList=y.paramsConfigList.filter(W=>y.pubulishData.hasOwnProperty(W.paramName)&&W.paramDirection!=="INPUT"),y.relations=y.relations.filter(W=>y.pubulishData.hasOwnProperty(W.source)&&y.pubulishData.hasOwnProperty(W.target))}),c.isLoadingScheme=!1)})}else c.publishConfigList=[],c.isLoadingScheme=!1}function K(v,s){return new Promise(d=>{ea.getAlgorithmDetailInfo(v).then(k=>{if(k.code==="0000"){const{data:h}=k,{name:y,paramsConfig:W}=h;if(oa(W)){const V=JSON.parse(W),I={paramsConfigList:V.config||[],relations:V.relations||[],type:V.type||"JOB",name:y,uid:s,pubulishData:{}};setTimeout(()=>{d(be(I))},100)}else d(!1)}else d(!1)}).catch(()=>{d(!1),c.isLoadingScheme=!1})})}function P(v,s,d){const k=c.publishConfigList.find(y=>y.uid===d);k.pubulishData[s]=v;const h=M(d);h.data[s]=v,E(h),setTimeout(()=>{D()},100)}function E(v){const{data:s={},requiredParamList:d=[],paramTypeEnums:k={}}=v;let h=!0;for(let y=0,W=d.length;y<W;y++){if(s[d[y]]===void 0||s[d[y]]===null||s[d[y]]===""){h=!1;break}if(k[d[y]]==="GEO_SRS")if(oa(s[d[y]])){const x=JSON.parse(s[d[y]]);if(!Array.isArray(x)||Array.isArray(x)&&x.length===0){h=!1;break}else if(x.some(V=>!(V!=null&&V.coordinateName)||!(V!=null&&V.geodeticDatum))){h=!1;break}}else{h=!1;break}}v.isPassValid=h}function D(v=!1,s=""){const d=be(c.cellData);return new Promise(k=>{let h=!0;for(let y=0,W=d.length;y<W;y++){const x=d[y];if(x.type==="algorithm.Element"&&(x.isError||!x.isPassValid)){h=!1;break}}h?(k(s?{name:s,valid:!0}:!0),c.showErrorTip=!1):(v&&se({type:"warning",message:"请正确填写参数赋值或选择正确的切片方案"}),k(s?{name:s,valid:!1}:!1),c.showErrorTip=!0)})}function T(v){return new Promise(s=>{v.validate(d=>{s(d)})})}return{...ma(c),initSchemeData:L,getAllTask:F,formatTreeData:J,getDefaultTaskInfo:u,handleTaskChange:l,getCellData:M,createTileInfoForm:Q,getParamConfigPromise:K,handleControlChange:P,setCellPassValid:E,checkDagScheme:D,checkSchemeForm:T,getTaskInfoById:O,renderSchemeByDag:g}}const Ht={class:"main server-common-form"},Kt={class:"card"},Yt=t("div",{class:"subtitle"},"服务信息",-1),Zt={class:"content-wrap"},Xt={class:"item-wrap item2"},Qt={class:"item-wrap item2"},el={class:"item-wrap"},al={class:"card"},tl=t("div",{class:"subtitle"},"数据信息",-1),ll={class:"content-wrap",style:{"margin-bottom":"18px"}},ol={class:"content-wrap"},sl={class:"item-wrap"},nl={class:"list-item"},il=t("span",null," — — ",-1),rl={class:"link-box"},dl=t("input",{id:"importCoordinateFile",style:{display:"none"},type:"file",class:"importCoordinateFile",directory:"",nwdirectory:"",accept:".xml"},null,-1),cl={key:0,class:"item-wrap"},ul={class:"card"},ml=t("div",{class:"subtitle",style:{"margin-bottom":"0"}}," 参数设置 ",-1),pl={class:"tab-container"},fl={class:"content-wrap"},gl={class:"content-wrap"},vl={"element-loading-text":"正在获取方案参数..."},_l={class:"content-wrap"},bl={class:"item-wrap item2"},hl={key:1,class:"content-wrap no-choose"},yl={class:"footer"},Il=Ce({__name:"Serve2DCommonForm",setup(j){const A=He(),{submiting:c,checkNameing:L,treeProps:F,groupIdentify:J,srsOptions:u,dataType:O,releseDataInfo:l,checkServiceName:g,checkFormPass:M,getListData:Q,srsFilterFunc:K}=je(Ie,()=>l.value.dataType),{tileInfoForm:P,cellData:E,isLoadingScheme:D,tileInfoFormRule:T,taskTreeData:v,publishConfigList:s,getAllTask:d,initSchemeData:k,checkDagScheme:h,handleTaskChange:y,handleControlChange:W}=va(O),x=X(),V=X(),I=X(),w=X(),o=X(),le=X([]),r=ke({includesBandSettings:["TERRAIN","IMAGEDATA"],serviceInfoForm:{publishService:!0,name:"",aliasName:"",categoryAliasName:"",description:"",category:"",categoryList:[],catalogObj:null},categoryOptions:[{value:"WMS",label:"WMS服务"},{value:"WMTS",label:"WMTS服务"}],dataInfoForm:{srs:"",origin:{x:"",y:"",z:""},rotate:0,bandSettings:[]},dataInfoFormRule:{srs:[{required:!0,message:"坐标系统不能为空",trigger:"change"}]},bandTableData:[{prop:"name",label:"波段"},{prop:"nullValue",label:"空值"},{prop:"min",label:"最小范围"},{prop:"max",label:"最大范围"}],dataInfoTableData:[],initDataInfo:{srs:"",srsOrigin:"",rotate:0},curTabName:"WMS",servicesOptions:[],treeProps:{label:"name",children:"children",disabled:"no"}});Ge("getCellById",ae);function ae(m){var $;const n=($=E.value)==null?void 0:$.find(G=>G.id===m);return n?{attributes:n}:{}}const ne=Te("handleClosed"),De=Te("handleSave");pa(()=>{le.value=[]});function Ie(){Ne(()=>{var m,n,$;(m=x.value)==null||m.clearValidate(),(n=V.value)==null||n.clearValidate(),($=I.value)==null||$.clearValidate(),w.value&&w.value.resetForm(),o.value&&o.value.resetForm()}),we(),Q(),U(),d(),Oe()}async function Oe(){r.servicesOptions=await Ye(Ze.SERVICE);const m=r.servicesOptions[0];r.serviceInfoForm.catalogObj=m}function we(){const{dataTypeAliasName:m,dataFormat:n,name:$,dataSize:G,createTime:b}=l.value;r.dataInfoForm.dataName=$,r.dataInfoForm.dataTypeAliasName=m,r.dataInfoForm.dataFormat=n,r.dataInfoForm.dataSize=G,r.dataInfoForm.createTime=b,r.dataInfoForm.bandSettings=[{name:"RED_BAND",nullValue:"",min:"",max:""},{name:"GREEN_BAND",nullValue:"",min:"",max:""},{name:"BLUE_BAND",nullValue:"",min:"",max:""}],r.dataInfoTableData=[r.dataInfoForm],r.serviceInfoForm.name="",r.serviceInfoForm.catalogObj=null,r.serviceInfoForm.aliasName=$,r.serviceInfoForm.description="",r.serviceInfoForm.categoryAliasName=m,r.serviceInfoForm.categoryList=["WMS"],r.curTabName="WMS",Ne(()=>{w.value.initStyleFormInfo({cqlFilter:"",srs:"EPSG:4326",styleInfo:null}),o.value.initStyleFormInfo({cqlFilter:"",srs:"EPSG:4326",format:["png"],gridSets:"",level:["",""],styleInfo:null})}),k()}function U(){const m=()=>{r.dataInfoForm.origin={x:"",y:"",z:""}};he.getDataInfoById(l.value.resourceId).then(n=>{var $,G,b;if(n.code==="0000")if(r.initDataInfo.srs=(($=n==null?void 0:n.data)==null?void 0:$.srs)??"EPSG:4326",r.initDataInfo.srsOrigin=((G=n==null?void 0:n.data)==null?void 0:G.srsOrigin)??"0,0,0",r.initDataInfo.rotate=((b=n==null?void 0:n.data)==null?void 0:b.rotate)??0,O.value=n.data.dataType,r.dataInfoForm.srs=n.data.srs||"EPSG:4326",n.data.srsOrigin){const z=n.data.srsOrigin.split(",");r.dataInfoForm.origin={x:z[0],y:z[1],z:z[2]}}else m();else r.dataInfoForm.srs="EPSG:4326",m()}).catch(()=>{r.dataInfoForm.srs="EPSG:4326",m()}).finally(()=>{r.dataInfoForm.rotate=0,d()})}function Ue(m){l.value.dataType==="VECTOR"&&(m.includes("WMS")||(r.serviceInfoForm.categoryList=r.serviceInfoForm.categoryList.filter(n=>n!=="WFS")))}function Ee(m,n){m?r.serviceInfoForm.categoryList.length===1&&(r.curTabName=n):r.curTabName===n&&r.serviceInfoForm.categoryList.length!==0&&([r.curTabName]=r.serviceInfoForm.categoryList)}function $e(m){r.curTabName!==m&&(r.curTabName=m)}function Y(){var m,n;(m=document.getElementById("importCoordinateFile"))==null||m.click(),(n=document.getElementById("importCoordinateFile"))==null||n.addEventListener("change",$=>{const{files:G}=$.target;if(G.length===0)return;const b=G[0];if(!/\.xml$/g.test(b.name)){ye.alert("仅支持导入xml格式！","提示",{confirmButtonText:"确定",type:"error"}),$.target.value="";return}C(b,z=>{r.dataInfoForm.srs=z.system,["VECTOR","TERRAIN","IMAGEDATA"].includes(l.value.dataType)&&(r.dataInfoForm.origin=z.origin),se({type:"success",message:"坐标导入成功!"})}),$.target.value=""})}function C(m,n){const $=new FileReader;$.onload=G=>{var _e,de;const b=G.target.result,z={},fe=b.match(/<SRS[^>]*>([\s\S]*?)<\/SRS>/);let oe=b.match(/<SRSOrigin[^>]*>([\s\S]*?)<\/SRSOrigin>/);if(["VECTOR","TERRAIN","IMAGEDATA"].includes(l.value.dataType)){if(!fe||!oe){ye.alert("文件未包含必要信息！请检查后重新导入！","提示",{confirmButtonText:"确定",type:"error"});return}}else if(!fe){ye.alert("文件未包含必要信息！请检查后重新导入！","提示",{confirmButtonText:"确定",type:"error"});return}[,z.system]=fe,["VECTOR","TERRAIN","IMAGEDATA"].includes(l.value.dataType)&&(oe=(de=(_e=oe[1])==null?void 0:_e.replace(/\s*/g,""))==null?void 0:de.split(","),z.origin={x:oe[0],y:oe[1],z:oe[2]}),n&&n(z)},$.readAsBinaryString(m)}function p(){const m=M(x),n=M(V);Promise.all([m,n]).then(([G,b])=>{var z;if(G&&b){const{name:fe,aliasName:oe,description:_e,publishService:de,categoryList:Se}=r.serviceInfoForm,N=[];if(Se.includes("WMS")){const H=w.value.checkFormPass("WMS");N.push(H)}if(Se.includes("WMTS")){const H=o.value.checkFormPass("WMTS");N.push(H)}Se.includes("self")&&(N.push(M(I,"self")),N.push(h(!1,"dag")),(z=le.value)==null||z.forEach(H=>{H==null||H.validate()})),Promise.all(N).then(H=>{if(H.some(ce=>!ce.valid)){H.forEach(f=>{f.valid||(f.name==="self"||f.name==="dag"?se({type:"warning",message:`参数设置中『${l.value.dataTypeAliasName}』未正确设置或未选择正确的切片方案！`}):se({type:"warning",message:`参数设置中『${f.name}』未正确设置！`}))});const ce=H.find(f=>!f.valid);ce.name==="WMS"||ce.name==="WMTS"?r.curTabName=ce.name:r.curTabName="self"}else{const ce=[];Se.forEach(f=>{if(f!=="WFS"){let ue="";f==="WMS"||f==="WMTS"?ue=r.categoryOptions.find(ge=>ge.value===f).label:f==="self"?ue=l.value.dataTypeAliasName:f==="WFS"&&(ue="WFS服务");const Z={name:fe,aliasName:oe,description:_e,category:f==="self"?l.value.dataType:f,categoryAliasName:ue,resourceId:l.value.resourceId,publishService:de,catalogId:r.serviceInfoForm.catalogObj.id};if(f==="WMS"||f==="WMTS"){const ge={srs:r.dataInfoForm.srs.replace("EPSG:","")};l.value.dataType==="IMAGEDATA"&&(ge.bandSettings=r.dataInfoForm.bandSettings),Z.dataInfo=JSON.stringify(ge);const ie={};if(f==="WMS"){const Ae=w.value.styleInfoData,{srs:Fe,styleInfo:xe,cqlFilter:Le}=Ae;ie.srs=Fe.replace("EPSG:",""),ie.styleId=xe?xe.id:null,ie.cqlFilter=Le,Z.generateWFS=Se.includes("WFS")}if(f==="WMTS"){const Ae=o.value.styleInfoData,{srs:Fe,styleInfo:xe,cqlFilter:Le,format:Pe,gridSets:Qe,level:_a}=Ae;ie.srs=Fe.replace("EPSG:",""),ie.styleId=xe?xe.id:null,ie.cqlFilter=Le,ie.format=Pe.join(","),ie.gridSets=Qe,[ie.zoomStart,ie.zoomStop]=_a}Z.tileConfig=JSON.stringify(ie)}else{const{srs:ge,origin:{x:ie,y:Ae,z:Fe},rotate:xe}=r.dataInfoForm,{taskInfo:Le}=P.value,Pe={};Pe.srs=ge.replace("EPSG:",""),Pe.srsOrigin=`${ie},${Ae},${Fe}`,Pe.rotate=xe;const Qe={cells:ia.cloneDeep(E.value)};Z.taskId=Le.id,Z.taskName=Le.name,Z.dag=JSON.stringify(Qe),Z.tileConfig=JSON.stringify(Pe)}ce.push(Z)}}),c.value=!0,he.publishService(ce).then(f=>{c.value=!1,f.code==="0000"?(ee({type:"success",title:"发布成功，数据切片处理中，前往查看",onClick:()=>{const ue={path:"/dataCenter/PublishTaskManage"};A.push(ue)}}),De==null||De(),ne==null||ne()):ee({type:"error",title:"服务发布失败",message:f.message})}).catch(f=>{c.value=!1,ee({type:"error",title:"服务发布错误",message:f.message})})}})}else se({type:"warning",message:"请正确填写服务信息和数据信息！"})})}return(m,n)=>{const $=S("el-icon"),G=S("el-input"),b=S("el-form-item"),z=S("el-checkbox"),fe=S("el-checkbox-group"),oe=S("el-form"),_e=S("el-table-column"),de=S("el-table"),Se=S("el-option"),N=S("el-select"),Ve=S("el-button"),H=S("el-tooltip"),ce=Ke("loading");return _(),q(te,null,[t("div",Ht,[t("div",Kt,[Yt,t("div",Zt,[e(oe,{ref_key:"editServeInfoForm",ref:x,class:"form edit-form",inline:"",model:r.serviceInfoForm,"label-width":"auto","label-position":"right"},{default:a(()=>[t("div",Xt,[e(b,{label:"服务标识",prop:"name",rules:[{validator:i(g),trigger:["change"]}]},{default:a(()=>[e(G,{modelValue:r.serviceInfoForm.name,"onUpdate:modelValue":n[0]||(n[0]=f=>r.serviceInfoForm.name=f),type:"text",placeholder:"英文大小写字母和数字",maxlength:"50","show-word-limit":""},{suffix:a(()=>[i(L)?(_(),B($,{key:0,class:"el-input__icon"},{default:a(()=>[e(i(qe))]),_:1})):ve("",!0)]),_:1},8,["modelValue"])]),_:1},8,["rules"]),e(b,{label:"服务名称",prop:"aliasName",rules:[{required:!0,message:"服务名称不能为空",trigger:["blur","change"]}]},{default:a(()=>[e(G,{modelValue:r.serviceInfoForm.aliasName,"onUpdate:modelValue":n[1]||(n[1]=f=>r.serviceInfoForm.aliasName=f),type:"text",placeholder:"请输入服务名称"},null,8,["modelValue"])]),_:1})]),t("div",Qt,[e(b,{label:"服务类型",prop:"categoryList",rules:[{required:!0,message:"服务类型不能为空",trigger:["change"]}]},{default:a(()=>[e(fe,{modelValue:r.serviceInfoForm.categoryList,"onUpdate:modelValue":n[4]||(n[4]=f=>r.serviceInfoForm.categoryList=f),onChange:Ue},{default:a(()=>[(_(!0),q(te,null,pe(r.categoryOptions,f=>(_(),B(z,{key:f.value,label:f.value,onChange:ue=>Ee(ue,f.value)},{default:a(()=>[R(re(f.label),1)]),_:2},1032,["label","onChange"]))),128)),i(l).dataType!=="VECTOR"?(_(),B(z,{key:0,label:"self",onChange:n[2]||(n[2]=f=>Ee(f,"self"))},{default:a(()=>[R(re(i(l).dataTypeAliasName),1)]),_:1})):(_(),B(z,{key:1,label:"WFS",disabled:!r.serviceInfoForm.categoryList.includes("WMS"),onChange:n[3]||(n[3]=f=>Ee(f,"WFS"))},{default:a(()=>[R(" WFS服务 ")]),_:1},8,["disabled"]))]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"服务目录",prop:"catalogObj",rules:[{required:!0,message:"请选择服务目录",trigger:["change"]}]},{default:a(()=>[e(i(Xe),{modelValue:r.serviceInfoForm.catalogObj,"onUpdate:modelValue":n[5]||(n[5]=f=>r.serviceInfoForm.catalogObj=f),"tree-props":r.treeProps,"tree-data":r.servicesOptions,"value-key":"id",style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data"])]),_:1})]),t("div",el,[e(b,{label:"服务说明",prop:"description"},{default:a(()=>[e(G,{modelValue:r.serviceInfoForm.description,"onUpdate:modelValue":n[6]||(n[6]=f=>r.serviceInfoForm.description=f),type:"textarea",rows:2,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"])])]),t("div",al,[tl,t("div",ll,[e(oe,{ref:"tableFormRef",class:"table-form tableContainer",model:r},{default:a(()=>[e(de,{ref:"tableRef",class:"table commonTable sortableTable",data:r.dataInfoTableData},{default:a(()=>[e(_e,{prop:"dataName",label:"数据名称"}),e(_e,{prop:"dataTypeAliasName",label:"数据类型"}),e(_e,{prop:"dataFormat",label:"数据格式"}),e(_e,{prop:"createTime",label:"创建时间"})]),_:1},8,["data"])]),_:1},8,["model"])]),t("div",ol,[e(oe,{ref_key:"editDataInfoForm",ref:V,class:"form edit-form",inline:"",model:r.dataInfoForm,"label-width":"auto","label-position":"right",rules:r.dataInfoFormRule},{default:a(()=>[t("div",sl,[e(b,{key:"srs",label:"坐标系统",prop:"srs",class:"srs-item"},{default:a(()=>[e(N,{modelValue:r.dataInfoForm.srs,"onUpdate:modelValue":n[7]||(n[7]=f=>r.dataInfoForm.srs=f),style:{width:"100%"},"popper-class":"srs-select",filterable:"","filter-method":i(K),placeholder:"请选择坐标系统"},{default:a(()=>[(_(!0),q(te,null,pe(i(u),f=>(_(),B(Se,{key:f.value,label:f.value,value:f.value},{default:a(()=>[t("div",nl,[t("span",null,re(f.value),1),il,t("span",null,re(f.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","filter-method"]),t("div",rl,[e(H,{content:"导入坐标文件",placement:"bottom"},{default:a(()=>[e(Ve,{type:"primary",link:"",icon:i(fa),onClick:Y},{default:a(()=>[R(" 导入 ")]),_:1},8,["icon"])]),_:1})]),dl]),_:1})]),i(l).dataType==="IMAGEDATA"?(_(),q("div",cl,[e(b,{key:"bandSettings",label:"波段设置",prop:"bandSettings"},{default:a(()=>[e(de,{data:r.dataInfoForm.bandSettings,style:{width:"100%"}},{default:a(()=>[(_(!0),q(te,null,pe(r.bandTableData,f=>(_(),B(_e,{key:f.prop,prop:f.prop,label:f.label,align:"center"},{default:a(ue=>[e(G,{modelValue:ue.row[f.prop],"onUpdate:modelValue":Z=>ue.row[f.prop]=Z,class:"centerInput",type:"text",readonly:f.prop==="name"},null,8,["modelValue","onUpdate:modelValue","readonly"])]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data"])]),_:1})])):ve("",!0)]),_:1},8,["model","rules"])])]),t("div",ul,[ml,r.serviceInfoForm.categoryList.length>0?(_(),q(te,{key:0},[t("div",pl,[me(t("div",{class:We({actived:r.curTabName==="WMS",btn:!0}),onClick:n[8]||(n[8]=f=>$e("WMS"))}," WMS ",2),[[Re,r.serviceInfoForm.categoryList.includes("WMS")]]),me(t("div",{class:We({actived:r.curTabName==="WMTS",btn:!0}),onClick:n[9]||(n[9]=f=>$e("WMTS"))}," WMTS ",2),[[Re,r.serviceInfoForm.categoryList.includes("WMTS")]]),me(t("div",{class:We({actived:r.curTabName==="self",btn:!0}),onClick:n[10]||(n[10]=f=>$e("self"))},re(i(l).dataTypeAliasName),3),[[Re,i(l).dataType!=="VECTOR"&&r.serviceInfoForm.categoryList.includes("self")]])]),me(t("div",fl,[e(i(na),{ref_key:"wmsStyleSettingRef",ref:w,"style-type":"WMS"},null,512)],512),[[Re,r.curTabName==="WMS"]]),me(t("div",gl,[e(i(na),{ref_key:"wmtsStyleSettingRef",ref:o,"style-type":"WMTS","data-type":i(O)},null,8,["data-type"])],512),[[Re,r.curTabName==="WMTS"]]),me((_(),q("div",vl,[t("div",_l,[e(oe,{ref_key:"editTileInfoForm",ref:I,class:"form edit-form",inline:"",model:i(P),rules:i(T),"label-width":"auto","label-position":"right"},{default:a(()=>[t("div",bl,[e(b,{label:"切片方案",prop:"taskInfo"},{default:a(()=>[e(i(aa),{modelValue:i(P).taskInfo,"onUpdate:modelValue":n[11]||(n[11]=f=>i(P).taskInfo=f),style:{width:"100%"},"tree-props":i(F),"tree-data":i(v),"node-key":"id",icon:"iconCls","expand-on-click-node":!1,"default-expand-all":"",filterable:"","only-click-child":"","show-group-icon":"","group-identify":i(J),onChange:i(y)},null,8,["modelValue","tree-props","tree-data","group-identify","onChange"])]),_:1}),e(b)])]),_:1},8,["model","rules"])]),i(s).length>0?(_(!0),q(te,{key:0},pe(i(s),(f,ue)=>(_(),q("div",{key:f.uid,class:"content-wrap"},[e(oe,{ref_for:!0,ref:Z=>{Z&&(le.value[ue]=Z)},class:"form scheme-form__common",uid:f.uid,inline:"",model:f.pubulishData,"label-width":"auto","label-position":"right"},{default:a(()=>[(_(!0),q(te,null,pe(f.paramsConfigList,(Z,ge)=>(_(),B(b,{key:Z.paramName+ge,class:We([{"scheme-form-item":!0,"is-left":ge%2===0}]),label:Z.paramLabel,prop:Z.paramName,required:Z.required,rules:{required:Z.required,message:`${Z.paramLabel}不能为空`}},{default:a(()=>[e(i(ga),{ref_for:!0,ref:"paramForm",modelValue:f.pubulishData[Z.paramName],"onUpdate:modelValue":ie=>f.pubulishData[Z.paramName]=ie,"control-name":Z.paramName,uid:f.uid,type:f.type,"all-param":Z,relations:f.relations,"default-data-info":r.initDataInfo,onChange:i(W)},null,8,["modelValue","onUpdate:modelValue","control-name","uid","type","all-param","relations","default-data-info","onChange"])]),_:2},1032,["class","label","prop","required","rules"]))),128))]),_:2},1032,["uid","model"])]))),128)):ve("",!0)])),[[Re,r.curTabName==="self"],[ce,i(D)]])],64)):(_(),q("div",hl,"未选择任何服务类型"))])]),t("div",yl,[e(Ve,{onClick:i(ne)},{default:a(()=>[R("取消")]),_:1},8,["onClick"]),e(Ve,{type:"primary",loading:i(c),onClick:p},{default:a(()=>[R("保存")]),_:1},8,["loading"])])],64)}}});const Sl={class:"main server-common-form"},Fl={class:"card"},Tl=t("div",{class:"subtitle"},"服务信息",-1),Cl={class:"content-wrap"},kl={class:"item-wrap item2"},Dl={class:"item-wrap item2"},wl={class:"item-wrap"},Vl={class:"card"},Nl=t("div",{class:"subtitle"},"数据信息",-1),Ol={class:"content-wrap",style:{"margin-bottom":"18px"}},El={class:"content-wrap"},$l={key:0,class:"item-wrap"},Al={class:"list-item"},xl=t("span",null," — — ",-1),Ll={class:"link-box"},Pl=t("input",{id:"importCoordinateFile",style:{display:"none"},type:"file",class:"importCoordinateFile",directory:"",nwdirectory:"",accept:".xml"},null,-1),Rl={key:1,class:"item-wrap origin-wrap"},Ml={class:"origin"},Ul={key:2,class:"item-wrap"},Bl={class:"rotate"},Wl={class:"card"},Gl={class:"subtitle"},ql={key:0,class:"tip"},jl={"element-loading-text":"正在获取方案参数..."},zl={class:"content-wrap"},Jl={class:"item-wrap item2"},Hl={class:"footer"},Kl=Ce({__name:"Serve3DCommonForm",setup(j){const{submiting:A,checkNameing:c,treeProps:L,groupIdentify:F,srsOptions:J,dataType:u,releseDataInfo:O,checkServiceName:l,checkFormPass:g,getSrsList:M,srsFilterFunc:Q}=je(De,()=>O.value.dataType),{tileInfoForm:K,cellData:P,showErrorTip:E,isLoadingScheme:D,tileInfoFormRule:T,taskTreeData:v,publishConfigList:s,getAllTask:d,initSchemeData:k,checkDagScheme:h,handleTaskChange:y,handleControlChange:W}=va(u),x=X(),V=X(),I=X(),w=X([]),o=ke({includesSrs:["IMAGERY","POINTCLOUD","BIMMODEL","MODEL"],includesOrigin:["IMAGERY","POINTCLOUD","BIMMODEL","MODEL"],includesRotate:["BIMMODEL","MODEL"],serviceInfoForm:{publishService:!0,name:"",aliasName:"",categoryAliasName:"",description:"",category:"",catalogObj:null},treeNewProps:{label:"name",children:"children",disabled:"no"},servicesOptions:[],dataInfoForm:{srs:"",origin:{x:"",y:"",z:""},rotate:0},dataInfoFormRule:{srs:[{required:!0,message:"坐标系统不能为空",trigger:"change"}],origin:{type:"object",required:!0,fields:{x:{required:!0,validator:ne,trigger:["blur","change"]},y:{required:!0,validator:ne,trigger:["blur","change"]},z:{required:!0,validator:ne,trigger:["blur","change"]}}}},dataInfoTableData:[],initDataInfo:{srs:"",srsOrigin:"",rotate:0}});Ge("getCellById",le);function le(Y){var p;const C=(p=P.value)==null?void 0:p.find(m=>m.id===Y);return C?{attributes:C}:{}}const r=Te("handleClosed"),ae=Te("handleSave");pa(()=>{w.value=[]});function ne(Y,C,p){const m=!!o.dataInfoForm.origin.x,n=!!o.dataInfoForm.origin.y,$=!!o.dataInfoForm.origin.z;m&&n&&$?p():p(new Error(`请完整填写偏移量，${m?"":" X"}${n?"":" Y"}${$?"":" Z"}不能为空`))}function De(){Ne(()=>{var Y,C;(Y=x.value)==null||Y.clearValidate(),(C=I.value)==null||C.clearValidate()}),Ie(),Oe(),d(),M(),$e()}function Ie(){const{dataTypeAliasName:Y,dataFormat:C,name:p,dataSize:m,createTime:n}=O.value;o.dataInfoForm.dataName=p,o.dataInfoForm.dataTypeAliasName=Y,o.dataInfoForm.dataFormat=C,o.dataInfoForm.dataSize=m,o.dataInfoForm.createTime=n,o.dataInfoTableData=[o.dataInfoForm],o.serviceInfoForm.name="",o.serviceInfoForm.aliasName=p,o.serviceInfoForm.description="",o.serviceInfoForm.categoryAliasName=Y,o.serviceInfoForm.catalogObj=null,k()}function Oe(){const Y=()=>{o.dataInfoForm.origin={x:"",y:"",z:""}};he.getDataInfoById(O.value.resourceId).then(C=>{var p,m,n;if(C.code==="0000")if(o.initDataInfo.srs=((p=C==null?void 0:C.data)==null?void 0:p.srs)??"EPSG:4326",o.initDataInfo.srsOrigin=((m=C==null?void 0:C.data)==null?void 0:m.srsOrigin)??"0,0,0",o.initDataInfo.rotate=((n=C==null?void 0:C.data)==null?void 0:n.rotate)??0,u.value=C.data.dataType,o.dataInfoForm.srs=C.data.srs||"EPSG:4326",C.data.srsOrigin){const $=C.data.srsOrigin.split(",");o.dataInfoForm.origin={x:$[0],y:$[1],z:$[2]}}else Y();else o.dataInfoForm.srs="EPSG:4326",Y()}).catch(()=>{o.dataInfoForm.srs="EPSG:4326",Y()}).finally(()=>{o.dataInfoForm.rotate=0,d()})}function we(Y){o.dataInfoForm.origin[Y]=o.dataInfoForm.origin[Y].replace(/^\.+|[^\d.]/g,"")}function U(){var Y,C;(Y=document.getElementById("importCoordinateFile"))==null||Y.click(),(C=document.getElementById("importCoordinateFile"))==null||C.addEventListener("change",p=>{const{files:m}=p.target;if(m.length===0)return;const n=m[0];if(!/\.xml$/g.test(n.name)){ye.alert("仅支持导入xml格式！","提示",{confirmButtonText:"确定",type:"error"}),p.target.value="";return}Ue(n,$=>{o.dataInfoForm.srs=$.system,o.includesOrigin.includes(O.value.dataType)&&(o.dataInfoForm.origin=$.origin),se({type:"success",message:"坐标导入成功!"})}),p.target.value=""})}function Ue(Y,C){const p=new FileReader;p.onload=m=>{var z,fe;const n=m.target.result,$={},G=n.match(/<SRS[^>]*>([\s\S]*?)<\/SRS>/);let b=n.match(/<SRSOrigin[^>]*>([\s\S]*?)<\/SRSOrigin>/);if(o.includesOrigin.includes(O.value.dataType)){if(!G||!b){ye.alert("文件未包含必要信息！请检查后重新导入！","提示",{confirmButtonText:"确定",type:"error"});return}}else if(!G){ye.alert("文件未包含必要信息！请检查后重新导入！","提示",{confirmButtonText:"确定",type:"error"});return}[,$.system]=G,o.includesOrigin.includes(O.value.dataType)&&(b=(fe=(z=b[1])==null?void 0:z.replace(/\s*/g,""))==null?void 0:fe.split(","),$.origin={x:b[0],y:b[1],z:b[2]}),C&&C($)},p.readAsBinaryString(Y)}function Ee(){g(x).then(C=>{if(C){const{name:p,aliasName:m,description:n,categoryAliasName:$,publishService:G}=o.serviceInfoForm,b=w.value;if((b==null?void 0:b.length)>0){b==null||b.forEach(de=>{de==null||de.validate()});const z=g(V),fe=g(I),oe=h(!0);Promise.all([z,fe,oe]).then(([de,Se,N])=>{if(de&&Se&&N){const{srs:Ve,origin:{x:H,y:ce,z:f},rotate:ue}=o.dataInfoForm,{taskInfo:Z}=K.value,ge={};o.includesSrs.includes(O.value.dataType)&&(ge.srs=Ve.replace("EPSG:","")),o.includesOrigin.includes(O.value.dataType)&&(ge.srsOrigin=`${H},${ce},${f}`),o.includesRotate.includes(O.value.dataType)&&(ge.rotate=ue);const ie={cells:ia.cloneDeep(P.value)},Ae={name:p,aliasName:m,description:n,catalogId:o.serviceInfoForm.catalogObj.id,category:O.value.dataType,categoryAliasName:$,resourceId:O.value.resourceId,tileConfig:JSON.stringify(ge),taskId:Z.id,taskName:Z.name,dag:JSON.stringify(ie),publishService:G};A.value=!0,he.publishService([Ae]).then(Fe=>{A.value=!1,Fe.code==="0000"?(ee({type:"success",title:"发布成功，数据切片处理中"}),ae==null||ae(),r==null||r()):ee({type:"error",title:"服务发布失败",message:Fe.message})}).catch(Fe=>{A.value=!1,ee({type:"error",title:"服务发布错误",message:Fe.message})})}})}else se({type:"warning",message:"请选择正确的切片方案！"}),g(V),g(I)}else se({type:"warning",message:"请正确填写服务信息！"})})}async function $e(){o.servicesOptions=await Ye(Ze.SERVICE);const Y=o.servicesOptions[0];o.serviceInfoForm.catalogObj=Y}return(Y,C)=>{const p=S("el-icon"),m=S("el-input"),n=S("el-form-item"),$=S("el-form"),G=S("el-table-column"),b=S("el-table"),z=S("el-option"),fe=S("el-select"),oe=S("el-button"),_e=S("el-tooltip"),de=S("el-input-number"),Se=Ke("loading");return _(),q(te,null,[t("div",Sl,[t("div",Fl,[Tl,t("div",Cl,[e($,{ref_key:"editServeInfoForm",ref:x,class:"form edit-form",inline:"",model:o.serviceInfoForm,"label-width":"auto","label-position":"right"},{default:a(()=>[t("div",kl,[e(n,{label:"服务标识",prop:"name",rules:[{validator:i(l),trigger:["change"]}]},{default:a(()=>[e(m,{modelValue:o.serviceInfoForm.name,"onUpdate:modelValue":C[0]||(C[0]=N=>o.serviceInfoForm.name=N),type:"text",placeholder:"英文大小写字母和数字",maxlength:"50","show-word-limit":""},{suffix:a(()=>[i(c)?(_(),B(p,{key:0,class:"el-input__icon"},{default:a(()=>[e(i(qe))]),_:1})):ve("",!0)]),_:1},8,["modelValue"])]),_:1},8,["rules"]),e(n,{label:"服务名称",prop:"aliasName",rules:[{required:!0,message:"服务名称不能为空",trigger:["blur","change"]}]},{default:a(()=>[e(m,{modelValue:o.serviceInfoForm.aliasName,"onUpdate:modelValue":C[1]||(C[1]=N=>o.serviceInfoForm.aliasName=N),type:"text",placeholder:"请输入服务名称"},null,8,["modelValue"])]),_:1})]),t("div",Dl,[e(n,{label:"服务类型",prop:"categoryAliasName"},{default:a(()=>[t("span",null,re(o.serviceInfoForm.categoryAliasName),1)]),_:1}),e(n,{label:"服务目录",prop:"catalogObj",rules:[{required:!0,message:"请选择服务目录",trigger:["change"]}]},{default:a(()=>[e(i(Xe),{modelValue:o.serviceInfoForm.catalogObj,"onUpdate:modelValue":C[2]||(C[2]=N=>o.serviceInfoForm.catalogObj=N),"tree-props":o.treeNewProps,"tree-data":o.servicesOptions,"value-key":"id",style:{width:"100%"}},null,8,["modelValue","tree-props","tree-data"])]),_:1})]),t("div",wl,[e(n,{label:"服务说明",prop:"description"},{default:a(()=>[e(m,{modelValue:o.serviceInfoForm.description,"onUpdate:modelValue":C[3]||(C[3]=N=>o.serviceInfoForm.description=N),type:"textarea",rows:2,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"])])]),t("div",Vl,[Nl,t("div",Ol,[e($,{ref:"tableFormRef",class:"table-form tableContainer",model:o},{default:a(()=>[e(b,{ref:"tableRef",class:"table commonTable sortableTable",data:o.dataInfoTableData},{default:a(()=>[e(G,{prop:"dataName",label:"数据名称"}),e(G,{prop:"dataTypeAliasName",label:"数据类型"}),e(G,{prop:"dataFormat",label:"数据格式"}),e(G,{prop:"createTime",label:"创建时间"})]),_:1},8,["data"])]),_:1},8,["model"])]),t("div",El,[e($,{ref_key:"editDataInfoForm",ref:V,class:"form edit-form",inline:"",model:o.dataInfoForm,"label-width":"auto","label-position":"right",rules:o.dataInfoFormRule},{default:a(()=>[o.includesSrs.includes(i(O).dataType)?(_(),q("div",$l,[e(n,{key:"srs",label:"坐标系统",prop:"srs",class:"srs-item"},{default:a(()=>[e(fe,{modelValue:o.dataInfoForm.srs,"onUpdate:modelValue":C[4]||(C[4]=N=>o.dataInfoForm.srs=N),style:{width:"100%"},"popper-class":"srs-select",filterable:"","filter-method":i(Q),placeholder:"请选择坐标系统"},{default:a(()=>[(_(!0),q(te,null,pe(i(J),N=>(_(),B(z,{key:N.value,label:N.value,value:N.value},{default:a(()=>[t("div",Al,[t("span",null,re(N.value),1),xl,t("span",null,re(N.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","filter-method"]),t("div",Ll,[e(_e,{content:"导入坐标文件",placement:"bottom"},{default:a(()=>[e(oe,{type:"primary",link:"",icon:i(fa),onClick:U},{default:a(()=>[R(" 导入 ")]),_:1},8,["icon"])]),_:1})]),Pl]),_:1})])):ve("",!0),o.includesOrigin.includes(i(O).dataType)?(_(),q("div",Rl,[e(n,{label:"偏移量",prop:"origin"},{default:a(()=>[t("div",Ml,[e(m,{modelValue:o.dataInfoForm.origin.x,"onUpdate:modelValue":C[5]||(C[5]=N=>o.dataInfoForm.origin.x=N),placeholder:"请输入X坐标",onInput:C[6]||(C[6]=N=>we("x"))},{prepend:a(()=>[R("X :")]),_:1},8,["modelValue"]),e(m,{modelValue:o.dataInfoForm.origin.y,"onUpdate:modelValue":C[7]||(C[7]=N=>o.dataInfoForm.origin.y=N),placeholder:"请输入Y坐标",onInput:C[8]||(C[8]=N=>we("y"))},{prepend:a(()=>[R("Y :")]),_:1},8,["modelValue"]),e(m,{modelValue:o.dataInfoForm.origin.z,"onUpdate:modelValue":C[9]||(C[9]=N=>o.dataInfoForm.origin.z=N),placeholder:"请输入Z坐标",onInput:C[10]||(C[10]=N=>we("z"))},{prepend:a(()=>[R("Z :")]),_:1},8,["modelValue"])])]),_:1})])):ve("",!0),o.includesRotate.includes(i(O).dataType)?(_(),q("div",Ul,[e(n,{label:"旋转角度",prop:"rotate"},{default:a(()=>[t("div",Bl,[e(de,{modelValue:o.dataInfoForm.rotate,"onUpdate:modelValue":C[11]||(C[11]=N=>o.dataInfoForm.rotate=N),placeholder:"请输入旋转角度","controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])])]),_:1})])):ve("",!0)]),_:1},8,["model","rules"])])]),t("div",Wl,[t("div",Gl,[R(" 参数设置 "),i(E)?(_(),q("span",ql," 请正确设置切片参数 ")):ve("",!0)]),me((_(),q("div",jl,[t("div",zl,[e($,{ref_key:"editTileInfoForm",ref:I,class:"form edit-form",inline:"",model:i(K),rules:i(T),"label-width":"auto","label-position":"right"},{default:a(()=>[t("div",Jl,[e(n,{label:"切片方案",prop:"taskInfo"},{default:a(()=>[e(i(aa),{modelValue:i(K).taskInfo,"onUpdate:modelValue":C[12]||(C[12]=N=>i(K).taskInfo=N),style:{width:"100%"},"tree-props":i(L),"tree-data":i(v),"node-key":"id",icon:"iconCls","expand-on-click-node":!1,"default-expand-all":"",filterable:"","only-click-child":"","show-group-icon":"","group-identify":i(F),onChange:i(y)},null,8,["modelValue","tree-props","tree-data","group-identify","onChange"])]),_:1}),e(n)])]),_:1},8,["model","rules"])]),i(s).length>0?(_(!0),q(te,{key:0},pe(i(s),(N,Ve)=>(_(),q("div",{key:N.uid,class:"content-wrap"},[e($,{ref_for:!0,ref:H=>{H&&(w.value[Ve]=H)},class:"form scheme-form__common",uid:N.uid,inline:"",model:N.pubulishData,"label-width":"auto","label-position":"right"},{default:a(()=>[(_(!0),q(te,null,pe(N.paramsConfigList,(H,ce)=>(_(),B(n,{key:H.paramName+ce,class:We([{"scheme-form-item":!0,"is-left":ce%2===0}]),label:H.paramLabel,prop:H.paramName,required:H.required,rules:{required:H.required,message:`${H.paramLabel}不能为空`}},{default:a(()=>[e(i(ga),{ref_for:!0,ref:"paramForm",modelValue:N.pubulishData[H.paramName],"onUpdate:modelValue":f=>N.pubulishData[H.paramName]=f,"control-name":H.paramName,uid:N.uid,type:N.type,"all-param":H,relations:N.relations,"default-data-info":o.initDataInfo,onChange:i(W)},null,8,["modelValue","onUpdate:modelValue","control-name","uid","type","all-param","relations","default-data-info","onChange"])]),_:2},1032,["class","label","prop","required","rules"]))),128))]),_:2},1032,["uid","model"])]))),128)):ve("",!0)])),[[Se,i(D)]])])]),t("div",Hl,[e(oe,{onClick:i(r)},{default:a(()=>[R("取消")]),_:1},8,["onClick"]),e(oe,{type:"primary",loading:i(A),onClick:Ee},{default:a(()=>[R("保存")]),_:1},8,["loading"])])],64)}}});const Yl={class:"main-content"},Zl={class:"title"},Xl=t("span",null,"服务发布",-1),Ql=Ce({__name:"PublishServiceDialog",props:{visible:{type:Boolean,default:!1},domId:{default:""},releseDataInfo:{}},emits:["update:visible","save"],setup(j,{emit:A}){const c=j,L=A;Ge("getDataInfo",l),Ge("handleClosed",u),Ge("handleSave",O);const F=ke({dialogVisible:!1,is3Dtiles:!1,isIOT:!1,isMapTilePackge:!1,is2D:!1});Me(()=>c.visible,g=>{F.dialogVisible=g});function J(){F.is3Dtiles=!1,F.isIOT=!1,F.isMapTilePackge=!1,F.is2D=!1;const{dataType:g,dataFormat:M,resultData:Q}=c.releseDataInfo;if(Q){F.is3Dtiles=!0;return}if(["3DTILES","GEOJSON","TERRAIN","PNG","WEBP","PAK","ZNP"].includes(M.toUpperCase())){F.is3Dtiles=!0;return}if(g.toUpperCase()==="IOT"){F.isIOT=!0;return}if(g.toUpperCase()==="MAPTILEPACKGE"){F.isMapTilePackge=!0;return}["VECTOR","TERRAIN","IMAGEDATA","GEODATABASE"].includes(g.toUpperCase())&&(F.is2D=!0)}function u(){L("update:visible",!1)}function O(){L("save")}function l(){return c.releseDataInfo}return(g,M)=>{const Q=S("ArrowLeft"),K=S("el-icon");return _(),B(i($a),{id:"publish-full-dialog",modelValue:F.dialogVisible,"onUpdate:modelValue":M[0]||(M[0]=P=>F.dialogVisible=P),class:"full-dialog common-full-dialog","append-to-dom":g.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:J,onClosed:u},{default:a(()=>[t("div",Yl,[t("div",Zl,[e(K,{onClick:u},{default:a(()=>[e(Q)]),_:1}),Xl]),F.is3Dtiles?(_(),B(ht,{key:0})):F.isIOT?(_(),B(xt,{key:1})):F.isMapTilePackge?(_(),B(Jt,{key:2})):F.is2D?(_(),B(Il,{key:3})):(_(),B(Kl,{key:4}))])]),_:1},8,["modelValue","append-to-dom"])}}});const ze=j=>(ca("data-v-f2bc0b1a"),j=j(),ua(),j),eo={class:"warehouse-form-container"},ao={class:"item-wrap"},to={key:0,style:{color:"#bbbbbb"}},lo=ze(()=>t("div",{class:"title-name"},"操作目标库",-1)),oo={class:"item-wrap"},so={class:"item-wrap"},no=ze(()=>t("div",{class:"title-name"},"操作选项",-1)),io={class:"item-wrap operate"},ro={class:"item-wrap operate test"},co=ze(()=>t("span",{class:"label"}," 字符编码 ",-1)),uo={class:"item-wrap operate test"},mo=ze(()=>t("span",{class:"label"}," 数据格式为CSV或xlsx时，设置列名 ",-1)),po={class:"item-wrap operate test"},fo=ze(()=>t("span",{class:"label"}," 数据格式为CSV或xlsx时，存在多个工作表，设置入库表 ",-1)),go={class:"dialog-footer"},vo=Ce({__name:"WarehousingDialog",props:{visible:{type:Boolean,default:!1},curItem:{default:()=>({})},isBatch:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(j,{emit:A}){const c=He(),L=j,F=A,J=X(),u=ke({dialogVisible:!1,isLoading:!1,submiting:!1,form:{name:"",dbType:"",datasourceId:"",spatialIndex:!0,useEncoding:!0,useSetCsvColumn:!0,useSetCsvSheet:!0,encoding:"default",setCsvColumn:1,setCsvSheet:"all"},rules:{},datasourceTypeOptions:[{label:"PostGIS",value:"POSTGIS"}],datasourceOptions:[]});Me(()=>L.visible,P=>{u.dialogVisible=P});function O(){L.isBatch?u.form.name="":u.form.name=L.curItem.name,u.form.dbType="POSTGIS",u.form.datasourceId="",u.form.spatialIndex=!0,u.form.useEncoding=!0,u.form.encoding="default",u.form.useSetCsvColumn=!0,u.form.setCsvColumn=1,u.form.useSetCsvSheet=!0,u.form.setCsvSheet="all",Ne(()=>{var P;(P=J.value)==null||P.clearValidate(),M(u.form.dbType)})}function l(){F("update:visible",!1)}function g(P){M(P),u.form.datasourceId=""}function M(P){const E={page:1,rows:9999,keyword:"",type:P,enable:1};u.isLoading=!0,Wa.getDataSourcePageList(E).then(D=>{D.code==="0000"?(u.datasourceOptions=D.data?D.data.records:[],u.datasourceOptions||(u.datasourceOptions=[])):(se({type:"error",message:D.message||"获取数据源数据失败"}),u.datasourceOptions=[])}).catch(D=>{se({type:"error",message:"获取数据源数据失败"}),u.datasourceOptions=[]}).finally(()=>{u.isLoading=!1})}function Q(){J.value.validate(P=>{if(P){const E=be(u.form),{curItem:{resourceId:D},isBatch:T}=L;delete E.useEncoding,delete E.useSetCsvColumn,delete E.useSetCsvSheet,u.submiting=!0,he.createMultiStorageTask(E,{resourceIds:D}).then(v=>{u.submiting=!1,v.code==="0000"?(ee({type:"success",title:`${T?"批量":""}入库成功`}),l(),F("save")):ee({type:"error",title:`${T?"批量":""}入库失败`,message:v.message})}).catch(v=>{u.submiting=!1,ee({type:"error",title:`${T?"批量":""}入库失败`,message:v.message})})}})}function K(){const P=c.resolve({name:"/dataCenter/DatasourceManage"});window.open(P.href,"_blank")}return(P,E)=>{const D=S("el-input"),T=S("el-form-item"),v=S("el-divider"),s=S("el-option"),d=S("el-select"),k=S("el-checkbox"),h=S("el-form"),y=S("el-button"),W=S("el-dialog"),x=Ke("loading");return _(),B(W,{modelValue:u.dialogVisible,"onUpdate:modelValue":E[9]||(E[9]=V=>u.dialogVisible=V),class:"center-dialog",title:`${P.isBatch?"批量":"数据"}入库`,"append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"540px",onOpen:O,onClosed:l},{footer:a(()=>[t("span",go,[e(y,{onClick:E[8]||(E[8]=V=>u.dialogVisible=!1)},{default:a(()=>[R("取 消")]),_:1}),e(y,{type:"primary",loading:u.submiting,disabled:u.isLoading,onClick:Q},{default:a(()=>[R("确 定")]),_:1},8,["loading","disabled"])])]),default:a(()=>[me((_(),q("div",eo,[e(h,{ref_key:"formRef",ref:J,class:"edit-form",inline:"",model:u.form,rules:u.rules,"label-width":"100px","label-position":"right"},{default:a(()=>[t("div",ao,[e(T,{label:"任务名称",prop:"name"},{default:a(()=>[P.isBatch?(_(),q("span",to,"默认读取数据名称")):(_(),B(D,{key:1,modelValue:u.form.name,"onUpdate:modelValue":E[0]||(E[0]=V=>u.form.name=V),style:{width:"100%"},clearable:"",placeholder:"请输入任务名称"},null,8,["modelValue"]))]),_:1})]),e(v),lo,t("div",oo,[e(T,{label:"数据源类型",prop:"dbType"},{default:a(()=>[e(d,{modelValue:u.form.dbType,"onUpdate:modelValue":E[1]||(E[1]=V=>u.form.dbType=V),style:{width:"100%"},filterable:"",placeholder:"请选择数据源类型",onChange:g},{default:a(()=>[(_(!0),q(te,null,pe(u.datasourceTypeOptions,V=>(_(),B(s,{key:V.value,label:V.label,value:V.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),t("div",so,[e(T,{label:"选择数据源",prop:"datasourceId"},{default:a(()=>[e(d,{modelValue:u.form.datasourceId,"onUpdate:modelValue":E[2]||(E[2]=V=>u.form.datasourceId=V),style:{width:"255px"},filterable:"",placeholder:"请选择数据源名称"},{default:a(()=>[e(s,{label:"默认数据源",value:""}),(_(!0),q(te,null,pe(u.datasourceOptions,V=>(_(),B(s,{key:V.id,label:V.name,value:V.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t("span",{class:"link",onClick:K},"数据源管理")]),_:1})]),no,t("div",io,[e(T,null,{default:a(()=>[e(k,{modelValue:u.form.spatialIndex,"onUpdate:modelValue":E[3]||(E[3]=V=>u.form.spatialIndex=V),label:"创建空间索引",size:"large"},null,8,["modelValue"]),t("span",{class:"label",onClick:E[4]||(E[4]=V=>u.form.spatialIndex=!u.form.spatialIndex)}," 创建空间索引 ")]),_:1})]),t("div",ro,[e(T,null,{default:a(()=>[co,e(d,{modelValue:u.form.encoding,"onUpdate:modelValue":E[5]||(E[5]=V=>u.form.encoding=V),style:{width:"150px"},filterable:"",disabled:!u.form.useEncoding},{default:a(()=>[e(s,{label:"默认",value:"default"}),e(s,{label:"UTF-8",value:"UTF-8"}),e(s,{label:"GBK",value:"GBK"})]),_:1},8,["modelValue","disabled"])]),_:1})]),t("div",uo,[e(T,null,{default:a(()=>[mo,e(d,{modelValue:u.form.setCsvColumn,"onUpdate:modelValue":E[6]||(E[6]=V=>u.form.setCsvColumn=V),style:{width:"150px"},filterable:"",disabled:!u.form.useSetCsvColumn},{default:a(()=>[e(s,{label:"第一行",value:1}),e(s,{label:"第二行",value:2}),e(s,{label:"第三行",value:3}),e(s,{label:"第四行",value:4}),e(s,{label:"第五行",value:5})]),_:1},8,["modelValue","disabled"])]),_:1})]),t("div",po,[e(T,null,{default:a(()=>[fo,e(d,{modelValue:u.form.setCsvSheet,"onUpdate:modelValue":E[7]||(E[7]=V=>u.form.setCsvSheet=V),style:{width:"150px"},filterable:"",disabled:!u.form.useSetCsvSheet},{default:a(()=>[e(s,{label:"全部",value:"all"}),e(s,{label:"sheet1",value:"sheet1"}),e(s,{label:"sheet2",value:"sheet2"}),e(s,{label:"sheet3",value:"sheet3"}),e(s,{label:"sheet4",value:"sheet4"}),e(s,{label:"sheet5",value:"sheet5"})]),_:1},8,["modelValue","disabled"])]),_:1})])]),_:1},8,["model","rules"])])),[[x,u.isLoading]])]),_:1},8,["modelValue","title"])}}});const _o=ra(vo,[["__scopeId","data-v-f2bc0b1a"]]),bo=["src","onClick"],ho=Ce({__name:"DataPage",setup(j){const A=X(),{searchOptions:c,columns:L}=ot(),F={catalogId:"#"},{data:J,total:u,pageNo:O,pageSize:l,multipleSelection:g,loading:M,handleSizeChange:Q,handleCurrentChange:K,handleSelectionChange:P,handleSearch:E,initData:D}=ba(he.getDataPageList,F);function T(p){if(p&&p.searchCategory){const[m,n]=p.searchCategory;p.dataType=m,p.dataFormat=n}E(p)}const v=Be(()=>g.value.map(p=>p.resourceId)),s=X(),d=Be(()=>{var p;return(p=s.value)==null?void 0:p.$el}),k=ka(),h=He(),y=Ea(),{miniDialogVisible:W,isSearchData:x}=ha(y),V=Be(()=>{var p;return((p=k.query)==null?void 0:p.keyword)||""}),I=ke({isLoading:!1,isLoadingTable:!1,dialogVisible:!1,dialogType:Je.CHECK,curEditId:"",releaseDialogVisible:!1,releseDataInfo:{},hasDataSourceAuthority:!1,chooseDataSourceVisible:!1,moveDataDialog:!1,thumbnailDialogVisible:!1,curPreviewItem:{},warehouseDialogVisible:!1,curWarehouseItem:{}});Me(()=>x.value,p=>{p&&D()}),Me(()=>I.releaseDialogVisible,p=>{p||(I.releseDataInfo={})}),Me(V,p=>{p&&Ne(()=>{A==null||A.value.handleSetFormValue("keyword",p)})},{immediate:!0}),da(()=>{D()});function w(p){const m=p.srcElement;m.src=La,m.onerror=null}function o(p){I.curPreviewItem={...p,url:p.previewUrl},I.thumbnailDialogVisible=!0}function le(){I.dialogType=Je.EDIT}function r(){ye.confirm("是否批量删除选中数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{I.isLoadingTable=!0,he.deleteDataByIds(Na(v.value)).then(p=>{I.isLoadingTable=!1,p.code==="0000"?(se({type:"success",message:"批量删除数据成功"}),D()):se({type:"error",message:"批量删除失败，请重试"})}).catch(p=>{I.isLoadingTable=!1,ee({type:"error",title:"批量删除错误",message:p.message||"服务错误"})})}).catch(()=>{})}const ae={SLICING:"",UPLOAD_FAIL:"danger",NOT_PROCESS:"danger",PROCESS_FAIL:"danger",PROCESSED:"success",PUBLISHED:"success",UPLOADING:"primary",PROCESSING:"primary"};function ne(p,m){m||(I.curEditId=p.resourceId,I.dialogType=Je.EDIT,I.dialogVisible=!0)}function De(){I.chooseDataSourceVisible=!0}function Ie(){y.setVisible(!0),y.setMiniDialogVisible(!1)}function Oe(){I.moveDataDialog=!0}function we(p){W.value?ye.alert("请先停止并关闭当前上传数据窗口","提示",{confirmButtonText:"确定"}):(y.setCurrentUploadItem(p),y.setVisible(!0))}function U(p,m){if(p.dataFormat==="MDB"||p.dataFormat==="GDB"){h.push({path:"/dataCenter/LayerGroupManagement",query:{from:"DataManage",resourceId:p.resourceId}});return}m||(p.resourceType==="DB"?(I.isLoading=!0,he.checkDatasourceEnable(p.resourceId).then(n=>{n.code==="0000"?(I.releseDataInfo=be(p),I.releaseDialogVisible=!0):ye.alert("该数据源已关闭或不存在","提示",{confirmButtonText:"确定"})}).catch(()=>{ye.alert("该数据源已关闭或不存在","提示",{confirmButtonText:"确定"})}).finally(()=>{I.isLoading=!1})):(I.releseDataInfo=be(p),I.releaseDialogVisible=!0))}function Ue(){ye.confirm("仅对矢量数据（shp/geojson/kml&kmz/csv）、地理数据库（mdb/gdb/fdb中的矢量数据）执行入库操作，是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{I.curWarehouseItem={resourceId:v.value.join(",")},I.warehouseDialogVisible=!0}).catch(()=>{})}function Ee(p){I.curEditId=p.resourceId,I.dialogType=Je.CHECK,I.dialogVisible=!0}function $e(p){ye.confirm(`删除【${p.name}】数据, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{I.isLoadingTable=!0,he.deleteDataByIds([p.resourceId]).then(m=>{I.isLoadingTable=!1,m.code==="0000"?(ee({type:"success",title:"删除数据成功"}),D()):ee({type:"warning",title:"删除失败，请重试"})})})}function Y(p){F.catalogId=p,D()}const C=Be(()=>p=>{if(p){const{resourceType:m,storageType:n}=p;return m==="DB"?n:"文件上传"}return""});return(p,m)=>{const n=S("el-button"),$=S("el-link"),G=Ke("action");return _(),q(te,null,[e(i(la),{id:"datapage",background:""},{default:a(()=>[e(i(ya),{ref_key:"treeAsideRef",ref:s},{default:a(()=>[e(Pa,{type:"RESOURCE",onChange:Y})]),_:1},512),e(i(la),null,{default:a(()=>[e(i(Ia),{target:d.value},null,8,["target"]),e(i(Sa),{padding:"1 1 0",border:""},{default:a(()=>[e(i(Fa),{ref_key:"SmartSearchRef",ref:A,options:i(c),onHandleSearch:T},null,8,["options"])]),_:1}),e(i(Ta),null,{default:a(()=>[e(i(Ca),{ref:"baseTable","operation-width":"240",columns:i(L),"table-data":i(J),"current-page":i(O),"page-size":i(l),total:i(u),"pagination-is-need":!0,"operation-is-need":!0,loading:i(M),"search-form-ref":A.value,"selection-is-need":!0,"index-is-need":!1,"column-select-key":"resourceId",onSizeChange:i(Q),onCurrentChange:i(K),onSelectionChange:i(P)},{"smart-table_operation":a(()=>[me((_(),B(n,{type:"primary",onClick:De},{default:a(()=>[R(" 注册数据 ")]),_:1})),[[G,"resource_manager_add"]]),me((_(),B(n,{type:"primary",onClick:Ie},{default:a(()=>[R(" 上传数据 ")]),_:1})),[[G,"resource_manager_upload"]])]),"smart-table_batch-operation":a(()=>[me((_(),B(n,{type:"primary",link:"",onClick:Oe},{default:a(()=>[R(" 批量移动 ")]),_:1})),[[G,"mapserver_resources_movecatalog"]]),e(n,{type:"primary",link:"",onClick:Ue},{default:a(()=>[R("批量入库")]),_:1}),e(n,{link:"",type:"danger",onClick:r},{default:a(()=>[R(" 批量删除 ")]),_:1})]),thumbnailUrl:a(({scope:b})=>[t("img",{class:"image-preview",src:i(xa)+b.row.thumbnailUrl,style:{width:"80%",height:"55px"},alt:"缩略图",onError:m[0]||(m[0]=z=>w(z)),onClick:z=>o(b.row)},null,40,bo)]),name:a(({scope:b})=>[e($,{type:"primary",onClick:z=>Ee(b.row)},{default:a(()=>[R(re(b.row.name),1)]),_:2},1032,["onClick"])]),resourceType:a(({scope:b})=>[R(re(C.value(b.row)),1)]),status:a(({scope:b})=>[e(n,{type:ae[b.row.status],link:""},{default:a(()=>[R(re(i(Aa).get(b.row.status)),1)]),_:2},1032,["type"])]),operation:a(({scope:b})=>[b.row.status==="UPLOAD_FAIL"?me((_(),B(n,{key:0,type:"primary",link:"",onClick:z=>we(b.row)},{default:a(()=>[R("重新上传 ")]),_:2},1032,["onClick"])),[[G,"resource_manager_upload"]]):ve("",!0),me((_(),B(n,{type:"primary",link:"",disabled:b.row.status!=="PROCESSED",onClick:z=>ne(b.row,b.row.status!=="PROCESSED")},{default:a(()=>[R(" 编辑 ")]),_:2},1032,["disabled","onClick"])),[[G,"mapserver_resources_update"]]),me((_(),B(n,{type:"primary",link:"",disabled:b.row.status!=="PROCESSED",onClick:z=>U(b.row,b.row.status!=="PROCESSED")},{default:a(()=>[R(" 发布 ")]),_:2},1032,["disabled","onClick"])),[[G,"mapserver_mapservices_publish"]]),me((_(),B(n,{type:"danger",link:"",disabled:b.row.type===1,onClick:z=>$e(b.row)},{default:a(()=>[R(" 删除 ")]),_:2},1032,["disabled","onClick"])),[[G,"resource_manager_delete"]])]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1})]),_:1})]),_:1}),e(Ma,{visible:I.dialogVisible,"onUpdate:visible":m[1]||(m[1]=b=>I.dialogVisible=b),"dom-id":"datapage","dialog-type":I.dialogType,"cur-edit-id":I.curEditId,onSave:i(D),onChangeEdit:le},null,8,["visible","dialog-type","cur-edit-id","onSave"]),e(Ql,{visible:I.releaseDialogVisible,"onUpdate:visible":m[2]||(m[2]=b=>I.releaseDialogVisible=b),"dom-id":"datapage","relese-data-info":I.releseDataInfo,onSave:i(D)},null,8,["visible","relese-data-info","onSave"]),e(Ua,{visible:I.chooseDataSourceVisible,"onUpdate:visible":m[3]||(m[3]=b=>I.chooseDataSourceVisible=b),"cur-catalog-id":F.catalogId,onSave:i(D)},null,8,["visible","cur-catalog-id","onSave"]),e(Ba,{visible:I.moveDataDialog,"onUpdate:visible":m[4]||(m[4]=b=>I.moveDataDialog=b),"resource-ids":v.value,onSave:i(D)},null,8,["visible","resource-ids","onSave"]),e(Ra,{visible:I.thumbnailDialogVisible,"onUpdate:visible":m[5]||(m[5]=b=>I.thumbnailDialogVisible=b),title:"数据封面","preview-data":I.curPreviewItem,"is-data":"",onSave:i(D)},null,8,["visible","preview-data","onSave"]),e(_o,{visible:I.warehouseDialogVisible,"onUpdate:visible":m[6]||(m[6]=b=>I.warehouseDialogVisible=b),"cur-item":I.curWarehouseItem,"is-batch":!0,onSave:i(D)},null,8,["visible","cur-item","onSave"])],64)}}}),qo=Ce({__name:"index",setup(j){return(A,c)=>(_(),B(ho,{ref:"componentRef"},null,512))}});export{qo as default};
