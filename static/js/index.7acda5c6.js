import{r as _,S as T,E as v,N as S,aj as f,d as x,b as C,e as B,o as k,x as w,k as c,j as h,u as e,l as P,g as j,U as A,B as E,ak as $}from"./element-plus.59ccb443.js";import{r as D,t as V,x as G,y as H,z as q,A as F,v as I}from"./login.a4e9287e.js";import{k as K}from"./index-a95bb620.js";import"./lodash.22f463b4.js";import"./error.229cea25.js";import"../../app-config.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";function U({category:o,visitor:i,keyword:r,rows:p,page:m,startDate:d,endDate:t}){return D.doGetPromise("/certification/manager/logs",{category:o,visitor:i,keyword:r,rows:p,page:m,startDate:d,endDate:t})}function J(){return D.doGetPromise("/certification/manager/logs/delete")}function Q(){const o=_({serviceTypeOptions:[]}),{serviceTypeOptions:i}=T(o),r=_({searchOptions:[{label:"关键字",key:"keyword",type:"text",placeholder:"搜索服务名称/别名",labelWidth:"0px",span:4},{label:"服务类型",key:"category",type:"select",options:i,span:4,value:"ALL"},{label:"访问人",key:"visitor",type:"text",placeholder:"搜索访问人",labelWidth:"0px",span:4},{label:"访问时间",key:"time",type:"dateTimePicker",datePickerType:"datetimerange",span:8,labelWidth:"0px",value:[`${v().subtract(2,"day").format("YYYY-MM-DD hh:mm:ss").slice(0,-8)}00:00:00`,`${v().format("YYYY-MM-DD hh:mm:ss").slice(0,-8)}23:59:59`],clearable:!1,datePickerOption:{defaultTime:[new Date(2022,1,1,0,0,0),new Date(2022,2,1,23,59,59)],disabledDate(t){return t.getTime()>new Date().setHours(23,59,59,999)||t.getTime()<Date.now()-3*24*60*60*1e3}}}],columns:[{prop:"serviceName",label:"服务名称",sortable:!0,minWidth:90},{prop:"serviceAlisName",label:"服务别名",sortable:!0,minWidth:90},{prop:"categoryAliasName",label:"服务类型",sortable:!0,width:120,minWidth:80},{prop:"url",label:"服务地址",minWidth:220},{prop:"visitor",label:"访问人",sortable:!0,minWidth:80},{prop:"ip",label:"服务IP",width:120,minWidth:80},{prop:"visitTime",label:"访问时间",sortable:!0,minWidth:80},{prop:"responseTime",label:"响应时间",sortable:!0,minWidth:80,slot:"responseTime",sortMethod:(t,n)=>{const a=t.responseTime,u=n.responseTime;return a-u}}]}),p=async()=>{d().then(t=>{let n=t;n=n.map(a=>({value:a.dictKey,label:a.dictValue})),o.serviceTypeOptions=[{label:"所有",value:"ALL"},...n]})},m=async()=>{p()};S(async()=>{m()});function d(){return new Promise((t,n)=>{K("kjfwlx").then(a=>{if(a.code==="0000"){const{data:{kjfwlx:u}}=a;t(u)}else f({type:"warning",message:"请求服务类型失败"}),t([])}).catch(a=>{f({type:"error",message:a.message}),t([])})})}return{...T(r)}}const X=x({__name:"NewestServerLog",setup(o){const i=C(),r=C(),{searchOptions:p,columns:m}=Q(),d={},{data:t,total:n,pageNo:a,pageSize:u,loading:N,handleSizeChange:W,handleCurrentChange:L,handleSelectionChange:O,handleSearch:g,initData:R}=V(U,d);S(()=>{R()});function M(s){return new RegExp("[一-龥]+").test(s)?"isError":Number(s)<=500?"isGood":"isCommom"}function z(s){if(new RegExp("[一-龥]+").test(s))return"--ms";{const l=Number(s);return l<=1e4?`${l}ms`:`${l/1e3}s`}}function Y(){$.confirm("该操作将清空当前列表中所有的数据，且不可恢复，是否继续？","清除访问日志",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",draggable:!0}).then(()=>{J().then(s=>{s.code==="0000"&&(f({type:"success",message:"清除成功"}),g())})}).catch(()=>{})}return(s,b)=>{const l=B("el-button");return k(),w(e(I),{ref_key:"mainContainerRef",ref:i,background:""},{default:c(()=>[h(e(G),{padding:"1 1 0",border:""},{default:c(()=>[h(e(H),{ref_key:"searchRef",ref:r,options:e(p),"query-permission":"sys_mapservice_visit_log_page","class-name":"commonSearchForm",onHandleSearch:e(g)},null,8,["options","onHandleSearch"])]),_:1}),h(e(q),null,{default:c(()=>[h(e(F),{ref:"baseTable","operation-width":"220",columns:e(m),"table-data":e(t),"current-page":e(a),"page-size":e(u),total:e(n),"pagination-is-need":!0,"operation-is-need":!1,loading:e(N),"search-form-ref":r.value,"selection-is-need":!1,"index-is-need":!1,"table-expand-is-need":!1,onSizeChange:e(W),onCurrentChange:e(L),onSelectionChange:e(O)},{"smart-table_operation":c(()=>[h(l,{type:"primary",onClick:Y},{default:c(()=>[P(" 清除 ")]),_:1})]),responseTime:c(({scope:y})=>[j("div",{class:A(["responseTime",M(y.row.responseTime)])},E(z(y.row.responseTime)),3)]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1})]),_:1},512)}}}),ce=x({__name:"index",setup(o){return(i,r)=>(k(),w(X))}});export{ce as default};
