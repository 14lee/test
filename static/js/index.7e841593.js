import{r as z,S as me,d as ee,b as f,e as s,o as y,f as M,j as e,k as t,l as h,u as n,F as P,R as fe,c as _e,w as le,g as b,B as Y,x as I,z as H,c3 as ge,bL as ve,bo as ie,y as be,n as ye,ai as L,ak as Z,aj as he}from"./element-plus.59ccb443.js";import{x as se,t as xe,y as Ce,z as ke,A as we,v as Ve}from"./login.a4e9287e.js";import{ac as Te,ad as Fe,ae as Se,v as Be,af as De,ag as $e,ah as oe,t as Ee}from"./index-a95bb620.js";import{_ as te}from"./error.229cea25.js";import{q as ne}from"./lodash.22f463b4.js";import"../../app-config.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";function Re(){const N=z({searchOptions:[{label:"关键字",key:"name",type:"text",span:5,placeholder:"目录名称"},{label:"创建/修改日期",key:"time",type:"dateTimePicker",datePickerType:"daterange",rangeKey:["startTime","endTime"],span:6}],columns:[{prop:"name",label:"目录名称",minWidth:120,showTooltip:!0,slot:"name"},{prop:"description",label:"目录描述",minWidth:120,showTooltip:!0},{prop:"creator",label:"创建人",minWidth:120},{prop:"createTime",label:"创建时间",minWidth:120},{prop:"updateTime",label:"修改时间",minWidth:120}]});return{...me(N)}}const Le=ee({__name:"addDialogForm",emits:["close","save"],setup(N,{emit:q}){const T=f(),r=z({name:"",description:""}),A=z({name:[{required:!0,message:"请填写",trigger:"blur"}]}),d=f(!1),m=q,l=async $=>{$&&await $.validate(async(_,x)=>{if(_){d.value=!0;const F=fe(r);await Te(F),d.value=!1,T.value.resetFields(),m("save"),m("close")}else d.value=!1,console.log("error submit!",x)})};function V(){m("close")}return($,_)=>{const x=s("el-input"),F=s("el-form-item"),c=s("el-form"),S=s("el-button");return y(),M(P,null,[e(c,{ref_key:"ruleFormRef",ref:T,model:r,rules:A,"label-width":"120px",class:"demo-ruleForm",size:"default","status-icon":""},{default:t(()=>[e(F,{label:"目录名称",prop:"name"},{default:t(()=>[e(x,{modelValue:r.name,"onUpdate:modelValue":_[0]||(_[0]=u=>r.name=u),clearable:"",maxlength:"32"},null,8,["modelValue"])]),_:1}),e(F,{label:"目录描述",prop:"description"},{default:t(()=>[e(x,{modelValue:r.description,"onUpdate:modelValue":_[1]||(_[1]=u=>r.description=u),type:"textarea",clearable:"",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),e(n(se),{justify:"end"},{default:t(()=>[e(S,{onClick:V},{default:t(()=>[h("取消")]),_:1}),e(S,{loading:d.value,type:"primary",onClick:_[2]||(_[2]=u=>l(T.value))},{default:t(()=>[h(" 确定 ")]),_:1},8,["loading"])]),_:1})],64)}}});const ze=te(Le,[["__scopeId","data-v-92decb17"]]),Oe={class:"common-wrapper engineer__detail-box"},Ue={class:"dataCenter-header"},Ie={class:"header-content"},Me={class:"left-content"},Ne={class:"dataCenter-main",style:{"background-color":"#ffffff"}},qe={style:{padding:"16px 16px 0 0"}},Ae={style:{padding:"0 20px"}},We={class:"dataCenter-footer"},je={class:"classify-data"},He={class:"dialog-footer"},Pe=ee({__name:"detailInfo",props:{curItem:{type:Object,default:()=>{}},canEdit:{type:Boolean,default:!0}},emits:["handleCloseFullscreenBox","initData"],setup(N,{emit:q}){const T=f(),r=f({id:"",name:"",description:""}),A=f(!1),d=f({}),m=f({}),l=z({dialogType:"add",dialogVisible:!1,btnLoading:!1}),V=f(),$=z({name:[{required:!0,message:"请填写",trigger:"blur"}]}),_=z({name:[{required:!0,message:"请填写",trigger:"blur"}]}),x=f([]),F=_e(()=>{if(x.value.length===0)return[{value:"#",label:"/"}];{let o=[{value:"#",label:"/",idx:0}];const a=(p,k,R)=>{p.forEach(g=>{var U;const v=g.pid==="#"?g.name:`${k} / ${g.name}`,O=g.pid==="#"?1:R;o.push({value:g.id,label:v,idx:O}),((U=g==null?void 0:g.children)==null?void 0:U.length)>0&&a(g.children,v,O+1)})},w=ne.cloneDeep(x.value).filter(p=>!p.isDefault);return a(w,"",1),l.dialogType==="edit"&&(o=o.filter(p=>p.value!==m.value.id)),o=o.filter(p=>p.idx<=5),o}}),c=f(!0),S=q,u=N;le(()=>u.canEdit,o=>{c.value=o},{immediate:!0});function W(){S("handleCloseFullscreenBox")}function E(){l.dialogType==="add"?(d.value={name:"",pid:"#",description:""},m.value.id&&(d.value.pid=m.value.id)):l.dialogType==="edit"&&(d.value={...m.value}),ye(()=>{V.value.clearValidate()})}function K(){T.value.validate(o=>{if(o){const a=ne.cloneDeep(r.value),w={id:a.id,name:a.name,description:a.description};Fe(w).then(p=>{p.success&&(L({type:"success",title:"目录编辑成功"}),S("initData"))})}})}function G(){l.dialogType="add",l.dialogVisible=!0}function J(o){m.value=o,l.dialogType="add",l.dialogVisible=!0}function Q(o){m.value=o,l.dialogType="edit",l.dialogVisible=!0}function j(){V.value.resetFields(),l.dialogVisible=!1,m.value={}}function X(o){Z.confirm("是否删除该分类?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{Se({catalogId:o.id}).then(a=>{a.code==="0000"?(L({type:"success",title:"删除成功"}),C(u.curItem.id)):L({type:"error",title:"删除失败"})}).catch(a=>{L({type:"error",title:"删除失败",message:a.message})})}).catch(()=>{})}async function C(o){const a=await Be({classificationId:o});a.success&&(x.value=a.data)}le(()=>u.curItem,o=>{o&&(r.value=o,C(o.id))},{deep:!0,immediate:!0});function B(){c.value=!0}function D(){V.value.validate(o=>{if(o){const a=l.dialogType==="add"?"新增":"编辑",w=l.dialogType==="add"?De:$e,p={...d.value,classificationId:u.curItem.id};l.dialogType!=="add"&&(delete p.children,delete p.level),l.btnLoading=!0,w(p).then(k=>{l.btnLoading=!1,k.code==="0000"?(L({type:"success",title:`${a}目录成功`}),V.value.resetFields(),l.dialogVisible=!1,C(u.curItem.id)):(l.btnLoading=!1,L({type:"error",title:`${a}目录失败`,message:k.message}))}).catch(k=>{l.btnLoading=!1,L({type:"error",title:`${a}目录失败`,message:k.message})})}})}return(o,a)=>{const w=s("ArrowLeft"),p=s("el-icon"),k=s("el-input"),R=s("el-form-item"),g=s("el-form"),v=s("el-button"),O=s("el-table-column"),U=s("el-tooltip"),de=s("el-table"),re=s("el-scrollbar"),ce=s("el-option"),ue=s("el-select"),pe=s("el-dialog");return y(),M(P,null,[b("div",Oe,[b("div",Ue,[b("div",Ie,[b("div",Me,[e(p,{onClick:W},{default:t(()=>[e(w)]),_:1}),b("span",null,Y(c.value?"编辑":"查看")+"目录",1)])])]),b("div",Ne,[e(re,null,{default:t(()=>[b("div",qe,[e(g,{ref_key:"ruleFormRef",ref:T,model:r.value,rules:_,"label-width":"90px",class:"demo-ruleForm",size:"default",disabled:!c.value,"status-icon":""},{default:t(()=>[e(R,{label:"目录名称",prop:"name"},{default:t(()=>[e(k,{modelValue:r.value.name,"onUpdate:modelValue":a[0]||(a[0]=i=>r.value.name=i),clearable:"",maxlength:"32"},null,8,["modelValue"])]),_:1}),e(R,{label:"目录描述",prop:"description"},{default:t(()=>[e(k,{modelValue:r.value.description,"onUpdate:modelValue":a[1]||(a[1]=i=>r.value.description=i),type:"textarea",clearable:"",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"]),b("div",Ae,[c.value?(y(),I(v,{key:0,type:"primary",onClick:G},{default:t(()=>[h("新增目录")]),_:1})):H("",!0),e(de,{data:x.value,style:{width:"100%","margin-top":"16px"},"row-key":"id"},{default:t(()=>[e(O,{prop:"name",label:"名称","show-overflow-tooltip":!0}),e(O,{prop:"description",label:"描述","show-overflow-tooltip":!0}),e(O,{align:"center",label:"操作",width:"220"},{default:t(i=>[i.row.id!=="1"?(y(),M(P,{key:0},[e(U,{content:"新增子目录",effect:"light"},{default:t(()=>[i.row.level<6?(y(),I(v,{key:0,icon:n(ge),type:"primary",text:"",palin:"",disabled:!c.value,onClick:ae=>J(i.row)},null,8,["icon","disabled","onClick"])):H("",!0)]),_:2},1024),e(U,{content:"编辑",effect:"light"},{default:t(()=>[e(v,{icon:n(ve),type:"primary",text:"",palin:"",disabled:!c.value,onClick:ae=>Q(i.row)},null,8,["icon","disabled","onClick"])]),_:2},1024),e(U,{content:"删除",effect:"light"},{default:t(()=>[e(v,{icon:n(ie),type:"danger",text:"",palin:"",disabled:!c.value,onClick:ae=>X(i.row)},null,8,["icon","disabled","onClick"])]),_:2},1024)],64)):H("",!0)]),_:1})]),_:1},8,["data"])])])]),_:1})]),b("div",We,[e(v,{onClick:W},{default:t(()=>[h("取消")]),_:1}),c.value?(y(),I(v,{key:0,loading:A.value,type:"primary",onClick:a[2]||(a[2]=i=>K())},{default:t(()=>[h(" 保存 ")]),_:1},8,["loading"])):(y(),I(v,{key:1,type:"primary",onClick:B},{default:t(()=>[h("编辑")]),_:1}))])]),e(pe,{modelValue:l.dialogVisible,"onUpdate:modelValue":a[6]||(a[6]=i=>l.dialogVisible=i),class:"center-dialog",title:`${l.dialogType==="add"?"新增":"编辑"}目录`,"append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"500px",onOpen:E,onClosed:j},{footer:t(()=>[b("span",He,[e(v,{onClick:j},{default:t(()=>[h("取 消")]),_:1}),e(v,{type:"primary",onClick:D},{default:t(()=>[h(Y(l.dialogType==="add"?"确定":"保存"),1)]),_:1})])]),default:t(()=>[b("div",je,[e(g,{ref_key:"addTreeFormRef",ref:V,model:d.value,rules:$,"label-width":"100px","label-position":"right"},{default:t(()=>[e(R,{label:"目录名称：",prop:"name"},{default:t(()=>[e(k,{modelValue:d.value.name,"onUpdate:modelValue":a[3]||(a[3]=i=>d.value.name=i),modelModifiers:{trim:!0},type:"text",placeholder:"请输入目录名称",maxlength:"10","show-word-limit":"",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(R,{label:"上级目录：",prop:"pid"},{default:t(()=>[e(ue,{modelValue:d.value.pid,"onUpdate:modelValue":a[4]||(a[4]=i=>d.value.pid=i),placeholder:"请选择上级目录",style:{width:"100%"},filterable:""},{default:t(()=>[(y(!0),M(P,null,be(F.value,i=>(y(),I(ce,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(R,{label:"描述：",prop:"description"},{default:t(()=>[e(k,{modelValue:d.value.description,"onUpdate:modelValue":a[5]||(a[5]=i=>d.value.description=i),type:"textarea",placeholder:"请输入描述",clearable:"",rows:6,maxlength:"100","show-word-limit":"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"])],64)}}});const Ke=te(Pe,[["__scopeId","data-v-b9a6c3d4"]]),Ge={class:"dataContainer"},Je=["onClick"],Qe={key:0,class:"fullscreenBox"},Xe=ee({__name:"index",setup(N){const{searchOptions:q,columns:T}=Re(),{data:r,total:A,pageNo:d,pageSize:m,multipleSelection:l,loading:V,handleSizeChange:$,handleCurrentChange:_,handleSelectionChange:x,handleSearch:F,initData:c}=xe(Ee),S=f(),u=f(!1),W=f(null),E=z({component:"",fullscreenBoxVisible:!1,canEdit:!0});function K(){E.fullscreenBoxVisible=!1}function G(){u.value=!0}function J(){u.value=!1}function Q(C){Z.confirm("是否确认删除该目录？",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(async()=>{C.id&&(await oe({classificationId:C.id})).success&&c()}).catch(()=>{})}function j(C,B){W.value=C,E.fullscreenBoxVisible=!0,E.canEdit=B}function X(){if(l.value.length===0){he.warning("请选择要删除的目录");return}Z.confirm("是否确认删除选中的目录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{if(l.value.length>0){const C=l.value.map(D=>D.id).toString();(await oe({classificationId:C})).success&&(c(),l.value=[])}}).catch(()=>{})}return(C,B)=>{const D=s("el-button"),o=s("el-dialog");return y(),M("div",Ge,[e(n(Ve),{background:""},{default:t(()=>[e(n(se),{padding:"1 1 0",border:""},{default:t(()=>[e(n(Ce),{ref_key:"SmartSearchRef",ref:S,options:n(q),"query-permission":"sys_message_getAnnouncementPage",onHandleSearch:n(F)},null,8,["options","onHandleSearch"])]),_:1}),e(n(ke),null,{default:t(()=>[e(n(we),{ref:"baseTable","operation-width":"220",columns:n(T),"table-data":n(r),"current-page":n(d),"page-size":n(m),total:n(A),"pagination-is-need":!0,"operation-is-need":!0,loading:n(V),"search-form-ref":S.value,"selection-is-need":!0,"index-is-need":!1,onSizeChange:n($),onCurrentChange:n(_),onSelectionChange:n(x)},{"smart-table_operation":t(()=>[e(D,{type:"primary",onClick:G},{default:t(()=>[h(" 新增目录 ")]),_:1})]),"smart-table_batch-operation":t(()=>[e(D,{link:"",type:"danger",icon:n(ie),onClick:X},{default:t(()=>[h(" 批量删除 ")]),_:1},8,["icon"])]),name:t(({scope:a})=>[b("div",{class:"linkStyle",type:"primary",onClick:w=>j(a.row,!1)},Y(a.row.name),9,Je)]),operation:t(({scope:a})=>[e(D,{link:"",type:"primary",onClick:w=>j(a.row,!0)},{default:t(()=>[h(" 编辑 ")]),_:2},1032,["onClick"]),e(D,{link:"",type:"danger",onClick:w=>Q(a.row)},{default:t(()=>[h(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1}),e(o,{modelValue:u.value,"onUpdate:modelValue":B[0]||(B[0]=a=>u.value=a),title:"新增目录",width:"30%"},{default:t(()=>[u.value?(y(),I(ze,{key:0,onClose:J,onSave:n(c)},null,8,["onSave"])):H("",!0)]),_:1},8,["modelValue"])]),_:1}),E.fullscreenBoxVisible?(y(),M("div",Qe,[e(Ke,{"cur-item":W.value,"can-edit":E.canEdit,onHandleCloseFullscreenBox:K,onInitData:n(c)},null,8,["cur-item","can-edit","onInitData"])])):H("",!0)])}}});const dt=te(Xe,[["__scopeId","data-v-cdc55fcf"]]);export{dt as default};
