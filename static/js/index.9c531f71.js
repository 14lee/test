import{d as J,b as A,r as q,w as X,e as v,t as Y,o as g,x as C,k as a,v as Z,f as U,g as i,j as l,B as u,u as t,U as ee,l as T,aj as F,ai as V,N as Q,S as ae,ad as z,bo as te,ak as G}from"./element-plus.59ccb443.js";import{q as ie,v as j}from"./lodash.22f463b4.js";import{S as w}from"./serviceManage.8c46f250.js";import{D as h,d as le,S as oe}from"./index.vue_vue_type_style_index_0_scoped_7b7c1886_lang.2666f209.js";import{t as se,x as ne,y as re,z as de,A as ce,v as ue}from"./login.a4e9287e.js";import"./index-a95bb620.js";import"./error.229cea25.js";import"../../app-config.js";import"./echarts.39e3cf74.js";import"./wujie-vue3.9ecbe737.js";import"./smartweb3.2d5e4c59.js";import"./smart-ui.e8e0134c.js";const pe={class:"main-content"},me={class:"title"},fe={class:"card"},ge=i("div",{class:"subtitle"},"服务信息",-1),he={class:"content-wrap"},_e={class:"item-wrap item2"},be={key:1},ve={class:"item-wrap item2"},ye={class:"item-wrap"},De={class:"item-wrap"},Ce={key:1},ke={class:"item-wrap item2"},Se={class:"item-wrap"},we={class:"link"},Te={class:"footer"},Ve=J({__name:"IOTServerInfoDialog",props:{visible:{type:Boolean,default:!1},dialogType:{default:h.CHECK},domId:{default:""},curEditData:{default:()=>{}}},emits:["update:visible","changeEdit","save"],setup(B,{emit:O}){const E=A(),H=A(),k=B,r=O,e=q({dialogVisible:!1,loading:!1,submiting:!1,initData:{id:"",name:"",aliasName:"",categoryAliasName:"",status:0,description:"",creator:"",publishTime:"",url:"",versions:[],resourceName:""},editData:{},rules:{aliasName:[{required:!0,message:"服务名称不能为空",trigger:"blur"},{min:0,max:50,message:"长度在 50 个字符以内",trigger:["blur","change"]}],description:[{min:0,max:100,message:"长度在 100 个字符以内",trigger:["blur","change"]}]}});X(()=>k.visible,s=>{e.dialogVisible=s});function $(){E.value.clearValidate(),W(k.curEditData.id)}function N(){r("update:visible",!1)}function M(s){r("changeEdit",s)}function W(s){e.loading=!0,w.getServiceInfoById(s).then(o=>{if(o.code==="0000"){e.editData=ie.cloneDeep(e.initData);for(const p in e.initData)e.editData[p]=o.data[p]??e.initData[p]}else F({type:"error",message:"获取信息失败"})}).catch(()=>{F({type:"error",message:"获取信息错误"})}).finally(()=>{e.loading=!1})}function _(s){return new Promise(o=>{s.validate(p=>{o(p)})})}function R(){k.dialogType===h.EDIT&&_(E.value).then(s=>{if(s){const{id:o,aliasName:p,status:I,description:n}=e.editData,S={id:o,aliasName:p,status:I,description:n};e.submiting=!0,w.updateServiceInfo(S).then(b=>{e.submiting=!1,b.code==="0000"?(V({type:"success",title:"编辑成功"}),N(),r("save")):V({type:"error",title:"服务编辑失败",message:b.message})}).catch(b=>{e.submiting=!1,V({type:"error",title:"服务编辑错误",message:b.message})})}})}return(s,o)=>{const p=v("ArrowLeft"),I=v("el-icon"),n=v("el-form-item"),S=v("el-input"),b=v("el-switch"),K=v("el-form"),x=v("el-button"),L=Y("loading");return g(),C(t(oe),{id:"iot-server-full-dialog",modelValue:e.dialogVisible,"onUpdate:modelValue":o[5]||(o[5]=m=>e.dialogVisible=m),class:"full-dialog common-full-dialog","append-to-dom":s.domId,"modal-append-to-body":!1,fullscreen:"","is-custom":"","close-on-press-escape":!1,onOpen:$,onClosed:N},{default:a(()=>[Z((g(),U("div",pe,[i("div",me,[l(I,{onClick:N},{default:a(()=>[l(p)]),_:1}),i("span",null,u((t(le).get(s.dialogType)||"查看")+"服务"),1)]),i("div",{ref_key:"mainRef",ref:H,class:"main"},[i("div",fe,[ge,i("div",he,[l(K,{ref_key:"editFormRef",ref:E,class:"form edit-form",inline:"",model:e.editData,rules:e.rules,"label-width":"auto","label-position":"right"},{default:a(()=>[i("div",_e,[l(n,{label:"服务标识",prop:"name"},{default:a(()=>[i("span",null,u(e.editData.name),1)]),_:1}),l(n,{label:"服务名称",prop:"aliasName"},{default:a(()=>[s.dialogType===t(h).EDIT?(g(),C(S,{key:0,modelValue:e.editData.aliasName,"onUpdate:modelValue":o[0]||(o[0]=m=>e.editData.aliasName=m),type:"text",placeholder:"请输入服务名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])):(g(),U("span",be,u(e.editData.aliasName),1))]),_:1})]),i("div",ve,[l(n,{label:"服务类型",prop:"categoryAliasName"},{default:a(()=>[i("span",null,u(e.editData.categoryAliasName||"流数据"),1)]),_:1}),l(n,{label:"数据名称",prop:"resourceName"},{default:a(()=>[i("span",null,u(e.editData.resourceName),1)]),_:1})]),i("div",ye,[l(n,{label:"服务说明",prop:"description"},{default:a(()=>[s.dialogType===t(h).EDIT?(g(),C(S,{key:0,modelValue:e.editData.description,"onUpdate:modelValue":o[1]||(o[1]=m=>e.editData.description=m),type:"text",placeholder:"请输入服务说明",clearable:""},null,8,["modelValue"])):(g(),U("span",{key:1,class:ee(["description",e.editData.description?"":"empty"])},u(e.editData.description||"未说明"),3))]),_:1})]),i("div",De,[l(n,{label:"服务状态",prop:"status"},{default:a(()=>[s.dialogType===t(h).EDIT?(g(),C(b,{key:0,modelValue:e.editData.status,"onUpdate:modelValue":o[2]||(o[2]=m=>e.editData.status=m),class:"swith-btn","active-value":0,"inactive-value":1},null,8,["modelValue"])):(g(),U("span",Ce,u(e.editData.status===0?"已启动":"已停止"),1))]),_:1})]),i("div",ke,[l(n,{label:"发布人",prop:"creator"},{default:a(()=>[i("span",null,u(e.editData.creator),1)]),_:1}),l(n,{label:"发布时间",prop:"publishTime"},{default:a(()=>[i("span",null,u(e.editData.publishTime),1)]),_:1})]),i("div",Se,[l(n,{label:"服务地址",prop:"url"},{default:a(()=>[i("span",we,u(e.editData.url),1)]),_:1})])]),_:1},8,["model","rules"])])])],512),i("div",Te,[l(x,{onClick:o[3]||(o[3]=m=>e.dialogVisible=!1)},{default:a(()=>[T("取消")]),_:1}),s.dialogType===t(h).CHECK?(g(),C(x,{key:0,type:"primary",onClick:o[4]||(o[4]=m=>M(t(h).EDIT))},{default:a(()=>[T("编辑")]),_:1})):(g(),C(x,{key:1,type:"primary",loading:e.submiting,onClick:R},{default:a(()=>[T(" 保存 ")]),_:1},8,["loading"]))])])),[[L,e.loading]])]),_:1},8,["modelValue","append-to-dom"])}}});function Ee(){const B=q({searchOptions:[{label:"关键字",key:"keyword",type:"text",placeholder:"标识/名称/发布人",span:5},{label:"服务状态",key:"status",type:"select",placeholder:"选择数据类型",span:5,options:[{label:"所有",value:""},{label:"已停止",value:1},{label:"已启动",value:0}],clearable:!0}],columns:[{prop:"name",label:"服务标识",minWidth:120,sortable:!0,slot:"name"},{prop:"aliasName",label:"服务名称",minWidth:120,sortable:!0,slot:"aliasName"},{prop:"categoryAliasName",label:"服务类型",minWidth:120,sortable:!0},{prop:"creator",label:"发布人",minWidth:120,sortable:!0},{prop:"publishTime",label:"发布时间",minWidth:120},{prop:"status",label:"服务状态",minWidth:120,slot:"status"}]});return Q(async()=>{}),{...ae(B)}}const Ne=["onClick"],Ie=["onClick"],xe={class:"operate-container"},Pe=J({__name:"index",setup(B){const{searchOptions:O,columns:E}=Ee(),H=A(),k=A(),r=q({domId:"graph-service-setting",dialogVisible:!1,dialogType:h.CHECK,curEditData:{}}),e={category:"IOT",publishStatus:"PUBLISHED"},{data:$,total:N,pageNo:M,pageSize:W,loading:_,multipleSelection:R,handleSizeChange:s,handleCurrentChange:o,handleSelectionChange:p,handleSearch:I,initData:n}=se(w.getServicePageList,e);Q(()=>{n()});function S(f,c){$.value.length!==0&&w.changeServiceStatus(c.id,c.status).then(y=>{y.code==="0000"&&V({title:"提示",message:`服务已${c.status===0?"启动":"停止"}！`,type:"success",duration:2e3}),n()}).catch(()=>{n()})}function b(f){r.curEditData=j(f),r.dialogType=h.CHECK,r.dialogVisible=!0}function K(f,c=h.EDIT){r.curEditData=j(f),r.dialogType=c,r.dialogVisible=!0}function x(f){r.dialogType=f}function L(f){G.confirm(`删除【${f.aliasName}】服务, 是否继续?`,"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{_.value=!0,w.deleteServiceByIds(f.id).then(c=>{_.value=!1,c.code==="0000"&&(V({type:"success",title:"删除服务成功"}),n())}).catch(()=>{_.value=!1})}).catch(()=>{})}function m(){G.confirm("是否批量删除选中服务?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.value=!0;const c=j(R.value).map(y=>y.id).join(",");w.deleteServiceByIds(c).then(y=>{_.value=!1,y.code==="0000"&&(V({type:"success",title:"批量删除服务成功"}),n(),R.value=[])}).catch(()=>{_.value=!1})}).catch(()=>{})}return(f,c)=>{const y=v("el-switch"),P=v("el-button");return g(),C(t(ue),{id:"graph-service-setting",ref_key:"mainContainerRef",ref:H,background:""},{default:a(()=>[l(t(ne),{padding:"1 1 0",border:""},{default:a(()=>[l(t(re),{ref_key:"SmartSearchRef",ref:k,options:t(O),"query-permission":"",onHandleSearch:t(I)},null,8,["options","onHandleSearch"])]),_:1}),l(t(de),null,{default:a(()=>[l(t(ce),{ref:"baseTable","operation-width":"220",columns:t(E),"table-data":t($),"current-page":t(M),"page-size":t(W),total:t(N),"pagination-is-need":!0,"operation-is-need":!0,loading:t(_),"search-form-ref":k.value,"selection-is-need":!0,"index-is-need":!1,"is-batch-slot-visible":!0,"desc-options":!1,onSizeChange:t(s),onCurrentChange:t(o),onSelectionChange:t(p)},{name:a(({scope:d})=>[i("span",{class:"link",onClick:z(D=>b(d.row),["stop"])},u(d.row.name),9,Ne)]),aliasName:a(({scope:d})=>[i("span",{class:"link",onClick:z(D=>b(d.row),["stop"])},u(d.row.aliasName),9,Ie)]),status:a(({scope:d})=>[l(y,{modelValue:d.row.status,"onUpdate:modelValue":D=>d.row.status=D,class:"swith-btn","active-value":0,"inactive-value":1,onChange:D=>S(D,d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),"smart-table_batch-operation":a(()=>[i("div",{class:"operate-row",onClick:m},[l(P,{"el-button":"",type:"danger",icon:t(te),link:""},{default:a(()=>[T("批量删除")]),_:1},8,["icon"])])]),operation:a(({scope:d})=>[i("div",xe,[l(P,{type:"primary",link:"",onClick:z(D=>K(d.row),["stop"])},{default:a(()=>[T("编辑")]),_:2},1032,["onClick"]),l(P,{disabled:d.row.default,type:"danger",link:"",onClick:z(D=>L(d.row),["stop"])},{default:a(()=>[T("删除")]),_:2},1032,["disabled","onClick"])])]),_:1},8,["columns","table-data","current-page","page-size","total","loading","search-form-ref","onSizeChange","onCurrentChange","onSelectionChange"])]),_:1}),l(Ve,{visible:r.dialogVisible,"onUpdate:visible":c[0]||(c[0]=d=>r.dialogVisible=d),"dom-id":r.domId,"dialog-type":r.dialogType,"cur-edit-data":r.curEditData,onSave:t(n),onChangeEdit:x},null,8,["visible","dom-id","dialog-type","cur-edit-data","onSave"])]),_:1},512)}}});export{Pe as default};
