import{d as oe,c as x,e as f,o as h,x as j,k as c,f as C,F as M,y as G,g as a,Q as J,ad as N,B as g,j as n,l as S,z as ge,aj as y,ak as ve,Z as se,_ as ae,b as W,r as X,w as he,N as ye,t as Se,u as R,A as Ce,U as H,v as we}from"./element-plus.59ccb443.js";import{r as ne,S as $,Z as ke,x as ee,v as te,z as be}from"./login.a4e9287e.js";import{e as xe}from"../../app-config.js";import{D as Te,p as Ve}from"./sceneManage.55882510.js";import{i as le}from"./index.e0e8e942.js";import{bh as De,d as Pe}from"./lodash.22f463b4.js";import{_ as ce}from"./error.229cea25.js";import{s as Re}from"./userManage.ffbb234b.js";function Ie(_){return ne.doGetPromise("/sceneservice/manager/searchForPortal",_)}function re(_){return ne.doGetPromise("/sceneservice/manager/updateAccessCount",{id:_})}const ie=_=>(se("data-v-c2f363a5"),_=_(),ae(),_),Ae={key:0,class:"no-data"},$e={key:1,class:"scene-container"},Ue=["onClick"],Ee=["onClick"],qe={class:"default"},Be={class:"scene-visit"},Ne={class:"cover"},He={class:"cover-info"},Me={class:"cover-info__name"},Fe={class:"cover-info__detail"},Le={class:"creator"},Oe={class:"cerateTime"},ze={class:"cover-description"},Ze={class:"cover-row"},je=ie(()=>a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[a("rect",{x:"6.28571",y:"1.99097",width:"3.42857",height:"5.71429",fill:"#ffffff"}),a("path",{d:"M6.26242 10.0374H9.73758L8.24823 14.009H7.75178L6.26242 10.0374Z",fill:"#ffffff"}),a("path",{d:"M3.78012 10.7821C3.78012 8.45154 5.66941 6.56226 7.99996 6.56226C10.3305 6.56226 12.2198 8.45154 12.2198 10.7821H3.78012Z",fill:"#ffffff"})],-1)),Ge=["onClick"],Ke=["onClick"],Qe={class:"scene-info"},Ye={class:"scene-name"},Je=ie(()=>a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[a("rect",{x:"6.28571",y:"1.99097",width:"3.42857",height:"5.71429",fill:"#409EFF"}),a("path",{d:"M6.26242 10.0374H9.73758L8.24823 14.009H7.75178L6.26242 10.0374Z",fill:"#409EFF"}),a("path",{d:"M3.78012 10.7821C3.78012 8.45154 5.66941 6.56226 7.99996 6.56226C10.3305 6.56226 12.2198 8.45154 12.2198 10.7821H3.78012Z",fill:"#409EFF"})],-1)),We=["onClick"],Xe=oe({__name:"scene",props:{data:{default:()=>[]},height:{default:0}},emits:["apply","refresh","raiseTop"],setup(_,{emit:w}){const T=_,e=w,i=["审核中","已通过","申请场景","申请场景","申请场景"],k=x(()=>T==null?void 0:T.data),V=x(()=>s=>{const u=document.documentElement,m={1:getComputedStyle(u).getPropertyValue("--el-color-success"),2:getComputedStyle(u).getPropertyValue("--el-color-warning"),3:getComputedStyle(u).getPropertyValue("--el-color-danger")};return{border:`1px solid ${m[s]}`,background:`${m[s]}`}}),F=()=>({plusAccessCount(s){re(s).then(u=>{u.code===$.SUCCESS&&e("refresh")})}}),d=x(()=>s=>({background:`url('${xe.VITE_APP_BASE_URL}${s}'), url('${Te}')`,"background-position":"center center","background-size":"cover"}));function I(s){const{status:u,permissionTypeNum:m,applyStatus:A}=s;return m>0||u===1||u===2&&m===0&&A===1}function U(s){e("apply",s)}function E(s){const{applyStatus:u}=s;if(u===0)return y.warning("该场景的申请正在审核中, 请稍后操作");if(I(s))q(s);else{const m="您还没有该场景的查看权限，是否前往申请？";ve.confirm(m,"权限提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{U(s)}).catch(()=>{})}}function L(s){I(s)&&q(s)}function q(s){F().plusAccessCount(s.sceneNo),s.externalScene?window.open(s.externalScene):window.open(le+s.sceneNo)}function O(s){e("raiseTop",s)}const B=x(()=>s=>{let{applyStatus:u}=s;return De(u)&&(u=4),I(s)?"":i[u]});return(s,u)=>{const m=f("el-tooltip"),A=f("el-scrollbar");return h(),j(A,null,{default:c(()=>[k.value.length===0?(h(),C("div",Ae,"暂无数据")):(h(),C("div",$e,[(h(!0),C(M,null,G(k.value,r=>(h(),C("div",{key:r.id,class:"scene-item",onClick:D=>E(r)},[a("div",{class:"scene-main",style:J(d.value(r.cover)),onClick:N(D=>L(r),["stop"])},[a("div",qe,[a("span",{class:"scene-type",style:J(V.value(r.status))},g(r.status===1?"公开":r.status===2?"受限":"私有"),5),a("div",Be,g(r.accessCount)+"次",1)]),a("div",Ne,[a("div",He,[a("div",Me,g(r.sceneName),1),a("div",Fe,[a("span",Le,g(r.creator),1),a("span",Oe,g(r.createTime),1)])]),n(m,{"popper-class":"scene-tooltip",disabled:r.description.length<100,content:r.description},{default:c(()=>[a("div",ze,g(r.description),1)]),_:2},1032,["disabled","content"]),a("div",Ze,[je,a("span",{onClick:N(D=>O(r),["stop"])},g(r.topOrder?"取消置顶":"点击置顶"),9,Ge),S("     "),a("span",{onClick:N(D=>E(r),["stop"])},"点击查看",8,Ke)])])],12,Ee),a("div",Qe,[a("div",Ye,[r.topOrder?(h(),j(m,{key:0,content:"已置顶",placement:"top-start"},{default:c(()=>[Je]),_:1})):ge("",!0),S(" "+g(r.sceneName),1)]),a("span",{class:"apply",onClick:N(D=>U(r),["stop"])},g(B.value(r)),9,We)])],8,Ue))),128))]))]),_:1})}}});const et=ce(Xe,[["__scopeId","data-v-c2f363a5"]]),tt=_=>(se("data-v-6e88afdc"),_=_(),ae(),_),ot={class:"search-input"},st=tt(()=>a("label",null,"关键字:",-1)),at={class:"operation"},nt=["onClick"],lt={class:"validateDays"},ct={class:"dialog-footer"},rt=oe({__name:"index",setup(_){const w=W("all"),T=W(),e=X({scenes:[],total:0,contentHeight:0,requestParams:{status:"",rows:20,page:1,keyword:"",sortColumn:"createTime",sortRule:"DESC",showTop:0},curSortType:"default",sortTypes:[{title:"热门浏览",type:"accessCount"},{title:"最新发布",type:"createTime"}],sortColumnIndex:0,sortRuleIndex:0,loading:!1}),i=X({applyScene:null,validateDays:7,applyReason:"",applyDialogVisible:!1,radios:Object.freeze([{title:"7天",value:7},{title:"1个月",value:30},{title:"3个月",value:90}])}),k=x(()=>["createTime","accessCount"][e.sortColumnIndex]),V=x(()=>["DESC","ASC"][e.sortRuleIndex]),F=x(()=>e.curSortType==="default"?0:1),d=()=>({getScenes(o){e.loading=!0;const t={...e.requestParams,showTop:F.value,sortColumn:k.value,sortRule:V.value,...o};Ie(t).then(p=>{p.code===$.SUCCESS&&(e.scenes=p.data.records,e.total=p.data.total)}).finally(()=>{e.loading=!1})},plusAccessCount(o){re(o).then(t=>{t.code===$.SUCCESS&&d().getScenes()})},applyScene(o){Re(o).then(t=>{const{code:p}=t;p===$.SUCCESS?(y({message:"申请成功",type:"success"}),d().getScenes()):y({message:t.message,type:"warning"})}).catch(t=>{y.error(`申请场景异常 : ${t.message}`)}).finally(()=>{i.applyDialogVisible=!1,i.validateDays=7,i.applyReason=""})}});function I(){e.requestParams.page=1,e.requestParams.rows=20,e.requestParams.keyword="",e.requestParams.showTop=0,e.requestParams.sortColumn="createTime",e.requestParams.sortRule="DESC",e.sortColumnIndex=0,e.sortRuleIndex=0,e.total=0,e.curSortType="default",e.requestParams.status=w.value==="all"?"":w.value==="open"?"1":"2"}he(w,o=>{I(),d().getScenes()});const U=()=>{e.curSortType!=="default"&&(e.curSortType="default",d().getScenes())},E=Pe(()=>{e.requestParams.page=1,d().getScenes()},500),L=()=>{e.requestParams.page=1,d().getScenes()};function q(o){k.value.toUpperCase()===o.toUpperCase()?e.sortRuleIndex^=1:(e.sortRuleIndex=0,e.sortColumnIndex^=1),d().getScenes()}function O(o){e.curSortType=o,e.requestParams.page=1,q(o)}function B(o){return k.value.toUpperCase()===o.toUpperCase()}function s(o,t){e.curSortType=o,e.requestParams.page=1,d().getScenes({sortColumn:o,sortRule:t}),k.value.toUpperCase()!==o.toUpperCase()&&(e.sortColumnIndex^=1),V.value.toUpperCase()!==t.toUpperCase()&&(e.sortRuleIndex^=1)}function u(o){const{status:t,permissionTypeNum:p,applyStatus:v}=o;return p>0||t===1||t===2&&p===0&&v===1}function m(o){d().plusAccessCount(o.sceneNo),o.externalScene?window.open(o.externalScene):window.open(le+o.sceneNo)}function A(o){const{applyStatus:t}=o;if(t===0)return y.warning("该场景的申请正在审核中, 请稍后操作");u(o)?m(o):(i.applyScene=o,i.validateDays=7,i.applyReason="",i.applyDialogVisible=!0)}function r(){var b;const{validateDays:o,applyReason:t,applyScene:p}=i;if(!t||((b=t==null?void 0:t.trim())==null?void 0:b.length)===0)return y.warning("请输入申请理由");const{id:v}=p;d().applyScene({id:v,validDays:o,applyReason:t})}function D(o){const{sceneNo:t,topOrder:p}=o;Ve(t).then(v=>{v.code===$.SUCCESS?(e.requestParams.page=1,d().getScenes(),y({type:"success",message:p?"取消置顶成功":"置顶成功"})):y({type:"warning",message:"请求数据失败"})}).catch(v=>{y({type:"error",message:v.message})})}const ue=()=>{d().getScenes()};return ye(()=>{ue(),ke(T,o=>{const t=o[0],p=52,v=20+32,b=16,z=32;e.contentHeight=t.contentRect.height-(p+v+b+z)-16})}),(o,t)=>{const p=f("el-tab-pane"),v=f("el-tabs"),b=f("el-input"),z=f("CaretTop"),K=f("el-icon"),pe=f("CaretBottom"),P=f("el-col"),Z=f("el-row"),de=f("el-radio"),_e=f("el-radio-group"),Q=f("el-button"),fe=f("el-dialog"),me=Se("loading");return h(),C(M,null,[n(R(te),{ref_key:"containerRef",ref:T,background:""},{default:c(()=>[n(R(ee),{padding:"0 0"},{default:c(()=>[n(v,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=l=>w.value=l)},{default:c(()=>[n(p,{label:"全部资源",name:"all"}),n(p,{label:"公开场景",name:"open"}),n(p,{label:"受限场景",name:"limit"})]),_:1},8,["modelValue"]),a("div",ot,[st,n(b,{modelValue:e.requestParams.keyword,"onUpdate:modelValue":t[1]||(t[1]=l=>e.requestParams.keyword=l),placeholder:"请输入关键词搜索","prefix-icon":"search",clearable:"",onInput:R(E),onKeyup:Ce(L,["enter"])},null,8,["modelValue","onInput"])])]),_:1}),n(R(te),null,{default:c(()=>[n(R(ee),{padding:"1 1 0"},{default:c(()=>[a("div",at,[a("span",{class:H(["sort",{isActive:e.curSortType==="default"}]),onClick:U},"默认排序",2),(h(!0),C(M,null,G(e.sortTypes,l=>(h(),C("span",{key:l.type,class:"sort"},[a("span",{class:H(["sort-type",{isActive:e.curSortType===l.type}]),onClick:Y=>O(l.type)},g(l.title),11,nt),n(K,{class:H(["caret-top",{active:B(l.type)&&V.value==="ASC"}]),title:"递增",onClick:Y=>s(l.type,"ASC")},{default:c(()=>[n(z)]),_:2},1032,["class","onClick"]),n(K,{class:H(["caret-bottom",{active:B(l.type)&&V.value==="DESC"}]),title:"递减",onClick:Y=>s(l.type,"DESC")},{default:c(()=>[n(pe)]),_:2},1032,["class","onClick"])]))),128))])]),_:1}),n(R(be),null,{default:c(()=>[we(n(et,{height:e.contentHeight,data:e.scenes,onApply:A,onRefresh:d().getScenes,onRaiseTop:D},null,8,["height","data","onRefresh"]),[[me,e.loading]])]),_:1})]),_:1})]),_:1},512),n(fe,{modelValue:i.applyDialogVisible,"onUpdate:modelValue":t[5]||(t[5]=l=>i.applyDialogVisible=l),title:"场景使用申请",width:"700px"},{footer:c(()=>[a("span",ct,[n(Q,{onClick:t[4]||(t[4]=l=>i.applyDialogVisible=!1)},{default:c(()=>[S("取消")]),_:1}),n(Q,{type:"primary",onClick:r},{default:c(()=>[S("提交")]),_:1})])]),default:c(()=>[n(Z,{class:"dialog-row"},{default:c(()=>[n(P,{span:3,offset:2},{default:c(()=>[S("申请场景")]),_:1}),n(P,{span:17},{default:c(()=>{var l;return[S(g((l=i.applyScene)==null?void 0:l.sceneName),1)]}),_:1})]),_:1}),n(Z,{class:"dialog-row"},{default:c(()=>[n(P,{span:3,offset:2},{default:c(()=>[S("持续时间")]),_:1}),n(P,{span:17},{default:c(()=>[a("div",lt,[n(_e,{modelValue:i.validateDays,"onUpdate:modelValue":t[2]||(t[2]=l=>i.validateDays=l)},{default:c(()=>[(h(!0),C(M,null,G(i.radios,l=>(h(),j(de,{key:l.value,label:l.value},{default:c(()=>[S(g(l.title),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1}),n(Z,{class:"dialog-row"},{default:c(()=>[n(P,{span:3,offset:2,class:"required"},{default:c(()=>[S("申请理由")]),_:1}),n(P,{span:17},{default:c(()=>[n(b,{modelValue:i.applyReason,"onUpdate:modelValue":t[3]||(t[3]=l=>i.applyReason=l),type:"textarea","min-rows":3,rows:3,maxlength:100,placeholder:"请填写申请理由，不超过100字"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const vt=ce(rt,[["__scopeId","data-v-6e88afdc"]]);export{vt as default};
