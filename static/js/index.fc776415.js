import{d as E,b as z,r as B,w as Y,e as I,t as ue,o as b,x as h,k as a,g as c,j as d,l as T,v as re,f as A,B as u,z as x,u as y,U as P,ai as Q,c as L,N as j,aj as U,Q as F,ad as O,ak as Z,ae as de,F as ie,y as me,bG as ve,X as fe,p as ge,n as ye,L as be,S as _e,bH as Se}from"./element-plus.59ccb443.js";import{m as he,x as H,S as R,y as ee,z as ae,A as te,E as le,v as K,F as we,o as De,a as ke}from"./login.a4e9287e.js";import{s as Ce,a as Ne,b as Ie,g as G,c as $e,d as xe,e as Te}from"./userManage.ffbb234b.js";import{c as se}from"./tools.374228bf.js";import{i as X,a as J}from"./index.e0e8e942.js";import{j as M}from"./lodash.22f463b4.js";import{_ as W}from"./error.229cea25.js";import{_ as Ve}from"./ServiceInfoDialog.vue_vue_type_script_setup_true_lang.94bc06b6.js";import"../../app-config.js";import"./index.81042689.js";const ze=""+new URL("../svg/userCenter-fa1235eb.svg",import.meta.url).href,oe=new Map([[0,"待审核"],[1,"已通过"],[2,"已拒绝"],[3,"已过期"],[5,"已删除"]]),q=new Map([[7,"7天"],[30,"1个月"],[90,"3个月"],[36500,"永久"]]),Re={class:"modal-content","element-loading-text":"处理中..."},Ue=c("div",{class:"divider"},null,-1),Ae={class:"dialog-footer"},ce=E({__name:"ApprovalDialog",props:{visible:{type:Boolean,default:!1},type:{type:String,default:""},currentItem:{type:Object,default:()=>{}}},emits:["closed"],setup(p,{emit:w}){const m=w,l=p,t=z(""),D=B({dialogVisible:!1,isProcessing:!1});Y(()=>l.visible,S=>{D.dialogVisible=S});function v(){var S;(S=l.currentItem)!=null&&S.phone&&(t.value=he(l.currentItem.phone)||"")}function k(){m("closed")}return(S,$)=>{const f=I("el-form-item"),_=I("el-form"),C=I("el-button"),i=I("el-dialog"),g=ue("loading");return b(),h(i,{modelValue:D.dialogVisible,"onUpdate:modelValue":$[0]||($[0]=r=>D.dialogVisible=r),class:"approvalDialog_uc center-dialog",title:"审批单详情","close-on-click-modal":!1,width:"660px",top:"12vh",center:"","append-to-body":"",onOpen:v,onClosed:k},{footer:a(()=>[c("span",Ae,[d(C,{type:"primary",plain:"",onClick:k},{default:a(()=>[T("关 闭")]),_:1})])]),default:a(()=>[re((b(),A("div",Re,[d(_,{ref:"approvalForm",class:"approvalForm",model:p.currentItem,"label-width":"160px"},{default:a(()=>[p.type==="scene"?(b(),h(f,{key:0,label:"申请场景 : ",prop:"sceneName"},{default:a(()=>[c("span",null,u(p.currentItem.sceneName),1)]),_:1})):x("",!0),p.type==="service"?(b(),h(f,{key:1,label:"服务名称 : ",prop:"serviceName"},{default:a(()=>[c("span",null,u(p.currentItem.serviceName),1)]),_:1})):x("",!0),p.type==="service"?(b(),h(f,{key:2,label:"服务别名 : ",prop:"serviceAlisName"},{default:a(()=>[c("span",null,u(p.currentItem.serviceAlisName),1)]),_:1})):x("",!0),d(f,{label:"申请人 : ",prop:"applyName"},{default:a(()=>[c("span",null,u(p.currentItem.applyName),1)]),_:1}),d(f,{label:"所属部门 : ",prop:"applyBelongDept"},{default:a(()=>[c("span",null,u(p.currentItem.applyBelongDept),1)]),_:1}),d(f,{label:"手机号码 : ",prop:"phone"},{default:a(()=>[c("span",null,u(t.value),1)]),_:1}),d(f,{label:"电子邮箱 : ",prop:"email"},{default:a(()=>[c("span",null,u(p.currentItem.email),1)]),_:1}),d(f,{label:"申请时间 : ",prop:"applyTime"},{default:a(()=>[c("span",null,u(p.currentItem.applyTime),1)]),_:1}),d(f,{label:"有效期 : ",prop:"validDays"},{default:a(()=>[c("span",null,u(y(q).get(p.currentItem.validDays)||"7天"),1)]),_:1}),d(f,{label:"申请理由 : ",prop:"applyReason"},{default:a(()=>[c("span",null,u(p.currentItem.applyReason),1)]),_:1}),Ue,d(f,{class:"approvalStatus",label:"审核情况 : ",prop:"approvalStatus"},{default:a(()=>[c("span",{class:P([{primary:p.currentItem.approvalStatus===0},{success:p.currentItem.approvalStatus===1},{fail:p.currentItem.approvalStatus===2},{overtime:p.currentItem.approvalStatus===3||p.currentItem.approvalStatus===5}])},u(y(oe).get(p.currentItem.approvalStatus)||"— —"),3)]),_:1}),p.currentItem.approvalStatus!==0?(b(),h(f,{key:3,label:"审核人 : ",prop:"approvalName"},{default:a(()=>[c("span",null,u(p.currentItem.approvalName),1)]),_:1})):x("",!0),p.currentItem.approvalStatus!==0?(b(),h(f,{key:4,label:"审核时间 : ",prop:"approvalTime"},{default:a(()=>[c("span",null,u(p.currentItem.approvalTime),1)]),_:1})):x("",!0),p.currentItem.approvalStatus!==0&&p.currentItem.approvalStatus!==2?(b(),h(f,{key:5,label:"有效期 : ",prop:"validDays"},{default:a(()=>[c("span",null,u(y(q).get(p.currentItem.validDays)||"7天"),1)]),_:1})):x("",!0),p.currentItem.approvalStatus!==0?(b(),h(f,{key:6,label:"审核意见 : ",prop:"approvalReason"},{default:a(()=>[c("span",null,u(p.currentItem.approvalReason),1)]),_:1})):x("",!0)]),_:1},8,["model"])])),[[g,D.isProcessing]])]),_:1},8,["modelValue"])}}}),pe=E({__name:"ApplyDialog",props:{visible:{type:Boolean,default:!1},type:{type:String,default:""},currentItem:{type:Object,default:()=>{}}},emits:["closed","search"],setup(p,{emit:w}){const m=w,l={sceneApply:Ce,serviceApply:Ne},t=p,D=z(),v=B({dialogVisible:!1,form:{approvalId:"",id:"",sceneName:"",serviceName:"",serviceAlisName:"",validDays:7,applyReason:""},rules:{validDays:[{required:!0,message:"请选择有效天数",trigger:"change"}],applyReason:[{required:!0,message:"请输入申请理由",trigger:"blur"}]},isSubmiting:!1});Y(()=>t.visible,f=>{v.dialogVisible=f});function k(){const{type:f,currentItem:_}=t;f==="scene"?(v.form.sceneName=_.sceneName,v.form.id=_.sceneId):f==="service"&&(v.form.serviceName=_.serviceName,v.form.serviceAlisName=_.serviceAlisName,v.form.id=_.serviceId),v.form.approvalId=_.id,v.form.validDays=7,v.form.applyReason=""}function S(){m("closed")}function $(){var f;(f=D.value)==null||f.validate(_=>{if(_){v.isSubmiting=!0;const C=t.type==="scene"?"sceneApply":"serviceApply",{approvalId:i,id:g,validDays:r,applyReason:e}=v.form;l[C]({approvalId:i,id:g,validDays:r,applyReason:e}).then(o=>{o.code===R.SUCCESS?(Q({title:"提交成功",message:"请等待管理员回复",type:"success"}),m("search"),m("closed")):Q({title:"提交失败",message:"请重新提交申请",type:"warning"}),v.isSubmiting=!1}).catch(o=>{v.isSubmiting=!1,Q({title:"提交失败",message:"请重新提交申请",type:"warning"})})}else return!1})}return(f,_)=>{const C=I("el-form-item"),i=I("el-radio"),g=I("el-radio-group"),r=I("el-input"),e=I("el-form"),o=I("el-button"),s=I("el-dialog");return b(),h(s,{modelValue:v.dialogVisible,"onUpdate:modelValue":_[3]||(_[3]=n=>v.dialogVisible=n),class:"applyDialog_uc center-dialog",title:`${p.type==="scene"?"场景访问":"服务使用"}申请`,"close-on-click-modal":!1,width:"600px",top:"15vh","append-to-body":"",center:"",onOpen:k,onClosed:S},{footer:a(()=>[d(y(H),{justify:"end"},{default:a(()=>[d(o,{onClick:_[2]||(_[2]=n=>f.$emit("closed"))},{default:a(()=>[T("取 消")]),_:1}),d(o,{type:"primary",loading:v.isSubmiting,onClick:$},{default:a(()=>[T("提 交")]),_:1},8,["loading"])]),_:1})]),default:a(()=>[d(e,{ref_key:"formRef",ref:D,class:"applyForm",model:v.form,rules:v.rules,"label-width":"140px"},{default:a(()=>[p.type==="scene"?(b(),h(C,{key:0,label:"申请场景：",prop:"sceneName"},{default:a(()=>[c("span",null,u(v.form.sceneName),1)]),_:1})):x("",!0),p.type==="service"?(b(),h(C,{key:1,label:"服务名称：",prop:"serviceName"},{default:a(()=>[c("span",null,u(v.form.serviceName),1)]),_:1})):x("",!0),p.type==="service"?(b(),h(C,{key:2,label:"服务别名：",prop:"serviceAlisName"},{default:a(()=>[c("span",null,u(v.form.serviceAlisName),1)]),_:1})):x("",!0),d(C,{label:"使用时长：",prop:"validDays"},{default:a(()=>[d(g,{modelValue:v.form.validDays,"onUpdate:modelValue":_[0]||(_[0]=n=>v.form.validDays=n)},{default:a(()=>[d(i,{label:7},{default:a(()=>[T("7天")]),_:1}),d(i,{label:30},{default:a(()=>[T("1个月")]),_:1}),d(i,{label:90},{default:a(()=>[T("3个月")]),_:1}),p.type==="service"?(b(),h(i,{key:0,label:36500},{default:a(()=>[T("永久")]),_:1})):x("",!0)]),_:1},8,["modelValue"])]),_:1}),d(C,{label:"申请理由：",prop:"applyReason"},{default:a(()=>[d(r,{modelValue:v.form.applyReason,"onUpdate:modelValue":_[1]||(_[1]=n=>v.form.applyReason=n),type:"textarea",rows:4,maxlength:"50","show-word-limit":"",placeholder:"请填写申请理由",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Le={class:"num"},Me=["title"],Ee=["title"],Be={key:0,class:"data-status overtime"},Oe={key:1,class:"validDays"},Pe=["title"],je=["onClick"],He=E({__name:"SceneManageContent",setup(p,{expose:w}){const m=z(),l=z(),t=B({isLoadingTableData:!1,approvalStatus:"",keyword:"",currentPage:1,pageSize:15,pageSizes:[15,30,50,100],total:0,tableDataEmpty:[],tableData:[],totalNum:"",columns:[{label:"场景名称",prop:"sceneName",slot:"scene-name",width:250},{label:"申请理由",prop:"applyReason",slot:"apply-reason",minWidth:150},{label:"申请时间",prop:"applyTime",slot:"apply-time",minWidth:170},{label:"审核人",prop:"approvalName",slot:"approval-name",minWidth:180},{label:"场景链接",prop:"shareUri",slot:"share-uri",minWidth:150}],statusOptions:[{value:"",label:"所有"},{value:0,label:"待审核"},{value:1,label:"已通过"},{value:2,label:"已拒绝"},{value:3,label:"已过期"}],currentItem:{},approvalDialogVisible:!1,currentApplyItem:{},applyDialogVisible:!1}),D=[{label:"关键字",key:"keyword",type:"text",placeholder:"请输入关键字",span:4},{type:"select",label:"场景状态",key:"approvalStatus",value:t.approvalStatus,options:t.statusOptions,placeholder:"请选择场景状态",span:4}],v=L(()=>r=>({color:`var(--el-color-${{0:"primary",1:"success",2:"danger",3:"info",5:"info"}[`${r}`]})`}));j(()=>{k()});function k(){$(),S()}function S(r){r&&(t.approvalStatus=r==null?void 0:r.approvalStatus,t.keyword=r==null?void 0:r.keyword);const{approvalStatus:e,keyword:o,currentPage:s,pageSize:n}=t;t.isLoadingTableData=!0,Ie({approvalStatus:e,keyword:o,page:s,rows:n}).then(N=>{t.isLoadingTableData=!1,N.code===R.SUCCESS&&(t.tableData=N.data.records,t.total=N.data.total)}).catch(N=>{t.isLoadingTableData=!1,U({type:"error",message:N.message})})}function $(){G().then(r=>{const{code:e,data:o=[]}=r;if(e===R.SUCCESS){const s=o.find(n=>n.dataType==="scene").totalNum;t.totalNum=s||""}})}function f(r,e){r.stopPropagation();const{approvalStatus:o}=e;o===0?Z.confirm("重新申请后，当前审批单将自动撤销，是否继续？","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{t.currentApplyItem=M(e),t.applyDialogVisible=!0}).catch(()=>{}):(t.currentApplyItem=M(e),t.applyDialogVisible=!0)}function _(r){var e;(e=m.value)==null||e.sort(r.prop,r.order)}function C(r,e){e.label!=="操作"&&i(r)}function i(r){t.currentItem=M(r),t.approvalDialogVisible=!0}function g(r){se(r)}return w({getData:S}),(r,e)=>{const o=I("el-button");return b(),h(y(K),{id:"scene-manage"},{default:a(()=>[d(y(H),{justify:"space-between",padding:"1 1 0"},{default:a(()=>[c("span",Le,"场景概览 "+u(t.totalNum?`${t.totalNum}个`:""),1),d(y(ee),{ref_key:"SmartSearchRef",ref:l,justify:"end",width:"400px",options:D,onHandleSearch:S},null,512)]),_:1}),d(y(ae),{class:"table",padding:"0 1 1"},{default:a(()=>[d(y(te),{ref_key:"tableRef",ref:m,loading:t.isLoadingTableData,"element-loading-text":"拼命加载中...","table-data":t.tableData,columns:t.columns,"pagination-is-need":"","page-size":t.pageSize,"page-sizes":t.pageSizes,"current-page":t.currentPage,total:t.total,"desc-options":!1,"index-is-need":!1,"search-form-ref":l.value,onSizeChange:S,onCurrentChange:S,onRowDblclick:C,onSortChange:_},{"scene-name":a(({scope:s})=>[c("div",{class:"ellipsis1",title:s.row.sceneName},u(s.row.sceneName),9,Me),c("div",{style:F(v.value(s.row.approvalStatus))},u(y(oe).get(s.row.approvalStatus)||"数据异常"),5)]),"apply-reason":a(({scope:s})=>[c("span",{class:"ellipsis2",title:s.row.applyReason},u(s.row.applyReason),9,Ee)]),"apply-time":a(({scope:s})=>[c("div",null,u(s.row.applyTime),1),s.row.approvalStatus===5?(b(),A("div",Be,"已删除")):(b(),A("div",Oe,u(y(q).get(s.row.validDays)||""),1))]),"approval-name":a(({scope:s})=>[c("span",{class:"ellipsis2",title:s.row.approvalName},u(s.row.approvalName),9,Pe)]),"share-uri":a(({scope:s})=>[d(y(le),{text:`${y(X)}${s.row.shareUri}?tk=${s.row.token}`,"line-clamp":2},{content:a(({setSlotRef:n,ellipsis:N})=>[c("div",{ref:V=>n(V),title:"点击复制链接",class:P({copylink:!0,"db-text__ellipsis-2":N}),onClick:O(V=>g(`${y(X)}${s.row.shareUri}?tk=${s.row.token}`),["stop"])},u(`${y(X)}${s.row.shareUri}?tk=${s.row.token}`),11,je)]),_:2},1032,["text"])]),operation:a(({scope:s})=>[d(o,{disabled:s.row.approvalStatus===1||s.row.approvalStatus===5,type:"primary",text:"",onClick:n=>f(n,s.row)},{default:a(()=>[T("重新申请")]),_:2},1032,["disabled","onClick"])]),_:1},8,["loading","table-data","columns","page-size","page-sizes","current-page","total","search-form-ref"])]),_:1}),d(ce,{visible:t.approvalDialogVisible,"onUpdate:visible":e[0]||(e[0]=s=>t.approvalDialogVisible=s),type:"scene","current-item":t.currentItem,onClosed:e[1]||(e[1]=s=>t.approvalDialogVisible=!1)},null,8,["visible","current-item"]),d(pe,{visible:t.applyDialogVisible,"onUpdate:visible":e[2]||(e[2]=s=>t.applyDialogVisible=s),"current-item":t.currentApplyItem,type:"scene",onClosed:e[3]||(e[3]=s=>t.applyDialogVisible=!1),onSearch:S},null,8,["visible","current-item"])]),_:1})}}});const Ke=W(He,[["__scopeId","data-v-f2207e9b"]]),We={class:"num"},Fe=["title","onClick"],qe=["title","onClick"],Ge=["title"],Qe={key:0,class:"data-status overtime"},Xe={key:1,class:"validDays"},Je=["onClick"],Ye=E({__name:"ServiceManageContent",setup(p){const w=z(),m=z(),l=B({isLoadingTableData:!1,approvalStatus:"",keyword:"",currentPage:1,pageSize:15,pageSizes:[15,30,50,100],total:0,tableDataEmpty:[],tableData:[],totalNum:"",statusOptions:[{value:"",label:"所有"},{value:0,label:"待审核"},{value:1,label:"已通过"},{value:2,label:"已拒绝"},{value:3,label:"已过期"}],serviceItem:{},infoDialogVisible:!1,currentItem:{},approvalDialogVisible:!1,currentApplyItem:{},applyDialogVisible:!1,columns:[{label:"服务名称",prop:"serviceName",slot:"service-name"},{label:"服务别名",prop:"serviceAlisName",slot:"service-alis-name"},{label:"申请理由",prop:"applyReason",slot:"apply-reason"},{label:"申请时间",prop:"applyTime",slot:"apply-time"},{label:"服务链接",prop:"serviceUrl",slot:"service-url",minWidth:200}]}),{getElColor:t}=we(),D=[{label:"关键字",key:"keyword",type:"text",placeholder:"请输入关键字",span:4,value:l.keyword},{type:"select",label:"服务状态",key:"approvalStatus",value:l.approvalStatus,options:l.statusOptions,span:4}],v=L(()=>e=>({color:t(`--el-color-${{0:"primary",1:"success",2:"danger",3:"info",5:"info"}[`${e}`]}`)}));j(()=>{k()});function k(){$(),S()}function S(e){e&&(l.keyword=e==null?void 0:e.keyword,l.approvalStatus=e==null?void 0:e.approvalStatus);const{approvalStatus:o,keyword:s,currentPage:n,pageSize:N}=l;l.isLoadingTableData=!0,$e({approvalStatus:o,keyword:s,page:n,rows:N}).then(V=>{l.isLoadingTableData=!1,V.code===R.SUCCESS&&(l.tableData=V.data.records,l.total=V.data.total)}).catch(V=>{l.isLoadingTableData=!1,U({type:"error",message:V.message})})}function $(){G().then(e=>{const{code:o,data:s=[]}=e;if(o===R.SUCCESS){const n=s.find(N=>N.dataType==="service").totalNum;l.totalNum=n||""}})}function f(e,o){e.stopPropagation();const{approvalStatus:s}=o;s===0?Z.confirm("重新申请后，当前审批单将自动撤销，是否继续？","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{l.currentApplyItem=M(o),l.applyDialogVisible=!0}).catch(()=>{}):(l.currentApplyItem=M(o),l.applyDialogVisible=!0)}function _(e){se(e)}function C(e,o,s){(o.label!=="操作"&&o.label!=="服务链接"||o.label==="服务链接"&&s.target.tagName!=="DIV")&&g(e)}function i(e){if(e.approvalStatus===5)return U.info("该服务已经删除");l.serviceItem=M(e),l.infoDialogVisible=!0}function g(e){l.currentItem=M(e),l.approvalDialogVisible=!0}function r(e){var o;(o=w.value)==null||o.sort(e.prop,e.order)}return(e,o)=>{const s=I("el-button");return b(),h(y(K),{id:"service-manage"},{default:a(()=>[d(y(H),{justify:"space-between",padding:"1 1 0"},{default:a(()=>[c("span",We,"服务概览 "+u(l.totalNum?`${l.totalNum}个`:""),1),d(y(ee),{ref_key:"SmartSearchRef",ref:m,justify:"end",width:"400px",options:D,onHandleSearch:S},null,512)]),_:1}),d(y(ae),{padding:"0 1 1"},{default:a(()=>[d(y(te),{ref_key:"tableRef",ref:w,loading:l.isLoadingTableData,"element-loading-text":"拼命加载中...","table-data":l.tableData,"pagination-is-need":"","page-size":l.pageSize,"page-sizes":l.pageSizes,"current-page":l.currentPage,total:l.total,columns:l.columns,"search-form-ref":m.value,"desc-options":!1,"index-is-need":!1,onSizeChange:S,onCurrentChange:S,onRowDblclick:C,onSortChange:r},{"service-name":a(({scope:n})=>[c("div",{class:"ellipsis1 link",title:n.row.serviceName,onClick:O(N=>i(n.row),["stop"])},u(n.row.serviceName),9,Fe),c("div",{style:F(v.value(n.row.approvalStatus))},u(y(oe).get(n.row.approvalStatus)||"数据异常"),5)]),"service-alis-name":a(({scope:n})=>[c("span",{class:"ellipsis2 link",title:n.row.serviceAlisName,onClick:O(N=>i(n.row),["stop"])},u(n.row.serviceAlisName),9,qe)]),"apply-reason":a(({scope:n})=>[c("span",{class:"ellipsis2",title:n.row.applyReason},u(n.row.applyReason),9,Ge)]),"apply-time":a(({scope:n})=>[c("div",null,u(n.row.applyTime),1),n.row.approvalStatus===5?(b(),A("div",Qe,"已删除")):(b(),A("div",Xe,u(y(q).get(n.row.validDays)||""),1))]),"service-url":a(({scope:n})=>[n.row.isPassed?(b(),h(y(le),{key:0,text:n.row.serviceUrl,"line-clamp":2},{content:a(({setSlotRef:N,ellipsis:V})=>[c("div",{ref:ne=>N(ne),title:"点击复制链接",class:P({copylink:!0,"db-text__ellipsis-2":V}),onClick:O(ne=>_(n.row.serviceUrl),["stop"])},u(n.row.serviceUrl),11,Je)]),_:2},1032,["text"])):x("",!0)]),operation:a(({scope:n})=>[d(s,{type:"primary",text:"",disabled:n.row.approvalStatus===1||n.row.approvalStatus===5,onClick:O(N=>f(N,n.row),["stop"])},{default:a(()=>[T("重新申请")]),_:2},1032,["disabled","onClick"])]),_:1},8,["loading","table-data","page-size","page-sizes","current-page","total","columns","search-form-ref"])]),_:1}),d(Ve,{visible:l.infoDialogVisible,"onUpdate:visible":o[0]||(o[0]=n=>l.infoDialogVisible=n),"custom-class":"serviceInfoDialog_uc center-dialog","dialog-top":"15vh","append-to-body":"","is-apply":"","current-item":l.serviceItem,onClosed:o[1]||(o[1]=n=>l.infoDialogVisible=!1)},null,8,["visible","current-item"]),d(ce,{visible:l.approvalDialogVisible,"onUpdate:visible":o[2]||(o[2]=n=>l.approvalDialogVisible=n),type:"service","current-item":l.currentItem,onClosed:o[3]||(o[3]=n=>l.approvalDialogVisible=!1)},null,8,["visible","current-item"]),d(pe,{visible:l.applyDialogVisible,"onUpdate:visible":o[4]||(o[4]=n=>l.applyDialogVisible=n),type:"service","current-item":l.currentApplyItem,onClosed:o[5]||(o[5]=n=>l.applyDialogVisible=!1),onSearch:S},null,8,["visible","current-item"])]),_:1})}}});const Ze=W(Ye,[["__scopeId","data-v-a80b6cea"]]),ea={class:"num"},aa=["title"],ta={class:"ellipsis1"},la=["onClick"],sa=E({__name:"ShareManageContent",setup(p){const w=z(),m=B({isLoadingTableData:!1,shareStatus:"",keyword:"",currentPage:1,pageSize:15,pageSizes:[15,30,50,100],total:0,tableDataEmpty:[],tableData:[],totalNum:"",statusOptions:[{value:"",label:"所有"},{value:0,label:"未过期"},{value:1,label:"已过期"},{value:2,label:"已取消"}],columns:[{label:"场景名称",prop:"sceneName",slot:"scene-name",minWidth:250},{label:"创建人",prop:"creator",slot:"creator"},{label:"分享链接",prop:"shortCode",slot:"short-code",minWidth:180},{label:"分享时间",prop:"startTime",slot:"start-time",minWidth:100},{label:"访问次数",prop:"assessCount",slot:"assess-count"}]}),l=[{label:"关键字",key:"keyword",type:"text",placeholder:"请输入关键字",span:4,value:m.keyword},{type:"select",label:"服务状态",key:"approvalStatus",value:m.shareStatus,options:m.statusOptions,span:4}],t=L(()=>i=>{const{sceneStatus:g,sceneNo:r}=i,e={1:"primary",2:"warning"};return r?{color:`var(--el-color-${e[`${g}`]})`}:{color:"var(--el-color-info)"}});j(()=>{D()});function D(){k(),v()}function v(i){i&&(m.keyword=i==null?void 0:i.keyword,m.shareStatus=i==null?void 0:i.shareStatus);const{shareStatus:g,keyword:r,currentPage:e,pageSize:o}=m;m.isLoadingTableData=!0,xe({shareStatus:g,keyword:r,page:e,rows:o}).then(s=>{m.isLoadingTableData=!1,s.code===R.SUCCESS&&(m.tableData=s.data.records,m.total=s.data.total)}).catch(s=>{m.isLoadingTableData=!1,U({type:"error",message:s.message})})}function k(){G().then(i=>{const{code:g,data:r=[]}=i;if(g===R.SUCCESS){const e=r.find(o=>o.dataType==="share").totalNum;m.totalNum=e||""}})}function S(i,g){i.stopPropagation(),Z.confirm("取消分享后链接将失效，确定取消分享吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Te(g.id).then(r=>{r.code===R.SUCCESS?(U({type:"success",message:"取消分享成功!"}),k(),v()):U({type:"warning",message:"取消分享失败!"})}).catch(r=>{U({type:"error",message:r.message})})}).catch(()=>{})}function $(i){const{shortCode:g}=i;return`${/^(http|\/\/)/.test(J)?J:window.location.origin+window.location.pathname.slice(0,-1)+J.replace(/^(\.\.?)/,"")}#/share/${g}`}function f(i){se(i)}function _(i){const{shareStatus:g,deadTime:r,sceneStatus:e}=i;if(g===0&&r){if(e===1)return"永久";const o=(new Date(r).getTime()-new Date().getTime())/(24*60*60*1e3);return`${Math.floor(o)}天后过期`}else{if(g===1)return"已过期";if(g===2)return"已取消"}return i.effectiveDay}const C=L(()=>i=>({color:`var(--el-color-${{0:"primary",1:"info",2:"info"}[`${i}`]})`}));return(i,g)=>{const r=I("el-button");return b(),h(y(K),{id:"share-manage"},{default:a(()=>[d(y(H),{justify:"space-between",padding:"1 1 0"},{default:a(()=>[c("span",ea,"分享概览 "+u(m.totalNum?`${m.totalNum}个`:""),1),d(y(ee),{ref_key:"SmartSearchRef",ref:w,justify:"end",width:"400px",options:l,onHandleSearch:v},null,512)]),_:1}),d(y(ae),{padding:"0 1 1"},{default:a(()=>[d(y(te),{ref:"tableRef",loading:m.isLoadingTableData,"element-loading-text":"拼命加载中...","table-data":m.tableData,columns:m.columns,"pagination-is-need":"","page-size":m.pageSize,"page-sizes":m.pageSizes,total:m.total,"current-page":m.currentPage,"search-form-ref":w.value,"index-is-need":!1,"desc-options":!1,onSizeChange:v,onCurrentChange:v},{"scene-name":a(({scope:e})=>[c("div",{class:"ellipsis1",title:e.row.sceneName},u(e.row.sceneName),9,aa),c("div",{style:F(t.value)},u(e.row.sceneNo===null?"已删除":e.row.sceneStatus===1?"公开":"受限"),5)]),creator:a(({scope:e})=>[c("span",ta,u(e.row.creator),1)]),"short-code":a(({scope:e})=>[d(y(le),{text:$(e.row),"line-clamp":2},{content:a(({setSlotRef:o,ellipsis:s})=>[c("div",{ref:n=>o(n),title:"点击复制链接",class:P({copylink:!0,"db-text__ellipsis-2":s}),onClick:O(n=>f($(e.row)),["stop"])},u($(e.row)),11,la)]),_:2},1032,["text"]),re(c("div",{class:"token"}," 提取码 ："+u(e.row.token),513),[[de,e.row.sceneStatus===2&&e.row.token]])]),"start-time":a(({scope:e})=>[c("div",null,u(e.row.startTime),1),c("div",{style:F(C.value(e.row.shareStatus))},u(_(e.row)),5)]),"access-count":a(({scope:e})=>[c("span",null,u(e.row.accessCount),1)]),operation:a(({scope:e})=>[d(r,{type:"primary",text:"",disabled:e.row.shareStatus!==0,onClick:o=>S(o,e.row)},{default:a(()=>[T("取消分享")]),_:2},1032,["disabled","onClick"])]),_:1},8,["loading","table-data","columns","page-size","page-sizes","total","current-page","search-form-ref"])]),_:1})]),_:1})}}});const oa=W(sa,[["__scopeId","data-v-4ce4119f"]]),na={class:"userInfo align-center"},ia={class:"info"},ra={key:0,class:"avatar"},ca={class:"more"},pa={class:"name"},ua={class:"userData align-center"},da={class:"data"},ma=["onClick"],va=E({__name:"Main",props:{curKey:{type:String,default:"scene"},userInfo:{type:Object,required:!0}},emits:["changeTabName"],setup(p,{emit:w}){const m=w,l=p,t=B({first:void 0,activeKey:"scene",dataList:[{dataType:"scene",title:"场景",totalNum:""},{dataType:"service",title:"服务",totalNum:""},{dataType:"share",title:"分享",totalNum:""}]}),D=z(),v={scene:Ke,service:Ze,share:oa},k=L(()=>v[t.activeKey]);Y(()=>t.activeKey,i=>{i&&$()}),j(()=>{t.activeKey=l.curKey,S()});function S(){var i;$(),t.first=t.first||0,t.first&&((i=D.value)==null||i.getData()),t.first++}function $(){G().then(i=>{i.code===R.SUCCESS&&(t.dataList=i.data,t.dataList.forEach(g=>{g.totalNum=g.totalNum??0}))}).catch(i=>{U({type:"error",message:i.message})})}const f=L(()=>{var r;const i=((r=l.userInfo.name)==null?void 0:r.substring(0,1))||"",g=i.charCodeAt(0);return g>=97&&g<=122?i.toUpperCase():i}),_=L(()=>l.userInfo.avatarInfo?l.userInfo.avatarInfo.url:ze);function C(i){t.activeKey=i,m("changeTabName",t.activeKey)}return(i,g)=>{const r=I("el-avatar"),e=I("el-divider");return b(),h(y(K),{ref:"overview",background:""},{default:a(()=>[d(y(H),{class:"overview__container"},{default:a(()=>[c("div",na,[c("div",ia,[p.userInfo?(b(),A("div",ra,[d(r,{size:64,src:_.value},{default:a(()=>[T(u(f.value),1)]),_:1},8,["src"])])):x("",!0),c("div",ca,[c("div",pa,u(p.userInfo.name),1)])])]),c("div",ua,[c("div",da,[(b(!0),A(ie,null,me(t.dataList,(o,s)=>(b(),A(ie,{key:s},[c("span",{class:P({"is-active":t.activeKey===o.dataType}),onClick:n=>C(o.dataType)},u(o.title)+"   "+u(o.totalNum),11,ma),s!==2?(b(),h(e,{key:s,direction:"vertical"})):x("",!0)],64))),128))])])]),_:1}),(b(),h(ve,null,[(b(),h(fe(k.value),{ref_key:"overviewList",ref:D,name:k.value},null,8,["name"]))],1024))]),_:1},512)}}});const fa=W(va,[["__scopeId","data-v-a3e3ad1e"]]);function ga(p){const w=B({maxHeight:500});ge("maxHeight",L(()=>w.maxHeight)),j(()=>{ye(()=>{setTimeout(()=>{m()},200)}),De(window,"resize",m)}),be(()=>{ke(window,"resize",m)});function m(){var l,t;w.maxHeight=((t=(l=p.value)==null?void 0:l.querySelector(".common-manage .table"))==null?void 0:t.offsetHeight)||500}return{..._e(w),resize:m}}const ya=E({__name:"index",props:{userInfo:{type:Object,required:!0}},setup(p){const w=p,m=z(),l=z("scene"),{resize:t}=ga(m);Se(()=>{setTimeout(()=>{D()},500)});function D(){t()}function v(k){l.value=k}return(k,S)=>(b(),h(y(K),{class:"p-16"},{default:a(()=>[d(fa,{"user-info":w.userInfo,"cur-key":l.value,onChangeTabName:v},null,8,["user-info","cur-key"])]),_:1}))}});const $a=W(ya,[["__scopeId","data-v-cb6c5171"]]);export{$a as default};
